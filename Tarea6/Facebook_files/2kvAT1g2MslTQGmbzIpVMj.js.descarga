;/*FB_PKG_DELIM*/

__d("useFDSProgressRingSvg.react",["FDSProgressRingUtils","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||(h=d("react"));b=h;var j=b.useMemo,k=b.useRef,l=2;function a(a){var b=a.color,c=a.isHidden,e=a.size,f=k(null),g=k(null),h=k(null);a=d("FDSProgressRingUtils").getRingColor(b);var m=a.backgroundColor,n=a.foregroundColor,o=(e-l)*Math.PI;b=j(function(){return i.jsxs(i.Fragment,{children:[i.jsx("svg",{className:"x1ey2m1c x9f619 xds687c x17qophe x10l6tqk x13vifvy",height:e,ref:f,viewBox:"0 0 "+e+" "+e,width:e,children:i.jsx("circle",{cx:e/2,cy:e/2,fill:"none","non-scaling-stroke":"non-scaling-stroke",r:(e-l)/2,stroke:m,strokeLinecap:"round",strokeWidth:l})}),i.jsx("div",{className:"x1ey2m1c xds687c xtzzx4i x6ikm8r x10wlt62 x10l6tqk x13vifvy",children:i.jsx("svg",{className:"x1ey2m1c x9f619 xds687c x1ytbgms x10l6tqk x13vifvy x1jpgh95",height:e,ref:g,viewBox:"0 0 "+e+" "+e,width:e,children:i.jsx("circle",{cx:e/2,cy:e/2,fill:"none","non-scaling-stroke":"non-scaling-stroke",r:(e-l)/2,stroke:n,strokeDasharray:o/2,strokeDashoffset:3*o/4,strokeWidth:l,style:{visibility:c?"hidden":void 0}})})}),i.jsx("div",{className:"x1ey2m1c x8cgc45 x17qophe x6ikm8r x10wlt62 x10l6tqk x13vifvy",children:i.jsx("svg",{className:"x1ey2m1c x9f619 x14l5gr7 x17qophe x10l6tqk x13vifvy x1jpgh95",height:e,ref:h,viewBox:"0 0 "+e+" "+e,width:e,children:i.jsx("circle",{cx:e/2,cy:e/2,fill:"none","non-scaling-stroke":"non-scaling-stroke",r:(e-l)/2,stroke:n,strokeDasharray:o/2,strokeDashoffset:o/4,strokeWidth:l,style:{visibility:c?"hidden":void 0}})})})]})},[e,m,n,o,c]);return{backgroundRef:f,leftCircleRef:h,progressRing:b,rightCircleRef:g}}g["default"]=a}),98);
__d("CometProgressRingDeterminate.react",["BaseLoadingStateElement.react","react","useFDSProgressRingSvg.react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||(h=d("react")),j=h.useEffect,k={rootDiv:{position:"x1n2onr6",$$css:!0}};function a(a){var b=a.color,d=a.percentage,e=a.size,f=a["aria-label"];a=a["aria-labelledby"];b=c("useFDSProgressRingSvg.react")({color:b,isHidden:!1,size:e});var g=b.leftCircleRef,h=b.progressRing,l=b.rightCircleRef;j(function(){var a=l.current,b=g.current;if(a==null||b==null)return;if(!(a instanceof SVGSVGElement)||!(b instanceof SVGSVGElement))return;var c=Math.max(0,Math.min(100,d))/100*360;a.style.transform="rotate("+Math.min(c,180)+"deg)";b.style.transform="rotate("+Math.max(c-180,0)+"deg)"},[g,d,l]);return i.jsx(c("BaseLoadingStateElement.react"),{"aria-label":f,"aria-labelledby":a,progress:d,style:{height:e,width:e},xstyle:k.rootDiv,children:h})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("LSBumpE2EEMetadataThread",["LSCancelTaskByQueueName","LSIssueNewTask"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return d[0]=new c.Map(),d[0].set("bump_timestamp_ms",a[1]),d[0].set("thread_key",a[0]),d[0].set("bumped_by_local_device_send",a[2]),d[0].set("tam_thread_subtype",c.i64.cast([0,0])),d[0].set("wa_jid",void 0),d[0].set("message_ephemeral_duration_in_sec",c.i64.cast([0,0])),d[0].set("message_product_type",void 0),d[0].set("is_message_deletion",!1),d[0].set("is_unbump",a[3]),d[1]=d[0].get("thread_key"),d[0],c.storedProcedure(b("LSCancelTaskByQueueName"),c.i64.to_string(d[1]),c.i64.cast([0,389]))},function(e){return d[2]=new c.Map(),d[2].set("bump_timestamp_ms",a[1]),d[2].set("thread_key",a[0]),d[2].set("bumped_by_local_device_send",a[2]),d[2].set("tam_thread_subtype",c.i64.cast([0,0])),d[2].set("wa_jid",void 0),d[2].set("message_ephemeral_duration_in_sec",c.i64.cast([0,0])),d[2].set("message_product_type",void 0),d[2].set("is_message_deletion",!1),d[2].set("is_unbump",a[3]),d[3]=d[2].get("thread_key"),d[2],d[4]=c.toJSON(d[2]),c.storedProcedure(b("LSIssueNewTask"),c.i64.to_string(d[3]),c.i64.cast([0,389]),d[4],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSE2EEMessagingMetadataMailboxBumpE2EEMetadataThreadStoredProcedure";e.exports=a}),null);
__d("LSBumpE2EEMetadataThreadStoredProcedure",["LSBumpE2EEMetadataThread","cr:8709"],(function(a,b,c,d,e,f,g){function a(a,b){var d=[];d[0]=b.threadKey;d[1]=b.serverAuthoritativeTimestampMs;d[2]=b.bumpedByLocalDeviceSend;d[3]=b.isUnbump;return c("LSBumpE2EEMetadataThread").apply(void 0,d.concat([a]))}g["default"]=a}),98);
__d("LSClearMessagePlaceholderRangeStoredProcedure",["LSClearMessagePlaceholderRange","cr:8709"],(function(a,b,c,d,e,f,g){function a(a,b){var d=[];d[0]=b.threadKey;d[1]=b.messageId;d[2]=b.maxTimestampMs;return c("LSClearMessagePlaceholderRange").apply(void 0,d.concat([a]))}g["default"]=a}),98);
__d("LSCoreClientFolderType",[],(function(a,b,c,d,e,f){a=Object.freeze({INBOX:0,PENDING:1,OTHER:2,SPAM:3,ARCHIVED:4,HIDDEN:5,MARKETPLACE:12,RESTRICTED:15,INTEROP:19});f["default"]=a}),66);
__d("LSCreateE2EEMetadataThread",["LSIssueNewTask"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return d[0]=new c.Map(),d[0].set("wa_jid",a[0]),d[0].set("offline_thread_key",a[1]),d[0].set("thread_type",a[2]),d[0].set("folder_type",a[3]),d[0].set("bump_timestamp_ms",a[4]),d[0].set("tam_thread_subtype",c.i64.cast([0,0])),d[0].set("created_by_local_device",a[5]),d[1]=d[0].get("offline_thread_key"),d[0],d[2]=c.toJSON(d[0]),c.storedProcedure(b("LSIssueNewTask"),c.i64.to_string(d[1]),c.i64.cast([0,388]),d[2],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))},function(a){return c.resolve(e)}])}a.__sproc_name__="LSE2EEMessagingMetadataMailboxCreateE2EEMetadataThreadStoredProcedure";e.exports=a}),null);
__d("LSCreateE2EEMetadataThreadStoredProcedure",["LSCreateE2EEMetadataThread","cr:8709"],(function(a,b,c,d,e,f,g){function a(a,b){var d=[];d[0]=b.waJid;d[1]=b.offlineThreadKey;d[2]=b.threadType;d[3]=b.folderType;d[4]=b.bumpTimestampMs;d[5]=b.createdByLocalDevice;return c("LSCreateE2EEMetadataThread").apply(void 0,d.concat([a]))}g["default"]=a}),98);
__d("LSCreateOfflineThreadingIDStoredProcedure",["LSCreateOfflineThreadingID","cr:8709"],(function(a,b,c,d,e,f,g){function a(a,b){var d=[];d[0]=b.timestampMs;return c("LSCreateOfflineThreadingID").apply(void 0,d.concat([a]))}g["default"]=a}),98);
__d("LSInsertNewMessageRangeStoredProcedure",["LSInsertNewMessageRange","cr:8709"],(function(a,b,c,d,e,f,g){function a(a,b){var d=[];d[0]=b.threadKey;d[1]=b.newMinTs;d[2]=b.newMaxTs;d[3]=b.newMinMid;d[4]=b.newMaxMid;d[5]=b.lowerOverlap;d[6]=b.upperOverlap;d[7]=b.hasMoreBefore;d[8]=b.hasMoreAfter;d[9]=b.requestedMessageId;return c("LSInsertNewMessageRange").apply(void 0,d.concat([a]))}g["default"]=a}),98);
__d("LSScheduleOccamThreadsIntegrityCheckerStoredProcedure",["LSScheduleOccamThreadsIntegrityChecker","cr:8709"],(function(a,b,c,d,e,f,g){function a(a,b){b===void 0&&(b={});var d=[];d[0]=b.delayMs;d[1]=b.maxThreadCount;return c("LSScheduleOccamThreadsIntegrityChecker").apply(void 0,d.concat([a]))}g["default"]=a}),98);
__d("LSThreadPointQueryAndRestoreMessagesWithGroupJID",["LSIssueNewTask"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return d[0]=new c.Map(),d[0].set("wa_jid",a[0]),d[0].set("tam_thread_subtype",c.i64.cast([0,0])),d[1]=d[0].get("wa_jid"),d[0],d[2]=c.toJSON(d[0]),c.storedProcedure(b("LSIssueNewTask"),c.i64.to_string(d[1]),c.i64.cast([0,1021]),d[2],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))},function(a){return c.resolve(e)}])}a.__sproc_name__="LSE2EEMessagingMetadataMailboxThreadPointQueryAndRestoreMessagesWithGroupJIDStoredProcedure";e.exports=a}),null);
__d("LSThreadPointQueryAndRestoreMessagesWithGroupJIDStoredProcedure",["LSThreadPointQueryAndRestoreMessagesWithGroupJID","cr:8709"],(function(a,b,c,d,e,f,g){function a(a,b){var d=[];d[0]=b.waJid;return c("LSThreadPointQueryAndRestoreMessagesWithGroupJID").apply(void 0,d.concat([a]))}g["default"]=a}),98);
__d("LSUpdateE2EEMetadataParticipants",["LSIssueNewTask"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return d[0]=new c.Map(),d[0].set("thread_key",a[0]),d[0].set("user_self_remove",!1),d[1]=d[0].get("thread_key"),d[0],d[2]=c.toJSON(d[0]),c.storedProcedure(b("LSIssueNewTask"),c.i64.to_string(d[1]),c.i64.cast([0,394]),d[2],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))},function(a){return c.resolve(e)}])}a.__sproc_name__="LSE2EEMessagingMetadataMailboxUpdateE2EEMetadataParticipantsStoredProcedure";e.exports=a}),null);
__d("LSUpdateE2EEMetadataParticipantsStoredProcedure",["LSUpdateE2EEMetadataParticipants","cr:8709"],(function(a,b,c,d,e,f,g){function a(a,b){var d=[];d[0]=b.threadKey;return c("LSUpdateE2EEMetadataParticipants").apply(void 0,d.concat([a]))}g["default"]=a}),98);
__d("LSUpsertAttachmentRange",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.sequence([function(c){return b.forEach(b.db.table(17).fetch([[[a[0],a[1]]]]),function(a){return a["delete"]()})},function(c){return b.db.table(17).add({threadKey:a[0],mediaGroup:a[1],minTimestampMs:a[2],maxTimestampMs:b.i64.cast([2328,1316134911]),hasMoreBefore:a[3],hasMoreAfter:!1,isLoadingBefore:!1,isLoadingAfter:!1,lastLoadedMessageId:a[4]})}])},function(a){return b.resolve(c)}])}a.__sproc_name__="LSMailboxUpsertAttachmentRangeStoredProcedure";e.exports=a}),null);
__d("LSUpsertAttachmentRangeStoredProcedure",["LSUpsertAttachmentRange","cr:8709"],(function(a,b,c,d,e,f,g){function a(a,b){var d=[];d[0]=b.threadKey;d[1]=b.mediaGroup;d[2]=b.newMinTs;d[3]=b.hasMoreBefore;d[4]=b.newLastLoadedMessageId;return c("LSUpsertAttachmentRange").apply(void 0,d.concat([a]))}g["default"]=a}),98);
__d("MessengerWaitForEvent",["Promise"],(function(a,b,c,d,e,f){"use strict";var g;function a(a,c,d){var e,f=d;return new(g||(g=b("Promise")))(function(b){f?e=function(){f.apply(this,arguments)&&b.apply(this,arguments)}:e=b,a==null?void 0:a.addEventListener==null?void 0:a.addEventListener(c,e)})["finally"](function(){a==null?void 0:a.removeEventListener==null?void 0:a.removeEventListener(c,e)})}f.waitForEvent=a}),66);
__d("LocalStorageMutex",["MessengerWaitForEvent","Promise","QPLUserFlow","err","pageID","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i=null,j=1e3,k=c("qpl")._(1056847375,"584");a=function(){function a(a){var b=this,d=a.mutexKey,e=a.localTakeoverKey,f=a.log,g=a.logError,h=a.getStorage,i=a.setItemGuarded,k=a.mutexTimeoutMs;k=k===void 0?j:k;a=a.mutexTimeoutCallback;this.mutexFilter=function(a){if(a.key!==b.$1)return!1;a=a.newValue||"";return!a.includes(c("pageID"))};this.$1=d;this.$2=e;this.$5=h;this.$6=i;this.$3=f;this.$4=g;this.$7=k;this.$8=a}var e=a.prototype;e.init=function(){c("QPLUserFlow").start(k);this.$3("APPMUTEX - this tab is "+c("pageID"));var a=this.getMutex();if(a===c("pageID")){this.$3("APPMUTEX - WE ALREADY HAVE THE MUTEX LOCK WITHIN INIT");c("QPLUserFlow").endSuccess(k);return(h||(h=b("Promise"))).resolve(!0)}if(a!=null){this.$3("APPMUTEX - initiating localTAKEOVER");return this.localTakeover()}else{this.$3("APPMUTEX - NO1 ELSE IS ALIVE, GET THE MUTEX");a=this.$9(c("pageID"));var d=this.$10(c("pageID"));if(!a.success||!d.success){c("QPLUserFlow").addAnnotations(k,{bool:{setMutexResult:d.success,setTakeoverResult:a.success},string:{setMutexError:d.error,setTakeoverError:a.error}});c("QPLUserFlow").endFailure(k,"fail_to_set_takeover_or_mutex");return(h||(h=b("Promise"))).resolve(!1)}c("QPLUserFlow").endSuccess(k);return(h||(h=b("Promise"))).resolve(!0)}};e.localTakeover=function(){var a,e=this,f=this.$9(c("pageID"));if(!f.success){c("QPLUserFlow").addAnnotations(k,{string:{initTakeoverError:f.error}});c("QPLUserFlow").endFailure(k,"local_takeover_init_takeover_failure");return(h||(h=b("Promise"))).resolve(!1)}var g,i=function(){g!=null&&clearTimeout(g)};f=d("MessengerWaitForEvent").waitForEvent(window,"storage",this.mutexFilter);var l=(a=this.$7)!=null?a:j;return(h||(h=b("Promise"))).race([f,new h(function(a){g=setTimeout(function(){a()},l)}),this.$8?this.$8():new(h||(h=b("Promise")))(function(a){})]).then(function(a){if(a==null){e.$3("AppMutex - Forcefully took the mutex and takeover lock");var b=e.$9(c("pageID")),d=e.$10(c("pageID"));if(!b.success||!d.success){c("QPLUserFlow").addAnnotations(k,{string:{setMutexError:d.error,setTakeoverError:b.error}});c("QPLUserFlow").endFailure(k,"local_takeover_forcefully_takeover_failure");return!1}c("QPLUserFlow").endSuccess(k);return!0}e.$3("APPMUTEX - GOT MUTEX STORAGE EVENT CHANGE FROM ANOTHER TAB");d=e.$11(a.newValue);if(!d&&e.hasTakeoverPermission()){e.$3("APPMUTEX - setting mutex on localtakeover");b=e.$10(c("pageID"));if(!b.success){c("QPLUserFlow").addAnnotations(k,{string:{setMutexError:b.error}});c("QPLUserFlow").endFailure(k,"local_takeover_set_mutex_failure");return!1}c("QPLUserFlow").endSuccess(k);return!0}else{e.hasTakeoverPermission()&&e.$12();c("QPLUserFlow").endFailure(k,"local_takeover_no_takeover_permission");return!1}}).then(function(a){i();return a})["catch"](function(a){i();e.$4("AppMutex - localTakeover error no permission - "+a);c("QPLUserFlow").endFailure(k,"local_takeover_general_failure");return!1})};e.onMutexDeath=function(){var a=this.getMutex();a!=null&&a===c("pageID")&&(this.$3("APPMUTEX - removing mutex on death"),this.$13(),this.hasTakeoverPermission()&&this.$12())};e.takeoverFilter=function(a){if(a.key!==this.$2)return!1;a=a.newValue||"";return!a.includes(c("pageID"))};e.$14=function(){if(!i){var a=this.$5();if(!a)throw c("err")("Could not get localStorage");i=a}return i};e.getMutex=function(){i=this.$14();return i.getItem(this.$1)};e.$10=function(a){i=this.$14();return this.$6(i,this.$1,a)};e.$13=function(){i=this.$14(),i.removeItem(this.$1)};e.getTakeover=function(){i=this.$14();return i.getItem(this.$2)};e.$9=function(a){i=this.$14();return this.$6(i,this.$2,a)};e.$12=function(){i=this.$14(),i.removeItem(this.$2)};e.$11=function(a){return a!=null?a:""};e.hasTakeoverPermission=function(){var a=this.getTakeover();return a!=null&&a===c("pageID")};return a}();g.THIS_TAB=c("pageID");g.LocalStorageMutex=a}),98);
__d("MAWAppMutex",["LocalStorageMutex","MAWLocalStorage","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h="armadillo_msgr_mutex",i="armadillo_msgr_local_takeover",j=null;function a(){j==null&&(j=new(d("LocalStorageMutex").LocalStorageMutex)({getStorage:d("MAWLocalStorage").getStorage,localTakeoverKey:i,log:function(a){d("WALogger").LOG([a])},logError:function(a){d("WALogger").ERROR([a])},mutexKey:h,setItemGuarded:d("MAWLocalStorage").setItemGuarded}));return j}g.MAW_MUTEX_KEY=h;g.MAW_LOCALTAKEOVER_KEY=i;g.use=a}),98);
__d("waitForMiActMappingForUniversalSearch",["FBLogger","I64","LSAuthorityLevel","LSFactory","LSThreadPointQueryAndRestoreMessagesWithGroupJIDStoredProcedure","LSThreadPointQueryAndRestoreMessagesWithJIDStoredProcedure","MAWCurrentUser","Promise","ReQL","WAJids","asyncToGeneratorRuntime","emptyFunction","err","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=3e4,k=3e4;function l(a){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield d("ReQL").toArrayAsync(a));return a.some(function(a){return a==null||(i||(i=d("I64"))).lt(a.authorityLevel,(i||(i=d("I64"))).of_int32(c("LSAuthorityLevel").AUTHORITATIVE))})===!1});return m.apply(this,arguments)}function n(a,b,c,d){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g){f===void 0&&(f=c("emptyFunction"));g===void 0&&(g=c("emptyFunction"));var h=(i||(i=d("I64"))).of_string(d("MAWCurrentUser").getID()),j=d("ReQL").leftJoin(d("ReQL").fromTableAscending(a.tables.participants,["contactId"]).getKeyRange(e.serverThreadKey).filter(function(a){return!(i||(i=d("I64"))).equal(a.contactId,h)}),d("ReQL").fromTableAscending(a.tables.contacts)).map(function(a){a[0];a=a[1];return a}),m=null,n={contents:function(){}};function o(){f(e),n.contents()}if(yield l(j))return o();n.contents=j.subscribe(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){if(b.operation==="delete")return;m!=null&&window.clearTimeout(m);if(yield l(j))return o()});return function(b,c){return a.apply(this,arguments)}}());m=window.setTimeout(function(){n.contents(),g(c("err")("Contacts timed out"))},k)});return o.apply(this,arguments)}function a(a,b){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){var g=(i||(i=d("I64"))).of_string(d("WAJids").threadIdForChatJid(e)),k=d("WAJids").interpretAsGroupJid(e)!=null,l=d("ReQL").fromTableAscending(a.tables.mi_act_mapping_table.index("jid")).getKeyRange(g);e=(yield d("ReQL").firstAsync(l));if(e!=null){yield n(a,e);return(h||(h=b("Promise"))).resolve(e)}var m=null,o=new(h||(h=b("Promise")))(function(d,e){var f={contents:function(){}};function g(a){f.contents(),d(a)}function h(a){f.contents(),e(a)}f.contents=l.subscribe(function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b,c){if(c.operation==="delete")return;m!=null&&window.clearTimeout(m);yield n(a,c.value,g,h)});return function(a,b){return c.apply(this,arguments)}}());m=window.setTimeout(function(){h(c("err")("MiActMapping timed out"))},j)});c("promiseDone")(a.runInTransaction(function(a){return k?c("LSThreadPointQueryAndRestoreMessagesWithGroupJIDStoredProcedure")(c("LSFactory")(a),{waJid:g}):c("LSThreadPointQueryAndRestoreMessagesWithJIDStoredProcedure")(c("LSFactory")(a),{waJid:g})},"readwrite",void 0,void 0,f.id+":148"));try{e=(yield o)}catch(a){c("FBLogger")("mw_message_search").warn("Issue waiting for mi_act_mapping to be ready",a)}return e});return p.apply(this,arguments)}g["default"]=a}),98);
__d("MAWBridgeAddMessageSearchResultHandler",["I64","JSResourceForInteraction","LSIntEnum","LSMessageSearchType","MAWCurrentUser","MAWFTSRawStringMatcher","MAWMiActOnMiThreadReadyForJid","Promise","ReQL","asyncToGeneratorRuntime","isMAWUniversalSearchWithEBEnabled","waitForMiActMappingForUniversalSearch"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=c("JSResourceForInteraction")("MWInboxSecureContentSearch").__setRef("MAWBridgeAddMessageSearchResultHandler"),l=c("JSResourceForInteraction")("addMAWBridgeSearchMessagesToUniversalSearch").__setRef("MAWBridgeAddMessageSearchResultHandler"),m=(j||(j=d("LSIntEnum"))).ofNumber(c("LSMessageSearchType").MESSAGE),n=j.ofNumber(c("LSMessageSearchType").THREAD);function a(a,c,d){return d.length===0?(h||(h=b("Promise"))).resolve():(h||(h=b("Promise"))).all([q(a,c,d),s(a,c,d)]).then(function(){})}function o(a,b){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=(yield d("MAWFTSRawStringMatcher").load());return b.filter(function(b){b=(b=b.msg)==null?void 0:b.content;return b==null?!1:c(a,b)})});return p.apply(this,arguments)}function q(a,b,c){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e){var f=(yield d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(c.message_search_queries).getKeyRange(m)));if(f.length===0)return;return d("MAWMiActOnMiThreadReadyForJid").onMiThreadReadyForJid(c,e[0].chatJid,"MAWBridgeAddMessageSearchResultHandler",function(c,g){return b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var b=f.filter(function(a){return(i||(i=d("I64"))).equal(a.threadKeyV2,g)})[0];if(b==null)return;var h=b.query;if(h==null||h.length<2)return;var j=(i||(i=d("I64"))).to_int32(b.resultCount);h=(yield o(h,e));if(h.length===0)return;var l=(yield k.load());l=l.addBridgeSearchMsgsToSearchResult;yield l(a,c,b.query,h,j+h.length,i.of_string(d("MAWCurrentUser").getID()))})().then(function(){})})});return r.apply(this,arguments)}function s(a,b,c){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){if(!c("isMAWUniversalSearchWithEBEnabled")())return;var f=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(b.message_search_queries).getKeyRange(n).filter(function(a){return(i||(i=d("I64"))).equal(a.threadKeyV2,i.one)})));if(f==null)return;var g=f.query;if(g==null||g.length<2)return;var h=(yield o(g,e));if(h.length===0)return;var j=(yield l.load());yield c("waitForMiActMappingForUniversalSearch")(a,e[0].chatJid);return d("MAWMiActOnMiThreadReadyForJid").onMiThreadReadyForJid(b,e[0].chatJid,"MAWBridgeAddMessageSearchResultHandler",function(b,c){return j(a,b,c,g,h,f)})});return t.apply(this,arguments)}g.call=a}),98);
__d("getMAWLastMessageCtaType",["MAWLocalizationType"],(function(a,b,c,d,e,f,g){"use strict";function a(a){switch(a){case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_MISSED_AUDIO_CALL:return"xma_rtc_missed_audio";case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_MISSED_AUDIO_CALL:return"xma_rtc_missed_group_audio";case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_MISSED_VIDEO_CALL:return"xma_rtc_missed_video";case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_MISSED_VIDEO_CALL:return"xma_rtc_missed_group_video"}}g["default"]=a}),98);
__d("MAWBridgeCentralizedThreadUpdateHandler",["FBLogger","I64","LSBumpE2EEMetadataThreadStoredProcedure","LSFactory","LSOptimisticMarkThreadReadV2StoredProcedure","MAWBridgeBuildThreadSnippet","MAWMiActOnMiThreadReadyForJid","MAWODSProxy","MAWThreadBumpType","MAWThreadUpdateType","ReQL","WALoggerDeferred","WAOdsEnums","asyncToGeneratorRuntime","getMAWLastMessageCtaType","gkx","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Occamadillo][Middleware] Updated thread via middleware. threadKey: ",", bumpTimestampMs: ",",\n    original lastActivityTimestampMs: ","\n    , isMessageAuthorMe: ",", bumpType: ",", threadUpdateType: ",",  from ",""]);i=function(){return a};return a}function a(a,e){return d("MAWMiActOnMiThreadReadyForJid").onMiThreadReadyForJid(a,e.jid,"CentralizedThreadUpdate",function(){var f=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b,f){var g=e.bumpTimestampMs,i=e.isMessageAuthorMe,k=e.threadBumpType,m=e.threadUpdateType,q=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(b.threads).getKeyRange(f)));if(q==null){c("FBLogger")("CentralizedThreadUpdate").mustfix("[Occamadillo][Middleware] missing thread for bumping threadKey: %s",(h||(h=d("I64"))).to_string(f));return}var r=q.lastActivityTimestampMs;if(m===d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD||m===d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.MARK_THREAD_AS_UNREAD||e.isUnbump){q=(yield l(e,q));m!==d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.MARK_THREAD_AS_UNREAD&&(q=(yield n(g,q)));if(k===d("MAWThreadBumpType").THREAD_BUMP_TYPE.LOCAL_AND_SERVER){k={readWatermarkTimestampMs:g,threadKey:f};i={bumpedByLocalDeviceSend:i,isUnbump:e.isUnbump,serverAuthoritativeTimestampMs:g,threadKey:f};yield j(c("LSFactory")(b),k,i,m)}}var s=o(e.centralizedThreadSnippetData,q);return a.threads.put(s).then(function(){q!=null&&p(e,r,s)})});return function(a,b){return f.apply(this,arguments)}}())}function j(a,b,c,d){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f){f!==d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.MARK_THREAD_AS_UNREAD&&(d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_THREAD_UPDATE_MIDDLEWARE,key:"$MarkThreadReadOnOccam"}),yield c("LSOptimisticMarkThreadReadV2StoredProcedure")(a,b));return c("LSBumpE2EEMetadataThreadStoredProcedure")(a,e)});return k.apply(this,arguments)}function l(a,b){return!m(a,b)?b:babelHelpers["extends"]({},b,{lastActivityTimestampMs:a.bumpTimestampMs})}function m(a,b){return a.isUnbump?(h||(h=d("I64"))).lt(a.bumpTimestampMs,b.lastActivityTimestampMs):(h||(h=d("I64"))).gt(a.bumpTimestampMs,b.lastActivityTimestampMs)}function n(a,b){return babelHelpers["extends"]({},b,{lastReadWatermarkTimestampMs:a})}function o(a,b){if(c("gkx")("6478"))return b;var e=a.snippetSenderContactId!=null?(h||(h=d("I64"))).of_string(a.snippetSenderContactId):(h||(h=d("I64"))).zero,f=c("getMAWLastMessageCtaType")(a.snippetType);a=d("MAWBridgeBuildThreadSnippet").buildBridgeThreadSnippet(a,b.snippet);return babelHelpers["extends"]({},b,{lastMessageCtaType:f,snippet:a,snippetSenderContactId:e})}function p(a,b,e){c("promiseDone")(d("WALoggerDeferred").LOG(i(),(h||(h=d("I64"))).to_string(e.threadKey),h.to_string(e.lastActivityTimestampMs),h.to_string(b),a.isMessageAuthorMe,a.threadBumpType,a.threadUpdateType,a.description))}g.call=a}),98);
__d("MAWBridgeDeleteGroupInviteHandler",["LSThreadBitOffset","MAWMiActOnMiThreadReadyForJid","Promise","ReQL","asyncToGeneratorRuntime","justknobx","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,e){return d("MAWMiActOnMiThreadReadyForJid").onMiThreadReadyForJid(a,e.threadJid,"MAWBridgeDeleteGroupInviteHandler",function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(e,f){var g=(yield d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(e.group_invites).getKeyRange(f)));return(h||(h=b("Promise"))).all(g.map(function(a){return e.group_invites["delete"](a.threadKey,a.inviterId,a.inviteeId)})).then(function(){if(!c("justknobx")._("1162"))return;c("promiseDone")(d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.threads).getKeyRange(f)),function(b){if(b==null)return;var c=d("LSThreadBitOffset").clear([105],b.capabilities,b.capabilities2,b.capabilities3,b.capabilities4),e=c[0],f=c[1],g=c[2];c=c[3];return a.threads.put(babelHelpers["extends"]({},b,{capabilities:e,capabilities2:f,capabilities3:g,capabilities4:c,snippet:void 0}))})})});return function(a,b){return e.apply(this,arguments)}}())}g.call=a}),98);
__d("MAWBridgeDeleteMessageRangesV2Handler",["I64","MAWMiActOnMiThreadReadyForJid"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){return d("MAWMiActOnMiThreadReadyForJid").onMiThreadReadyForJid(a,b.threadJid,"MAWBridgeDeleteMessageRangesV2Handler",function(a,c){return a.messages_ranges_v2__generated["delete"](c,(h||(h=d("I64"))).of_float(b.minTimestampMs),b.minMsgId)})}g.call=a}),98);
__d("MAWBridgeEditMsgHistoryAddedHandler",["I64","LSMessageSendStatus","MAWChatJid","Promise","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(a,b){return{messageContent:a.msgContent.content,originalMessagePk:a.originalMsgId,pk:a.editMsgHistoryId,sendStatus:a.sendStatus!=null?(i||(i=d("I64"))).of_int32(a.sendStatus):(i||(i=d("I64"))).of_int32(c("LSMessageSendStatus").SERVER_RECEIVED),serverAdjustedEditTsMs:(i||(i=d("I64"))).of_int32(a.editTs),threadKey:b}}function k(a,b,c){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){a=(yield d("MAWChatJid").toThreadKey(a.tables,c.threadJid,"MAWBridgeEditMsgHistoryAddedHandler"));c=j(c,a);return b.edit_message_history.put(c)});return l.apply(this,arguments)}function a(a,c,d){return(h||(h=b("Promise"))).all(d.map(function(b){return k(a,c,b)})).then(function(){})}g.composeEditHistoryMsg=j;g.call=a}),98);
__d("MAWBridgeFulfillRestorePromisePayloadHandler",["MAWAsyncEBPendingQueryPromise","MAWEBRestoreTrackingUtils","Promise","err"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){a.success?(d("MAWAsyncEBPendingQueryPromise").resolvePendingQueryUponReStore(a.value.traceId),d("MAWEBRestoreTrackingUtils").markEBRestoreSuccess(a.value.traceId)):(d("MAWAsyncEBPendingQueryPromise").rejectPendingQueryIfPresent(a.error.traceId,c("err")(a.error.message)),d("MAWEBRestoreTrackingUtils").markEBRestoreFail(a.error.traceId));return(h||(h=b("Promise"))).resolve()}g.call=a}),98);
__d("MAWBridgeGroupInfoUpdatedHandler",["MAWMiActOnMiThreadReadyForJid","ReQL","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a,c){return d("MAWMiActOnMiThreadReadyForJid").onMiThreadReadyForJid(a,c.chatJid,"MAWBridgeGroupInfoUpdatedHandler",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e;e=(e=c.threadName)!=null?e:void 0;a=a.threads;b=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a).getKeyRange(b)));if(b==null)return;var f=c.memberAddMode!=="all_member_add";yield a.put(babelHelpers["extends"]({},b,{needsAdminApprovalForNewParticipant:f,threadName:e}))});return function(b,c){return a.apply(this,arguments)}}())}g.call=a}),98);
__d("MAWBridgeGroupInviteLoadedHandler",["fbt","I64","LSMessagingThreadTypeUtil","MAWMiActOnMiThreadReadyForJid","ReQL","asyncToGeneratorRuntime","justknobx"],(function(a,b,c,d,e,f,g,h){"use strict";var i;function j(a,b,c){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){var f=a.threads,g=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(f).getKeyRange(e)));if(g==null)return;var j=d("LSMessagingThreadTypeUtil").isGroup(g.threadType);if(!j)return;j=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.group_invites).getKeyRange(e)));if(j==null){c("justknobx")._("1162")&&(yield f.put(babelHelpers["extends"]({},g,{additionalThreadContext:void 0})));return}e=(i||(i=d("I64"))).equal((i||(i=d("I64"))).of_string(b.actorId),j.inviterId)?null:yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.contacts,["name"]).getKeyRange(j.inviterId));if(e==null)return;b=h._("__JHASH__UJFQkCMRFkv__JHASH__",[h._param("Inviter Name",e.name)]).toString();a=g.folderName==="inbox"?h._("__JHASH__4F6x7gUU1-S__JHASH__").toString():g.additionalThreadContext;yield f.put(babelHelpers["extends"]({},g,{additionalThreadContext:a,snippet:b}))});return k.apply(this,arguments)}function a(a,b){return d("MAWMiActOnMiThreadReadyForJid").onMiThreadReadyForJid(a,b.threadJid,"MAWBridgeGroupInviteLoadedHandler",function(a,c){return j(a,b,c)})}g.callWithoutWaitingForAnything=j;g.call=a}),226);
__d("MAWBridgeGroupInviteUpdateHandler",["I64","MAWMiActOnMiThreadReadyForJid","MAWUpdateLSThreadCapabilities","Promise"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a,c){return d("MAWMiActOnMiThreadReadyForJid").onMiThreadReadyForJid(a,c.threadJid,"MAWBridgeGroupInviteUpdateHandler",function(a,e){var f=(i||(i=d("I64"))).of_string(c.inviterId);return(h||(h=b("Promise"))).all([d("MAWUpdateLSThreadCapabilities").setGroupInviteTxn(a,e,f)]).then(function(){})})}g.call=a}),98);
__d("MAWBridgeHandleCOPDigest",["Promise"],(function(a,b,c,d,e,f){"use strict";var g;function a(a,c){return(g||(g=b("Promise"))).resolve()}f.call=a}),66);
__d("MAWBridgeMediaExpiredHandler",["MAWMiActOnMiThreadReadyForJid","gkx"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("MAWMiActOnMiThreadReadyForJid").onMiThreadReadyForJid(a,b.threadJid,"MAWBridgeMediaExpiredHandler.bs",function(a,d){if(c("gkx")("2419"))return a.attachments["delete"](d,b.msgId,String(b.plaintextHash));else return a.attachments["delete"](d,b.msgId,String(b.mediaId))})}g.call=a}),98);
__d("MAWBridgeMsgRangeLoadedHandler",["I64","LSFactory","LSInsertNewMessageRangeStoredProcedure","MAWMiActOnMiThreadReadyForJid","MAWTimeUtils","Promise","WALogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["No messages found for thread "," with message id ",""]);j=function(){return a};return a}function a(a,e){if(e.rangeExtensionType==null){d("WALogger").ERROR(j(),e.threadJid,e.offsetMsgId);return(i||(i=b("Promise"))).resolve()}return d("MAWMiActOnMiThreadReadyForJid").onMiThreadReadyForJid(a,e.threadJid,"MAWBridgeMsgRangeLoadedHandler",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var f,g,i,j,k,l;f=((f=e.rangeExtensionType)==null?void 0:f.minMsgTs)!=null?(h||(h=d("I64"))).of_float(e.rangeExtensionType.minMsgTs):d("MAWTimeUtils").MIN_TIMESTAMP_MS;g=((g=e.rangeExtensionType)==null?void 0:g.maxMsgTs)!=null?(h||(h=d("I64"))).of_float(e.rangeExtensionType.maxMsgTs):d("MAWTimeUtils").MAX_TIMESTAMP_MS;i=(i=(i=e.rangeExtensionType)==null?void 0:i.minMsgId)!=null?i:"";j=(j=(j=e.rangeExtensionType)==null?void 0:j.maxMsgId)!=null?j:"";k=(k=(k=e.rangeExtensionType)==null?void 0:k.hasMoreBefore)!=null?k:!1;l=(l=(l=e.rangeExtensionType)==null?void 0:l.hasMoreAfter)!=null?l:!1;var m=e.offsetMsgId;yield c("LSInsertNewMessageRangeStoredProcedure")(c("LSFactory")(a),{hasMoreAfter:l,hasMoreBefore:k,lowerOverlap:f,newMaxMid:j,newMaxTs:g,newMinMid:i,newMinTs:f,requestedMessageId:m,threadKey:b,upperOverlap:g})});return function(b,c){return a.apply(this,arguments)}}())}g.call=a}),98);
__d("MAWBridgeMsgUpdatedHandler",["FBLogger","I64","LSIntEnum","MAWAckLevel","MAWAdminMsgCTA","MAWMiActOnMiThreadReadyForJid","MAWMsgReplySnippet","MAWUpdateMsg","MWChatInteraction","QPLUserFlow","ReQL","asyncToGeneratorRuntime","gkx","qpl","sendToSentQPLUtils"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(a,b){var e=d("MWChatInteraction").get(d("MWChatInteraction").s2sKey(a)),f=c("gkx")("4851");a=(a=d("sendToSentQPLUtils").getS2sKeyFromOfflineMessageId(a))!=null?a:f?b.instanceKey:null;if(e!=null){f=d("MAWAckLevel").levelToMessagingSendStatusV2(b.ack);(h||(h=d("I64"))).equal(f,(i||(i=d("LSIntEnum"))).ofNumber(2))?d("MWChatInteraction").addMarkerPoint(e,"received_successful_server_ack"):(h||(h=d("I64"))).equal(f,(i||(i=d("LSIntEnum"))).ofNumber(4))&&d("MWChatInteraction").addMarkerPoint(e,"received_failure_server_ack")}if(a!=null){f=d("MAWAckLevel").levelToMessagingSendStatusV2(b.ack);(h||(h=d("I64"))).equal(f,(i||(i=d("LSIntEnum"))).ofNumber(2))?c("QPLUserFlow").endSuccess(c("qpl")._(25313175,"1551"),{instanceKey:a}):(h||(h=d("I64"))).equal(f,(i||(i=d("LSIntEnum"))).ofNumber(4))?c("QPLUserFlow").endFailure(c("qpl")._(25313175,"1551"),"error_from_server",{instanceKey:a}):(c("QPLUserFlow").addAnnotations(c("qpl")._(25313175,"1551"),{"int":{messageAckResponse:b.ack}},{instanceKey:a}),c("QPLUserFlow").addPoint(c("qpl")._(25313175,"1551"),"unexpected_ack_response",{instanceKey:a}))}else c("FBLogger")("messenger_e2ee_web").info("s2sInstanceKey is null for type %s",b.type_)}function k(a){a=d("sendToSentQPLUtils").getS2sKeyFromOfflineMessageId(a);a!=null&&c("QPLUserFlow").endFailure(c("qpl")._(25313175,"1551"),"message_not_found",{instanceKey:a})}function a(a,e){return d("MAWMiActOnMiThreadReadyForJid").onMiThreadReadyForJid(a,e.chatJid,"MAWBridgeMsgUpdatedHandler",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var f,g=(yield (f=d("ReQL")).firstAsync(f.fromTableAscending(a.messages.index("messageId")).getKeyRange(e.msgId)));f=(yield f.firstAsync(f.fromTableAscending(a.attachments).getKeyRange(b,e.msgId)));if(g==null){c("FBLogger")("messenger_e2ee_web").info("existing message is null for type %s, and attachment is null: %s",e.type_,f==null);f&&f.offlineAttachmentId!=null&&k(f==null?void 0:f.offlineAttachmentId);return}f=[g.offlineThreadingId,f==null?void 0:f.offlineAttachmentId];f.forEach(function(a){a!=null&&j(a,e)});f=(yield d("MAWAdminMsgCTA").getAdminMsgCtaStep(a,b,e));b=(yield d("MAWMsgReplySnippet").getReplySnippet(e));return d("MAWUpdateMsg").call(a,e,g,f,b)});return function(b,c){return a.apply(this,arguments)}}())}g.logServerAckToS2S=j;g.call=a}),98);
__d("MAWBridgeMsgsLoadedHandler",["I64","LSClearMessagePlaceholderRangeStoredProcedure","LSFactory","LSInsertNewMessageRangeStoredProcedure","MAWMiActOnMiThreadReadyForJid","MAWTimeUtils","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){return d("MAWMiActOnMiThreadReadyForJid").onMiThreadReadyForJid(a,b.chatJid,"MAWBridgeMsgsLoadedHandler",function(a,e){return c("LSClearMessagePlaceholderRangeStoredProcedure")(c("LSFactory")(a),{maxTimestampMs:d("MAWTimeUtils").MAX_TIMESTAMP_MS,messageId:"",threadKey:e}).then(function(){if(c("gkx")("23927")){var f,g,i,j,k,l,m,n;f=(f=(f=b.rangeExtensionType)==null?void 0:f.hasMoreBefore)!=null?f:!1;g=(g=(g=b.rangeExtensionType)==null?void 0:g.hasMoreAfter)!=null?g:!1;i=f&&((i=b.rangeExtensionType)==null?void 0:i.minMsgTs)!=null?(h||(h=d("I64"))).of_float(b.rangeExtensionType.minMsgTs):d("MAWTimeUtils").MIN_TIMESTAMP_MS;j=g&&((j=b.rangeExtensionType)==null?void 0:j.maxMsgTs)!=null?(h||(h=d("I64"))).of_float(b.rangeExtensionType.maxMsgTs):d("MAWTimeUtils").MAX_TIMESTAMP_MS;k=(k=(k=b.rangeExtensionType)==null?void 0:k.minMsgId)!=null?k:"";l=(l=(l=b.rangeExtensionType)==null?void 0:l.maxMsgId)!=null?l:"";m=((m=b.rangeExtensionType)==null?void 0:m.rangeKind)==="before"?i:d("MAWTimeUtils").MIN_TIMESTAMP_MS;n=((n=b.rangeExtensionType)==null?void 0:n.rangeKind)==="after"?j:d("MAWTimeUtils").MAX_TIMESTAMP_MS;return c("LSInsertNewMessageRangeStoredProcedure")(c("LSFactory")(a),{hasMoreAfter:g,hasMoreBefore:f,lowerOverlap:m,newMaxMid:l,newMaxTs:j,newMinMid:k,newMinTs:i,threadKey:e,upperOverlap:n})}else{f=((g=b.rangeExtensionType)==null?void 0:g.minMsgTs)!=null?(h||(h=d("I64"))).of_float(b.rangeExtensionType.minMsgTs):d("MAWTimeUtils").MIN_TIMESTAMP_MS;l=((m=b.rangeExtensionType)==null?void 0:m.maxMsgTs)!=null?(h||(h=d("I64"))).of_float(b.rangeExtensionType.maxMsgTs):d("MAWTimeUtils").MAX_TIMESTAMP_MS;i=(k=(j=b.rangeExtensionType)==null?void 0:j.minMsgId)!=null?k:"";m=(g=(n=b.rangeExtensionType)==null?void 0:n.maxMsgId)!=null?g:"";k=((j=b.rangeExtensionType)==null?void 0:j.rangeKind)==="extensionBefore"?f:d("MAWTimeUtils").MIN_TIMESTAMP_MS;g=((n=b.rangeExtensionType)==null?void 0:n.rangeKind)==="extensionAfter"?l:d("MAWTimeUtils").MAX_TIMESTAMP_MS;j=(n=(j=b.rangeExtensionType)==null?void 0:j.hasMoreBefore)!=null?n:!1;n=(n=(n=b.rangeExtensionType)==null?void 0:n.hasMoreAfter)!=null?n:!1;return c("LSInsertNewMessageRangeStoredProcedure")(c("LSFactory")(a),{hasMoreAfter:n,hasMoreBefore:j,lowerOverlap:k,newMaxMid:m,newMaxTs:l,newMinMid:i,newMinTs:f,threadKey:e,upperOverlap:g})}})})}g.call=a}),98);
__d("MAWBridgeNewMediaRangeHandler",["I64","LSFactory","LSIntEnum","LSThreadMediaGalleryGroup","LSUpsertAttachmentRangeStoredProcedure","MAWMiActOnMiThreadReadyForJid","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(a,b){return d("MAWMiActOnMiThreadReadyForJid").onMiThreadReadyForJid(a,b.threadJid,"MAWBridgeNewMediaRangeHandler",function(a,e){var f=c("gkx")("2616")===!0?(h||(h=d("I64"))).of_float(b.earliestLoadedMediaTs):(h||(h=d("I64"))).of_int32(b.earliestLoadedMediaTs),g=b.hasMoreBefore,j=b.mediaGalleryGroup;return c("LSUpsertAttachmentRangeStoredProcedure")(c("LSFactory")(a),{hasMoreBefore:g,mediaGroup:j!=null&&c("gkx")("1338")===!0?(i||(i=d("LSIntEnum"))).ofNumber(j):(i||(i=d("LSIntEnum"))).ofNumber(c("LSThreadMediaGalleryGroup").PHOTOS_AND_VIDEOS),newLastLoadedMessageId:b.lastLoadedMessageId,newMinTs:f,threadKey:e})})}function a(a,b){return j(a,b).then(function(){})}g.call=a}),98);
__d("MAWCreateOptimisticThread",["I64","LSAuthorityLevel","LSCreateOfflineThreadingIDStoredProcedure","LSFactory","LSIntEnum","LSMailboxType","LSRtcCallState","ReQL","WAJids","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield c("LSCreateOfflineThreadingIDStoredProcedure")(c("LSFactory")(a),{timestampMs:(h||(h=d("I64"))).of_float(Date.now())}));b=b[0];var e={authorityLevel:(i||(i=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").OPTIMISTIC),folderName:"inbox",lastReadWatermarkTimestampMs:h.of_float(0),mailboxType:i.ofNumber(c("LSMailboxType").MESSENGER),ongoingCallState:i.ofNumber(c("LSRtcCallState").NO_ONGOING_CALL),parentThreadKey:h.zero,threadKey:b,threadType:i.ofNumber(15)};yield a.threads.put(e);return b});return k.apply(this,arguments)}function l(a,b){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){b=(h||(h=d("I64"))).of_string(d("WAJids").threadIdForChatJid(b));return(a=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.mi_act_mapping_table.index("jid")).getKeyRange(b))))==null?void 0:a.serverThreadKey});return m.apply(this,arguments)}function a(a,b){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=(h||(h=d("I64"))).of_string(d("WAJids").threadIdForChatJid(b));b=(yield l(a,b));if(b!=null)return b;b=(yield j(a));yield a.mi_act_mapping_table.add({clientThreadPk:c,jid:c,serverThreadKey:b});return b});return n.apply(this,arguments)}g.createOptimisticThread=j;g.getThreadKey=l;g.getOrCreateOptimisticThreadKey=a}),98);
__d("MAWFolderUtils",["LSCoreClientFolderType","LSIntEnum","MAWFolderTypes","MessagingFolderTag"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){switch(a){case d("MAWFolderTypes").PENDING:return c("MessagingFolderTag").PENDING;case d("MAWFolderTypes").OTHER:return c("MessagingFolderTag").OTHER;case d("MAWFolderTypes").SPAM:return c("MessagingFolderTag").SPAM;case d("MAWFolderTypes").ARCHIVED:return c("MessagingFolderTag").UNKNOWN;default:return c("MessagingFolderTag").INBOX}}function b(a){switch(a){case d("MAWFolderTypes").PENDING:return(h||(h=d("LSIntEnum"))).ofNumber(-101);case d("MAWFolderTypes").OTHER:return(h||(h=d("LSIntEnum"))).ofNumber(-102);case d("MAWFolderTypes").SPAM:return(h||(h=d("LSIntEnum"))).ofNumber(-103);case d("MAWFolderTypes").ARCHIVED:return(h||(h=d("LSIntEnum"))).ofNumber(-110);default:return(h||(h=d("LSIntEnum"))).ofNumber(-100)}}function e(a){switch(a){case d("MAWFolderTypes").INBOX:return(h||(h=d("LSIntEnum"))).ofNumber(c("LSCoreClientFolderType").INBOX);case d("MAWFolderTypes").PENDING:return(h||(h=d("LSIntEnum"))).ofNumber(c("LSCoreClientFolderType").PENDING);case d("MAWFolderTypes").OTHER:return(h||(h=d("LSIntEnum"))).ofNumber(c("LSCoreClientFolderType").OTHER);case d("MAWFolderTypes").SPAM:return(h||(h=d("LSIntEnum"))).ofNumber(c("LSCoreClientFolderType").SPAM);case d("MAWFolderTypes").ARCHIVED:return(h||(h=d("LSIntEnum"))).ofNumber(c("LSCoreClientFolderType").ARCHIVED)}}function f(a){switch(a){case(h||(h=d("LSIntEnum"))).ofNumber(-1):return(h||(h=d("LSIntEnum"))).ofNumber(-101);case(h||(h=d("LSIntEnum"))).ofNumber(-2):return(h||(h=d("LSIntEnum"))).ofNumber(-102);case(h||(h=d("LSIntEnum"))).ofNumber(-3):return(h||(h=d("LSIntEnum"))).ofNumber(-103);case(h||(h=d("LSIntEnum"))).ofNumber(-10):return(h||(h=d("LSIntEnum"))).ofNumber(-110);default:return(h||(h=d("LSIntEnum"))).ofNumber(-100)}}g.getMessagingFolderTag=a;g.getClientSystemFolder=b;g.systemFolderToLSCoreClientFolder=e;g.systemFolderToClientSystemFolder=f}),98);
__d("MAWThreadDefaults",["fbt","I64","LSBitOffset","LSIntEnum","qex"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j;function k(){if(c("qex")._("327")===!0)return!0;else return c("qex")._("121")===!0}function a(a){if(k())return d("LSBitOffset").set((j||(j=d("LSIntEnum"))).ofNumber(42),a);else return a}function b(a){return d("LSBitOffset").set((j||(j=d("LSIntEnum"))).ofNumber(4),a)}e=d("LSBitOffset").set((j||(j=d("LSIntEnum"))).ofNumber(18),d("LSBitOffset").set(j.ofNumber(56),d("LSBitOffset").set(j.ofNumber(14),d("LSBitOffset").set(j.ofNumber(23),d("LSBitOffset").set(j.ofNumber(8),d("LSBitOffset").set(j.ofNumber(15),d("LSBitOffset").set(j.ofNumber(2),d("LSBitOffset").empty)))))));f=a(b(d("LSBitOffset").set(j.ofNumber(7),d("LSBitOffset").set(j.ofNumber(6),d("LSBitOffset").set(j.ofNumber(9),d("LSBitOffset").set(j.ofNumber(10),d("LSBitOffset").set(j.ofNumber(19),d("LSBitOffset").set(j.ofNumber(35),d("LSBitOffset").set(j.ofNumber(3),d("LSBitOffset").set(j.ofNumber(43),e))))))))));a=d("LSBitOffset").set(j.ofNumber(17),d("LSBitOffset").set(j.ofNumber(60),d("LSBitOffset").set(j.ofNumber(16),d("LSBitOffset").set(j.ofNumber(26),d("LSBitOffset").set(j.ofNumber(28),d("LSBitOffset").clear(j.ofNumber(27),f))))));b=d("LSBitOffset").set((i||(i=d("I64"))).sub(j.ofNumber(103),i.of_string("64")),d("LSBitOffset").set(i.sub(j.ofNumber(85),i.of_string("64")),d("LSBitOffset").set(i.sub(j.ofNumber(109),i.of_string("64")),d("LSBitOffset").set(i.sub(j.ofNumber(74),i.of_string("64")),d("LSBitOffset").set(i.sub(j.ofNumber(65),i.of_string("64")),d("LSBitOffset").set(i.sub(j.ofNumber(64),i.of_string("64")),d("LSBitOffset").set(i.sub(j.ofNumber(106),i.of_string("64")),d("LSBitOffset").empty)))))));e=h._("__JHASH__9ZFn8zMzjpf__JHASH__").toString();h=d("LSBitOffset").set(i.sub(j.ofNumber(172),i.of_string("64")),d("LSBitOffset").empty);g.defaultThreadCapabilities=f;g.defaultGroupThreadCapabilities=a;g.defaultThreadCapabilities_2=b;g.nullstateDescriptionText1=e;g.defaultThreadCapabilities_3=h;g.defaultThreadCapabilities_4=d("LSBitOffset").empty}),226);
__d("MAWBridgeOccamadilloVerifyThreadExistsHandler",["DateConsts","FBLogger","I64","LSAuthorityLevel","LSCoreClientFolderType","LSCreateE2EEMetadataThreadStoredProcedure","LSFactory","LSIntEnum","LSThreadBitOffset","MAWBridgeFireAndForget","MAWCreateOptimisticThread","MAWFolderUtils","MAWMiActGetThreadLifecycleState","MAWMiActOnActThreadReadyQueue","MAWMiActThreadLifecycleState","MAWThreadDefaults","MAWTimeUtils","Promise","WAJids","WALoggerDeferred","WATagsLogger","WATimeUtils","asyncToGeneratorRuntime","gkx","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Occam] Thread loading complete: jid ",", threadKey ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Occam] New authoritative thread: jid ",", threadKey: ","), state: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Occam] Notifying MI server about thread: jid ",", state: ",". "]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Occam] Authoritative thread not found for clientThreadPk: ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Occam] Thread is missing in Occamadillo verify thread exists"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["Duplicated thread creation for ",""]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Occam] Duplicated thread creation.\n      threadKey: ","\n      bumpTimestampMs: ",""]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Occam] Creating e2ee metadata optimistic thread.\n  threadKey: ","\n  bumpTimestampMs: ",",\n  description: ",",\n  createdByLocalDevice: ",""]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Occam] Last activity timestamp = 0 from MI for thread: ",", using local state timestamp: ",""]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Occam] no folder type was supplied to Occamadillo verify thread exists handler"]);t=function(){return a};return a}var u=new Set();function v(a){return(i||(i=d("I64"))).of_string(d("WAJids").threadIdForChatJid(a))}function w(a){a=d("MAWFolderUtils").systemFolderToLSCoreClientFolder(a);a==null&&(c("promiseDone")(d("WALoggerDeferred").WARN(t())),a=(i||(i=d("I64"))).of_int32(c("LSCoreClientFolderType").INBOX));return a}function x(a,b){return b==null?d("MAWCreateOptimisticThread").createOptimisticThread(a):(i||(i=d("I64"))).of_string(b)}function y(a){a=d("MAWTimeUtils").millisTimeToTimestamp(a);return(i||(i=d("I64"))).equal(a,(i||(i=d("I64"))).zero)?d("MAWTimeUtils").millisTimeToTimestamp(d("WATimeUtils").millisTime()):a}var z=new Set();function A(a,b,c){return B.apply(this,arguments)}function B(){B=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){var f,g=c("LSFactory")(a),h=y(b.lastActivityTs),k=(yield x(a,b.clientThreadKey)),l=w(b.folder),m=v(b.jid),n=b.isGroup?(j||(j=d("LSIntEnum"))).ofNumber(16):(j||(j=d("LSIntEnum"))).ofNumber(15);yield a.mi_act_mapping_table.put({clientThreadPk:m,jid:m,serverThreadKey:k});a=(i||(i=d("I64"))).to_string(k);f=(f=b.description)!=null?f:"unknown";e=c("gkx")("4764")?e.type===d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.OPTIMISTIC_THREAD_WITH_ACT:null;c("promiseDone")(d("WALoggerDeferred").LOG(r(),a,i.to_string(h),f,e));u.has(a)?c("promiseDone")(d("WALoggerDeferred").WARN(q(),a,(i||(i=d("I64"))).to_string(h))):u.add(a);z.has(b.jid)&&d("WATagsLogger").TAGS(["occamadillo","call_create_sproc"]).LOG(p(),b.jid);z.add(b.jid);a=d("WATimeUtils").millisTime();var o=i.to_float(h);Math.abs(o-a)<d("DateConsts").MS_PER_SEC&&c("FBLogger")("messenger_e2ee_web").warn("[GetOrCreateThread] bumpTimestampMs is too close to now. bumpTimestampMs: %s, lastActivityTs: %s, now: %s, description: %s",o,b.lastActivityTs,a,f);return c("LSCreateE2EEMetadataThreadStoredProcedure")(g,{bumpTimestampMs:h,createdByLocalDevice:e,folderType:l,offlineThreadKey:k,threadType:n,waJid:m})});return B.apply(this,arguments)}function C(a,b,e){a=a;(i||(i=d("I64"))).equal(a,(i||(i=d("I64"))).zero)&&(c("promiseDone")(d("WALoggerDeferred").WARN(s(),(i||(i=d("I64"))).to_string(e),i.to_string(b))),a=b);return a}var D=[105,17,25,24];function E(a,b){var c=D.filter(function(b){return d("LSThreadBitOffset").has(b,a)}),e=61,f=d("LSThreadBitOffset").has(e,a);f&&c.push(e);return d("LSThreadBitOffset").set(c,b?d("MAWThreadDefaults").defaultGroupThreadCapabilities:d("MAWThreadDefaults").defaultThreadCapabilities,d("MAWThreadDefaults").defaultThreadCapabilities_2,d("MAWThreadDefaults").defaultThreadCapabilities_3,d("MAWThreadDefaults").defaultThreadCapabilities_4)}function F(a,b,c){return G.apply(this,arguments)}function G(){G=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f){var g=(yield a.threads.get(e));if(g==null){c("promiseDone")(d("WALoggerDeferred").ERROR(o()));return(h||(h=b("Promise"))).resolve()}var j=f.clientThreadKey!=null?(i||(i=d("I64"))).of_string(f.clientThreadKey):g.clientThreadKey,k=C(g.lastActivityTimestampMs,d("MAWTimeUtils").millisTimeToTimestamp(f.lastActivityTs),e);f=E(g,f.isGroup);return a.threads.upsert([e],babelHelpers["extends"]({},g,{capabilities:f[0],capabilities2:f[1],capabilities3:f[2],capabilities4:f[3],clientThreadKey:j,lastActivityTimestampMs:k}))});return G.apply(this,arguments)}function H(a,b,c){return I.apply(this,arguments)}function I(){I=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,d){yield a.mi_act_mapping_table.put({clientThreadPk:v(d.jid),jid:v(d.jid),serverThreadKey:c}),yield (h||(h=b("Promise"))).all([F(a,c,d),J(a,c,d)])});return I.apply(this,arguments)}function J(a,b,c){return K.apply(this,arguments)}function K(){K=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){if(c.clientThreadKey!=null){c=(i||(i=d("I64"))).of_string(c.clientThreadKey);(i||(i=d("I64"))).equal(b,c)||(yield a.threads["delete"](c))}});return K.apply(this,arguments)}function L(a,b,c){return M.apply(this,arguments)}function M(){M=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f){var g=(yield a.threads.get(e));g!=null&&(i||(i=d("I64"))).to_int32(g.authorityLevel)===c("LSAuthorityLevel").AUTHORITATIVE&&(yield (h||(h=b("Promise"))).all([F(a,e,f),J(a,e,f)]));g==null&&c("promiseDone")(d("WALoggerDeferred").LOG(n(),v(f.jid)))});return M.apply(this,arguments)}function N(a,b){return O.apply(this,arguments)}function O(){O=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e,f=(i||(i=d("I64"))).of_string(d("WAJids").threadIdForChatJid(b.jid));f=(yield d("MAWMiActGetThreadLifecycleState").getThreadLifecycleStateByJidOrThreadKey(a,f,b.authoritativeThreadKey,"MAWBridgeOccamadilloVerifyThreadExistsHandler"));e=(e=b.description)!=null?e:"unknown";switch(f.type){case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.JID_MISSING_MAPPING_ROW:case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.JID_MISSING_MI_THREAD:case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.OPTIMISTIC_THREAD_WITH_ACT:case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.CLIENT_PARTIAL_MI_THREAD:case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.CLIENT_PARTIAL_MI_THREAD_WITH_ACT:case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.SERVER_PARTIAL_MI_THREAD:case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.THREAD_KEY_ONLY:c("promiseDone")(d("WALoggerDeferred").LOG(m(),b.jid,f.type));return A(a,b,f);case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.AUTHORITATIVE_THREAD_ONLY:case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.AUTHORITATIVE_THREAD_MISSING_MAPPING_ROW:var g=(i||(i=d("I64"))).to_string(f.serverThreadKey);c("promiseDone")(d("WALoggerDeferred").LOG(l(),b.jid,g,f.type));return H(a,f.serverThreadKey,b);case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.MI_AND_ACT_THREAD_COMPLETE:g=(i||(i=d("I64"))).to_string(f.serverThreadKey);c("promiseDone")(d("WALoggerDeferred").LOG(k(),b.jid,g));return L(a,f.serverThreadKey,b);case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.OPTIMISTIC_THREAD_NO_ACT:throw c("FBLogger")("messenger_e2ee_web").mustfixThrow("[Occam] Unimplemented VerifyThreadExists state: %s for JID: %s, from %s",f.type,b.jid,e);default:f.type;throw c("FBLogger")("messenger_e2ee_web").mustfixThrow("[Occam] Unhandled VerifyThreadExists state: %s for JID: %s, from %s",f.type,b.jid,e)}});return O.apply(this,arguments)}function P(a,b,c){return Q.apply(this,arguments)}function Q(){Q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){a=(yield a.threads.get(b));if(a!=null){a={ephemeralExpirationInSec:(i||(i=d("I64"))).to_int32((b=a.disappearingSettingTtl)!=null?b:(i||(i=d("I64"))).zero),ephemeralLastUpdatedOrSetTimestamp:d("WATimeUtils").castMilliSecondsToUnixTime(i.to_float((b=a.disappearingSettingUpdatedTs)!=null?b:(i||(i=d("I64"))).zero))};d("MAWBridgeFireAndForget").fireAndForget("backend","setEphemeralSettingCache",{jid:c,settings:a})}});return Q.apply(this,arguments)}function a(a,b){return R.apply(this,arguments)}function R(){R=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){yield N(a,b);if(b.clientThreadKey!=null){var e=(i||(i=d("I64"))).of_string(b==null?void 0:b.clientThreadKey);c("promiseDone")(d("MAWMiActOnActThreadReadyQueue").processQueueOnActThreadReady(e,b.jid))}if(b.authoritativeThreadKey!=null){e=(i||(i=d("I64"))).of_string(b.authoritativeThreadKey);c("promiseDone")(d("MAWMiActOnActThreadReadyQueue").processQueueOnActThreadReady(e,b.jid))}e=(e=b.authoritativeThreadKey)!=null?e:b.clientThreadKey;if(e!=null){e=(i||(i=d("I64"))).of_string(e);yield P(a,e,b.jid)}return});return R.apply(this,arguments)}g.call=a}),98);
__d("MAWBridgeOneToOneMessageRequestLoadedHandler",["fbt","FBLogger","I64","LSAuthorityLevel","LSIntEnum","LSMessagingThreadTypeUtil","LSThreadBitOffset","MAWContactRelationshipType","MAWMessageRequestUtil","MAWMiActOnMiThreadReadyForJid","Promise","ReQL","WADbContact"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k;function a(a,e){return d("MAWMiActOnMiThreadReadyForJid").onMiThreadReadyForJid(a,e.threadJid,"MAWBridgeOneToOneMessageRequestLoadedHandler",function(a,f){return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.threads).getKeyRange(f)).then(function(c){if(c==null)return(k||(k=b("Promise"))).resolve([void 0,void 0,void 0,!1]);var f=d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.contacts).getKeyRange((i||(i=d("I64"))).of_string(e.fbid)));return(k||(k=b("Promise"))).all([k.resolve(c),f,k.resolve(d("LSMessagingThreadTypeUtil").isOneToOne(c.threadType))])}).then(function(e){var f=e[0];if(f==null)return(k||(k=b("Promise"))).resolve();var g=e[1];if(g==null)return(k||(k=b("Promise"))).resolve();e=e[2];if(e===!1||e==null)return(k||(k=b("Promise"))).resolve();e=d("MAWContactRelationshipType").getContactRelationshipType(g);e=f.folderName==="inbox"&&e===d("WADbContact").REVERSED_ONE_WAY_CONTACT&&!(i||(i=d("I64"))).equal(f.lastActivityTimestampMs,(i||(i=d("I64"))).zero);e&&(i||(i=d("I64"))).lt(g.authorityLevel,(j||(j=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE))&&(c("FBLogger")("messenger_web_product").mustfix("[MAW] Message Request loaded before contact is fully loaded"),e=!1);if(f.folderName==="pending"||f.folderName==="other"||f.folderName==="spam"||e){g=d("LSThreadBitOffset").clear(d("MAWMessageRequestUtil").disabledThreadCapabilitiesForIncomingRequest,f.capabilities,f.capabilities2,f.capabilities3,f.capabilities4);e=g[0];var l=g[1],m=g[2];g=g[3];var n=void 0;f.folderName==="inbox"&&(n=h._("__JHASH__4F6x7gUU1-S__JHASH__").toString());e=[d("LSThreadBitOffset").set(d("MAWMessageRequestUtil").enabledThreadCapabilitiesForIncomingRequest,e,l,m,g),n]}else e=[[f.capabilities,f.capabilities2,f.capabilities3,f.capabilities4],void 0];l=e[0];m=e[1];g=babelHelpers["extends"]({},f,{additionalThreadContext:m,capabilities:l[0],capabilities2:l[1],capabilities3:l[2],capabilities4:l[3]});return a.threads.put(g).then(function(){})})})}g.call=a}),226);
__d("MAWBridgeParticipantRemovedHandler",["I64","MAWMiActOnMiThreadReadyForJid"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){return d("MAWMiActOnMiThreadReadyForJid").onMiThreadReadyForJid(a,b.threadJid,"MAWBridgeParticipantRemovedHandler",function(a,c){return a.participants["delete"](c,(h||(h=d("I64"))).of_string(b.userId))})}g.call=a}),98);
__d("MAWBridgeParticipantUpdatedHandler",["fbt","I64","LSAuthorityLevel","LSContactBlockedByViewerStatus","LSContactGender","LSContactIdType","LSContactType","LSContactViewerRelationship","LSContactWorkForeignEntityType","LSFactory","LSGroupParticipantJoinState","LSIntEnum","LSVerifyContactRowExistsStoredProcedure","MAWCurrentUser","MAWMiActOnMiThreadReadyForJid","MAWTimeUtils","MAWUpdateLSThreadCapabilities","Promise","TemporaryLoggingUtilsForS406998Only","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k,l=d("MAWCurrentUser").getID(),m=(j||(j=d("I64"))).of_string(l);function n(a,b,c){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){var f=(j||(j=d("I64"))).of_string(b.fbid),g=d("MAWTimeUtils").toTimestamp(b.readWatermarkTs),i=d("MAWTimeUtils").toTimestamp(b.deliveredWatermarkTs),n=d("MAWTimeUtils").toTimestamp(b.lastReadActionTs),o=b.isSuperAdmin?h._("__JHASH__-gVxfbL98KU__JHASH__").toString():void 0,p=(yield a.participants.get(e,f));p!=null?yield a.participants.put(d("TemporaryLoggingUtilsForS406998Only").logIfInvalidParticipantAndReturnForS406998Only({authorityLevel:p.authorityLevel,contactId:f,deliveredWatermarkTimestampMs:i,groupParticipantJoinState:b.isInvited?(k||(k=d("LSIntEnum"))).ofNumber(c("LSGroupParticipantJoinState").INVITED):(k||(k=d("LSIntEnum"))).ofNumber(c("LSGroupParticipantJoinState").MEMBER),isAdmin:b.isAdmin,isModerator:!1,isSuperAdmin:p.isSuperAdmin,nickname:p.nickname,normalizedSearchTerms:p.normalizedSearchTerms,participantCapabilities:p.participantCapabilities,readActionTimestampMs:n,readWatermarkTimestampMs:g,subscribeSource:o,threadKey:e},"MAWBridgeParticipantUpdatedHandler.put")):yield a.participants.add(d("TemporaryLoggingUtilsForS406998Only").logIfInvalidParticipantAndReturnForS406998Only({authorityLevel:(j||(j=d("I64"))).zero,contactId:f,deliveredWatermarkTimestampMs:i,groupParticipantJoinState:b.isInvited?(k||(k=d("LSIntEnum"))).ofNumber(c("LSGroupParticipantJoinState").INVITED):(k||(k=d("LSIntEnum"))).ofNumber(c("LSGroupParticipantJoinState").MEMBER),isAdmin:b.isAdmin,isModerator:!1,isSuperAdmin:b.isSuperAdmin,nickname:void 0,normalizedSearchTerms:void 0,participantCapabilities:void 0,readActionTimestampMs:j.zero,readWatermarkTimestampMs:g,subscribeSource:o,threadKey:e},"MAWBridgeParticipantUpdatedHandler.add"));yield d("MAWUpdateLSThreadCapabilities").disableBlockerCapabilitiesTxn(a,e);n=b.isAdmin;(j||(j=d("I64"))).equal(m,f)&&(n?yield d("MAWUpdateLSThreadCapabilities").enableAddMembersTxn(a,e):yield d("MAWUpdateLSThreadCapabilities").disableAddMembersTxn(a,e));p==null&&(yield c("LSVerifyContactRowExistsStoredProcedure")(c("LSFactory")(a),{authorityLevel:(k||(k=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").OPTIMISTIC),blockedByViewerStatus:k.ofNumber(c("LSContactBlockedByViewerStatus").UNBLOCKED),contactIdType:k.ofNumber(c("LSContactIdType").FBID),contactType:k.ofNumber(c("LSContactType").USER),contactViewerRelationship:k.ofNumber(c("LSContactViewerRelationship").UNKNOWN),gender:k.ofNumber(c("LSContactGender").UNKNOWN),id:f,isBlocked:!1,isMemorialized:!1,isSelf:l===b.fbid,workForeignEntityType:k.ofNumber(c("LSContactWorkForeignEntityType").UNKNOWN)}))});return o.apply(this,arguments)}function a(a,c){return c.fbid.startsWith("shadow_")?(i||(i=b("Promise"))).resolve():d("MAWMiActOnMiThreadReadyForJid").onMiThreadReadyForJid(a,c.threadJid,"MAWBridgeParticipantUpdatedHandler",function(a,b){return n(a,c,b)})}g.callWithoutWaitingForAnything=n;g.call=a}),226);
__d("MAWBridgeParticipantsUpdatedHandler",["fbt","I64","LSAuthorityLevel","LSContactBlockedByViewerStatus","LSContactGender","LSContactIdType","LSContactType","LSContactViewerRelationship","LSContactWorkForeignEntityType","LSFactory","LSGroupParticipantJoinState","LSIntEnum","LSVerifyContactRowExistsStoredProcedure","MAWCurrentUser","MAWMiActOnMiThreadReadyForJid","MAWTimeUtils","MAWUpdateLSThreadCapabilities","Promise","ReQLTable","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k,l=d("MAWCurrentUser").getID(),m=(k||(k=d("I64"))).of_string(l);function a(a,b){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){e=e.participants.filter(function(a){return!a.fbid.startsWith("shadow_")});yield (i||(i=b("Promise"))).all(e.map(function(e){return d("MAWMiActOnMiThreadReadyForJid").onMiThreadReadyForJid(a,e.threadJid,"MAWBridgeParticipantsUpdatedHandler",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var f=(k||(k=d("I64"))).of_string(e.fbid),g=d("MAWTimeUtils").toTimestamp(e.readWatermarkTs),i=d("MAWTimeUtils").toTimestamp(e.deliveredWatermarkTs),n=d("MAWTimeUtils").toTimestamp(e.lastReadActionTs),o=e.isSuperAdmin?h._("__JHASH__-gVxfbL98KU__JHASH__").toString():void 0,p=!1,q=!1;yield d("ReQLTable").update(a.participants,[b,f],function(a){if(a!=null){q=!0;return{authorityLevel:a.authorityLevel,contactId:f,deliveredWatermarkTimestampMs:(k||(k=d("I64"))).equal(i,(k||(k=d("I64"))).zero)?a.deliveredWatermarkTimestampMs:i,groupParticipantJoinState:e.isInvited?(j||(j=d("LSIntEnum"))).ofNumber(c("LSGroupParticipantJoinState").INVITED):(j||(j=d("LSIntEnum"))).ofNumber(c("LSGroupParticipantJoinState").MEMBER),isAdmin:e.isAdmin,isModerator:!1,isSuperAdmin:a.isSuperAdmin,nickname:a.nickname,normalizedSearchTerms:a.normalizedSearchTerms,participantCapabilities:a.participantCapabilities,readActionTimestampMs:(k||(k=d("I64"))).equal(n,(k||(k=d("I64"))).zero)?a.readActionTimestampMs:n,readWatermarkTimestampMs:(k||(k=d("I64"))).equal(g,(k||(k=d("I64"))).zero)?a.readWatermarkTimestampMs:g,subscribeSource:o,threadKey:b}}else{q=!0;p=!0;return{authorityLevel:(k||(k=d("I64"))).zero,contactId:f,deliveredWatermarkTimestampMs:i,groupParticipantJoinState:e.isInvited?(j||(j=d("LSIntEnum"))).ofNumber(c("LSGroupParticipantJoinState").INVITED):(j||(j=d("LSIntEnum"))).ofNumber(c("LSGroupParticipantJoinState").MEMBER),isAdmin:e.isAdmin,isModerator:!1,isSuperAdmin:e.isSuperAdmin,nickname:void 0,normalizedSearchTerms:void 0,participantCapabilities:void 0,readActionTimestampMs:k.zero,readWatermarkTimestampMs:g,subscribeSource:o,threadKey:b}}});q&&(yield d("MAWUpdateLSThreadCapabilities").disableBlockerCapabilitiesTxn(a,b),(k||(k=d("I64"))).equal(m,f)&&(e.isAdmin?yield d("MAWUpdateLSThreadCapabilities").enableAddMembersTxn(a,b):yield d("MAWUpdateLSThreadCapabilities").disableAddMembersTxn(a,b)));p&&(yield c("LSVerifyContactRowExistsStoredProcedure")(c("LSFactory")(a),{authorityLevel:(j||(j=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").OPTIMISTIC),blockedByViewerStatus:j.ofNumber(c("LSContactBlockedByViewerStatus").UNBLOCKED),contactIdType:j.ofNumber(c("LSContactIdType").FBID),contactType:j.ofNumber(c("LSContactType").USER),contactViewerRelationship:j.ofNumber(c("LSContactViewerRelationship").UNKNOWN),gender:j.ofNumber(c("LSContactGender").UNKNOWN),id:f,isBlocked:!1,isMemorialized:!1,isSelf:l===e.fbid,workForeignEntityType:j.ofNumber(c("LSContactWorkForeignEntityType").UNKNOWN)}))});return function(b,c){return a.apply(this,arguments)}}())}))});return n.apply(this,arguments)}g.call=a}),226);
__d("MAWBridgeRavenActionMsgForUIHandler",["I64","MAWMiActOnMiThreadReadyForJid","MAWMsg","MAWRavenUtils","Promise","ReQL","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a,c){return d("MAWMiActOnMiThreadReadyForJid").onMiThreadReadyForJid(a,c.threadJid,"MAWBridgeRavenActionMsgForUIHandler",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){a=a.attachments;e=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a).getKeyRange(e,c.ravenMsgId)));if(e==null)return(i||(i=b("Promise"))).resolve();if(e.ephemeralMediaState==null)return(i||(i=b("Promise"))).resolve();var f=(h||(h=d("I64"))).to_int32(e.ephemeralMediaState);if(e.ephemeralMediaViewMode==null)return(i||(i=b("Promise"))).resolve();var g=h.to_int32(e.ephemeralMediaViewMode);f=d("MAWMsg").MAWRavenMsgEphemeralMediaState.cast(f);g=d("MAWMsg").MAWRavenMsgEphemeralType.cast(g);if(f==null||g==null)return(i||(i=b("Promise"))).resolve();f=d("MAWRavenUtils").getNextRavenMessageEphemeralState(f,g);if(f==null)return(i||(i=b("Promise"))).resolve();e.ephemeralMediaState;g=babelHelpers.objectWithoutPropertiesLoose(e,["ephemeralMediaState"]);e=babelHelpers["extends"]({ephemeralMediaState:h.of_int32(f)},g,{transportKey:"WhatsApp"});f=[g.threadKey,g.messageId,g.attachmentFbid];return a.upsert(f,e)});return function(b,c){return a.apply(this,arguments)}}())}g.call=a}),98);
__d("MAWBridgeReceivedChatStateHandler",["I64","MAWMiActOnMiThreadReadyForJid","Promise","ServerTime","WAChatState"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a,c){return d("MAWMiActOnMiThreadReadyForJid").onMiThreadReadyForJid(a,c.threadJid,"MAWBridgeReceivedChatStateHandler",function(a,e){var f=(i||(i=d("I64"))).of_string(c.senderId),g=i.of_float(3e3+d("ServerTime").getMillis());if(c.state===d("WAChatState").TYPING)return a.typing_indicator.upsert([e,f],{expirationTimestampMs:g,senderId:f,threadKey:e}).then(function(){});else if(c.state===d("WAChatState").IDLE)return a.typing_indicator["delete"](e,f).then(function(){});else return(h||(h=b("Promise"))).resolve()})}g.call=a}),98);
__d("MAWBridgeReceivedReceiptHandler",["I64","MAWMiActOnMiThreadReadyForJid","MAWTimeUtils","ReQL","TemporaryLoggingUtilsForS406998Only","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,b,c){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){var e=(h||(h=d("I64"))).of_string(b.fbid),f=d("MAWTimeUtils").toTimestamp(b.lastReadWatermarkTs),g=d("MAWTimeUtils").toTimestamp(b.deliveredWatermarkTs);b=d("MAWTimeUtils").toTimestamp(b.lastReadActionTs);c=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.participants).getKeyRange(c,e)));c!=null&&(yield a.participants.put(d("TemporaryLoggingUtilsForS406998Only").logIfInvalidParticipantAndReturnForS406998Only({authorityLevel:c.authorityLevel,contactId:c.contactId,deliveredWatermarkTimestampMs:(h||(h=d("I64"))).equal(g,(h||(h=d("I64"))).zero)?c.deliveredWatermarkTimestampMs:g,groupParticipantJoinState:c.groupParticipantJoinState,isAdmin:c.isAdmin,isModerator:c.isModerator,isSuperAdmin:c.isSuperAdmin,nickname:c.nickname,normalizedSearchTerms:c.normalizedSearchTerms,participantCapabilities:c.participantCapabilities,readActionTimestampMs:(h||(h=d("I64"))).equal(b,(h||(h=d("I64"))).zero)?c.readActionTimestampMs:b,readWatermarkTimestampMs:(h||(h=d("I64"))).equal(f,(h||(h=d("I64"))).zero)?c.readWatermarkTimestampMs:f,subscribeSource:c.subscribeSource,threadKey:c.threadKey,threadRoles:(h||(h=d("I64"))).zero},"MAWBridgeReceivedReceiptHandler")))});return j.apply(this,arguments)}function a(a,b){return d("MAWMiActOnMiThreadReadyForJid").onMiThreadReadyForJid(a,b.chatJid,"MAWBridgeReceivedReceiptHandler",function(a,c){return i(a,b,c)})}g.callWithoutWaitingForAnything=i;g.call=a}),98);
__d("MAWBridgeRefreshContactHandler",["LSFactory","LSRefetchContactRowIfExistsStoredProcedure"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return c("LSRefetchContactRowIfExistsStoredProcedure")(c("LSFactory")(a),{id:b})}g.call=a}),98);
__d("MAWBridgeRemoveMessageSearchResultHandler",["Promise","ReQL","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,c){return b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e=(yield d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.message_search_results).filter(function(a){return c.includes(a.messageOtid)})));yield (h||(h=b("Promise"))).all(e.map(function(b){return a.message_search_results["delete"](b.type_,b.query,b.threadKey,b.globalIndex)}))})().then(function(){})}g.call=a}),98);
__d("MAWBridgeSyncContacts",["CurrentMessengerUser","I64","LSAuthorityLevel","LSContactBlockedByViewerStatus","LSContactGender","LSContactIdType","LSContactType","LSContactViewerRelationship","LSContactWorkForeignEntityType","LSFactory","LSIntEnum","LSVerifyContactRowExistsStoredProcedure","Promise"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=d("CurrentMessengerUser").getID();function a(a,e){return e.reduce(function(b,e){var f=(i||(i=d("I64"))).of_string(e);return b.then(function(){return c("LSVerifyContactRowExistsStoredProcedure")(c("LSFactory")(a),{authorityLevel:(j||(j=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").OPTIMISTIC),blockedByViewerStatus:j.ofNumber(c("LSContactBlockedByViewerStatus").UNBLOCKED),contactIdType:j.ofNumber(c("LSContactIdType").FBID),contactType:j.ofNumber(c("LSContactType").USER),contactViewerRelationship:j.ofNumber(c("LSContactViewerRelationship").UNKNOWN),gender:j.ofNumber(c("LSContactGender").UNKNOWN),id:f,isBlocked:!1,isMemorialized:!1,isSelf:k===e,workForeignEntityType:j.ofNumber(c("LSContactWorkForeignEntityType").UNKNOWN)})}).then(function(){})},(h||(h=b("Promise"))).resolve())}g.call=a}),98);
__d("MAWBridgeThreadBumpedServerHandler",["I64","LSBumpE2EEMetadataThreadStoredProcedure","LSFactory","MAWCalculateBumpTimestampMs","MAWMiActOnMiThreadReadyForJid","WALoggerDeferred","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Occamadillo] Bumping thread on server. threadKey: ",", bumpTimestampMs: ",", isLocalDeviceSend: ",", from ",""]);i=function(){return a};return a}function a(a,b){return d("MAWMiActOnMiThreadReadyForJid").onMiThreadReadyForJid(a,b.threadJid,"MAWBridgeThreadBumpedServerHandle",function(a,e){var f=b.lastActivityTs;f=d("MAWCalculateBumpTimestampMs").calculateBumpTimestampMs(f,b.lastMsgExternalId);c("promiseDone")(d("WALoggerDeferred").LOG(i(),(h||(h=d("I64"))).to_string(e),h.to_string(f),b.isCurrentDeviceSendingMsg,b.description));return c("LSBumpE2EEMetadataThreadStoredProcedure")(c("LSFactory")(a),{bumpedByLocalDeviceSend:b.isCurrentDeviceSendingMsg,isUnbump:!1,serverAuthoritativeTimestampMs:f,threadKey:e})})}g.call=a}),98);
__d("MAWThreadBumpedV2LoggingUtils",["DateConsts","I64","LSAuthorityLevel","ODS","Promise","ReQL"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function a(a,e,f){var g=(j||(j=d("I64"))).of_int32(c("LSAuthorityLevel").AUTHORITATIVE),k=function(a){a=a.authorityLevel;return(j||(j=d("I64"))).equal(g,a)},l=d("ReQL").firstAsync(d("ReQL").fromTableDescending(a.messages).getKeyRange(f.threadKey).filter(k)).then(function(a){return(j||(j=d("I64"))).to_float((a=a==null?void 0:a.timestampMs)!=null?a:(j||(j=d("I64"))).zero)});a=d("ReQL").toArrayAsync(d("ReQL").fromTableDescending(a.reactions).getKeyRange(f.threadKey).filter(k).take(20)).then(function(a){return a.reduce(function(a,b){return Math.max(a,(j||(j=d("I64"))).to_float((a=b.reactionCreationTimestampMs)!=null?a:(j||(j=d("I64"))).zero))},0)});return(h||(h=b("Promise"))).all([l,a]).then(function(a){var b=a[0];a=a[1];b=Math.max(b,a);a=Math.floor((j||(j=d("I64"))).to_float(e.bumpTimestampMs)/d("DateConsts").MS_PER_SEC)*1e3;if(a!==b)return(i||(i=d("ODS"))).bumpEntityKey(3185,"armadillo_thread_bump","thread_bump_call_unexpected");else return(i||(i=d("ODS"))).bumpEntityKey(3185,"armadillo_thread_bump","thread_bump_call_expected")})}g.logIfBumpIsUnexpected=a}),98);
__d("MAWBridgeThreadBumpedV2Handler",["FBLogger","I64","LSBumpE2EEMetadataThreadStoredProcedure","LSFactory","LSOptimisticMarkThreadReadV2StoredProcedure","MAWBridgeBuildThreadSnippet","MAWLocalizationType","MAWMiActOnMiThreadReadyForJid","MAWThreadBumpedV2LoggingUtils","ODS","Promise","ReQL","WALoggerDeferred","asyncToGeneratorRuntime","getMAWLastMessageCtaType","gkx","justknobx","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Occamadillo] Skipping local bump for thread: ",", bumpTimestampMs: ",", DB lastActivityTimestampMs: ",", from ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Occamadillo] Bumping thread on local (v2). threadKey: ",", bumpTimestampMs: ",", originalActivityTimestampMs: ",", originalReadTimestampMs : ",", isMessageAuthorMe: ","\n          from ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Occamadillo] missing thread for bumping threadKey: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Occamadillo] Bumping thread v2. threadKey: ",", bumpTimestampMs: ",", isMessageAuthorMe: ",", skipServerThreadBump: ",", from ",""]);n=function(){return a};return a}function a(a,e){return d("MAWMiActOnMiThreadReadyForJid").onMiThreadReadyForJid(a,e.threadJid,"MAWBridgeThreadBumpedV2Handler",function(){var f=b("asyncToGeneratorRuntime").asyncToGenerator(function*(f,g){var p,q=e.bumpTimestampMs;p=(p=e.skipServerThreadBump)!=null?p:!1;var s=e.isMessageAuthorMe;c("promiseDone")(d("WALoggerDeferred").LOG(n(),(i||(i=d("I64"))).to_string(g),i.to_string(q),s,p,e.description));var t=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(f.threads).getKeyRange(g)));if(t==null){c("promiseDone")(d("WALoggerDeferred").WARN(m(),(i||(i=d("I64"))).to_string(g)));return(j||(j=d("ODS"))).bumpEntityKey(3185,"armadillo_thread_bump","missing_thread")}c("justknobx")._("2374")&&c("promiseDone")(d("MAWThreadBumpedV2LoggingUtils").logIfBumpIsUnexpected(a,e,t));var u=r(e,t);if(u){c("promiseDone")(d("WALoggerDeferred").LOG(l(),(i||(i=d("I64"))).to_string(g),i.to_string(q),i.to_string(t.lastActivityTimestampMs),i.to_string(t.lastReadWatermarkTimestampMs),s,e.description));u=babelHelpers["extends"]({},t,{lastActivityTimestampMs:q});if(!c("gkx")("6478")){var v=e.snippetSenderContactId!=null?(i||(i=d("I64"))).of_string(e.snippetSenderContactId):void 0;v=(v=v)!=null?v:t.snippetSenderContactId;var w=d("MAWBridgeBuildThreadSnippet").buildBridgeThreadSnippet(e,t.snippet),x=c("getMAWLastMessageCtaType")(e.snippetType);u=babelHelpers["extends"]({},u,{lastMessageCtaType:x,snippet:w,snippetSenderContactId:v})}s&&(u=babelHelpers["extends"]({},u,{lastReadWatermarkTimestampMs:q}));yield f.threads.put(u)}else{c("promiseDone")(d("WALoggerDeferred").LOG(k(),(i||(i=d("I64"))).to_string(g),i.to_string(q),i.to_string(t.lastActivityTimestampMs),e.description));p||c("FBLogger")("MAWBridgeThreadBumpedV2Handler").mustfix("[Occamadillo] Bumping thread on server when thread should not be bumped: %s, bumpTimestampMs: %s, DB lastActivityTimestampMs: %s, snippetType: %s, from %s",(i||(i=d("I64"))).to_string(g),i.to_string(q),i.to_string(t.lastActivityTimestampMs),e.snippetType,e.description);return(h||(h=b("Promise"))).resolve()}if(!p){x={readWatermarkTimestampMs:q,threadKey:g};v={bumpedByLocalDeviceSend:s,isUnbump:(w=e==null?void 0:e.isUnbump)!=null?w:!1,serverAuthoritativeTimestampMs:q,threadKey:g};return o(c("LSFactory")(f),s,x,v)}return(h||(h=b("Promise"))).resolve()});return function(a,b){return f.apply(this,arguments)}}())}function o(a,b,c,d){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f){b&&((j||(j=d("ODS"))).bumpEntityKey(3185,"thread_bumped_v2","mark_thread_as_read_on_server"),yield c("LSOptimisticMarkThreadReadV2StoredProcedure")(a,e));return c("LSBumpE2EEMetadataThreadStoredProcedure")(a,f)});return p.apply(this,arguments)}var q=[(e=d("MAWLocalizationType")).LOCALIZATION_TYPE.E2EE_THREAD_DESCRIPTION,e.LOCALIZATION_TYPE.DUAL_THREAD_CUTOVER_ADMIN_MESSAGE,e.LOCALIZATION_TYPE.CUTOVER_IGD_THREAD_ADMIN_MESSAGE,e.LOCALIZATION_TYPE.CUTOVER_THREAD_ADMIN_MESSAGE,e.LOCALIZATION_TYPE.CUTOVER_ROLLBACK_ADMIN_MESSAGE];function r(a,b){if(a.skipBumpTimestampValidation===!0)return!0;var e;c("justknobx")._("2773")?e=q.includes(a.snippetType):e=!1;if(e){(j||(j=d("ODS"))).bumpEntityKey(3185,"thread_bumped_v2","attempted_to_bump_with_prohibited_snippet_type");return!1}e=(i||(i=d("I64"))).ge(a.bumpTimestampMs,b.lastActivityTimestampMs);return e}g.call=a;g.prohibitedLocalizationsForThreadBumps=q}),98);
__d("MAWBridgeThreadHiddenV2Handler",["LSFactory","LSIntEnum","LSOptimisticRemoveThreadStoredProcedure","LSThreadRemoveType","MAWMiActOnMiThreadReadyForJid"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){return d("MAWMiActOnMiThreadReadyForJid").onMiThreadReadyForJid(a,b,"MAWBridgeThreadHiddenV2Handler",function(a,b){a=c("LSFactory")(a);return c("LSOptimisticRemoveThreadStoredProcedure")(a,{removeType:(h||(h=d("LSIntEnum"))).ofNumber(c("LSThreadRemoveType").DELETE_THREAD),threadKey:b})})}g.call=a}),98);
__d("MAWBridgeThreadTimestampsHandler",["CurrentMessengerUser","I64","MAWMiActOnMiThreadReadyForJid","MAWTimeUtils","ReQL","TemporaryLoggingUtilsForS406998Only","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,b,c){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){var e=d("MAWTimeUtils").millisTimeToTimestamp(c.lastReadWatermarkTs),f=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.threads).getKeyRange(b)));if(f==null||c.markUnread!==null&&c.markUnread===!1&&(h||(h=d("I64"))).ge(f.lastReadWatermarkTimestampMs,e))return;e=babelHelpers["extends"]({},f,{lastReadWatermarkTimestampMs:d("MAWTimeUtils").millisTimeToTimestamp(c.lastReadWatermarkTs)});yield a.threads.put(e);f=(h||(h=d("I64"))).of_string(d("CurrentMessengerUser").getID());e=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.participants).getKeyRange(b,f)));e!=null&&(yield a.participants.put(d("TemporaryLoggingUtilsForS406998Only").logIfInvalidParticipantAndReturnForS406998Only(babelHelpers["extends"]({},e,{readActionTimestampMs:d("MAWTimeUtils").millisTimeToTimestamp(c.lastActivityTimestampMs),readWatermarkTimestampMs:d("MAWTimeUtils").millisTimeToTimestamp(c.lastReadWatermarkTs)}),"MAWBridgeThreadTimestampsHandler")))});return j.apply(this,arguments)}function a(a,b){return d("MAWMiActOnMiThreadReadyForJid").onMiThreadReadyForJid(a,b.threadJid,"MAWBridgeThreadTimestampsHandler",function(a,c){return i(a,c,b)})}g.callWithoutWaitingForAnything=i;g.call=a}),98);
__d("MAWBridgeThreadUpdatedHandler",["I64","LSBitOffset","MAWBridgeBuildThreadSnippet","MAWBridgeUIEventDataValidation","MAWFolderUtils","MAWMiActOnMiThreadReadyForJid","ReQL","asyncToGeneratorRuntime","getMAWLastMessageCtaType","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,b){if(c("gkx")("2814"))return a;return b!=null&&b==="viewer_not_subscribed"?d("LSBitOffset").clear((h||(h=d("I64"))).sub(h.of_int32(28),h.of_string("64")),a):a}function j(a,b){var c=b.folder!=null?d("MAWFolderUtils").getMessagingFolderTag(b.folder):a.folderName;return(b=b.cannotReplyReason)!=null?b:c==="inbox"?void 0:a.cannotReplyReason}function k(a,b,c){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){e=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.threads).getKeyRange(e)));if(e==null)return;var f=j(e,b);f=babelHelpers["extends"]({},e,{cannotReplyReason:f,capabilities2:i(e.capabilities2,f),folderName:e.folderName,muteExpireTimeMs:b.muteExpireTimeMs==null?e.muteExpireTimeMs:(h||(h=d("I64"))).of_float(b.muteExpireTimeMs),parentThreadKey:e.parentThreadKey});if(!c("gkx")("6478")){var g=d("MAWBridgeBuildThreadSnippet").buildBridgeThreadSnippet(b,e.snippet),k=c("getMAWLastMessageCtaType")(b.snippetType);f=babelHelpers["extends"]({},f,{lastMessageCtaType:k,snippet:g,snippetSenderContactId:b.snippetSenderContactId==null?e.snippetSenderContactId:d("MAWBridgeUIEventDataValidation").stringToI64Opt(b.snippetSenderContactId)})}yield a.threads.put(f)});return l.apply(this,arguments)}function a(a,b){var c=b.threadJid;return d("MAWMiActOnMiThreadReadyForJid").onMiThreadReadyForJid(a,c,"MAWBridgeThreadUpdatedHandler",function(a,c){return k(a,b,c)})}g.callWithoutWaitingForAnything=k;g.call=a}),98);
__d("MAWBridgeUIEventQueueQPLLogger",["QPLUserFlow","qpl"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){c("QPLUserFlow").start(c("qpl")._(1056849266,"1765"),{annotations:{string_array:{events:b}},instanceKey:a})}function b(a){c("QPLUserFlow").endSuccess(c("qpl")._(1056849266,"1765"),{instanceKey:a})}function d(a,b){c("QPLUserFlow").endFailure(c("qpl")._(1056849266,"1765"),"MAWBridgeUIEventHandlerFailure",{annotations:{string:{failedEventTag:b}},instanceKey:a})}g.start=a;g.endSuccess=b;g.endFailure=d}),98);
__d("MAWBridgeUnArchivedSelfDeviceChangeAlertsHandler",["Promise"],(function(a,b,c,d,e,f){"use strict";var g;function a(a,c){return(g||(g=b("Promise"))).resolve()}f.call=a}),66);
__d("MAWBridgeUpdateContactAsConnectedHandler",["FBLogger","I64","LSAddMessengerContactStoredProcedure","LSContactViewerRelationship","LSFactory","LSIntEnum","LSOptimisticAcceptMessageRequestStoredProcedure","MAWMiActOnMiThreadReadyForJid","MAWUpdateLSThreadCapabilities","Promise","ReQL","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function a(a,b){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){var f=e.contactUserId;e=e.threadJid;var g=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.contacts).getKeyRange((i||(i=d("I64"))).of_string(f))));if(g==null){c("FBLogger")("maw_bridge").warn("Missing contact in MAWBridgeUpdateContactAsConnectedHandler");return}var k=babelHelpers["extends"]({},g,{contactViewerRelationship:(j||(j=d("LSIntEnum"))).ofNumber(c("LSContactViewerRelationship").CONTACT_OF_VIEWER)});return d("MAWMiActOnMiThreadReadyForJid").onMiThreadReadyForJid(a,e,"MAWBridgeUpdateContactAsConnectedHandler",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){yield (h||(h=b("Promise"))).allSettled([a.contacts.upsert([g.id],k),c("LSAddMessengerContactStoredProcedure")(c("LSFactory")(a),{contactId:g.id}),d("MAWUpdateLSThreadCapabilities").updateNonMessageRequestThreadTxn(a,e),c("LSOptimisticAcceptMessageRequestStoredProcedure")(c("LSFactory")(a),{threadKey:e})])});return function(b,c){return a.apply(this,arguments)}}())});return k.apply(this,arguments)}g.call=a}),98);
__d("MAWBridgeUpdateE2EEMetadataParticipantsHandler",["LSFactory","LSUpdateE2EEMetadataParticipantsStoredProcedure","MAWMiActOnMiThreadReadyForJid"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("MAWMiActOnMiThreadReadyForJid").onMiThreadReadyForJid(a,b.threadJid,"MAWBridgeThreadsLoadedHandler",function(a,b){return c("LSUpdateE2EEMetadataParticipantsStoredProcedure")(c("LSFactory")(a),{threadKey:b})})}g.call=a}),98);
__d("MAWBridgeUpdateMessageRangeHandler",["I64","LSClearMessagePlaceholderRangeStoredProcedure","LSFactory","LSInsertNewMessageRangeStoredProcedure","MAWMiActOnMiThreadReadyForJid","MAWTimeUtils","ReQL","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,e){return d("MAWMiActOnMiThreadReadyForJid").onMiThreadReadyForJid(a,e.threadJid,"MAWBridgeUpdateMessageRangeHandler",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var f,g;yield c("LSClearMessagePlaceholderRangeStoredProcedure")(c("LSFactory")(a),{maxTimestampMs:d("MAWTimeUtils").MAX_TIMESTAMP_MS,messageId:"",threadKey:b});var i=(yield d("ReQL").firstAsync(d("ReQL").fromTableDescending(a.messages_ranges_v2__generated).getKeyRange(b)));i!=null&&(yield a.messages_ranges_v2__generated["delete"](i.threadKey,i.minTimestampMs,i.minMessageId));var j=e.hasMoreAfter,k=e.hasMoreBefore,l=e.maxMsgId,m=e.minMsgId;f=k&&e.minMsgTs!=null?(h||(h=d("I64"))).of_float(e.minMsgTs):(f=i==null?void 0:i.minTimestampMs)!=null?f:d("MAWTimeUtils").MIN_TIMESTAMP_MS;var n=(i==null?void 0:i.minTimestampMs)!=null&&(h||(h=d("I64"))).lt(i==null?void 0:i.minTimestampMs,f),o=j&&e.maxMsgTs!=null?(h||(h=d("I64"))).of_float(e.maxMsgTs):d("MAWTimeUtils").MAX_TIMESTAMP_MS,p=d("MAWTimeUtils").MIN_TIMESTAMP_MS;g=(g=o)!=null?g:d("MAWTimeUtils").MAX_TIMESTAMP_MS;return c("LSInsertNewMessageRangeStoredProcedure")(c("LSFactory")(a),{hasMoreAfter:j,hasMoreBefore:n?(a=i==null?void 0:i.hasMoreBefore)!=null?a:!0:k,lowerOverlap:p,newMaxMid:(j=l)!=null?j:"",newMaxTs:o,newMinMid:n?(a=i==null?void 0:i.minMessageId)!=null?a:"":(k=m)!=null?k:"",newMinTs:n?(p=i==null?void 0:i.minTimestampMs)!=null?p:d("MAWTimeUtils").MIN_TIMESTAMP_MS:f,threadKey:b,upperOverlap:g})});return function(b,c){return a.apply(this,arguments)}}())}g.call=a}),98);
__d("MAWBridgeUpdateMinMessageHandler",["I64","MAWMiActOnMiThreadReadyForJid","ReQL","ReQLTable","unrecoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){var e=(h||(h=d("I64"))).of_float(b.minTimestampMs),f=b.minMessageId;return d("MAWMiActOnMiThreadReadyForJid").onMiThreadReadyForJid(a,b.threadJid,"MAWBridgeUpdateMinMessageHandler",function(a,g){return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.messages_ranges_v2__generated).getKeyRange(g)).then(function(h){if(h==null)return;var i=b.hasMoreBefore,j=i!=null?i:h.hasMoreBefore;return d("ReQLTable").update(a.messages_ranges_v2__generated,[g,h.minTimestampMs,h.minMessageId],function(a){if(a!=null)return{hasMoreAfter:a.hasMoreAfter,hasMoreBefore:j,isLoadingAfter:a.isLoadingAfter,isLoadingBefore:a.isLoadingBefore,maxMessageId:a.maxMessageId,maxTimestampMs:a.maxTimestampMs,minMessageId:f,minTimestampMs:e,threadKey:a.threadKey};throw c("unrecoverableViolation")("Thread is missing in updating the min message in message range","maw_threads")})})})}g.call=a}),98);
__d("MAWBridgeXMAShareExpiredHandler",["MAWMiActOnMiThreadReadyForJid","Promise"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,c,d){var e=String(d.xmaId);return a.attachments.get(c,d.msgId,e).then(function(f){if(f==null)return(h||(h=b("Promise"))).resolve();f=[f.defaultCtaId,f.attachmentCta1Id,f.attachmentCta2Id,f.attachmentCta3Id].filter(Boolean);f=f.map(function(b){return a.attachment_ctas["delete"](b)});return(h||(h=b("Promise"))).all(f).then(function(){return a.attachments["delete"](c,d.msgId,e)})})}function a(a,b){return d("MAWMiActOnMiThreadReadyForJid").onMiThreadReadyForJid(a,b.threadJid,"MAWBridgeXMAShareExpiredHandler",function(a,c){return i(a,c,b)})}g.callWithoutWaitingForAnything=i;g.call=a}),98);
__d("MAWBridgeXMAShareTombstonedHandler",["FBLogger","MAWMiActOnMiThreadReadyForJid","Promise","ReQL","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,e){var f=String(e.xmaId);return d("MAWMiActOnMiThreadReadyForJid").onMiThreadReadyForJid(a,e.threadJid,"MAWBridgeXMAShareTombstonedHandler",function(a,g){return a.attachments.get(g,e.msgId,f).then(function(i){if(i==null)return(h||(h=b("Promise"))).resolve();i=[i.defaultCtaId,i.attachmentCta1Id,i.attachmentCta2Id,i.attachmentCta3Id].filter(Boolean);i=i.map(function(b){return a.attachment_ctas["delete"](b)});return(h||(h=b("Promise"))).all(i).then(function(){return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.attachments).getKeyRange(g,e.msgId,f)).then(function(){var d=b("asyncToGeneratorRuntime").asyncToGenerator(function*(d){if(d!=null){d=babelHelpers["extends"]({},d,{attachmentCta1Id:void 0,attachmentCta2Id:void 0,attachmentCta3Id:void 0,cta1Title:void 0,cta1Type:void 0,cta2Title:void 0,cta2Type:void 0,cta3Title:void 0,cta3Type:void 0,defaultCtaId:void 0,defaultCtaTitle:void 0,maxSubtitleNumOfLines:void 0,maxTitleNumOfLines:void 0,previewHeight:void 0,previewHeightLarge:void 0,previewWidth:void 0,previewWidthLarge:void 0,subtitleText:void 0,titleText:void 0});yield a.attachments.put(d)}c("FBLogger")("messenger_web_sharing").blameToPreviousFrame().mustfix("Trying to tombstone a secure xma attachment but no existing attachment");return(h||(h=b("Promise"))).resolve()});return function(a){return d.apply(this,arguments)}}())})})})}g.call=a}),98);
__d("isInstamadilloDYI",["qex"],(function(a,b,c,d,e,f,g){"use strict";function a(){return c("qex")._("665")===!0}g["default"]=a}),98);
__d("MAWBridgeUIEventHandler",["FBLogger","JSResourceForInteraction","MAWAbPropsClient","MAWBridgeAddMessageSearchResultHandler","MAWBridgeCentralizedThreadUpdateHandler","MAWBridgeDeleteGroupInviteHandler","MAWBridgeDeleteMessageRangesV2Handler","MAWBridgeDeleteMessagesHandler","MAWBridgeDeleteReactionHandler","MAWBridgeDropAllSecureThreadsHandler","MAWBridgeEditMsgHistoryAddedHandler","MAWBridgeFulfillRestorePromisePayloadHandler","MAWBridgeGroupInfoUpdatedHandler","MAWBridgeGroupInviteLoadedHandler","MAWBridgeGroupInviteUpdateHandler","MAWBridgeHandleCOPDigest","MAWBridgeMediaExpiredHandler","MAWBridgeMsgRangeLoadedHandler","MAWBridgeMsgUpdatedHandler","MAWBridgeMsgsLoadedHandler","MAWBridgeMsgsStartCountdownHandler","MAWBridgeNewMediaHandler","MAWBridgeNewMediaRangeHandler","MAWBridgeNewMsgHandler","MAWBridgeNewReceiverFetchInfoHandler","MAWBridgeNewXMAHandler","MAWBridgeOccamadilloVerifyThreadExistsHandler","MAWBridgeOneToOneMessageRequestLoadedHandler","MAWBridgeParticipantRemovedHandler","MAWBridgeParticipantUpdatedHandler","MAWBridgeParticipantsUpdatedHandler","MAWBridgeRavenActionMsgForUIHandler","MAWBridgeReactionUpsertHandler","MAWBridgeReceivedChatStateHandler","MAWBridgeReceivedReceiptHandler","MAWBridgeRefreshContactHandler","MAWBridgeRemoveMessageSearchResultHandler","MAWBridgeSyncContacts","MAWBridgeThreadBumpedServerHandler","MAWBridgeThreadBumpedV2Handler","MAWBridgeThreadHiddenV2Handler","MAWBridgeThreadTimestampsHandler","MAWBridgeThreadUpdatedHandler","MAWBridgeUIEventQueueQPLLogger","MAWBridgeUnArchivedSelfDeviceChangeAlertsHandler","MAWBridgeUpdateClientRestoreStatus","MAWBridgeUpdateContactAsConnectedHandler","MAWBridgeUpdateE2EEMetadataParticipantsHandler","MAWBridgeUpdateMessageRangeHandler","MAWBridgeUpdateMinMessageHandler","MAWBridgeXMAShareExpiredHandler","MAWBridgeXMAShareTombstonedHandler","MAWEphemeralMessageExpirationStorage","MAWLoggerUtils","Promise","WAResultOrError","WATagsLogger","WATimeUtils","asyncToGeneratorRuntime","emptyFunction","getErrorSafe","isArmadillo","isInstamadilloDYI","promiseDone","recoverableViolation","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Handle UI Events: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Attempted to call the old DYI V1 flow"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Attempted to call the old DYI V1 flow"]);l=function(){return a};return a}var m=(i=c("requireDeferred"))("MAWBridgeDeleteMessagesOfThreadHandler").__setRef("MAWBridgeUIEventHandler"),n=i("MAWBridgeIssuePointQueryHandler").__setRef("MAWBridgeUIEventHandler"),o=i("MAWBridgeStartTraceHandler").__setRef("MAWBridgeUIEventHandler"),p=i("MAWBridgeStartTraceWithTraceIdHandler").__setRef("MAWBridgeUIEventHandler"),q=i("MAWBridgeTraceRecordCheckpointHandler").__setRef("MAWBridgeUIEventHandler"),r=i("MAWBridgeUpdateTraceHandler").__setRef("MAWBridgeUIEventHandler"),s=i("MAWBridgeUploadMessageByBatchHandler").__setRef("MAWBridgeUIEventHandler"),t=i("MAWBridgeUploadMessageHandler").__setRef("MAWBridgeUIEventHandler");function u(a,e,f){switch(f.tag){case"NewMsg":return d("MAWBridgeNewMsgHandler").call(e,f.value);case"MsgsStartCountdown":return d("MAWBridgeMsgsStartCountdownHandler").call(e,f.value);case"MsgClearCountdown":return(h||(h=b("Promise"))).resolve(d("MAWEphemeralMessageExpirationStorage").clearMessageFromExpiration(f.value));case"DropAllSecureThreads":return d("MAWBridgeDropAllSecureThreadsHandler").call(e);case"VerifyThreadExists":var g=f.value;return d("MAWBridgeOccamadilloVerifyThreadExistsHandler").call(e,g);case"EditMsgHistoryAdded":return d("MAWBridgeEditMsgHistoryAddedHandler").call(a,e,f.value);case"MsgUpdated":return d("MAWBridgeMsgUpdatedHandler").call(e,f.value);case"NewMedia":return d("MAWBridgeNewMediaHandler").call(e,f.value,c("emptyFunction"));case"NewMediaRange":return d("MAWBridgeNewMediaRangeHandler").call(e,f.value);case"MediaExpired":return d("MAWBridgeMediaExpiredHandler").call(e,f.value);case"XMAShareExpired":return d("MAWBridgeXMAShareExpiredHandler").call(e,f.value);case"NewXMA":return d("MAWBridgeNewXMAHandler").call(e,f.value);case"XMAShareTombstoned":return d("MAWBridgeXMAShareTombstonedHandler").call(e,f.value);case"ParticipantUpdated":return d("MAWBridgeParticipantUpdatedHandler").call(e,f.value);case"ParticipantRemoved":return d("MAWBridgeParticipantRemovedHandler").call(e,f.value);case"UpdateE2EEMetadataParticipants":return d("MAWBridgeUpdateE2EEMetadataParticipantsHandler").call(e,f.value);case"ReceivedReceipt":return d("MAWBridgeReceivedReceiptHandler").call(e,f.value);case"ThreadUpdated":return d("MAWBridgeThreadUpdatedHandler").call(e,f.value);case"GroupInfoUpdated":return d("MAWBridgeGroupInfoUpdatedHandler").call(e,f.value);case"ThreadBumpedV2":return d("MAWBridgeThreadBumpedV2Handler").call(e,f.value);case"CentralizedThreadUpdate":return d("MAWBridgeCentralizedThreadUpdateHandler").call(e,f.value);case"ThreadTimestampsUpdated":return d("MAWBridgeThreadTimestampsHandler").call(e,f.value);case"MsgsLoaded":return d("MAWBridgeMsgsLoadedHandler").call(e,f.value);case"MsgRangeLoaded":return d("MAWBridgeMsgRangeLoadedHandler").call(e,f.value);case"StartTrace":return o.load().then(function(a){return a.call(e,f.value)});case"UpdateTrace":return r.load().then(function(a){return a.call(e,f.value)});case"ThreadHiddenV2":return d("MAWBridgeThreadHiddenV2Handler").call(e,f.value);case"SyncContacts":return d("MAWBridgeSyncContacts").call(e,f.value);case"ReceivedChatState":return d("MAWBridgeReceivedChatStateHandler").call(e,f.value);case"ClockSkewUpdated":return(h||(h=b("Promise"))).resolve(d("WATimeUtils").setClockSkew(f.value));case"ABPropsUpdated":c("FBLogger")("messenger_e2ee_web").warn("[messenger_e2ee_web] ABPropsUpdated has been deprecated. Please use the bridge with ABPropsUpdated");return(h||(h=b("Promise"))).resolve(d("MAWAbPropsClient").rewrite(f.value));case"COPDigestReceived":return d("MAWBridgeHandleCOPDigest").call(e,f.value);case"UpsertReaction":return d("MAWBridgeReactionUpsertHandler").call(e,f.value);case"DeleteReaction":return d("MAWBridgeDeleteReactionHandler").call(e,f.value);case"UploadMessage":return t.load().then(function(a){return a.call(e,f.value)});case"UploadMessageByBatch":return s.load().then(function(a){return a.call(e,f.value)});case"DeleteMessagesOfThread":return m.load().then(function(a){return a.call(e,f.value)});case"UploadAttachment":return c("JSResourceForInteraction")("MAWBridgeUploadAttachmentHandler").__setRef("MAWBridgeUIEventHandler").load().then(function(a){return a.call(e,f.value)});case"ResignAttachmentCDNUrl":return c("JSResourceForInteraction")("MAWBridgeResignAttachmentCDNUrlHandler").__setRef("MAWBridgeUIEventHandler").load().then(function(a){return a.call(e,f.value)});case"DeleteMessages":return d("MAWBridgeDeleteMessagesHandler").call(e,f.value);case"RestoreMessageBatch":d("WATagsLogger").TAGS(["labyrinth_web","labyrinth_dyi"]).WARN(l());return(h||(h=b("Promise"))).resolve();case"OneToOneMessageRequestLoaded":return d("MAWBridgeOneToOneMessageRequestLoadedHandler").call(e,f.value);case"GroupInviteUpdate":return d("MAWBridgeGroupInviteUpdateHandler").call(e,f.value);case"UpdateDyiStatus":d("WATagsLogger").TAGS(["labyrinth_web","labyrinth_dyi"]).WARN(k());return(h||(h=b("Promise"))).resolve();case"DeleteGroupInvite":return d("MAWBridgeDeleteGroupInviteHandler").call(e,f.value);case"TraceRecordCheckpoint":return q.load().then(function(a){return a.call(e,f.value)});case"DeleteMessageRangesV2":return d("MAWBridgeDeleteMessageRangesV2Handler").call(e,f.value);case"UpdateMinMessage":return d("MAWBridgeUpdateMinMessageHandler").call(e,f.value);case"IssuePointQuery":return n.load().then(function(a){return a.call(e,f.value)});case"ThreadBumpedServer":return d("MAWBridgeThreadBumpedServerHandler").call(e,f.value);case"ParticipantsUpdated":return d("MAWBridgeParticipantsUpdatedHandler").call(e,f.value);case"StartTraceWithTraceId":return p.load().then(function(a){return a.call(e,f.value)});case"UpdateClientRestoreStatus":return d("MAWBridgeUpdateClientRestoreStatus").call(e,f.value);case"NewMsgs":return d("MAWBridgeNewMsgHandler").bulkCall(e,f.value.msgs);case"UnArchivedSelfDeviceChangeAlerts":return d("MAWBridgeUnArchivedSelfDeviceChangeAlertsHandler").call(e,f.value);case"EphemeralSettingsUpdatedForUI":return c("JSResourceForInteraction")("MAWBridgeEphemeralSettingsUpdatedForUIHandler").__setRef("MAWBridgeUIEventHandler").load().then(function(a){return a.call(e,f.value)});case"RavenActionUpdate":return d("MAWBridgeRavenActionMsgForUIHandler").call(e,f.value);case"GroupInviteLoaded":return d("MAWBridgeGroupInviteLoadedHandler").call(e,f.value);case"UpdateMessageRange":return d("MAWBridgeUpdateMessageRangeHandler").call(e,f.value);case"RemoveMessageSearchResult":return d("MAWBridgeRemoveMessageSearchResultHandler").call(e,f.value);case"AddMessageSearchResult":return d("MAWBridgeAddMessageSearchResultHandler").call(a,e,f.value);case"FulfillRestorePromise":return d("MAWBridgeFulfillRestorePromisePayloadHandler").call(f.value);case"UpdateContactAsConnected":return d("MAWBridgeUpdateContactAsConnectedHandler").call(e,f.value);case"RefreshContact":return d("MAWBridgeRefreshContactHandler").call(e,f.value);case"NewReceiverFetchInfo":return d("MAWBridgeNewReceiverFetchInfoHandler").call(e,f.value);default:return(h||(h=b("Promise"))).resolve()}}function a(a,b){if(!c("isArmadillo")()&&!c("isInstamadilloDYI")()){c("recoverableViolation")("User is neither part of armadillo QE and dual send QE but somehow loaded this handler","maw_worker");return}if(!(b.length===1&&b[0].tag==="TraceRecordCheckpoint")){var e={};e=b.reduce(function(a,b){a[b.tag]=((b=a[b.tag])!=null?b:0)+1;return a},e);d("WATagsLogger").TAGS(["MAWBridgeUIEvent"]).LOG(j(),e)}c("promiseDone")(v(a,b),function(a){},function(a){c("FBLogger")("messenger_e2ee_web").catching(a).mustfix("[MAWBridgeUIEventHandler] Failed to handle UI events: %s",b.map(function(a){return a.tag}).join(", "))})}function v(a,b){return w.apply(this,arguments)}function w(){w=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){var g=(yield a);a=d("MAWLoggerUtils").getInstanceKey();var h=e.map(function(a){return a.tag}),i="";d("MAWBridgeUIEventQueueQPLLogger").start(a,h);var j;try{j=(yield g.runInTransaction(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){for(var b=0;b<e.length;b++){var f=e[b];try{yield u(g,a,f)}catch(a){i=f.tag;return d("WAResultOrError").makeError(c("getErrorSafe")(a))}}return d("WAResultOrError").makeResult(!0)});return function(b){return a.apply(this,arguments)}}(),"readwrite","background",{events:e,type:"maw_ui_bridge"},f.id+":360"))}catch(a){j=d("WAResultOrError").makeError(c("getErrorSafe")(a))}!j.success?(d("MAWBridgeUIEventQueueQPLLogger").endFailure(a,i),c("FBLogger")("messenger_e2ee_web").catching(j.error).mustfix("MAWBridgeUIEventHandler] Did not commit UI events to DB: %s",h.toString())):d("MAWBridgeUIEventQueueQPLLogger").endSuccess(a)});return w.apply(this,arguments)}function e(a,b,c){return x.apply(this,arguments)}function x(){x=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,d){try{yield u(a,b,d)}catch(b){a=c("getErrorSafe")(b);c("FBLogger")("messenger_e2ee_web").catching(a).mustfix("[handleShimEvent] Failed to handle UI event: %s",d.tag);throw b}});return x.apply(this,arguments)}g.handleEvents=a;g.handleShimEvent=e}),98);
__d("MAWCatQuery.graphql",["cr:11203"],(function(a,b,c,d,e,f){"use strict";e.exports=b("cr:11203")}),null);
__d("MAWCatQuery",["MAWCatQuery.graphql"],(function(a,b,c,d,e,f,g){"use strict";var h;a=h!==void 0?h:h=b("MAWCatQuery.graphql");c=a;g["default"]=c}),98);
__d("MAWCatQuery_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="23999698219677129"}),null);
__d("MAWCatQuery.facebook.graphql",["MAWCatQuery_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a=function(){var a=[{alias:null,args:null,concreteType:"SecureMessageOverWACATGraphResult",kind:"LinkedField",name:"secure_message_over_wa_cat_query",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"encrypted_serialized_cat",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"expiration_time_in_seconds",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:[],kind:"Fragment",metadata:null,name:"MAWCatQuery",selections:a,type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[],kind:"Operation",name:"MAWCatQuery",selections:a},params:{id:b("MAWCatQuery_facebookRelayOperation"),metadata:{},name:"MAWCatQuery",operationKind:"query",text:null}}}();e.exports=a}),null);
__d("MAWCommonBackendSetup",["EARInitType","MAWAppMutex","MAWEncryptionIndexedDbV2","MAWInit","MAWInitError","MAWIssueNewUserVisibleErrors","MAWLocalStorage","MAWSetupWorker","MAWVaultMaterialsStorage","MWSetupDBEncryption","Promise","asyncToGeneratorRuntime","requireDeferredForDisplay","shouldUseMAWSharedWorker"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("requireDeferredForDisplay")("MAWMainThreadLogger").__setRef("MAWCommonBackendSetup");function a(a,b,c,d,e){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g,j){yield a.measurePerformance("prepare_logger",b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=i.load();(yield a).setupMainWaLogger()}));var k=d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker();k||(yield a.measurePerformance("detection_support",function(){if(!d("MAWLocalStorage").isLocalStorageAvailable())throw new(d("MAWInitError").MAWInitError)("localstorage_not_supported");return(h||(h=b("Promise"))).resolve()}));var l=a.measurePerformance("setup_vault_materials",function(){return d("MAWVaultMaterialsStorage").setupVaultMaterials()}),m=(yield a.measurePerformance("acquire_mutex",function(){try{var a=d("MAWAppMutex").use().init();return k?a.then(function(){return(h||(h=b("Promise"))).resolve(!0)},function(){return(h||(h=b("Promise"))).resolve(!0)}):a}catch(a){if(k)return(h||(h=b("Promise"))).resolve(!0);throw a}})),n=(yield a.measurePerformance("main_ear_setup",b("asyncToGeneratorRuntime").asyncToGenerator(function*(){d("MWSetupDBEncryption").setPerformanceMeasurementTool(d("MAWInit").MAWInit.measurePerformance);var a=(yield d("MWSetupDBEncryption").init(c("EARInitType").MAW_INIT));d("MAWEncryptionIndexedDbV2").maybeSetEncryptionDbOnVersionChange(function(){var a;(a=d("MAWIssueNewUserVisibleErrors")).issueError(a.MAWLegacyUserErrorMsgBody,a.MAWLegacyUserErrorMsgTitle,a.MAWUserVisibleErrorPresentationType.BANNER)});return a})));if(!n.success){a.logPoint("keychain_setup_failure");throw new(d("MAWInitError").MAWInitError)("keychain_setup_failure",n.payload)}if(!m){a.logPoint("maw_appmutex_no_permission");throw new(d("MAWInitError").MAWInitError)("maw_appmutex_no_permission")}var o=(yield l);yield a.measurePerformance("setup_worker",function(){return d("MAWSetupWorker").getOrSetupWorker(o,e,f,g,j)["catch"](function(a){throw new(d("MAWInitError").MAWInitError)("worker_setup_error",a)})})});return j.apply(this,arguments)}g.setupArmadilloBackend=a}),98);
__d("useMWEncryptedBackupsProcessBackupIdsDeferred",["promiseDone","react","requireDeferred","useAsyncReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i=(h||d("react")).useEffect,j=c("requireDeferred")("MWEncryptedBackupsProcessBackupIdsDEPRECATED").__setRef("useMWEncryptedBackupsProcessBackupIdsDeferred");function a(a){var b=c("useAsyncReStore")();i(function(){var d,e=!1;j.onReadyImmediately(function(f){c("promiseDone")(b,function(b){e||(d=f.subscribeToEncryptedBackupsRow(b,a))})});return function(){e=!0,d==null?void 0:d()}},[b,a])}g["default"]=a}),98);
__d("MAWCommonSetup",["EARInitType","MAWBridgeFireAndForget","MAWCommonBackendSetup","MAWEARKeychainDecryptionError","MAWEncryptedBackupsStateManager","MAWInit","MAWInitError","MAWIsIDBOperational","MAWIssueNewUserVisibleErrors","MAWJobDefinitions","MAWMIC","MAWStateContext.react","MAWUIJob","MAWUnrecoverableDbErrors","MAWWaitForBackendSetup","MWEARKeychainV3","MWSetupDBEncryption","Promise","WABridge","WADynamicRouterSync","WAJobOrchestratorTypes","asyncToGeneratorRuntime","cr:7644","getErrorSafe","gkx","maybeSetupMAWMainThreadLogger","performance","promiseDone","react","requireDeferred","useMWEncryptedBackupsProcessBackupIdsDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;e=j||d("react");var k=e.useContext,l=e.useEffect,m=c("requireDeferred")("FBLogger").__setRef("MAWCommonSetup"),n=!1,o=function(){return(i||(i=c("performance"))).now()},p=function(a){d("MAWEncryptedBackupsStateManager").setEncryptedBackupsState(a),d("MAWBridgeFireAndForget").fireAndForget("backend","setEncryptedBackupsState",{newState:a})};function a(a){var b=k(d("MAWStateContext.react").MAWStateContext),e=b.dispatch,f=d("MAWIsIDBOperational").useIsIDBOperational();l(function(){f&&c("promiseDone")(t(e,a))},[a,e,f]);c("useMWEncryptedBackupsProcessBackupIdsDeferred")(p)}var q,r=new(h||(h=b("Promise")))(function(a){q=function(c){a(c),c.onmessage=function(a){return s.onmessage==null?void 0:s.onmessage(a)},q=function(a){a.onmessage=function(a){return s.onmessage==null?void 0:s.onmessage(a)},r=(h||(h=b("Promise"))).resolve(a)}}}),s={onmessage:null,postMessage:function(a){c("promiseDone")(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var b=(yield r);b.postMessage(a)})())}};function t(a,b){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){var f=e.logout,g=e.reregisterDevice,h=e.rotateCryptoAuthToken,i=e.setupBridge;if(n){void m.load().then(function(a){a("messenger_e2ee_web").warn("Armadillo already setup - return")});return}n=!0;d("MAWMIC").startMAWMICFlow();d("MAWInit").MAWInit.start();b("cr:7644")&&(d("maybeSetupMAWMainThreadLogger").maybeSetupMAWMainThreadLogger(),c("promiseDone")(d("MWSetupDBEncryption").init(c("EARInitType").MAW_IN_UI_INIT).then(function(){return b("cr:7644").makeDB(d("MWEARKeychainV3").getDbEncryptionKey,d("MAWWaitForBackendSetup").waitForBackendSetup("ui_dexie"))}),function(){},function(a){return m.load().then(function(b){return b("messenger_e2ee_web").catching(a).mustfix("UI Dexie initialisation failed: %s",a.message)})}));d("WABridge").makeWABridge(new(d("WADynamicRouterSync").DynamicRouterSync)());try{d("MAWIssueNewUserVisibleErrors").deleteAllErrors(),yield d("MAWCommonBackendSetup").setupArmadilloBackend(d("MAWInit").MAWInit,function(b){var d={close:function(){},onmessage:null,postMessage:function(a){return b.postMessage(a)}},e={close:function(){return b.close()},onmessage:null,postMessage:function(a){return b.postMessage(a)}};q==null?void 0:q(d);b.onmessage=function(a){d.onmessage==null?void 0:d.onmessage(a),e.onmessage==null?void 0:e.onmessage(a)};c("promiseDone")(i({dispatch:a,logout:f,reregisterDevice:g,rotateCryptoAuthToken:h,worker:e}))},function(){a({tag:"InitOfflineQueueSyncComplete",value:void 0}),a({tag:"IsDbMigrating",value:!1}),d("MAWMIC").onConnectToExistingWorker()},function(){a({tag:"InitOfflineQueueSyncComplete",value:void 0}),a({tag:"IsDbMigrating",value:!1})},"mawInit"),d("MAWUIJob").UIJobStarters.fireAndForget(d("MAWJobDefinitions").jobSerializers.handleFutureproofMsg({priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.LOW})),d("MAWInit").MAWInit.addIntAnnotation("endTimePageRelative",o()),d("MAWInit").MAWInit.endSuccess(),d("MAWWaitForBackendSetup").resolveBackendSetup()}catch(a){var j,k=c("getErrorSafe")(a);e=k instanceof d("MAWInitError").MAWInitError?k.message:"maw_init_failure";k.message=(j=k.message)!=null?j:"Unknown";e==="keychain_setup_failure"&&d("MAWUnrecoverableDbErrors").setError(new(d("MAWUnrecoverableDbErrors").EarInitError)(k));j=k.message==="maw_appmutex_no_permission"&&document.visibilityState!=="visible";j?d("MAWInit").MAWInit.cancel(e,k):(d("MAWWaitForBackendSetup").rejectBackendSetup(k),d("MAWInit").MAWInit.fail(e,k));d("MAWIssueNewUserVisibleErrors").issueError(d("MAWIssueNewUserVisibleErrors").MAWGeneralErrorMsgBody,d("MAWIssueNewUserVisibleErrors").MAWGeneralErrorMsgTitle,d("MAWIssueNewUserVisibleErrors").MAWUserVisibleErrorPresentationType.BANNER,c("gkx")("218")&&k instanceof d("MAWInitError").MAWInitError&&k.error instanceof c("MAWEARKeychainDecryptionError")?"MAWEARKeychainDecryptionError":k.message);k&&void m.load().then(function(a){a("messenger_e2ee_web").catching(k).mustfix("MAW backend setup failed -- %s",k.message)});throw k}});return u.apply(this,arguments)}g.useArmadillo=a;g.workerProxy=s}),98);
__d("MAWCommonSetupBridge",["BrowserLockManager","CurrentUser","ErrorTransport","I64","LSDatabaseSingleton","LSIntEnum","LSMessagingThreadAttributionType","MAWBridge","MAWChatJid","MAWCrossWorkerPortal","MAWCurrentUser","MAWDbMedia","MAWEBSwitch","MAWFrontendMediaUtils","MAWJobActionsV2","MAWMICSafe","MAWThreadCutover","MAWVault","MAWXMAUtils","MWLogSend","MultipleTabsLogger","ODS","Promise","QPLEvent","QPLUserFlow","URLMatcher","WACrossWorkerPortal","WADevToolMessageChannel","WADevToolsBridge","WAExceededStorageQuota","WAJids","WALogger","cr:2691","err","gkx","justknobx","pageID","promiseDone","qpl","requireDeferred","shouldUseMAWSharedWorker"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m;function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["fbErrorProxy: "," ",""]);n=function(){return a};return a}var o=c("requireDeferred")("MAWMainThreadLogger").__setRef("MAWCommonSetupBridge"),p=new Set([25312111,25311870]),q=new Map(),r=new Map(),s=new Map([[(a=d("MAWDbMedia")).MEDIA_TYPE.IMAGE,8],[a.MEDIA_TYPE.VIDEO,10],[a.MEDIA_TYPE.GIF,6],[a.MEDIA_TYPE.STICKER,4],[a.MEDIA_TYPE.PTT,11],[a.MEDIA_TYPE.DOCUMENT_FILE,9]]),t=new Set([25312150,25313100,1056840931,25299294]);function u(a,b){return a+"_"+b}function v(a,b,c,d,e,f,g,h){if(e)return 43;if(a==="revokeMsg")return 26;if(f!=null)return f;if(c)return 3;if(d&&g===!1)return 13;if(h===!0)return 13;e=b!=null?s.get(b):null;return(a=e)!=null?a:0}function w(a,b,e){return(i||(i=d("LSDatabaseSingleton"))).LSDatabaseSingleton.then(function(f){return d("MAWThreadCutover").isCutoverSecureThreadFromChatJid(f,a).then(function(a){c("QPLUserFlow").addAnnotations(b,{bool:{is_cutover:a}},{instanceKey:e})})})}var x={fbErrorProxy:function(a){var b;d("ErrorTransport").log(a);d("WALogger").ERROR(n(),(b=a==null?void 0:a.messageFormat)!=null?b:"unknown",a==null?void 0:(b=a.messageParams)==null?void 0:b.toString())},log:function(a){var b=a.logLevel,c=a.logString,d=a.tags;switch(b){case"log":o.onReadyImmediately(function(a){a=a.info;return a(c,d)});return;case"warn":o.onReadyImmediately(function(a){a=a.warn;return a(c,d)});return;case"logRestricted":o.onReadyImmediately(function(a){a=a.logRestricted;return a(c,d)});return;case"debug":break;case"error":break;default:break}},logError:function(a){var b=a.entriesToReport,c=a.framesToPop,d=a.logString,e=a.message,f=a.stack,g=a.tags;o.onReadyImmediately(function(a){a=a.logError;return a(d,g,e,f,c,b)})},odsBumpEntityKey:function(a){var b=a.amount,e=a.entity;a=a.key;(j||(j=d("ODS"))).bumpEntityKey(3185,e,a+"."+(c("CurrentUser").getAppID()||"unknown"),b)},onJobFinished:function(a){a.type==="createGroup"&&a.originalArgs.key!=null&&d("MAWJobActionsV2").recentFinishedJobsCache.set(a.originalArgs.key,a.result);switch(a.type){case"sendMsg":case"sendMediaMsg":case"sendReactionMsg":case"sendXMAShareMsg":case"forwardMsg":var b=a.originalArgs.chatJid,e=a.type==="sendXMAShareMsg"?a.originalArgs.xmaMsgExternalId:a.originalArgs.externalId;q.set(u(b,e),babelHelpers["extends"]({},a.originalArgs,{type:"sendMsg"}));break;case"sendEditMsg":b=a.originalArgs.args.originalProtocolMsgId.chat;e=a.originalArgs.externalId;q.set(u(b,e),babelHelpers["extends"]({},a.originalArgs,{chatJid:b,type:"editMsg"}));break;case"revokeMsgs":e=a.result;e.forEach(function(a){var b=a.deleting;a=a.original;q.set(u(b.chat,b.externalId),{chatJid:a.chat,externalId:a.externalId,type:"revokeMsg"})});break;case"sendAppData":b=a.originalArgs;var f=a.result;(e=b.args.contents.actions)==null?void 0:e.forEach(function(a){a=a.messageAction;if(a==null||a.type!=="delete_for_me"||f.type!=="not_sent")return;r.set(f.appDataExternalId,{chatJid:a.protocolMsgId.chat,externalId:a.protocolMsgId.externalId,type:"deleteMsgForMe"})});break}if(a.type==="sendWrittenMsg"){b=a.originalArgs.protocolMsgId;e=b.chat;b=b.externalId;e=u(e,b);var g=q.get(e);q["delete"](e);if(a.result.success&&g!=null){var h,j=g.type!=="revokeMsg"?b:g.externalId,m=g.args,n=g.chatJid;e=g.file;b=g.type;g=g.type==="editMsg";var o=(m==null?void 0:m.reactToAuthor)!=null,p=null;o&&(p=(m==null?void 0:m.reaction)!=null?20:27);o=(m==null?void 0:m.specialTextSize)!=null;e=e!=null?d("MAWFrontendMediaUtils").getMediaTypeAndServerMediaTypeFromBlob(e.type).mediaType:null;var s=(m==null?void 0:m.xmaMessageType)!=null,t=(m==null?void 0:m.quote)!=null||d("MAWXMAUtils").isXMAStoryReply(m==null?void 0:m.xmaMessageType);h=c("URLMatcher").match(d("MAWVault").unvault((h=m==null?void 0:m.content)!=null?h:""));h=h!=null&&h.length>0;var w=v(b,e,o,s,g,p,t,h),x=d("WAJids").switchOnMsgrChatJidType(n,{group:function(){return(k||(k=d("LSIntEnum"))).ofNumber(16)},user:function(){return(k||(k=d("LSIntEnum"))).ofNumber(15)}});c("promiseDone")((i||(i=d("LSDatabaseSingleton"))).LSDatabaseSingleton.then(function(a){var b=(m==null?void 0:m.source)!=null?m.source:(k||(k=d("LSIntEnum"))).ofNumber(c("LSMessagingThreadAttributionType").UNKNOWN);c("promiseDone")(d("MAWChatJid").toThreadKey(a.tables,n,"MAWCommonSetupBridge::sendWrittenMsg").then(function(e){var f;if(c("justknobx")._("154")&&d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker()&&(c("BrowserLockManager")!=null&&!d("MultipleTabsLogger").hasUniqueLock()))return;d("MWLogSend").log(a,{actor:(l||(l=d("I64"))).of_string(d("MAWCurrentUser").getID()),attachmentFbids:[],attachmentType:w,backend:1,hasReply:t,initatingSource:m==null?void 0:m.initiatingSource,messagingThreadId:l.to_string(e),msgTtl:m==null?void 0:(f=m.ephemeralSetting)==null?void 0:f.ephemeralExpirationInSec,offlineThreadingId:j,sendType:1,source:b,threadKey:e,threadType:x})}))}))}}if(a.type==="sendWrittenAppData"){b=a.originalArgs.appDataExternalId;e=r.get(b);r["delete"](b);if(e!=null&&e.type==="deleteMsgForMe"&&a.result.type==="success"){var y=e.chatJid,z=e.externalId,A=d("WAJids").switchOnMsgrChatJidType(y,{group:function(){return(k||(k=d("LSIntEnum"))).ofNumber(16)},user:function(){return(k||(k=d("LSIntEnum"))).ofNumber(15)}});c("promiseDone")((i||(i=d("LSDatabaseSingleton"))).LSDatabaseSingleton.then(function(a){c("promiseDone")(d("MAWChatJid").toThreadKey(a.tables,y,"MAWCommonSetupBridge::sendWrittenAppData").then(function(b){d("MWLogSend").log(a,{actor:(l||(l=d("I64"))).of_string(d("MAWCurrentUser").getID()),attachmentFbids:[],attachmentType:25,backend:1,hasReply:!1,messagingThreadId:l.to_string(b),offlineThreadingId:z,sendType:3,source:(k||(k=d("LSIntEnum"))).ofNumber(c("LSMessagingThreadAttributionType").UNKNOWN),threadKey:b,threadType:A})}))}))}}},qplEvent:function(a){var e=a.action,f=a.annotations,g=a.debugInfo,i=a.error,j=a.event,k=a.instanceKey,l=a.timeoutInMs,n=a.timestamp;if(!c("CurrentUser").isEmployee()&&p.has((m||(m=d("QPLEvent"))).getMarkerId(j)))return;var o=k||0;k=f==null?void 0:(a=f.string)==null?void 0:a.jid;a=k!=null?d("WAJids").validateChatJid(k):void 0;k=t.has((m||(m=d("QPLEvent"))).getMarkerId(j))&&a!=null?w(a,j,o):(h||(h=b("Promise"))).resolve();switch(e.type){case"start":c("QPLUserFlow").start(j,{annotations:babelHelpers["extends"]({},f||{},{bool:babelHelpers["extends"]({},(f==null?void 0:f.bool)||{},{is_eb_enabled:c("MAWEBSwitch").isEnabled(),is_pdb:c("gkx")("24032"),isArmadilloPublicLaunchUser:c("gkx")("23405"),isDev:0,isGifSearchEnbled:!0,isM1M2OverrideUser:c("gkx")("24022"),isRestoreDBEnabled:c("gkx")("23906"),isTlcPublicUser:d("MAWCurrentUser").isTlcPublicUser(),useSharedWorker:d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker()})}),instanceKey:o,timeoutInMs:l,timestamp:n});break;case"success":c("QPLUserFlow").addAnnotations(j,{bool:{exceededStorageQuota:d("WAExceededStorageQuota").getExceededStorageQuota(),isRelaxedDurability:!0}},{instanceKey:o});k["finally"](function(){c("QPLUserFlow").endSuccess(j,{annotations:f,instanceKey:o,timestamp:n})});break;case"cancel":c("QPLUserFlow").addAnnotations(j,{bool:{exceededStorageQuota:d("WAExceededStorageQuota").getExceededStorageQuota(),isRelaxedDurability:!0}},{instanceKey:o});k["finally"](function(){c("QPLUserFlow").endCancel(j,{annotations:f,instanceKey:o,timestamp:n})});break;case"point":f&&c("QPLUserFlow").addAnnotations(j,f,{instanceKey:o});(m||(m=d("QPLEvent"))).getMarkerId(j)===1056839232?d("MAWMICSafe").markEvent(e.name,n):c("QPLUserFlow").addPoint(j,e.name,{instanceKey:o,timestamp:n});break;case"annotations":c("QPLUserFlow").addAnnotations(j,(a=f)!=null?a:{},{instanceKey:o});break;case"failure":c("QPLUserFlow").addAnnotations(j,{bool:{exceededStorageQuota:d("WAExceededStorageQuota").getExceededStorageQuota(),isRelaxedDurability:!0}},{instanceKey:o});k["finally"](function(){c("QPLUserFlow").endFailure(j,e.name,{annotations:f,instanceKey:o,timestamp:n})});break;case"error":c("QPLUserFlow").markError(j,e.name,{debugInfo:g,error:i,instanceKey:o});break;default:throw c("err")("Bridge sends unreachable qplEvent action type")}}},y=function(a,b){a.push(b);return a};e=function(a){var e=a.customizeEventHandlers;a=a.worker;var f=d("MAWBridge").getBridge();f.setHandlers("event",babelHelpers["extends"]({},x,e));e=d("MAWCrossWorkerPortal").getOrCreateCrossWorkerPortal(f,["backend"],y,{onAfterSend:function(a){a=(a=a.content.arg)==null?void 0:(a=a.args)==null?void 0:(a=a.args)==null?void 0:a.s2sInstanceKey;a!=null&&c("QPLUserFlow").addPoint(c("qpl")._(25313175,"1551"),"cross_worker_portal_bridge_called",{instanceKey:a})},onBeforeSend:function(a){a=(a=a.content.arg)==null?void 0:(a=a.args)==null?void 0:(a=a.args)==null?void 0:a.s2sInstanceKey;a!=null&&c("QPLUserFlow").addPoint(c("qpl")._(25313175,"1551"),"cross_worker_portal_calling_bridge",{instanceKey:a})}});e.setPort(a);if(c("gkx")("3282")){var g=d("WADevToolsBridge").getDevToolBridge();a=new MessageChannel();var i=d("WACrossWorkerPortal").attachPortal(g,["backend"],y,c("pageID")),j=d("WACrossWorkerPortal").attachPortal(g,["devtool"],y,c("pageID"));d("WADevToolMessageChannel").onCreateNewChannel(function(a){i.setPort(a.port1)});j.setPort(a.port1);b("cr:2691")==null?void 0:b("cr:2691").connectAddonPort(a.port2);e.addListener(function(a,b){return g.fireAndForget("devtool","bridgeMessage",{direction:b==="outgoing"?"toWorker":"toMain",msg:a,ts:Date.now()},!0)})}return(h||(h=b("Promise"))).resolve(f)};g.MEDIA_TYPE_TO_ATTACHMENT_TYPE=s;g.initBridge=e}),98);
__d("MAWCryptoAuthToken",["FBLogger","MAWCatQuery","RelayHooks"],(function(a,b,c,d,e,f,g){"use strict";function h(a){return a==null||a.secure_message_over_wa_cat_query==null||a.secure_message_over_wa_cat_query.encrypted_serialized_cat==null||a.secure_message_over_wa_cat_query.expiration_time_in_seconds==null?{error:"Crypto Auth Token was null or incomplete"}:{success:{encrypted_serialized_cat:a.secure_message_over_wa_cat_query.encrypted_serialized_cat,expiration_time_in_seconds:a.secure_message_over_wa_cat_query.expiration_time_in_seconds}}}function a(a){return d("RelayHooks").fetchQuery(a,c("MAWCatQuery"),{}).toPromise().then(h).then(function(a){if(a.error!==null&&a.error!==void 0)throw c("FBLogger")("maw_device_reg").mustfixThrow("[MAWCryptoAuthToken] Error while fetching CAT from GraphQL: %s",a.error);return a.success})}g.fetchFreshCAT=a}),98);
__d("MAWDBUsageMetrics",["FBLogger","WebStorageEstimator","asyncToGeneratorRuntime","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h=c("requireDeferred")("WebStorageManagerEstimatesFalcoEvent").__setRef("MAWDBUsageMetrics");function a(){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{var a=(yield d("WebStorageEstimator").estimateStorage());h.onReady(function(b){c("FBLogger")("maw_db").debug("Sending storage manager estimates falco event, quota: %s, usage: %s, usage_details: %s",a==null?void 0:a.quota,a==null?void 0:a.usage,JSON.stringify(a==null?void 0:a.usageDetails)),b.log(function(){var b;return{quota:String((b=a==null?void 0:a.quota)!=null?b:0),usage:String((b=a==null?void 0:a.usage)!=null?b:0),usage_details:{caches:String((b=a==null?void 0:(b=a.usageDetails)==null?void 0:b.caches)!=null?b:0),indexedDB:String((b=a==null?void 0:(b=a.usageDetails)==null?void 0:b.indexedDB)!=null?b:0),serviceWorkerRegistrations:String((b=a==null?void 0:(b=a.usageDetails)==null?void 0:b.serviceWorkerRegistrations)!=null?b:0)}}})})}catch(a){c("FBLogger")("maw_db").warn("Error while getting the storage manager estimate: %s",a);return}});return i.apply(this,arguments)}g.logMAWDBUsageMetrics=a}),98);
__d("toMsgrUserJid",["MAWJids"],(function(a,b,c,d,e,f,g){"use strict";g["default"]=d("MAWJids").toUserJid}),98);
__d("MAWFetchContacts",["I64","LSContactTypeExact","LSIntEnum","MAWContactRelationshipType","ReQL","WAJids","asyncToGeneratorRuntime","requireDeferred","toMsgrUserJid"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=c("requireDeferred")("LSDatabaseSingletonLazyWrapper").__setRef("MAWFetchContacts");function k(a){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield j.load());b=(yield b());var e=new Set(a.map(function(a){return d("WAJids").extractUserId(a)}));return d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(b.tables.contacts).filter(function(a){return e.has((h||(h=d("I64"))).to_string(a.id))})).then(function(a){return new Map(a.map(function(a){return[c("toMsgrUserJid")((h||(h=d("I64"))).to_string(a.id)),a]}))})});return l.apply(this,arguments)}function a(a){return k(a).then(function(a){var b=new Map();a.forEach(function(a,c){b.set(c,d("MAWContactRelationshipType").getContactRelationshipType(a))});return b})}function e(a){return k(a).then(function(a){var b=new Map();a.forEach(function(a,e){a=a.contactTypeExact!=null&&(h||(h=d("I64"))).equal(a.contactTypeExact,(i||(i=d("LSIntEnum"))).ofNumber(c("LSContactTypeExact").MESSENGER_ONLY_NOT_ALLOWED_ON_FB));b.set(e,a)});return b})}g.fetchContacts=k;g.fetchContactsRelationships=a;g.fetchContactsIsMsplit=e}),98);
__d("MWXProgressRing.react",["cr:6782","cr:6783","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(a){var c=a.color,d=a.percentage;a=a.size;if(b("cr:6782")!=null){var e;return i.jsx(b("cr:6782"),{color:(e=c)!=null?e:"light",percentage:(e=d)!=null?e:0,size:(e=a)!=null?e:16})}return b("cr:6783")!=null?i.jsx(b("cr:6783"),{color:c,percentage:d,size:a}):null}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("mwReplaceToast",["BaseToasterStateManager","MWXToast.react","err","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react"),j=c("BaseToasterStateManager").getInstance();function a(a){var b=a.body,d=a.icon,e=a.startAddOn;e=e===void 0?null:e;var f=a.supressCloseButton;f=f===void 0?!1:f;var g=a.title,h=a.toastId;if(h==null){c("err")("toastId or toasterStateManager is not provided");return}j.replace(h,i.jsx(c("MWXToast.react"),{body:b,icon:d,onDismiss:function(){return j.expire(h)},startAddOn:e,supressCloseButton:f,title:g}))}g.mwReplaceToast=a}),98);
__d("MAWLoadingSpinner.react",["BaseToasterStateManager","MWXIconCheckmarkCircle","MWXIconStrict.react","MWXProgressRing.react","MWXSpinner.react","mwPushToast","mwReplaceToast","react","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||(h=d("react"));b=h;var j=b.useEffect,k=b.useLayoutEffect,l=b.useRef,m=c("BaseToasterStateManager").getInstance();function n(a,b,d,e){e===void 0&&(e=0);if(a==="spinner")return{icon:{comet:i.jsx(c("MWXSpinner.react"),{color:b?"light":"dark",size:24})},startAddOn:{type:"spinner"},title:d};else if(a==="progressRing")return{icon:{comet:i.jsx(c("MWXProgressRing.react"),{color:b?"light":"dark",size:24})},startAddOn:{source:e,type:"progressRing"},title:d};else return{icon:{comet:i.jsx(c("MWXSpinner.react"),{color:b?"light":"dark",size:24})},startAddOn:{type:"spinner"},title:d}}function o(a,b){d("mwReplaceToast").mwReplaceToast({icon:{comet:i.jsx(c("MWXIconStrict.react"),{icon:c("MWXIconCheckmarkCircle"),size:24}),mds:c("MWXIconCheckmarkCircle").component},title:b,toastId:a})}function a(a,b,e,f,g,h){var i=l();k(function(){if(g)i.current==null?i.current=d("mwPushToast").mwPushToast(n(a,b,e,h),Number.MAX_SAFE_INTEGER):d("mwReplaceToast").mwReplaceToast(babelHelpers["extends"]({},n(a,b,e,h),{toastId:i.current}));else if(i.current!=null){var j=i.current;o(j,f);c("setTimeout")(function(){m.expire(j),i.current=void 0},2750)}},[g,b,a,e,h,f]);j(function(){return function(){i.current!=null&&m.expire(i.current)}},[])}g.useMAWLoadingSpinner=a}),98);
__d("MAWLoadingStateToastSelectors",[],(function(a,b,c,d,e,f){"use strict";a=function(a){return a.offlineQueueCount};b=function(a){return a.offlineQueueProgressDownloaded};c=function(a){return a.offlineQueueProgressProcessed};f.offlineQueueCountSelector=a;f.offlineQueueProgressCountSelector=b;f.offlineQueueConsumerProgressCountSelector=c}),66);
__d("MAWLoadingStateSpinner.react",["fbt","CometDarkModeContext","MAWLoadingSpinner.react","MAWLoadingStateToastSelectors","MAWStateContext.react","react","useMAWOfflineQueueLoadingIndicator"],(function(a,b,c,d,e,f,g,h){"use strict";var i;i||(i=d("react"));b=i;e=b.memo;var j=b.useContext,k=function(a){return h._("__JHASH__LlHcIvsh5It__JHASH__",[h._param("restoredPercentage",a.toFixed(0).toString())])},l=h._("__JHASH__EPxp6BXcf-B__JHASH__");function m(a,b,c){if(c===0)return 100;a=50*(a/c);b=50*(b/c);return Math.min(100,b+a)}function a(){var a=j(c("CometDarkModeContext")).currentSetting==="ENABLED",b=c("useMAWOfflineQueueLoadingIndicator")(!0),e=d("MAWStateContext.react").useMAWSelector(d("MAWLoadingStateToastSelectors").offlineQueueCountSelector),f=d("MAWStateContext.react").useMAWSelector(d("MAWLoadingStateToastSelectors").offlineQueueProgressCountSelector),g=d("MAWStateContext.react").useMAWSelector(d("MAWLoadingStateToastSelectors").offlineQueueConsumerProgressCountSelector);f=m(f,g,e);g=k(f);d("MAWLoadingSpinner.react").useMAWLoadingSpinner("progressRing",a,g,l,b,f);return null}a.displayName=a.name+" [from "+f.id+"]";b=e(a);g["default"]=b}),226);
__d("MAWMigrationStateToastSelector.react",[],(function(a,b,c,d,e,f){"use strict";a=function(a){return a.isDbMigrating};f.isDbMigratingSelector=a}),66);
__d("MAWMigrationStateSpinner.react",["fbt","CometDarkModeContext","MAWLoadingSpinner.react","MAWMigrationStateToastSelector.react","MAWStateContext.react","react"],(function(a,b,c,d,e,f,g,h){"use strict";var i;i||(i=d("react"));b=i;e=b.memo;var j=b.useContext,k=h._("__JHASH__BcL_Hf5UaRM__JHASH__"),l=h._("__JHASH__UJ0S4v9Hktq__JHASH__");function a(){var a=j(c("CometDarkModeContext")).currentSetting==="ENABLED",b=d("MAWStateContext.react").useMAWSelector(d("MAWMigrationStateToastSelector.react").isDbMigratingSelector);d("MAWLoadingSpinner.react").useMAWLoadingSpinner("spinner",a,k,l,b);return null}a.displayName=a.name+" [from "+f.id+"]";b=e(a);g["default"]=b}),226);
__d("MAWOccamadilloOnMutexChange",["I64","LSDefaultSyncGroups","LSIntEnum","LSSyncGroupsUtils","Promise","WALogger","isOccamadilloResumeSyncEnabled","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Occamadillo] Resetting sync cursor and network request"]);k=function(){return a};return a}function l(a){var e=d("LSDefaultSyncGroups").e2eeMetadataSyncGroup;if(!c("isOccamadilloResumeSyncEnabled")()&&e!=null)return a.sync_groups.put(babelHelpers["extends"]({},d("LSSyncGroupsUtils").defaultSyncGroup,{groupId:(j||(j=d("LSIntEnum"))).ofNumber(e.groupId)}));else return(h||(h=b("Promise"))).resolve()}function m(a){if(!c("isOccamadilloResumeSyncEnabled")())return a.network_requests.put({epochId:void 0,failureCount:(i||(i=d("I64"))).zero,lastDelayedRequestTimestampMs:void 0,lastSentTimestampMs:i.zero,lastSyncRequestTimestampMs:i.zero,networkTaskIdentifier:void 0,syncDatabaseId:(j||(j=d("LSIntEnum"))).ofNumber(95),taskQueueName:""});else return(h||(h=b("Promise"))).resolve()}function a(a){d("WALogger").LOG(k()),c("promiseDone")(a.runInTransaction(function(a){return(h||(h=b("Promise"))).all([l(a),m(a)])},"readwrite",void 0,void 0,f.id+":58"))}g.onOccamadilloMutexChange=a}),98);
__d("MAWReinit",["ExecutionEnvironment","MAWCurrentUser","MAWEBSwitch","QPLUserFlow","QuickPerformanceLogger","WAGetStorageQplAnnotations","asyncToGeneratorRuntime","gkx","qpl","shouldUseMAWSharedWorker"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=c("qpl")._(25310984,"169");function a(a){var e=a!=null?{instanceKey:a}:void 0,f=!1,g=!1;function k(){if(g)return;g=!0;c("QPLUserFlow").start(j,babelHelpers["extends"]({cancelOnUnload:!0,onFlowTimeout:function(){f=!0},timeoutInMs:(h||(h=c("ExecutionEnvironment"))).canUseDOM?6e4:0},e));void d("WAGetStorageQplAnnotations").getStorageQplAnnotations().then(function(a){c("QPLUserFlow").addAnnotations(j,a)});s()}function l(a){if(!g||f)return;s();c("QPLUserFlow").addPoint(j,a,e)}function m(a,b){var d;if(!g||f)return;c("QPLUserFlow").addAnnotations(j,{bool:(d={},d[a]=b,d)})}function n(a,b){var d;if(!g||f)return;c("QPLUserFlow").addAnnotations(j,{string:(d={},d[a]=b,d)})}function o(a,b){var d;if(!g||f)return;c("QPLUserFlow").addAnnotations(j,{"int":(d={},d[a]=b,d)})}function p(a){s(),f=!0,c("QPLUserFlow").addAnnotations(j,{string:{failReason:a}},e),c("QPLUserFlow").endFailure(j,"maw_init_fail",e),r=!1}function q(a){s(),f=!0,r=!1,c("QPLUserFlow").addAnnotations(j,{string:{dropReason:a}},e),(i||(i=c("QuickPerformanceLogger"))).markerDrop(j)}var r=!1;function s(){if(r)return;r=!0;c("QPLUserFlow").addAnnotations(j,{bool:{armadillo_init_sync_api_improvements:c("gkx")("24025"),is_eb_enabled:c("MAWEBSwitch").isEnabled(),isArmadilloPublicLaunchUser:c("gkx")("23405"),isTlcPublicUser:d("MAWCurrentUser").isTlcPublicUser(),useSharedWorker:d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker()}})}function t(a){s(),f=!0,c("QPLUserFlow").addAnnotations(j,{string:{cancelReason:a}},e),c("QPLUserFlow").endCancel(j,e),r=!1}function u(){s(),f=!0,c("QPLUserFlow").endSuccess(j,e),r=!1}function v(a,b){return w.apply(this,arguments)}function w(){w=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=a+"_start";a=a+"_end";l(c);c=(yield b());l(a);return c});return w.apply(this,arguments)}return{addBoolAnnotation:m,addIntAnnotation:o,addStringAnnotation:n,cancel:t,drop:q,endSuccess:u,fail:p,logPoint:l,measurePerformance:v,start:k}}g.getMAWReinit=a}),98);
__d("MAWReinitWorker",["MAWCommonBackendSetup","MAWOccamadilloOnMutexChange","MAWReinit","asyncToGeneratorRuntime","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.allTablesPersisted,e=a.db,f=a.dispatch,g=a.dispatchClearEphemeralSettings,h=a.instanceKey,i=a.logout,j=a.reregisterDevice,k=a.rotateCryptoAuthToken,l=a.setupBridge;a=a.workerCreateReason;h=d("MAWReinit").getMAWReinit(h);h.start();var m=function(){f({tag:"InitOfflineQueueSyncComplete",value:void 0}),f({tag:"IsDbMigrating",value:!1})};yield d("MAWCommonBackendSetup").setupArmadilloBackend(h,function(a){c("promiseDone")(l({dispatch:f,logout:i,reregisterDevice:j,rotateCryptoAuthToken:k,worker:a}).then(function(){b||d("MAWOccamadilloOnMutexChange").onOccamadilloMutexChange(e)}))},m,m,a);h.endSuccess();g()});return h.apply(this,arguments)}g["default"]=a}),98);
__d("MAWSetupBridgeIsDbMigrating",[],(function(a,b,c,d,e,f){"use strict";a=function(a){return function(b){b=b.status;switch(b){case!0:a({tag:"IsDbMigrating",value:!0});return;case!1:a({tag:"IsDbMigrating",value:!1});return}}};b=a;f["default"]=b}),66);
__d("MAWSetupBridgeOfflineConsumer",["InteractionTracingMetrics","MAWBridgeInitOfflineQueueSyncCompleteHandler","MAWMIC","MAWOfflineQueueStatus","MAWSharedProtocolQueueConst","MWChatInteraction","WATagsLogger","asyncToGeneratorRuntime","cr:9793","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Stats failed: expected: ",", processed: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Stats end: expected: ",", processed: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Stats: expected: ",", processed: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Stats start: ",""]);k=function(){return a};return a}var l=d("WATagsLogger").TAGS(["ServerRPC","OfflineConsumer"]);function m(a){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield a;b("cr:9793")!=null&&b("cr:9793").prewarmMediaWasmWorker("mp4CheckAndRepair");return d("MAWBridgeInitOfflineQueueSyncCompleteHandler").call()});return n.apply(this,arguments)}function o(a){d("MAWMIC").addIntAnnotation("offlineQueueSize",a);var b=d("MWChatInteraction").get(d("MWChatInteraction").MW_AUTO_CHAT_TAB_OPEN);b!=null&&c("InteractionTracingMetrics").addAnnotationInt(b,"offlineQueueSize",a)}function p(a,b){var e=d("MWChatInteraction").get(d("MWChatInteraction").MW_AUTO_CHAT_TAB_OPEN);e!=null&&c("InteractionTracingMetrics").addSubspan(e,"offline_queue","LONGTASK",a,b,{})}function a(a,b){return function(e){var f=e.chatJidStatus,g=e.status,n=e.timestamp,q=e.totalExpectedCount,r=e.totalProcessedCount;switch(g){case d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Initializing:l.LOG(k(),q);o(q);b({tag:"InitOfflineQueueSyncStart",value:q});d("MAWOfflineQueueStatus").markThreadWithOfflineQueueStatus(f,d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Initializing);d("MAWMIC").markEvent("worker_process_offline_queue_start",n);d("MAWOfflineQueueStatus").resetOfflineQueueState();return;case d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Processing:l.LOG(j(),q,r);b({tag:"InitOfflineQueueConsumerSyncProgress",value:{chatJidStatus:f,processed:r}});d("MAWOfflineQueueStatus").markThreadWithOfflineQueueStatus(f,d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Processing);return;case d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Complete:l.LOG(i(),q,r);e.startTime!=null&&p(e.startTime,n);b({tag:"InitOfflineQueueSyncComplete",value:f});c("promiseDone")(m(a));d("MAWOfflineQueueStatus").markThreadWithOfflineQueueStatus(f,d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Complete);d("MAWMIC").markEvent("worker_process_offline_queue_end",n);d("MAWOfflineQueueStatus").markOfflineQueueComplete();return;case d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Failed:l.LOG(h(),q,r);d("MAWMIC").markEvent("worker_process_offline_queue_failed",n);d("MAWMIC").markEvent("worker_process_offline_queue_end",n);b({tag:"InitOfflineQueueSyncComplete",value:void 0});c("promiseDone")(m(a));d("MAWOfflineQueueStatus").markThreadWithOfflineQueueStatus(f,d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Failed);d("MAWOfflineQueueStatus").markOfflineQueueComplete();return}}}g["default"]=a}),98);
__d("MAWSetupBridgeOfflineSnapshot",["InteractionTracingMetrics","MAWMIC","MWChatInteraction","WAOfflineUtils","WATagsLogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["WA infra offline connection lost"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Stats end: "," / ",", messages: "," / ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Progress: "," / ",", messages: "," / ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Stats start: ",", messages: ",""]);k=function(){return a};return a}var l=d("WATagsLogger").TAGS(["ServerRPC","Offline"]);function m(a){d("MAWMIC").addIntAnnotation("offlineQueueSize",a);var b=d("MWChatInteraction").get(d("MWChatInteraction").MW_AUTO_CHAT_TAB_OPEN);b!=null&&c("InteractionTracingMetrics").addAnnotationInt(b,"offlineQueueSize",a)}a=function(a){return function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var c=b.downloaded,e=b.expected,f=b.status;b=b.timestamp;switch(f){case d("WAOfflineUtils").WAClientInfraOfflineProgress.Initializing:l.LOG(k(),e.count,e.message);m(e.count);a({tag:"InitOfflineQueueSyncStart",value:e.count});d("MAWMIC").markEvent("worker_download_offline_queue_start",b);return;case d("WAOfflineUtils").WAClientInfraOfflineProgress.Processing:l.LOG(j(),c.count,e.count,c.message,e.message);a({tag:"InitOfflineQueueSyncProgress",value:c.count});return;case d("WAOfflineUtils").WAClientInfraOfflineProgress.Complete:l.LOG(i(),c.count,e.count,c.message,e.message);d("MAWMIC").addIntAnnotation("offlineQueueDownloadedCount",c.count);a({tag:"InitOfflineQueueSyncProgress",value:e.count});d("MAWMIC").markEvent("worker_download_offline_queue_end",b);return;case d("WAOfflineUtils").WAClientInfraOfflineProgress.Failed:l.LOG(h());d("MAWMIC").markEvent("worker_download_offline_queue_connection_lost",b);return}});return function(a){return c.apply(this,arguments)}}()};e=a;g["default"]=e}),98);
__d("MAWSetupUpdateMediaStatus",[],(function(a,b,c,d,e,f){"use strict";a=function(a){return function(b){var c=b.details,d=b.key,e=b.status;b=b.type;a({tag:"UpdateMediaStatus",value:{details:c,key:d,status:e,type:b}});return}};b=a;f["default"]=b}),66);
__d("MAWSetupBridge",["DTSG","LSDatabaseSingleton","LSInitSyncCompleteSubscription","LSPlatformGraphQLLightspeedRequest","MAWAbPropsClient","MAWBridgeReceivedChatStateHandler","MAWBridgeUIEventHandler","MAWCommonSetupBridge","MAWEncryptionErrorHandler","MAWFetchContacts","MAWGetEphemeralSettings","MAWSetupBridgeIsDbMigrating","MAWSetupBridgeOfflineConsumer","MAWSetupBridgeOfflineSnapshot","MAWSetupUpdateMediaStatus","Promise","Run","Visibility","WAExceededStorageQuota","asyncToGeneratorRuntime","cr:3411","promiseDone","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=c("requireDeferred")("ArmadilloCutoverClientFalcoEvent").__setRef("MAWSetupBridge"),k=c("requireDeferred")("MAWBridgeUpdateDYIStatusV2").__setRef("MAWSetupBridge"),l=c("requireDeferred")("MAWBridgeUploadMessageByBatchGQLHandler").__setRef("MAWSetupBridge"),m=(i||(i=d("LSDatabaseSingleton"))).LSDatabaseSingleton.then(d("LSInitSyncCompleteSubscription").use).then(function(){return(i||(i=d("LSDatabaseSingleton"))).LSDatabaseSingleton}),n=function(a){j.loadImmediately(function(b){b=b.log;return b(function(){return{armadillo_thread_id:a.armadilloThreadId,domain:a.domain,event:a.event,event_details:a.eventDetails,open_thread_id:a.openThreadId,success:a.success,trace_id:a.traceId}})})};function a(a){var e=a.dispatch,f=a.logout,g=a.reregisterDevice,i=a.rotateCryptoAuthToken,j=a.worker;function o(){j.postMessage({type:"force-flush-data"})}d("Run").onUnload(o);d("Run").onBeforeUnload(o,!1);c("Visibility").addListener(c("Visibility").HIDDEN,function(){j.postMessage({type:"force-flush-logs-only"})});return d("MAWCommonSetupBridge").initBridge({customizeEventHandlers:{abPropsUpdated:function(a){d("MAWAbPropsClient").rewrite(a.abProps)},earDecryptionFailure:function(a){d("MAWEncryptionErrorHandler").handleEARDecryptionError(a.tableName)},executeGraphQLLightSpeedRequest:function(a){a=a.args;return c("LSPlatformGraphQLLightspeedRequest").apply(void 0,a)},getDTSGToken:function(){return(h||(h=b("Promise"))).resolve(d("DTSG").getToken())},getLSDBEphemeralSetting:function(a){return d("MAWGetEphemeralSettings").getEphemeralSetting(a.chatJid)},getLSDBUsersIsMsplit:function(a){return d("MAWFetchContacts").fetchContactsIsMsplit(a.users)},getLSDBUsersRelationships:function(a){return d("MAWFetchContacts").fetchContactsRelationships(a.users)},isDbMigrating:c("MAWSetupBridgeIsDbMigrating")(e),logCutoverEvent:n,logout:f,offlineConsumerProgress:function(){return c("MAWSetupBridgeOfflineConsumer")(m,e).apply(void 0,arguments)},offlineSnapshot:c("MAWSetupBridgeOfflineSnapshot")(e),receivedChatState:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield m);yield b.runInTransaction(function(b){return d("MAWBridgeReceivedChatStateHandler").call(b,a)},"readwrite")});function c(b){return a.apply(this,arguments)}return c}(),reregisterDevice:g,resignCdnUrl:function(){return(h||(h=b("Promise"))).resolve()},rotateCryptoAuthToken:i,storageQuota:function(a){a=a.exceededStorageQuota;d("WAExceededStorageQuota").setExceededStorageQuota(a)},uiUpdate:function(a){a=a.events;e&&a.forEach(function(a){return e(a)});b("cr:3411")==null?void 0:b("cr:3411").recordBridgeUIEvent(a);d("MAWBridgeUIEventHandler").handleEvents(m,a)},updateDYIStatus:function(a){var b=a.qplEvent,d=a.qplInstanceKeyE2E,e=a.status;c("promiseDone")(k.load().then(function(a){return a.call({qplEvent:b,qplInstanceKeyE2E:d,status:e})}))},updateMediaStatus:c("MAWSetupUpdateMediaStatus")(e),uploadMessagesToBackup:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield m);c("promiseDone")(l.load().then(function(c){return c.call(b,a)}))});function d(b){return a.apply(this,arguments)}return d}(),uploadOpenMessages:function(){return(h||(h=b("Promise"))).reject("this bridge should not be used for msgr")}},worker:j})}g.setupBridge=a}),98);
__d("MAWSetupMutex",["FBLogger","LocalStorageMutex","MAWAppMutex","MAWBridge","MAWInit","MAWIssueNewUserVisibleErrors","MAWLocalStorage","MAWMIC","MAWReinitWorker","MAWSetupWorker","MAWStateContext.react","MAWWaitForBackendSetup","MAWWebWorkerInstance","QPLUserFlow","Run","WALoggerDeferred","asyncToGeneratorRuntime","isInstamadillo","qpl","react","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["AppMutex - Shouldn't reinitialize, worker already exists"]);j=function(){return a};return a}e=i||d("react");var k=e.useCallback,l=e.useEffect,m=e.useMemo,n=c("FBLogger")("messenger_e2ee_web"),o=!1,p=0;function q(a){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(document.visibilityState!=="visible")return!1;a=a();var b=window.indexedDB!=null,c=d("MAWLocalStorage").isLocalStorageAvailable();if(a){void d("WALoggerDeferred").DEV(j());return!1}return!b||!c?!1:!0});return r.apply(this,arguments)}function a(a,e){var f=a.logout,g=a.reregisterDevice,i=a.rotateCryptoAuthToken,j=a.setupBridge,r=m(function(){return d("MAWAppMutex").use()},[]),s=(h||(h=c("useReStore")))(),t=d("MAWStateContext.react").useDispatchClearEphemeralSettings(),u=s.persistenceTypes.includes("indexeddb"),v=k(function(a){var b=r.takeoverFilter(a);if(!b||a.newValue===d("LocalStorageMutex").THIS_TAB||a.newValue==="")return;!u&&!c("isInstamadillo")()&&d("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:[{tag:"DropAllSecureThreads",value:void 0}]});d("MAWSetupWorker").terminateDedicatedWorker("MAWSetupMutexV2:handleStoreChange");d("MAWWaitForBackendSetup").resetBackendSetup();d("MAWMIC").cancel("workerMutexLost");d("MAWInit").MAWInit.cancel("workerMutexLost");r.onMutexDeath()},[r,u]),w=k(function(){d("MAWSetupWorker").terminateDedicatedWorker("MAWSetupMutexV2:handleUnload"),r.onMutexDeath()},[r]),x=k(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield q(d("MAWWebWorkerInstance").doesWorkerExist));if(!a||o)return;o=!0;p++;try{yield c("MAWReinitWorker")({allTablesPersisted:u,db:s,dispatch:e,dispatchClearEphemeralSettings:t,instanceKey:p,logout:f,reregisterDevice:g,rotateCryptoAuthToken:i,setupBridge:j,workerCreateReason:"mawReinitSetupMutex"}),d("MAWWaitForBackendSetup").resolveBackendSetup(),d("MAWIssueNewUserVisibleErrors").deleteUserVisibleErrorByJSErrorMessage("maw_appmutex_no_permission")}catch(a){n.mustfix("AppMutex - failed to reinitialize worker: "+a.message.concat(" (",a.error,")")),n.catching(a),c("QPLUserFlow").endFailure(c("qpl")._(25310984,"169"),"failed_to_reinitialize_worker",{annotations:{string:{error:a.message.concat(": ",a.error)}},error:a,instanceKey:p})}finally{o=!1}}),[u,s,e,t,f,g,i,j]);l(function(){window.addEventListener("storage",v);var a=d("Run").onBeforeUnload(w,!1),b=d("Run").onUnload(w);window.addEventListener("visibilitychange",x);return function(){window.removeEventListener("storage",v),a.remove(),b.remove(),window.removeEventListener("visibilitychange",x)}},[v,w,x])}g.useMutex=a}),98);
__d("MAWSetupMutex.react",["MAWSetupMutex"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.dispatch;a.environment;a.fbId;a=a.platformSetupUtils;d("MAWSetupMutex").useMutex(a,b);return null}g["default"]=a}),98);
__d("MWChatFetchThreadMessageCounts",["asyncToGeneratorRuntime"],(function(a,b,c,d,e,f){"use strict";function a(a){return g.apply(this,arguments)}function g(){g=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){return{}});return g.apply(this,arguments)}function c(a,b){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){return 0});return h.apply(this,arguments)}f.fetchArmadilloThreadMessageCounts=a;f.fetchArmadilloThreadMessageCount=c}),66);
__d("globalCryptoSubtle",[],(function(a,b,c,d,e,f){"use strict";b=a.crypto.subtle;c=b;f["default"]=c}),66);
__d("useDataLossStatisticsStorageListener",["LSDatabaseSingleton","MWChatFetchThreadMessageCounts","Visibility","WebStorage","promiseDone","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=(i||d("react")).useEffect,l="armadillo_msgr_data_loss_stats";function a(){k(function(){var a;window.setTimeout(function(){a=c("Visibility").addListener(c("Visibility").HIDDEN,function(){c("promiseDone")((j||(j=d("LSDatabaseSingleton"))).LSDatabaseSingleton.then(function(a){return d("MWChatFetchThreadMessageCounts").fetchArmadilloThreadMessageCounts(a).then(function(a){(h||(h=c("WebStorage"))).setItemGuarded(h.getLocalStorage(),l,JSON.stringify(a))})}))})},3e4);return function(){var b;(b=a)==null?void 0:b.remove()}},[])}g.DATA_LOSS_STATISTICS_STORAGE_KEY=l;g.useDataLossStatisticsStorageListener=a}),98);
__d("MWChatDataLossCheckerUtil",["FBLogger","I64","MWChatFetchThreadMessageCounts","Promise","QuickPerformanceLogger","WebStorage","asyncToGeneratorRuntime","gkx","globalCryptoSubtle","promiseDone","qpl","useDataLossStatisticsStorageListener"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;function l(a){a=Array.from(new Uint8Array(a));return a.map(function(a){return a.toString(16).padStart(2,"0")}).join("")}function m(a){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){try{if(c("gkx")("24059"))return a;var b=new TextEncoder();b=b.encode(a).buffer;a=(yield c("globalCryptoSubtle").digest("SHA-256",b));return l(a)}catch(a){return a}});return n.apply(this,arguments)}function o(a){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.currentIDBCnt,d=a.currentMsgCnt,e=a.logThreadId,f=a.prevMsgCnt,g=a.qplEvent;a=a.threadId;if(e!=null&&e){e=(yield m(a));b!=null?((j||(j=c("QuickPerformanceLogger"))).markerStartFromNavStart(g),j.markerAnnotate(g,{"int":{current_idb_count:b,current_msg_count:d,prev_msg_count:f},string:{encrypted_threadId:e}}),j.markerEnd(g,2)):((j||(j=c("QuickPerformanceLogger"))).markerStartFromNavStart(g),j.markerAnnotate(g,{"int":{current_msg_count:d,prev_msg_count:f},string:{encrypted_threadId:e}}),j.markerEnd(g,2))}else b!=null?((j||(j=c("QuickPerformanceLogger"))).markerStartFromNavStart(g),j.markerAnnotate(g,{"int":{current_idb_count:b,current_msg_count:d,prev_msg_count:f}}),j.markerEnd(g,2)):((j||(j=c("QuickPerformanceLogger"))).markerStartFromNavStart(g),j.markerAnnotate(g,{"int":{current_msg_count:d,prev_msg_count:f}}),j.markerEnd(g,2))});return p.apply(this,arguments)}function q(a){var b=a.currentMsgCnt,c=a.logThreadId,d=a.prevMsgCnt,e=a.qplEvent;a=a.threadId;return o({currentMsgCnt:b,logThreadId:c,prevMsgCnt:d,qplEvent:e,threadId:a})}function a(a,b){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){try{a=(yield d("MWChatFetchThreadMessageCounts").fetchArmadilloThreadMessageCount(a,b));var e=(k||(k=c("WebStorage"))).getAllowlistedKeyFromLocalStorage(d("useDataLossStatisticsStorageListener").DATA_LOSS_STATISTICS_STORAGE_KEY);if(e==null)return{isThreadMissingMessages:!1};e=JSON.parse(e);b=(e=e[(i||(i=d("I64"))).to_string(b)])!=null?e:null;if(b==null)return{isThreadMissingMessages:!1};return b>0&&a===0?{currCount:a,isThreadMissingMessages:!0,prevCount:b}:{isThreadMissingMessages:!1}}catch(a){c("FBLogger")("labyrinth").catching(a).warn("Failed to check for data loss");return{isThreadMissingMessages:!1}}});return r.apply(this,arguments)}function e(a){a=d("MWChatFetchThreadMessageCounts").fetchArmadilloThreadMessageCounts(a);a.then(function(a){var e=(k||(k=c("WebStorage"))).getAllowlistedKeyFromLocalStorage(d("useDataLossStatisticsStorageListener").DATA_LOSS_STATISTICS_STORAGE_KEY);if(e==null)return(h||(h=b("Promise"))).resolve(null);e=JSON.parse(e);return(h||(h=b("Promise"))).resolve({current:a,previous:e})}).then(function(a){if(a==null)return(h||(h=b("Promise"))).resolve();var c=a.current;a=a.previous;return s(a,c)})["catch"](function(a){return c("FBLogger")("labyrinth").catching(a).warn("Failed to check for data loss")});return a.then(function(){})}function s(a,b){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,d){var e=[];for(var f in a)Object.prototype.hasOwnProperty.call(d,f)&&e.push(f);f=[];for(var g=0;g<e.length;g++){var i=e[g],j={currentMsgCnt:d[i],prevMsgCnt:a[i],threadId:i};a[i]>0&&d[i]===0?(f.push(q(babelHelpers["extends"]({},j,{qplEvent:c("qpl")._(717553665,"1183")}))),f.push(q(babelHelpers["extends"]({},j,{logThreadId:!0,qplEvent:c("qpl")._(717562243,"1358")})))):(f.push(q(babelHelpers["extends"]({},j,{qplEvent:c("qpl")._(717553666,"1184")}))),f.push(q(babelHelpers["extends"]({},j,{logThreadId:!0,qplEvent:c("qpl")._(717556541,"1361")}))))}yield (h||(h=b("Promise"))).all(f)});return t.apply(this,arguments)}function f(a){var b=function(b){c("promiseDone")(m(b).then(function(d){(j||(j=c("QuickPerformanceLogger"))).markerStartFromNavStart(c("qpl")._(717567419,"1383")),j.markerAnnotate(c("qpl")._(717567419,"1383"),{string:{encryptedThreadId:d,msg_count:a[b].toString()}}),j.markerEnd(c("qpl")._(717567419,"1383"),2)}))};for(var d in a)b(d)}g.qplLog=q;g.checkIsThreadMissingMessages=a;g.fetchCountsAndLogDataLoss=e;g.logThreadCompleteDataLoss=s;g.logLocalStatistics=f}),98);
__d("useOnMawSetupComplete.react",["promiseDone","react","waitForMAWMIC"],(function(a,b,c,d,e,f,g){"use strict";var h,i=(h||d("react")).useEffect;function a(a,b,e){b===void 0&&(b=function(){}),i(function(){var e=!1;c("promiseDone")(d("waitForMAWMIC").promise.then(function(){if(e)return;a()})["catch"](function(){if(e)return;b()}));return function(){e=!0}},e)}g.useOnMawSetupComplete=a}),98);
__d("useDataLossChecker",["FBLogger","I64","LSDatabaseSingleton","LSFactory","LSScheduleOccamThreadsIntegrityCheckerStoredProcedure","MWChatDataLossCheckerUtil","asyncToGeneratorRuntime","gkx","justknobx","promiseDone","useDataLossStatisticsStorageListener","useOnMawSetupComplete.react"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(){d("useDataLossStatisticsStorageListener").useDataLossStatisticsStorageListener(),d("useOnMawSetupComplete.react").useOnMawSetupComplete(function(){c("promiseDone")(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield (h||(h=d("LSDatabaseSingleton"))).LSDatabaseSingleton);yield d("MWChatDataLossCheckerUtil").fetchCountsAndLogDataLoss(a)})()),j()},j(),[])}function j(){try{var a=c("gkx")("24061"),e=c("justknobx")._("1683");a&&e&&c("promiseDone")(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield (h||(h=d("LSDatabaseSingleton"))).LSDatabaseSingleton);return a.runInTransaction(function(a){return c("LSScheduleOccamThreadsIntegrityCheckerStoredProcedure")(c("LSFactory")(a),{delayMs:(i||(i=d("I64"))).of_int32(6e4),maxThreadCount:i.of_int32(20)})},"readonly",void 0,void 0,f.id+":61")})())}catch(a){c("FBLogger")("labyrinth_web").warn("Error running thread integrity checker",a)}}g["default"]=a}),98);
__d("useLegacyUserWatchdog",["MAWIssueNewUserVisibleErrors","clearTimeout","react","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";var h,i=(h||d("react")).useEffect;b=24*60*60*1e3;var j=5*b;function a(){i(function(){var a=c("setTimeout")(function(){var a;(a=d("MAWIssueNewUserVisibleErrors")).issueError(a.MAWLegacyUserErrorMsgBody,a.MAWLegacyUserErrorMsgTitle,a.MAWUserVisibleErrorPresentationType.BANNER)},j);return function(){return c("clearTimeout")(a)}})}g["default"]=a}),98);
__d("useMAWReregisterDeviceOnError",["LSPersistedDbGating","MAWIssueNewUserVisibleErrors","MAWLoggerUtils","MAWReinitWorker","MAWSetupWorker","MAWStateContext.react","MAWWaitForBackendSetup","ODS","WABridgedAPI","WATagsLogger","asyncToGeneratorRuntime","react","shouldUseMAWSharedWorker","useAsyncReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unable to reinit worker ",""]);j=function(){return a};return a}e=h||d("react");var k=e.useCallback,l=e.useContext,m=!1,n=typeof window!=="undefined"?window:self;function o(){m=!0,d("MAWSetupWorker").terminateWorkerPermanently(),(i||(i=d("ODS"))).bumpEntityKey(3185,"armadillo_forced_reregister_fail",n.location.hostname),d("MAWIssueNewUserVisibleErrors").issueError(d("MAWIssueNewUserVisibleErrors").MAWLegacyUserErrorMsgBody,d("MAWIssueNewUserVisibleErrors").MAWLegacyUserErrorMsgTitle,d("MAWIssueNewUserVisibleErrors").MAWUserVisibleErrorPresentationType.BANNER)}function a(a){var e=a.rotateCryptoAuthToken,f=a.setupBridge,g=c("useAsyncReStore")(),h=d("MAWStateContext.react").useDispatchClearEphemeralSettings();a=l(d("MAWStateContext.react").MAWStateContext);var p=a.dispatch;return k(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(m)return;(i||(i=d("ODS"))).bumpEntityKey(3185,"armadillo_forced_deregister",n.location.hostname);yield c("WABridgedAPI").removeCurrentDevice();var a=d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker();a&&(yield d("MAWSetupWorker").killSharedWorker(!0));d("MAWSetupWorker").terminateDedicatedWorker("useMAWReregisterDeviceOnError");d("MAWWaitForBackendSetup").withKnobs(function(){return d("MAWWaitForBackendSetup").resetBackendSetup()});try{a=(yield g);yield c("MAWReinitWorker")({allTablesPersisted:d("LSPersistedDbGating").allTablesPersisted,db:a,dispatch:p,dispatchClearEphemeralSettings:h,logout:o,reregisterDevice:o,rotateCryptoAuthToken:e,setupBridge:f,workerCreateReason:"mawReinitReregDevice"});d("MAWWaitForBackendSetup").withKnobs(function(){return d("MAWWaitForBackendSetup").resolveBackendSetup()})}catch(b){d("MAWWaitForBackendSetup").withKnobs(function(){return d("MAWWaitForBackendSetup").rejectBackendSetup(b)});a=b.description||b.message||b;d("WATagsLogger").TAGS([d("MAWLoggerUtils").Tag.DeviceRegistration,d("MAWLoggerUtils").Tag.LogoutHandler,d("MAWLoggerUtils").Tag.WorkerSetup,d("MAWLoggerUtils").Tag.MAWWorker,d("MAWLoggerUtils").Tag.MAWInit]).ERROR(j(),a);d("MAWIssueNewUserVisibleErrors").issueError(d("MAWIssueNewUserVisibleErrors").MAWLegacyUserErrorMsgBody,d("MAWIssueNewUserVisibleErrors").MAWLegacyUserErrorMsgTitle,d("MAWIssueNewUserVisibleErrors").MAWUserVisibleErrorPresentationType.BANNER)}}),[g,p,h,e,f])}g["default"]=a}),98);
__d("useStorageUsageMetricsLogger",["cr:3504","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=(h||d("react")).useEffect;function a(){i(function(){void (b("cr:3504")==null?void 0:b("cr:3504").logMAWDBUsageMetrics())},[])}g["default"]=a}),98);
__d("MAWSetupImpl.react",["BaseHeadingContext","CometRelay","MAWCommonSetup","MAWCryptoAuthToken","MAWSetupMutex.react","MAWStateContext.react","cr:6159","cr:6160","cr:8800","promiseDone","react","shouldUseMAWSharedWorker","useDataLossChecker","useLegacyUserWatchdog","useMAWReregisterDeviceOnError","useStorageUsageMetricsLogger"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||(h=d("react"));e=h;var j=e.useCallback,k=e.useContext,l=e.useMemo;window.XPlatTesting=b("cr:6159");window.XPlatTestingGroups=b("cr:6160");window.XPlatMockServer=b("cr:8800");function a(a){var b=a.children,e=a.fbid,f=a.logout,g=a.setupBridge;a=k(d("MAWStateContext.react").MAWStateContext);a=a.dispatch;var h=d("CometRelay").useRelayEnvironment(),m=j(function(){return d("MAWCryptoAuthToken").fetchFreshCAT(h)},[h]),n=c("useMAWReregisterDeviceOnError")({rotateCryptoAuthToken:m,setupBridge:g}),o=l(function(){return{logout:f!=null?f:function(){return c("promiseDone")(n())},reregisterDevice:function(){return c("promiseDone")(n())},rotateCryptoAuthToken:m,setupBridge:g}},[m,f,n,g]);d("MAWCommonSetup").useArmadillo(o);c("useLegacyUserWatchdog")();c("useDataLossChecker")();c("useStorageUsageMetricsLogger")();var p=k(c("BaseHeadingContext")),q=!d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker();return i.jsxs(c("BaseHeadingContext").Provider,{value:p+1,children:[b,q?i.jsx(c("MAWSetupMutex.react"),{dispatch:a,environment:h,fbId:e,platformSetupUtils:o}):null]})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("MAWSetup.react",["CometPlaceholder.react","CometRelay","CurrentUser","MAWOembedIframeContainer.react","MAWSetupBridge","MAWSetupImpl.react","cr:3487","cr:4944","cr:6809","deferredLoadComponent","isGroupInvitesEnabled","promiseDone","react","requireDeferredForDisplay","useAsyncReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||(h=d("react")),j=h.useEffect,k=b("cr:6809")!=null?b("cr:6809").CometLogoutProvider:function(a){a=a.children;return i.jsx(i.Fragment,{children:a})},l=c("deferredLoadComponent")(c("requireDeferredForDisplay")("MAWLoadingStateSpinner.react").__setRef("MAWSetup.react")),m=c("deferredLoadComponent")(c("requireDeferredForDisplay")("MAWMigrationStateSpinner.react").__setRef("MAWSetup.react"));c("isGroupInvitesEnabled")();function a(a){a=a.children;j(function(){var a=d("MAWOembedIframeContainer.react").createMAWOembedIframeContainer();return function(){a==null?void 0:a.stopListening()}},[]);var e=d("CometRelay").useRelayEnvironment(),f=c("useAsyncReStore")();j(function(){c("promiseDone")(f,function(a){b("cr:4944")&&c("promiseDone")(b("cr:4944").updateOhaiGatewayKeyConfigs(e,a))})},[f,e]);return i.jsxs(k,{children:[i.jsx(c("MAWSetupImpl.react"),{fbid:c("CurrentUser").getID(),logout:void 0,setupBridge:d("MAWSetupBridge").setupBridge,children:a}),i.jsx(c("CometPlaceholder.react"),{fallback:null,children:i.jsx(m,{})}),i.jsx(c("CometPlaceholder.react"),{fallback:null,children:i.jsx(l,{})}),b("cr:3487")&&i.jsx(b("cr:3487"),{})]})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("MWChatBadgeCountUpdater.react",["CometRelay","LSIntEnum","MWChatBadgeCountUpdates.react","MWXacGating","react","recoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=(h||d("react")).useEffect;function a(){var a=d("CometRelay").useRelayEnvironment(),b=d("MWChatBadgeCountUpdates.react").useUnseenThreadCount((i||(i=d("LSIntEnum"))).ofNumber(0));j(function(){var e={suppress_xac_groups:!d("MWXacGating").isGroupsEnabled()};a.commitUpdate(function(a){a=a.getRoot();if(a==null){c("recoverableViolation")("A store root must be present to move forward.","messenger_web_entrypoints");return}a=a.getOrCreateLinkedRecord("viewer","Viewer");a=a.getOrCreateLinkedRecord("message_threads","ViewerMessageThreadsConnection");if(b!=null){var d=a.getValue("unseen_count",e);(d===null||d!==b)&&a.setValue(b,"unseen_count",e)}})},[a,b]);return null}g["default"]=a}),98);
__d("MWChatEncryptedBackupsHandleRestoreWrapperDeferred.react",["CometErrorBoundary.react","CometPlaceholder.react","HeroInteractionIgnoreWithDiv.react","deferredLoadComponent","react","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react"),j=c("deferredLoadComponent")(c("requireDeferred")("MWChatEncryptedBackupsHandleRestoreWrapper.react").__setRef("MWChatEncryptedBackupsHandleRestoreWrapperDeferred.react"));function a(a){return i.jsx(c("HeroInteractionIgnoreWithDiv.react"),{children:i.jsx(c("CometErrorBoundary.react"),{fallback:function(){return null},children:i.jsx(c("CometPlaceholder.react"),{fallback:null,name:"EncryptedBackupsHandleRestoreWrapper",children:i.jsx(j,babelHelpers["extends"]({},a))})})})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("MWChatStateV2IsComposeTab",["MWChatStateV2Types"],(function(a,b,c,d,e,f,g){"use strict";function a(a){a=a.tabType;return a.type===d("MWChatStateV2Types").MWChatStateTabType.ComposeTab}g.isComposeTab=a}),98);
__d("MWChatStateV2HeadGroups",["MWChatStateV2CompareTabs","MWChatStateV2IsComposeTab","MWChatStateV2IsMinimized"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c,e){c=Array.from(c.values()).filter(function(b){return d("MWChatStateV2IsMinimized").isMinimized(a,b)}).sort(function(a,b){var c=d("MWChatStateV2CompareTabs").byMostRecentMinimized(a,b);return c===0?d("MWChatStateV2CompareTabs").byMostRecentOpened(a,b):c});b=b.filter(function(a){return!d("MWChatStateV2IsComposeTab").isComposeTab(a)}).concat(c);return[b.slice(0,e),b.slice(e,b.length)]}g.getHeadGroups=a}),98);
__d("MWFallbackWithTimeout.react",["FBLogger","react","useTimeout"],(function(a,b,c,d,e,f,g){"use strict";var h;h||(h=d("react"));var i=h.useEffect;function a(a){var b=a.children,d=a.message;a=c("useTimeout")(1e4);var e=a.pending;i(function(){e||c("FBLogger")("messenger_web_entrypoints","fallback_timeout").warn(d)},[d,e]);return b}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("MWSetupPresenceReportingDeferred.react",["CometPlaceholder.react","deferredLoadComponent","react","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react"),j=c("deferredLoadComponent")(c("requireDeferred")("MWSetupPresenceReporting.react").__setRef("MWSetupPresenceReportingDeferred.react"));function a(){return i.jsx(c("CometPlaceholder.react"),{fallback:null,children:i.jsx(j,{})})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("MWV2ChatHeadsLayout.react",["react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(a){a=a.children;a=a;return i.jsx("div",{className:"x191j7n5 x92rtbv x10l6tqk x1useyqa",children:a})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("MWV2ChatOptionsHead.react",["fbt","ix","MWXDeferredPopoverTrigger.react","MWXIcon.react","MWXPressable.react","MWXTooltip.react","fbicon","react","requireDeferred"],(function(a,b,c,d,e,f,g,h,i){"use strict";var j,k=j||(j=d("react")),l=j.useState,m=c("requireDeferred")("MWV2ChatOptionsHeadPopover.react").__setRef("MWV2ChatOptionsHead.react"),n={head:{alignItems:"x6s0dn4",backgroundColor:"x1l31dnx",borderTopStartRadius:"x14yjl9h",borderTopEndRadius:"xudhj91",borderBottomEndRadius:"x18nykt9",borderBottomStartRadius:"xww2gxu",boxShadow:"x1qeybcx",display:"x78zum5",height:"xc9qbxq",justifyContent:"xl56j7k",opacity:"xg01cxk",transform:"x1f85oc2",transitionDuration:"x19bguh7",transitionProperty:"x6o7n8i",width:"x14qfxbe",":hover_boxShadow":"x19xcq9t",$$css:!0},headVisible:{opacity:"x1hc1fzr",transform:"x3oybdh",$$css:!0}},o=h._("__JHASH__GqqnGnZcXBj__JHASH__");function a(a){var b=a.isVisible,e=a.openTabCount,f=a.style;a=l(!1);var g=a[0],h=a[1];a=l(!1);var j=a[0],p=a[1];a=l(!1);var q=a[0];a=a[1];return k.jsx(c("MWXDeferredPopoverTrigger.react"),{align:"end",onVisibilityChange:a,popoverProps:{hasOpenTabs:e>0},popoverResource:m,position:"above",children:function(a,e){return k.jsx("div",{className:"x14yjl9h xudhj91 x18nykt9 xww2gxu xc9qbxq xi8xln7 x10l6tqk x14qfxbe",style:f,children:k.jsx("div",{className:"x6s0dn4 xjbqb8w x78zum5 xnnlda6 xl56j7k x1tl9596 xhsvlbd x1dmp6jm","data-testid":void 0,onMouseEnter:function(){return h(!0)},onMouseLeave:function(){return h(!1)},children:k.jsx(c("MWXPressable.react"),{label:o,onFocusChange:function(a){return p(a)},onPress:e,ref:a,testid:void 0,xstyle:function(){return[n.head,b||g||j||q?n.headVisible:!1]},children:k.jsx(c("MWXTooltip.react"),{align:"middle",position:"start",tooltip:o,children:k.jsx(c("MWXIcon.react"),{icon:d("fbicon")._(i("484387"),20)})})})})})}})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),226);
__d("useMWV2PreloadComposeTab",["JSResourceForInteraction","JSScheduler","react","useCometPreloader"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=(h||d("react")).useCallback,k=c("JSResourceForInteraction")("MWV2ComposeTab.react").__setRef("useMWV2PreloadComposeTab");function a(){var a=j(function(){(i||(i=d("JSScheduler"))).scheduleSpeculativeCallback(function(){k.preload()})},[]);a=c("useCometPreloader")("button",a,a);var b=a.onHoverInPreloader;a=a.onHoverOutPreloader;return[b,a]}g["default"]=a}),98);
__d("MWV2ComposeHead.react",["fbt","ix","FDSTintedIcon.react","LSThreadAttributionStore","MWChatInteraction","MWChatStateV2.react","MWChatStateV2Types","MWXPressable.react","MWXTooltip.react","MessengerWebUXLogger","fbicon","react","useMWNewChatOpenTabTraceProvider","useMWV2PreloadComposeTab"],(function(a,b,c,d,e,f,g,h,i){"use strict";var j,k=j||d("react"),l={button:{alignItems:"x6s0dn4",appearance:"xjyslct",backgroundColor:"x1l31dnx",borderTopStartRadius:"x14yjl9h",borderTopEndRadius:"xudhj91",borderBottomEndRadius:"x18nykt9",borderBottomStartRadius:"xww2gxu",boxShadow:"x1qeybcx",display:"x3nfvp2",height:"xsdox4t",justifyContent:"xl56j7k",position:"x1n2onr6",width:"x1useyqa",":hover_boxShadow":"x19xcq9t",$$css:!0}};function a(a){var b=a.onFocusChange;a=a.onHoverChange;var e=d("MWChatStateV2.react").useDispatch(),f=c("MessengerWebUXLogger").useInteractionLogger(),g=c("useMWNewChatOpenTabTraceProvider")(),j=function(){g(function(a){d("MWChatInteraction").set("open_new",a);f==null?void 0:f({eventName:"create_thread"});d("LSThreadAttributionStore").setSourceForNewThread("chatheadsNewMessage");var b=Date.now();a=function(a){return{clientForcedMinimizeWatermark:a.clientForcedMinimizeWatermark,closeWatermark:a.closeWatermark,doNotBlockWithEBUpsell:!0,minimizeWatermark:a.minimizeWatermark,openFlyoutWatermark:a.openFlyoutWatermark,openWatermark:b,tabId:a.tabId,tabType:a.tabType}};var c=function(a){var c=a.openWatermark<a.closeWatermark;if(c)return{clientForcedMinimizeWatermark:a.clientForcedMinimizeWatermark,closeWatermark:a.closeWatermark,minimizeWatermark:a.minimizeWatermark,openFlyoutWatermark:a.openFlyoutWatermark,openWatermark:b,tabId:a.tabId,tabType:a.tabType};else return{clientForcedMinimizeWatermark:a.clientForcedMinimizeWatermark,closeWatermark:b,minimizeWatermark:a.minimizeWatermark,openFlyoutWatermark:a.openFlyoutWatermark,openWatermark:a.openWatermark,tabId:a.tabId,tabType:a.tabType}};return e([{inserter:a,tabConfig:{shouldFocus:!0},tabType:{initialTokens:[],secureThreadToggleEnabled:!1,type:d("MWChatStateV2Types").MWChatStateTabType.ComposeTab},type:d("MWChatStateV2Types").MWChatStateActionsType.UpsertTab,updater:c}])},"chatheadsNewMessage")},m=c("useMWV2PreloadComposeTab")(),n=m[0];m=m[1];var o=h._("__JHASH__lMGuJRoIOm8__JHASH__");return k.jsx(c("MWXTooltip.react"),{align:"middle",position:"start",tooltip:o.toString(),children:k.jsx(c("MWXPressable.react"),{"aria-label":o,onFocusChange:b,onHoverChange:a,onHoverIn:n,onHoverOut:m,onPress:j,testid:void 0,xstyle:function(){return[l.button]},children:k.jsx(c("FDSTintedIcon.react"),{color:"primary",icon:d("fbicon")._(i("507172"),20)})})})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),226);
__d("MWV2ChatHeads.react",["CometErrorBoundary.react","CometHeroInteractionWithDiv.react","CometPlaceholder.react","I64","JSResourceForInteraction","MWChatInteraction","MWChatStateContext","MWChatStateV2HeadGroups","MWChatStateV2TabGroups","MWChatStateV2Types","MWPActor.react","MWV2ChatHeadsLayout.react","MWV2ChatOptionsHead.react","MWV2ComposeHead.react","WebUXLoggingEntryPointContextProvider","lazyLoadComponent","react","useMWChatStateV2MaxTabCount"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=h||(h=d("react")),k=h.useState,l=5,m=c("lazyLoadComponent")(c("JSResourceForInteraction")("MWV2ChatHead.react").__setRef("MWV2ChatHeads.react")),n=c("lazyLoadComponent")(c("JSResourceForInteraction")("MWV2ChatOverflowHead.react").__setRef("MWV2ChatHeads.react"));function o(a){return{transform:"translateY(-"+Math.imul(a,58)+"px)"}}function p(a){return{transform:"translateY(-"+(Math.imul(a,58)-12)+"px"}}function a(a){a=a.isMediaViewer;var b=d("MWPActor.react").isAPPlus(),e=d("MWChatStateContext").useChatState(function(a){return[a.tabs,a.focusedTabId,a.mediaViewerOpenWatermark]}),f=e[0],g=e[1];e=e[2];var h=c("useMWChatStateV2MaxTabCount")(a);g=d("MWChatStateV2TabGroups").getTabGroups(e,f,g,h);h=g.openExcessTabs;g=g.openTabs;a=d("MWChatStateV2HeadGroups").getHeadGroups(a?e:void 0,h,f,l);e=a[0];h=a[1];f=g.length;a=e.length;var q=h.length>0?1:0;g=k(!1);var r=g[0],s=g[1],t;g=h[0];if(h.length===1&&g.tabType.type!==d("MWChatStateV2Types").MWChatStateTabType.ComposeTab){g=g.tabType.threadKeyDescriptor;t=j.jsx(c("CometErrorBoundary.react"),{fallback:function(){return null},children:j.jsx(c("CometPlaceholder.react"),{fallback:null,children:j.jsx(m,{onFocusChange:s,onHoverChange:s,style:o(1),tab:h[0],threadKeyDescriptor:g})})},(i||(i=d("I64"))).to_string(g.threadKey))}else h.length>1&&(t=j.jsx(c("CometPlaceholder.react"),{fallback:null,children:j.jsx(n,{excessHeads:h,onHoverChange:s,style:o(1)})}));return j.jsx(d("WebUXLoggingEntryPointContextProvider").WebUXLoggingEntryPointContextProvider,{value:"chat_heads",children:j.jsx(c("CometHeroInteractionWithDiv.react"),{interactionDesc:"Comet initial load to chatheads VC",interactionUUID:d("MWChatInteraction").get(d("MWChatInteraction").MW_CHATHEADS_LOAD),children:j.jsxs(c("MWV2ChatHeadsLayout.react"),{children:[c("MWV2ChatOptionsHead.react")!=null&&f+a>=2?j.jsx(c("MWV2ChatOptionsHead.react"),{isVisible:r,openTabCount:f,style:p(a+q+1)}):null,e.reverse().map(function(a,b){var e=a.tabType;if(e.type===d("MWChatStateV2Types").MWChatStateTabType.ComposeTab)return null;b=b+q+1;return j.jsx(c("CometErrorBoundary.react"),{fallback:function(){return null},children:j.jsx(c("CometPlaceholder.react"),{fallback:null,children:j.jsx(m,{onFocusChange:s,onHoverChange:s,style:o(b),tab:a,threadKeyDescriptor:e.threadKeyDescriptor})})},(i||(i=d("I64"))).to_string(e.threadKeyDescriptor.threadKey))}),t,!b&&j.jsx(c("MWV2ComposeHead.react"),{onFocusChange:s,onHoverChange:s})]})})})}a.displayName=a.name+" [from "+f.id+"]";g.MAX_CHAT_HEADS=l;g.MWV2ChatHeads=a}),98);
__d("MWV2ChatTabsLayout.react",["react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(a){a=a.children;a=a;return i.jsx("div",{className:"x1ey2m1c x78zum5 x164qtfw xixxii4 x1vjfegm","data-testid":void 0,children:a})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("useMWMonitorChatConnectionStatus",["I64","LSIntEnum","LSInternetConnectionState","MWGetChatTabOpenQPLEventTrace","ReQL","gkx","promiseDone","react","useAsyncReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;b=h||d("react");var k=b.useCallback,l=b.useEffect,m=b.useRef,n=function(a){return(i||(i=d("I64"))).equal(a.internetConnectionState,(j||(j=d("LSIntEnum"))).ofNumber(c("LSInternetConnectionState").CONNECTED))?"connected":"not_connected"};function a(a){var b=c("useAsyncReStore")(),e=m(null),f=m(null),g=k(function(b){c("MWGetChatTabOpenQPLEventTrace")(a,function(a){a.addMarkerPoint("connectivity_status_"+b,"AppTiming")})},[a]);l(function(){if(!c("gkx")("3822"))return;void b.then(function(a){c("promiseDone")(d("ReQL").firstAsync(d("ReQL").fromTableDescending(a.tables.connectivity_status).map(n)).then(function(a){if(a!==f.current){var b;g((b=a)!=null?b:"connection_is_not_created");f.current=a}})),e.current=a.tables.connectivity_status.subscribe(function(a,b){if(b.operation==="add"){a=n(b.value);a!==f.current&&(g(a),f.current=a)}})});return function(){e.current!=null&&e.current()}},[g,b,e])}g["default"]=a}),98);
__d("MWV2ChatTabs.react",["CometErrorBoundary.react","CometPlaceholder.react","HeroInteractionIgnoreWithDiv.react","I64","JSResourceForInteraction","MAWEditMessageContext.react","MWChatInteraction","MWChatStateContext","MWChatStateV2CompareTabs","MWChatStateV2HeadGroups","MWChatStateV2TabGroups","MWChatStateV2Types","MWPReplyContext.react","MWV2ChatHeads.react","MWV2ChatTabLoadingWithGlimmers.react","MWV2ChatTabsLayout.react","MWV2EnsureThatChatTabExists","MWV2IsTabFocusedContext.react","cr:7101","hero-tracing","justknobx","lazyLoadComponent","react","useCometDisplayTimingTrackerForInteraction","useMWChatStateV2MaxTabCount","useMWMonitorChatConnectionStatus"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=h||(h=d("react"));e=h;var k=e.useCallback,l=e.useContext;e=b("cr:7101")||{};var m=e.MWComposerKeyCommandFocusManager,n=e.MWComposerKeyCommandFocusManagerTabIndex,o=c("lazyLoadComponent")(c("JSResourceForInteraction")("MWV2ComposeTab.react").__setRef("MWV2ChatTabs.react")),p=c("lazyLoadComponent")(c("JSResourceForInteraction")("MWV2ChatTab.react").__setRef("MWV2ChatTabs.react"));function q(a){var b=a.isMinimized,e=a.tab;a=a.threadKeyDescriptor;d("MWV2EnsureThatChatTabExists").useMWV2EnsureThatChatTabExists(a.threadKey,a.threadType,a.clientThreadKey);c("useMWMonitorChatConnectionStatus")(a.threadKey);return j.jsx(p,{isMinimized:b,tab:e,threadKeyDescriptor:a})}q.displayName=q.name+" [from "+f.id+"]";function a(a){a=a.isMediaViewer;var b=l(d("MWChatStateContext").stateContext),e=d("MWChatStateContext").useChatState(function(a){return[a.focusedTabId,a.mediaViewerOpenWatermark]}),f=e[0];e=e[1];var g=c("useMWChatStateV2MaxTabCount")(a);g=d("MWChatStateV2TabGroups").getTabGroups(a?e:void 0,b.tabs,f,g);var h=g.minimizedTabs,p=g.openExcessTabs,r=g.openTabs;g=d("MWChatStateV2HeadGroups").getHeadGroups(a?e:void 0,p,b.tabs,d("MWV2ChatHeads.react").MAX_CHAT_HEADS);g[0];var s=g[1],t=k(function(a){if(a.type===d("MWChatStateV2Types").MWChatStateTabType.ComposeTab)return null;else return d("MWChatInteraction").get((i||(i=d("I64"))).to_string(a.threadKeyDescriptor.threadKey))},[]),u=c("useCometDisplayTimingTrackerForInteraction")("ChatMain",!0);a=c("justknobx")._("1857")?h.filter(function(a){return!s.includes(a)}):h;e=[].concat(r,a,p).sort(d("MWChatStateV2CompareTabs").byMostRecentOpened);b=e.map(function(a,b){var e=f===a.tabId,g=a.tabType,h=null,i=r.indexOf(a)===-1;g.type===d("MWChatStateV2Types").MWChatStateTabType.ComposeTab?h=j.jsx(o,{initialTokens:g.initialTokens,tab:a},g.initialTokens.map(function(a){return a.id}).join()):h=j.jsx(q,{isMinimized:i,tab:a,threadKeyDescriptor:g.threadKeyDescriptor});g=j.jsx(d("MWV2IsTabFocusedContext.react").MWV2IsTabFocusedContextProvider,{isFocused:e,children:j.jsx(d("MWPReplyContext.react").MWPReplyContextProvider,{children:j.jsx(d("MAWEditMessageContext.react").MAWEditMessageContext,{children:j.jsx(c("HeroInteractionIgnoreWithDiv.react"),{children:j.jsx(d("hero-tracing").HeroInteraction,{alwaysMarkMutationRootAsVisualChange:!0,interactionDesc:"MWV2_CHAT_TAB",interactionUUID:t(a.tabType),pageletName:"ChatTab",ref:u,children:j.jsx(c("CometPlaceholder.react"),{fallback:i?null:j.jsx(c("MWV2ChatTabLoadingWithGlimmers.react"),{tab:a}),children:h})})})})})});return j.jsx(c("CometErrorBoundary.react"),{fallback:function(){return null},children:n==null?g:j.jsx(n,{value:b,children:g})},String(a.tabId))});return j.jsx(c("MWV2ChatTabsLayout.react"),{children:m==null?b:j.jsx(m,{children:b})})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("useSubscribeToErrorTableAndShowToast",["ReQL","react","requireDeferred","translatedServerString","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=(i||d("react")).useEffect,k=c("requireDeferred")("LSUserVisibleErrorsUtil").__setRef("useSubscribeToErrorTableAndShowToast"),l=c("requireDeferred")("mwPushToast").__setRef("useSubscribeToErrorTableAndShowToast"),m={contents:!1};function a(){var a=(h||(h=c("useReStore")))();return j(function(){if(m.contents)return;m.contents=!0;var b=d("ReQL").fromTableAscending(a.tables.user_visible_errors).subscribe(function(b,d){switch(d.operation){case"add":var e=d.value;b=e.presentationStyle;if(b!=null&&b!=="toast"&&b!=="undefined")return;l.onReady(function(b){b.mwPushErrorToast({body:e.errorBodyText!=null?c("translatedServerString")(e.errorBodyText):void 0,onDismiss:function(){k.onReady(function(b){b.removeUserVisibleErrorFromTable(a,e.errorId)})},title:c("translatedServerString")(e.errorTitleText)})});return;case"put":case"delete":return}});return function(){m.contents=!1;return b()}},[a])}g["default"]=a}),98);
__d("useMWChatInit",["MWLSCommunityChatPopper","MWPGetThreadTitle","ReQL","ReQLSuspense","promiseDone","react","useMWLSChatPopperUpper","useReStore","useSubscribeToErrorTableAndShowToast"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=(i||d("react")).useEffect;function a(){var a=(h||(h=c("useReStore")))();j(function(){var b;c("promiseDone")((b=d("ReQL")).toArrayAsync(b.fromTableAscending(a.tables.threads).map(function(b){return[b,d("ReQLSuspense").toArray(d("ReQL").leftJoin(d("ReQL").fromTableAscending(a.tables.participants,[]).getKeyRange(b.threadKey),d("ReQL").fromTableAscending(a.tables.contacts)).take(d("MWPGetThreadTitle").amountToFetchForTitle),f.id+":34")]}).take(30)));c("promiseDone")(b.toArrayAsync(b.fromTableAscending(a.tables.pinned_threads.index("pinnedTimestamp"))));c("promiseDone")(b.toArrayAsync(b.fromTableAscending(a.tables.community_folders)))},[a]);c("useSubscribeToErrorTableAndShowToast")();var b=!0;c("useMWLSChatPopperUpper")({storage:a,withChatTabTracing:b});d("MWLSCommunityChatPopper").useOpenCommunityChatTabs({storage:a,withChatTabTracing:b})}g["default"]=a}),98);
__d("useMWIsAPPlusChannelsInbox",["useCometRouterState"],(function(a,b,c,d,e,f,g){"use strict";function a(){var a=c("useCometRouterState")();if(a==null)return!1;var b=a.main;a=a.pushViewStack;a=a&&a.length>0?a[a.length-1]:b;return((b=a.route)==null?void 0:b.tracePolicy)==="comet.messenger.applus.inbox"}g["default"]=a}),98);
__d("useMWIsTopLevelRouteMessengerMediaViewer",["useCometRouterState"],(function(a,b,c,d,e,f,g){"use strict";function a(){var a=c("useCometRouterState")();if(a==null)return!1;var b=a.main;a=a.pushViewStack;a=a&&a.length>0?a[a.length-1]:b;return((b=a.route)==null?void 0:b.tracePolicy)==="comet.sharedmediaviewer.media"}g["default"]=a}),98);
__d("useMWV2ChatUpdateMediaViewerOpenWatermark",["MWChatStateActions","MWChatStateV2.react","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=(h||d("react")).useCallback;function a(){var a=d("MWChatStateV2.react").useDispatch();return i(function(){var b=Date.now();a(d("MWChatStateActions").updateMediaViewerOpenWatermark(b))},[a])}g["default"]=a}),98);
__d("MWV2CookieWriter",["DeferredCookie","I64","MWCMThreadTypes.react","MWChatStateV2Types","Promise","ReQL","promiseDone","recoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(a){switch(Number((i||(i=d("I64"))).to_string(a))){case 2:return"g.";case 15:return"sc.";case 16:return"sg.";case 18:return"cg.";case 19:return"cgu.";case 23:return"cbj.";case 24:return"cbu.";case 21:return"cphj.";case 22:return"cphu.";case 150:return"dp.";case 151:return"dpu.";case 152:return"dpb.";case 153:return"dpbu.";case 154:return"dp2.";case 155:return"dp2u.";default:return"u."}}function a(a,e,f){var g=function(a){if(e==null)return!1;var b=e.tabType;if(b.type===d("MWChatStateV2Types").MWChatStateTabType.ComposeTab)return!1;else return(i||(i=d("I64"))).equal(b.threadKeyDescriptor.threadKey,a)},k=function(a){return d("ReQL").firstAsync(d("ReQL").fromTableAscending(f.tables.threads).getKeyRange(a))},l={contents:void 0};a=a.map(function(a){var c=a.isOpen,e=a.threadKey,f=a.threadType,m={o:c?1:0};return k(e).then(function(a){if(a!=null)if(g(e)){d("MWCMThreadTypes.react").isJoinedCMThread(f)&&(l.contents=(i||(i=d("I64"))).to_string(a.parentThreadKey));return(h||(h=b("Promise"))).resolve()}else{m.i=j(f)+(i||(i=d("I64"))).to_string(e);d("MWCMThreadTypes.react").isJoinedCMThread(f)&&(m.p=(i||(i=d("I64"))).to_string(a.parentThreadKey));return(h||(h=b("Promise"))).resolve(m)}else{m.i=j(f)+(i||(i=d("I64"))).to_string(e);return(h||(h=b("Promise"))).resolve(m)}})});c("promiseDone")((h||(h=b("Promise"))).all(a).then(function(a){var f;if(e!=null){var g=e.tabType;if(g.type===d("MWChatStateV2Types").MWChatStateTabType.ComposeTab)f=void 0;else{g=g.threadKeyDescriptor;var k=g.threadKey;g=g.threadType;f=j(g)+(i||(i=d("I64"))).to_string(k)}}else f=void 0;g=a.filter(function(a){return a!=null});k=l.contents;a=k!=null?JSON.stringify({lm3:f,lm3p:k,t3:g,utc3:Date.now(),v:1}):JSON.stringify({lm3:f,t3:g,utc3:Date.now(),v:1});a!=null?c("DeferredCookie").addToQueue("presence","C"+a,0,"/",!1,!1,!0):c("recoverableViolation")("Failed to serialize cookie","messenger_comet");return(h||(h=b("Promise"))).resolve()}))}g.write=a}),98);
__d("useMWV2CookieWriter",["MWChatStateContext","MWChatStateV2CompareTabs","MWChatStateV2IsOpen","MWChatStateV2Types","MWV2CookieWriter","gkx","react","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=(i||d("react")).useEffect;function a(){var a=d("MWChatStateContext").useChatState(function(a){return a.tabs}),b=(h||(h=c("useReStore")))();j(function(){var c=Array.from(a.values()).filter(function(a){return d("MWChatStateV2IsOpen").isOpen(void 0,a)}).sort(d("MWChatStateV2CompareTabs").byMostRecentOpened)[0],e=[];Array.from(a.values()).filter(function(a){if(a.openWatermark>a.closeWatermark)return!0;else return a.minimizeWatermark>a.closeWatermark}).sort(function(a,b){var c=d("MWChatStateV2CompareTabs").byMostRecentMinimized(a,b);if(c===0)return d("MWChatStateV2CompareTabs").byMostRecentOpened(a,b);else return c}).forEach(function(a){a=a.tabType;if(a.type===d("MWChatStateV2Types").MWChatStateTabType.ComposeTab)return;e.push(babelHelpers["extends"]({},a.threadKeyDescriptor,{isOpen:!1}))});d("MWV2CookieWriter").write(e,c,b)},[b,a])}function b(){return}e=c("gkx")("24038")?a:b;f=e;g["default"]=f}),98);
__d("MWV2ChatTabsRoot.react",["CometContextualLayerAnchorRoot.react","CometDOMOnlyBoundary.react","CometPlaceholder.react","FocusRegion.react","MWChatStateV2.react","MWChatVisibilityOverrideContext","MWFallbackWithTimeout.react","MWLSThreadDisplayContext","MWV2ChatHeads.react","MWV2ChatTabs.react","WebUXLoggingEntryPointContextProvider","cr:905","cr:9942","focusScopeQueries","gkx","react","stylex","useMWChatInit","useMWIsAPPlusChannelsInbox","useMWIsOnPushView","useMWIsTopLevelRouteMediaViewerExperiment","useMWIsTopLevelRouteMessengerMediaViewer","useMWV2ChatUpdateMediaViewerOpenWatermark","useMWV2CookieWriter","useShouldShowMessagingEntrypointInCometRoot"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=i||(i=d("react")),k=i,l=k.useEffect,m=k.useMemo;function a(){return{}}var n=(k=b("cr:905"))!=null?k:a,o={chatAbovePushView:{zIndex:"x1vjfegm",$$css:!0},hidden:{display:"x1s85apg",$$css:!0},root:{bottom:"x1ey2m1c",end:"xds687c",position:"xixxii4",$$css:!0}};function p(a){var b=a.isMediaViewer;a=a.showChatAbovePushView;var e=d("MWChatStateV2.react").useChatState(function(a){return a.tabs}),f=c("useMWIsTopLevelRouteMessengerMediaViewer")(),g=m(function(){return Array.from(e.values()).some(function(a){return a.openWatermark>a.closeWatermark})},[e]);a=j.jsx(d("WebUXLoggingEntryPointContextProvider").WebUXLoggingEntryPointContextProvider,{value:"popup_chat_box",children:j.jsx(d("MWLSThreadDisplayContext").MWLSThreadDisplayContextProvider,{value:"ChatTab",children:j.jsx("div",{className:(h||(h=c("stylex")))(o.root,a||c("gkx")("24129")?o.chatAbovePushView:!1,f?o.hidden:null),children:j.jsx(c("CometContextualLayerAnchorRoot.react"),{children:j.jsx("div",{className:"xuk3077 x78zum5 xc8icb0",children:j.jsx(d("FocusRegion.react").FocusRegion,{containFocusQuery:g?d("focusScopeQueries").tabbableScopeQuery:void 0,id:"MWV2ChatTabsRootChatTabsFocusRegion",children:j.jsxs(j.Fragment,{children:[j.jsx(c("MWV2ChatTabs.react"),{isMediaViewer:b}),j.jsx(c("CometDOMOnlyBoundary.react"),{children:j.jsx(d("MWV2ChatHeads.react").MWV2ChatHeads,{isMediaViewer:b})})]})})})})})})});return a}p.displayName=p.name+" [from "+f.id+"]";function q(a){a=a.children;c("useMWV2CookieWriter")();c("useMWChatInit")();return a}q.displayName=q.name+" [from "+f.id+"]";function e(){var a=c("useMWIsOnPushView")(),e=c("useMWIsTopLevelRouteMediaViewerExperiment")(),f=d("MWChatVisibilityOverrideContext").useMWChatVisibilityOverride(e),g=c("useMWV2ChatUpdateMediaViewerOpenWatermark")(),h=c("useMWIsAPPlusChannelsInbox")(),i=c("useShouldShowMessagingEntrypointInCometRoot")("CHAT_TABS_ROOT")&&f&&!h;l(function(){e&&g()},[e,g]);n();return m(function(){return j.jsxs(c("CometPlaceholder.react"),{fallback:j.jsx(c("MWFallbackWithTimeout.react"),{message:"MWV2ChatTabsRoot suspense timeout"}),children:[b("cr:9942")&&j.jsx(b("cr:9942"),{}),j.jsx(q,{children:i?j.jsx(p,{isMediaViewer:e,showChatAbovePushView:a}):null})]})},[i,a,e])}e.displayName=e.name+" [from "+f.id+"]";g["default"]=e}),98);
__d("MWV2ChatContainer.react",["MWChatEncryptedBackupsHandleRestoreWrapperDeferred.react","MWV2ChatTabsRoot.react","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(){return i.jsxs(i.Fragment,{children:[i.jsx(c("MWV2ChatTabsRoot.react"),{}),i.jsx(c("MWChatEncryptedBackupsHandleRestoreWrapperDeferred.react"),{})]})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);/*FB_PKG_DELIM*/
__d("BPlusTree",["unrecoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";var h={gt:[!1,0],gte:[!0,0],lt:[!0,1],lte:[!1,1]};a=function(){function a(a,b){b===void 0&&(b=32),this.$3={children:[],isLeaf:!0,keys:[]},this.$4=this.$3,this.$5=this.$3,this.$1=a,this.$2=b}a.fromSorted=function(a,b,c){b=new this(b,c);c=a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();a=c.next();while(!a.done){var d=[],e=b.$5,f;while(!e.isLeaf)d.push([e,-1]),f=e.keys.length,e=e.children[f];f=(b.$2-1)*2;f=f-e.keys.length;while(!a.done&&f>0)e.keys.push(a.value[0]),e.children.push(a.value[1]),f--,a=c.next();b.$6(e,d,!0)}return b};var b=a.prototype;b.$7=function(a,b){var c=this.$5,d=-1;while(!c.isLeaf)b==null?void 0:b.push([c,d]),d=this.$8(c.keys,a,h.gt),d===-1&&(d=c.keys.length),c=c.children[d];return[c,d]};b.$8=function(a,b,c){var d=0,e=a.length-1;while(d<=e){var f=d+e>>1;(c[0]?this.$1(a[f],b)<0:this.$1(a[f],b)<=0)?d=f+1:e=f-1}f=[d,e][c[1]];return f===a.length?-1:f};b.$9=function(a,b){if(!a.length){a.push(b);return[0,0]}var c=this.$8(a,b,h.gte);if(c===-1)return[a.push(b)-1,0];else if(this.$1(a[c],b)===0)return[c,1];a.splice(c,0,b);return[c,0]};b.$6=function(a,b,c){for(var a=a,d;a.keys.length>=this.$2;a=d){var d=b.pop()||[this.$5={children:[a],isLeaf:!1,keys:[]}];d=d[0];var e=Math.floor(a.keys.length/2),f=void 0;a.isLeaf?(f=a.next={children:a.children.slice(e),isLeaf:!0,keys:a.keys.slice(e),next:a.next,prev:a},f.next?f.next.prev=f:this.$4=f):f={children:a.children.slice(e+1),isLeaf:!1,keys:a.keys.slice(e+1)};if(c)d.keys.push(a.keys[e]),d.children.push(f);else{var g=this.$9(d.keys,a.keys[e]);g=g[0];d.children.splice(g+1,0,f)}a.keys.length=e;a.children.length=e+(a.isLeaf?0:1)}};b.clear=function(){this.$5=this.$3=this.$4={children:[],isLeaf:!0,keys:[]}};b.delete=function(a){var b=Math.floor(this.$2/2),d=[],e=this.$7(a,d),f=e[0];e=e[1];var g=this.$8(f.keys,a,h.gte);if(g===-1||this.$1(f.keys[g],a)!==0)return!1;f.keys.splice(g,1);f.children.splice(g,1);for(var a=f,g=e,e,f;a.keys.length<b&&d.length;o=[e,f],a=o[0],g=o[1],o){f=d.pop();e=f[0];f=f[1];var i=[[e.children[g-1],a,g-1],[a,e.children[g+1],g]].filter(function(a){var b=a[0];a=a[1];return b&&a});for(var j of i){var k=j[0],l=j[1],m=j[2];if(k.keys.length+l.keys.length>=b*2){if(a.isLeaf){var n=[].concat(k.children,l.children),o=[].concat(k.keys,l.keys);k.children=(l.children=n).splice(0,b);k.keys=(l.keys=o).splice(0,b);e.keys[m]=o[0]}else{n=[].concat(k.children,l.children);o=[].concat(k.keys,[e.keys[m]],l.keys);k.children=(l.children=n).splice(0,b+1);e.keys[m]=o.splice(b,1)[0];k.keys=(l.keys=o).splice(0,b)}return!0}}for(n of i){m=n[0];k=n[1];l=n[2];m.children=[].concat(m.children,k.children);a.isLeaf?(m.keys=[].concat(m.keys,k.keys),k.keys.length=0,k.next?k.next.prev=m:this.$4=m,m.next=k.next):m.keys=[].concat(m.keys,[e.keys[l]],k.keys);e.keys.splice(l,1);e.children.splice(l+1,1);break}}if(!this.$5.keys.length&&this.$5.children.length){j=this.$5;if(j.isLeaf)throw c("unrecoverableViolation")("cannot be leaf","maw_db");this.$5=j.children[0]}return!0};b.entries=function*(a){a=a===void 0?{}:a;var b=a.dir;b=b===void 0?"asc":b;a=babelHelpers.objectWithoutPropertiesLoose(a,["dir"]);if(Object.prototype.hasOwnProperty.call(a,"gt")&&Object.prototype.hasOwnProperty.call(a,"gte"))throw c("unrecoverableViolation")("cannot specify both greater than and greater than or equal","maw_db");if(Object.prototype.hasOwnProperty.call(a,"lt")&&Object.prototype.hasOwnProperty.call(a,"lte"))throw c("unrecoverableViolation")("cannot specify both less than and less than or equal","maw_db");if(b==="asc"){if(Object.prototype.hasOwnProperty.call(a,"gt")){b=this.$7(a.gt);b=b[0]}else if(Object.prototype.hasOwnProperty.call(a,"gte")){var d=this.$7(a.gte);b=d[0]}else b=this.$3;d=Object.prototype.hasOwnProperty.call(a,"gt")?this.$8(b.keys,a.gt,h.gt):Object.prototype.hasOwnProperty.call(a,"gte")?this.$8(b.keys,a.gte,h.gte):0;while(b){var e=b;while(d!==-1&&d<e.keys.length){var f=e.keys[d];if(Object.prototype.hasOwnProperty.call(a,"lt")&&this.$1(f,a.lt)>=0||Object.prototype.hasOwnProperty.call(a,"lte")&&this.$1(f,a.lte)>0)return;var g=(yield [e.keys[d],e.children[d]]);if(g!=null){if(this.$1(g,f)<=0)throw c("unrecoverableViolation")("key must be greater than current key","maw_db");d=this.$8(e.keys,g,h.gte);if(d===-1){var i=this.$7(g);e=i[0];d=this.$8(e.keys,g,h.gte)}}else{i=e.keys[d]!==f;if(i){d=this.$8(e.keys,f,h.lte);if(d===-1){g=this.$7(f);e=g[0];d=this.$8(e.keys,f,h.lte)}}d++}}b=e.next;d=0}}else{if(Object.prototype.hasOwnProperty.call(a,"lt")){i=this.$7(a.lt);b=i[0]}else if(Object.prototype.hasOwnProperty.call(a,"lte")){g=this.$7(a.lte);b=g[0]}else b=this.$4;f=Object.prototype.hasOwnProperty.call(a,"lt")?this.$8(b.keys,a.lt,h.lt):Object.prototype.hasOwnProperty.call(a,"lte")?this.$8(b.keys,a.lte,h.lte):b.keys.length-1;while(b){e=b;while(f!==-1&&f>=0){d=e.keys[f];if(Object.prototype.hasOwnProperty.call(a,"gt")&&this.$1(d,a.gt)<=0||Object.prototype.hasOwnProperty.call(a,"gte")&&this.$1(d,a.gte)<0)return;i=(yield [e.keys[f],e.children[f]]);if(i!=null){if(this.$1(i,d)>=0)throw c("unrecoverableViolation")("key must be less than current key","maw_db");f=this.$8(e.keys,i,h.lte);if(f===-1){g=this.$7(i);e=g[0];f=this.$8(e.keys,i,h.lte)}}else{g=e.keys[f]!==d;if(g){f=this.$8(e.keys,d,h.gte);if(f===-1){i=this.$7(d);e=i[0];f=this.$8(e.keys,d,h.gte)}}f--}}b=e.prev;f=b!=null?b.keys.length-1:-1}}};b.get=function(a){var b=this.$7(a);b=b[0];var d=this.$8(b.keys,a,h.gte);if(d===-1||this.$1(b.keys[d],a)!==0)throw c("unrecoverableViolation")("key not found: "+String(a),"maw_db");return b.children[d]};b.getWithDefault=function(a,b){var c=this.$7(a);c=c[0];var d=this.$8(c.keys,a,h.gte);return d===-1||this.$1(c.keys[d],a)!==0?b:c.children[d]};b.has=function(a){var b=this,c=this.$7(a);c=c[0];return c.keys.findIndex(function(c){return b.$1(a,c)===0})!==-1};b.set=function(a,b){var c=[],d=this.$7(a,c);d=d[0];a=this.$9(d.keys,a);var e=a[0];a=a[1];d.children.splice(e,a,b);this.$6(d,c,!1);return this};return a}();g.default=a}),98);
__d("MAWWaitForBackendSetup",["ErrorSerializer","MAWInitError","Promise","err","justknobx","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=new(h||(h=b("Promise")))(function(a,b){i=a,j=b}),l=!1,m=!1,n=i,o=j;function p(a){return new(h||(h=b("Promise")))(function(b,e){k.then(b)["catch"](function(b){var f=a+" rejected because backend setup failed: "+b.message+".";b=b instanceof d("MAWInitError").MAWInitError?b.error:null;b!=null&&(f=f.concat(" More error detail: "+c("ErrorSerializer").toReadableMessage(b)));e(c("err")(f))})})}function a(a,b){c("promiseDone")(p(b).then(function(){a()}))}function e(){k=new(h||(h=b("Promise")))(function(a,b){i=a,j=b}),l=!1,n=i,o=j,m=!0}function f(){l=!0,n==null?void 0:n()}function q(a){l=!1,o==null?void 0:o(a)}function r(){return l}function s(){return m}function t(a){if(c("justknobx")._("2628"))return a()}g.waitForBackendSetup=p;g.runAfterBackendSetup=a;g.resetBackendSetup=e;g.resolveBackendSetup=f;g.rejectBackendSetup=q;g.isBackendSetupSuccessful=r;g.wasBackendSetupReset=s;g.withKnobs=t}),98);
__d("EBSMGating",["MAWWaitForBackendSetup","gkx"],(function(a,b,c,d,e,f,g){"use strict";function h(){return c("gkx")("24151")}function a(){return d("MAWWaitForBackendSetup").isBackendSetupSuccessful()||h()}g.isPersistedEBTableEnabled=h;g.isBackendSetupSuccessfulForEBSM=a}),98);
__d("EBSMProperties",[],(function(a,b,c,d,e,f){"use strict";a=["encrypted_backups_virtual_devices","secure_encrypted_backups_recovery_code_status","device_metadata","secure_encrypted_backups_epochs","secure_encrypted_backups_client_state","encrypted_backups","experiences_shared_state","occamadillo_most_recent_message_per_thread","auto_restore_opt_out"];b=new Set(["secure_encrypted_backups_client_state","secure_encrypted_backups_epochs"]);c={dbVersion:5,mandatoryTables:b,persistedTables:new Set(a),persistedTablesArray:a};d=c;f["default"]=d}),66);
__d("I64MigrationHelper",["I64","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return c("nullthrows")((h||(h=d("I64"))).cast(a))}g.cast=a}),98);
__d("LSAuthorityLevel",[],(function(a,b,c,d,e,f){a=Object.freeze({OPTIMISTIC:20,CLIENT_PARTIAL:40,SERVER_PARTIAL:60,AUTHORITATIVE_PENDING_REPLACEMENT:75,AUTHORITATIVE:80,CLIENT_AUTHORITATIVE_DELETE:100});f["default"]=a}),66);
__d("LSBitOffset",["I64","LSBitFlag"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){return d("LSBitFlag").set((h||(h=d("I64"))).lsl_(h.one,h.to_int32(a)),b)}function b(a,b){return d("LSBitFlag").clear((h||(h=d("I64"))).lsl_(h.one,h.to_int32(a)),b)}g.set=a;g.clear=b;g.empty=(h||(h=d("I64"))).zero}),98);
__d("LSClientSchemaType",[],(function(a,b,c,d,e,f){"use strict";a="maw";f.MAW_SCHEMA_NAME=a}),66);
__d("LSConstants",[],(function(a,b,c,d,e,f){"use strict";a="ls";f.LS_SCHEMA_NAME=a}),66);
__d("LSContactBitOffset",["I64","LSBitFlag","LSBitOffset"],(function(a,b,c,d,e,f,g){"use strict";var h;c=["capabilities","capabilities2"];function a(a,b){return i(a,b,!1)}function i(a,b,c){var e=b.capabilities,f=b.capabilities2;if(a>=64){return f==null?c:d("LSBitFlag").has((h||(h=d("I64"))).lsl_(h.one,a-64),(f=b.capabilities2)!=null?f:d("LSBitOffset").empty)}return e==null?c:d("LSBitFlag").has((h||(h=d("I64"))).lsl_(h.one,a),(f=b.capabilities)!=null?f:d("LSBitOffset").empty)}function b(a,b){return d("LSBitFlag").has((h||(h=d("I64"))).lsl_(h.one,a-64),(a=b)!=null?a:d("LSBitOffset").empty)}g.contactCapabilityFields=c;g.has=a;g.hasWithDefault=i;g.contactCapabilitiesHas=b}),98);
__d("LSContactBlockedByViewerStatus",[],(function(a,b,c,d,e,f){a=Object.freeze({UNBLOCKED:0,MESSAGE_BLOCKED:1,FULLY_BLOCKED:2});f["default"]=a}),66);
__d("LSDbForeignKeys",[],(function(a,b,c,d,e,f){"use strict";a={attachments:[{indexName:"fk_attachments",tableName:"attachment_items"},{indexName:"fk_attachments",tableName:"attachment_ctas"}],community_chat_poll_options:[{tableName:"community_chat_poll_votes"}],community_chat_polls:[{tableName:"community_chat_poll_options"},{tableName:"community_chat_poll_votes"}],data_trace_meta:[{indexName:"traceIdAddonId",tableName:"data_trace_addon"}],messages:[{indexName:"fk_messages",tableName:"attachments"},{indexName:"fk_messages",tableName:"reactions"}],pending_tasks:[{tableName:"encrypted_backup_restore_task_payload_context"},{indexName:"fk_pending_tasks",tableName:"pending_backups_context_v2"},{indexName:"fk_pending_tasks",tableName:"secure_recovery_code_data"},{indexName:"fk_pending_tasks",tableName:"secure_encrypted_backups_message_thread_id_context"},{tableName:"messages_optimistic_context"}],rooms:[{tableName:"room_participants"}],secure_encrypted_backups_client_state:[{indexName:"fk_secure_encrypted_backups_client_state",tableName:"secure_encrypted_backups_epochs"}],secure_encrypted_backups_devices:[{indexName:"fk_secure_encrypted_backups_device_supported_versions_device_id",tableName:"secure_encrypted_backups_device_supported_versions"}],threads:[{indexName:"threadKeyCtaId",tableName:"thread_nullstate_ctas"},{tableName:"messages"},{tableName:"attachments"},{tableName:"thread_nullstate"},{tableName:"messages_ranges_v2__generated"},{tableName:"attachments_ranges_v2__generated"},{tableName:"participants"},{indexName:"fk_threads",tableName:"mi_act_mapping_table"},{tableName:"group_invites"}]};b=a;f["default"]=b}),66);
__d("MAWDbVersionList",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a}b={V21:21,V22:22,V23:23,V24:24,V25:25,V26:26,V27:27,V28:28,V29:29,V30:30,V31:31,V32:32,V33:33,V34:34,V35:35,V36:36,V37:37,V38:38,V39:39,V40:40,V41:41,V42:42,V43:43,V44:44,V45:45,V46:46,V47:47,V48:48,V49:49,V50:50,V51:51,V52:52,V53:53,V54:54,V55:55,V56:56,V57:57,V58:58,V59:59,V60:60,V61:61,V62:62,V63:63,V64:64,V65:65,V66:66,V67:67,V68:68,V69:69,V70:70,V71:71,V72:72,V73:73,V74:74,V75:75,V76:76,V77:77,V78:78,V79:79,V80:80,V81:81,V82:82,V83:83,V84:84,V85:85,V86:86,V87:87,V88:88,V89:89,V90:90,V91:91,V92:92,V93:93,V94:94,V95:95,V96:96,V97:97,V98:98,V99:99,V100:100,V101:101,V102:102,V103:103,V104:104,V105:105,V106:106,V107:107,V108:108,V109:109,V110:110,V111:111,V112:112,V113:113,V114:114,V115:115,V116:116,V117:117};f.toVersion=a;f.VERSION=b}),66);
__d("MAWDbSchema",["MAWDbVersionList"],(function(a,b,c,d,e,f,g){"use strict";a=[{autoIncrement:!0,indexes:{externalId:{columns:["externalId"]}},name:"e2ee_appData",primaryKey:["appDataId"]},{autoIncrement:!1,indexes:{},name:"e2ee_meta",primaryKey:["key"]},{autoIncrement:!1,indexes:{},name:"e2ee_appMeta",primaryKey:["key"]},{autoIncrement:!1,indexes:{},name:"e2ee_prekey",primaryKey:["keyId"]},{autoIncrement:!1,indexes:{},name:"e2ee_prekeyGeneration",primaryKey:["generationId"]},{autoIncrement:!1,indexes:{},name:"e2ee_session",primaryKey:["id"]},{autoIncrement:!1,indexes:{},name:"e2ee_signedPrekey",primaryKey:["keyId"]},{autoIncrement:!1,indexes:{},name:"e2ee_tasks",primaryKey:["taskName"]},{autoIncrement:!1,indexes:{groupJid:{columns:["groupJid"],unique:!1},userJid:{columns:["userJid"],unique:!1}},name:"e2ee_senderKeySessions",primaryKey:["id"]},{autoIncrement:!1,indexes:{},name:"e2ee_personalSenderKeyStatuses",primaryKey:["groupJid"]},{autoIncrement:!0,indexes:{altIndex:{columns:["altIndex"],unique:!1},externalId:{columns:["externalId"],unique:!1},messageDeleteTs:{columns:["messageDeleteTs"],unique:!1},messageExpirationTs:{columns:["messageExpirationTs"],unique:!1},msgId:{columns:["msgId"],unique:!1},quoteExternalId:{columns:["quoteExternalId"],unique:!1},thread:{columns:["thread"],unique:!1}},name:"e2ee_messages",primaryKey:["rowId"]},{autoIncrement:!0,indexes:{externalId:{columns:["externalId"],unique:!1},msgId:{columns:["msgId"],unique:!1},thread:{columns:["thread"],unique:!1}},name:"e2ee_unrenderedMessages",primaryKey:["rowId"]},{autoIncrement:!0,indexes:{externalIdWithType:{columns:["externalIdWithType"],unique:!1}},name:"e2ee_pendingStanzas",primaryKey:["rowId"]},{autoIncrement:!1,indexes:{threadId:{columns:["threadId"],unique:!1},userJid:{columns:["userJid"],unique:!1}},name:"e2ee_participants",primaryKey:["id"]},{autoIncrement:!1,indexes:{},name:"e2ee_contacts",primaryKey:["contactJid"]},{autoIncrement:!1,indexes:{},name:"e2ee_receipts",primaryKey:["msgId"]},{autoIncrement:!0,indexes:{"*msgIds":{columns:["msgIds"],multiEntry_DO_NOT_USE:!0},hashedPlaintextHash:{columns:["hashedPlaintextHash"]}},name:"e2ee_media",primaryKey:["mediaId"]},{autoIncrement:!0,indexes:{externalId:{columns:["externalId"],unique:!1},reactionId:{columns:["reactionId"],unique:!1},reactToExternalId:{columns:["reactToExternalId"],unique:!1},reactToMsgId:{columns:["reactToMsgId"],unique:!1},threadJid:{columns:["threadJid"],unique:!1}},name:"e2ee_reactions",primaryKey:["rowId"]},{autoIncrement:!0,indexes:{hashedPlaintextHash:{columns:["hashedPlaintextHash"]}},name:"e2ee_chunk",primaryKey:["chunkId"]},{autoIncrement:!0,indexes:{jid:{columns:["jid"]},threadOrder:{columns:["threadOrder"],unique:!1}},name:"e2ee_threads",primaryKey:["chatId"]},{autoIncrement:!1,indexes:{},name:"e2ee_existingUsers",primaryKey:["id"]},{autoIncrement:!1,indexes:{},name:"e2ee_pendingReceipts",primaryKey:["id"]},{autoIncrement:!0,indexes:{version:{columns:["version"]}},name:"e2ee_browserEncryptionMeta",primaryKey:["id"]},{autoIncrement:!1,indexes:{},name:"e2ee_ftsBackloggedMessages",primaryKey:["rowId"]},{autoIncrement:!1,indexes:{},name:"e2ee_ftsEncryptionMeta",primaryKey:["key"]},{autoIncrement:!0,indexes:{"*prefixes":{columns:["prefixes"],multiEntry_DO_NOT_USE:!0,unique:!1},chatId:{columns:["chatId"],unique:!1},id:{columns:["id"],unique:!1}},name:"e2ee_ftsIndexV3",primaryKey:["ftsRowId"]},{autoIncrement:!0,indexes:{uniqKey:{columns:["uniqKey"]}},name:"e2ee_jobs",primaryKey:["jobId"]},{autoIncrement:!1,indexes:{},name:"e2ee_identity",primaryKey:["deviceJid"]},{autoIncrement:!1,indexes:{threadId:{columns:["threadId"],unique:!1}},name:"e2ee_groupInfo",primaryKey:["groupJid"]}];b=[{autoIncrement:!0,indexes:{altIndex:{columns:["altIndex"],unique:!1},externalId:{columns:["externalId"],unique:!1},messageDeleteTs:{columns:["messageDeleteTs"],unique:!1},messageExpirationTs:{columns:["messageExpirationTs"],unique:!1},msgId:{columns:["msgId"],unique:!1},quoteExternalId:{columns:["quoteExternalId"],unique:!1},thread:{columns:["thread"],unique:!1},unsendMsgContentDeleteTs:{columns:["unsendMsgContentDeleteTs"],unique:!1}},name:"e2ee_messages",primaryKey:["rowId"]}];c=[{autoIncrement:!0,indexes:{altIndex:{columns:["altIndex"],unique:!1},externalId:{columns:["externalId"],unique:!1},messageDeleteTs:{columns:["messageDeleteTs"],unique:!1},messageExpirationTs:{columns:["messageExpirationTs"],unique:!1},msgId:{columns:["msgId"],unique:!1},quoteExternalId:{columns:["quoteExternalId"],unique:!1},revokedExternalId:{columns:["revokedExternalId"],unique:!1},thread:{columns:["thread"],unique:!1},unsendMsgContentDeleteTs:{columns:["unsendMsgContentDeleteTs"],unique:!1}},name:"e2ee_messages",primaryKey:["rowId"]}];e=[{autoIncrement:!0,indexes:{},name:"e2ee_isDualSend",primaryKey:["rowId"]}];f=[{autoIncrement:!1,indexes:{},name:"e2ee_historySyncQRCodeSecretKey",primaryKey:["key"]}];var h=[{autoIncrement:!0,indexes:{externalId:{columns:["externalId"],unique:!1},messageDeleteForMeTs:{columns:["messageDeleteForMeTs"],unique:!1},msgId:{columns:["msgId"],unique:!1},thread:{columns:["thread"],unique:!1}},name:"e2ee_unrenderedMessages",primaryKey:["rowId"]}],i=[{autoIncrement:!0,indexes:{altIndex:{columns:["altIndex"],unique:!1},externalId:{columns:["externalId"],unique:!1},messageDeleteTs:{columns:["messageDeleteTs"],unique:!1},messageExpirationTs:{columns:["messageExpirationTs"],unique:!1},msgId:{columns:["msgId"],unique:!1},quoteExternalId:{columns:["quoteExternalId"],unique:!1},revokedExternalId:{columns:["revokedExternalId"],unique:!1},thread:{columns:["thread"],unique:!1},threadJid:{columns:["threadJid"],unique:!1},unsendMsgContentDeleteTs:{columns:["unsendMsgContentDeleteTs"],unique:!1}},name:"e2ee_messages",primaryKey:["rowId"]},{autoIncrement:!0,indexes:{externalId:{columns:["externalId"],unique:!1},messageDeleteForMeTs:{columns:["messageDeleteForMeTs"],unique:!1},msgId:{columns:["msgId"],unique:!1},thread:{columns:["thread"],unique:!1},threadJid:{columns:["threadJid"],unique:!1}},name:"e2ee_unrenderedMessages",primaryKey:["rowId"]}],j=[{autoIncrement:!1,indexes:{inviterJid:{columns:["inviterJid"],unique:!1}},name:"e2ee_groupInvites",primaryKey:["invitedParticipantId"]}],k=[{autoIncrement:!0,indexes:{deleteTs:{columns:["deleteTs"],unique:!1},externalIdWithType:{columns:["externalIdWithType"],unique:!1}},name:"e2ee_pendingStanzas",primaryKey:["rowId"]}],l=[{autoIncrement:!0,indexes:{"*msgIds":{columns:["msgIds"],multiEntry_DO_NOT_USE:!0},fbid:{columns:["fbid"]},hashedPlaintextHash:{columns:["hashedPlaintextHash"]},objectId:{columns:["objectId"]}},name:"e2ee_media",primaryKey:["mediaId"]}],m=[{autoIncrement:!0,indexes:{},name:"e2ee_dualSendMedia",primaryKey:["id"]}],n=[{autoIncrement:!0,indexes:{associatedMessageId:{columns:["associatedMessageId"],unique:!1},defaultPreviewMediaId:{columns:["defaultPreviewMediaId"],unique:!1},faviconMediaId:{columns:["faviconMediaId"],unique:!1},headerMediaId:{columns:["headerMediaId"],unique:!1},targetExpiringAtSec:{columns:["targetExpiringAtSec"],unique:!1}},name:"e2ee_xma",primaryKey:["xmaId"]}],o=[{autoIncrement:!1,indexes:{},name:"e2ee_historySyncQRCodeData",primaryKey:["rowId"]}],p=[{autoIncrement:!0,indexes:{associatedMessageId:{columns:["associatedMessageId"],unique:!1},defaultPreviewMediaId:{columns:["defaultPreviewMediaId"],unique:!1},externalId:{columns:["externalId"],unique:!1},faviconMediaId:{columns:["faviconMediaId"],unique:!1},headerMediaId:{columns:["headerMediaId"],unique:!1},targetExpiringAtSec:{columns:["targetExpiringAtSec"],unique:!1}},name:"e2ee_xma",primaryKey:["xmaId"]}],q=[{autoIncrement:!0,indexes:{},name:"e2ee_dyiBatch",primaryKey:["batchId"]}],r=[{autoIncrement:!1,indexes:{correspondingOpenThreadKey:{columns:["correspondingOpenThreadKey"],unique:!1},threadId:{columns:["threadId"],unique:!1}},name:"e2ee_groupInfo",primaryKey:["groupJid"]}],s=[{autoIncrement:!1,indexes:{},name:"e2ee_groupInvites",primaryKey:["invitedParticipantId","inviterJid"],removed:!0}],t=[{autoIncrement:!1,indexes:{inviterJid:{columns:["inviterJid"],unique:!1}},name:"e2ee_groupInvites",primaryKey:["invitedParticipantId","inviterJid"]}],u=[{autoIncrement:!0,indexes:{"[thread+sortOrderMs]":{columns:["thread","sortOrderMs"],unique:!1},altIndex:{columns:["altIndex"],unique:!1},externalId:{columns:["externalId"],unique:!1},messageDeleteTs:{columns:["messageDeleteTs"],unique:!1},messageExpirationTs:{columns:["messageExpirationTs"],unique:!1},msgId:{columns:["msgId"],unique:!1},quoteExternalId:{columns:["quoteExternalId"],unique:!1},revokedExternalId:{columns:["revokedExternalId"],unique:!1},thread:{columns:["thread"],unique:!1},threadJid:{columns:["threadJid"],unique:!1},unsendMsgContentDeleteTs:{columns:["unsendMsgContentDeleteTs"],unique:!1}},name:"e2ee_messages",primaryKey:["rowId"]},{autoIncrement:!0,indexes:{"[thread+sortOrderMs]":{columns:["thread","sortOrderMs"],unique:!1},externalId:{columns:["externalId"],unique:!1},messageDeleteForMeTs:{columns:["messageDeleteForMeTs"],unique:!1},msgId:{columns:["msgId"],unique:!1},thread:{columns:["thread"],unique:!1},threadJid:{columns:["threadJid"],unique:!1}},name:"e2ee_unrenderedMessages",primaryKey:["rowId"]}],v=[{autoIncrement:!1,indexes:{"[modelId+modelType+actionState]":{columns:["modelId","modelType","actionState"],unique:!1},action:{columns:["action"],unique:!1},actionState:{columns:["actionState"],unique:!1},collection:{columns:["collection"],unique:!1},indexMac:{columns:["indexMac"],unique:!1}},name:"e2ee_syncActions",primaryKey:["index"]}],w=[{autoIncrement:!1,indexes:{},name:"e2ee_missingKeys",primaryKey:["keyHex"]}],x=[{autoIncrement:!0,indexes:{action:{columns:["action"],unique:!1},collection:{columns:["collection"],unique:!1},index:{columns:["index"],unique:!1}},name:"e2ee_pendingMutations",primaryKey:["id"]}],y=[{autoIncrement:!0,indexes:{collection:{columns:["collection"]}},name:"e2ee_collectionVersions",primaryKey:["id"]}],z=[{autoIncrement:!0,indexes:{keyEpoch:{columns:["keyEpoch"],unique:!1},keyId:{columns:["keyId"]}},name:"e2ee_syncKeys",primaryKey:["id"]}],A=[{autoIncrement:!1,indexes:{userJid:{columns:["userJid"],unique:!1}},name:"e2ee_identity",primaryKey:["deviceJid"]}],B=[{autoIncrement:!1,indexes:{externalId:{columns:["externalId"],unique:!1},lastRetryTs:{columns:["lastRetryTs"],unique:!1},traceId:{columns:["traceId"],unique:!1}},name:"e2ee_uploadRetryStatus",primaryKey:["externalId","lastRetryTs"]}],C=[{autoIncrement:!0,indexes:{jid:{columns:["jid"],unique:!1},stanzaId:{columns:["stanzaId"],unique:!1},type:{columns:["type"],unique:!1}},name:"e2ee_stanzaQueue",primaryKey:["stanzaQueueId"]}],D=[{autoIncrement:!0,indexes:{},name:"e2ee_deviceChangeAlerts",primaryKey:["deviceChangeAlertsId"]}],E=[{autoIncrement:!1,indexes:{},name:"e2ee_retroactiveBackupsState",primaryKey:["threadId"]}],F=[{autoIncrement:!0,indexes:{deduplicationKey:{columns:["deduplicationKey"],predicate:function(a){return a.deduplicationKey!=null}},jid:{columns:["jid"]},threadOrder:{columns:["threadOrder"],unique:!1}},name:"e2ee_threads",primaryKey:["chatId"]}],G=[{autoIncrement:!0,indexes:{mediaId:{columns:["mediaId"],unique:!1},msgId:{columns:["msgId"],unique:!1},objectId:{columns:["objectId"]}},name:"e2ee_mediaBackup",primaryKey:["mediaBackupId"]}],H=[{autoIncrement:!0,indexes:{authoritativeThreadKey:{columns:["authoritativeThreadKey"]},deduplicationKey:{columns:["deduplicationKey"],predicate:function(a){return a.deduplicationKey!=null}},jid:{columns:["jid"]},threadOrder:{columns:["threadOrder"],unique:!1}},name:"e2ee_threads",primaryKey:["chatId"]}],I=[{autoIncrement:!0,indexes:{"[jid+type]":{columns:["jid","type"],unique:!1},jid:{columns:["jid"],unique:!1},stanzaId:{columns:["stanzaId"],unique:!1},type:{columns:["type"],unique:!1}},name:"e2ee_stanzaQueue",primaryKey:["stanzaQueueId"]}],J=[{autoIncrement:!0,indexes:{originalMsgExternalId:{columns:["originalMsgExternalId"],unique:!1},threadJid:{columns:["threadJid"],unique:!1}},name:"e2ee_editMsgHistory",primaryKey:["editMsgHistoryId"]}],K=[{autoIncrement:!1,indexes:{},name:"e2ee_ftsBackloggedMessages",primaryKey:["rowId"],removed:!0},{autoIncrement:!1,indexes:{},name:"e2ee_ftsEncryptionMeta",primaryKey:["key"],removed:!0},{autoIncrement:!0,indexes:{},name:"e2ee_ftsIndexV3",primaryKey:["ftsRowId"],removed:!0}],L=[{autoIncrement:!0,indexes:{"*msgIds":{columns:["msgIds"],multiEntry_DO_NOT_USE:!0},fbid:{columns:["fbid"],unique:!1},hashedPlaintextHash:{columns:["hashedPlaintextHash"]},objectId:{columns:["objectId"],unique:!1}},name:"e2ee_media",primaryKey:["mediaId"]}],M=[{autoIncrement:!0,indexes:{},name:"e2ee_ebRestoreQueue",primaryKey:["queueId"]},{autoIncrement:!0,indexes:{},name:"e2ee_ebUploadQueue",primaryKey:["queueId"]}],N=[{autoIncrement:!0,indexes:{"[uploadStatus+uploadTsSec]":{columns:["uploadStatus","uploadTsSec"],unique:!1},uploadStatus:{columns:["uploadStatus"],unique:!1},uploadTsSec:{columns:["uploadTsSec"],unique:!1}},name:"e2ee_ebRestoreQueue",primaryKey:["queueId"]},{autoIncrement:!0,indexes:{"[uploadStatus+uploadTsSec]":{columns:["uploadStatus","uploadTsSec"],unique:!1},uploadStatus:{columns:["uploadStatus"],unique:!1},uploadTsSec:{columns:["uploadTsSec"],unique:!1}},name:"e2ee_ebUploadQueue",primaryKey:["queueId"]}],O=[{autoIncrement:!0,indexes:{"[thread+serverTs]":{columns:["thread","serverTs"],unique:!1},"[thread+sortOrderMs]":{columns:["thread","sortOrderMs"],unique:!1},altIndex:{columns:["altIndex"],unique:!1},externalId:{columns:["externalId"],unique:!1},messageDeleteTs:{columns:["messageDeleteTs"],unique:!1},messageExpirationTs:{columns:["messageExpirationTs"],unique:!1},msgId:{columns:["msgId"],unique:!1},quoteExternalId:{columns:["quoteExternalId"],unique:!1},revokedExternalId:{columns:["revokedExternalId"],unique:!1},thread:{columns:["thread"],unique:!1},threadJid:{columns:["threadJid"],unique:!1},unsendMsgContentDeleteTs:{columns:["unsendMsgContentDeleteTs"],unique:!1}},name:"e2ee_messages",primaryKey:["rowId"]}],P=[{autoIncrement:!0,indexes:{},name:"e2ee_jobs",primaryKey:[],removed:!0}],Q=[{autoIncrement:!0,indexes:{},name:"e2ee_danglingQueue",primaryKey:["queueId"]}],R=[{autoIncrement:!0,indexes:{dbVersion:{columns:["dbVersion"],unique:!1}},name:"e2ee_staleQueue",primaryKey:["staleQueueId"]}],S=[{autoIncrement:!0,indexes:{"[offlineThreadingId+backupActionType]":{columns:["offlineThreadingId","backupActionType"],unique:!1},"[uploadStatus+uploadTsSec]":{columns:["uploadStatus","uploadTsSec"],unique:!1},backupActionType:{columns:["backupActionType"],unique:!1},msgIdKey:{columns:["msgIdKey"],unique:!1},offlineThreadingId:{columns:["offlineThreadingId"],unique:!1},uploadStatus:{columns:["uploadStatus"],unique:!1},uploadTsSec:{columns:["uploadTsSec"],unique:!1}},name:"e2ee_ebUploadQueue",primaryKey:["queueId"]}],T=[{autoIncrement:!1,indexes:{},name:"e2ee_ftsBackloggedMessages",primaryKey:["rowId"]},{autoIncrement:!1,indexes:{},name:"e2ee_ftsEncryptionMeta",primaryKey:["key"]},{autoIncrement:!0,indexes:{"*prefixes":{columns:["prefixes"],multiEntry_DO_NOT_USE:!0,unique:!1},chatId:{columns:["chatId"],unique:!1},id:{columns:["id"],unique:!1}},name:"e2ee_ftsIndexV3",primaryKey:["ftsRowId"]}],U=[{autoIncrement:!1,indexes:{"[threadJid+userJid]":{columns:["threadJid","userJid"],unique:!1},threadId:{columns:["threadId"],unique:!1},userJid:{columns:["userJid"],unique:!1}},name:"e2ee_participants",primaryKey:["id"]}],V=[{autoIncrement:!0,indexes:{},name:"e2ee_pendingMessageStanzaQueue",primaryKey:["pendingMessageStanzaQueueId"]}],W=[{autoIncrement:!0,indexes:{author:{columns:["author"],unique:!1},chat:{columns:["chat"],unique:!1},externalId:{columns:["externalId"],unique:!1}},name:"e2ee_deletedMessages",primaryKey:["rowId"]}],X=[{autoIncrement:!0,indexes:{threadJid:{columns:["threadJid"],unique:!1}},name:"e2ee_ebMsgRanges",primaryKey:["rangeId"]}],Y=[{autoIncrement:!1,indexes:{inviterJid:{columns:["inviterJid"],unique:!1},threadJid:{columns:["threadJid","inviteeJid"],unique:!1}},name:"e2ee_groupInvites",primaryKey:["invitedParticipantId","inviterJid"]}],Z=[{autoIncrement:!1,indexes:{waMsgId:{columns:["waMsgId"]}},name:"e2ee_receipts",primaryKey:["msgId"]}],$=[{autoIncrement:!0,indexes:{"[jid+priority]":{columns:["jid","priority"],unique:!1},"[jid+type]":{columns:["jid","type"],unique:!1},jid:{columns:["jid"],unique:!1},priority:{columns:["priority"],unique:!1},stanzaId:{columns:["stanzaId"],unique:!1},type:{columns:["type"],unique:!1}},name:"e2ee_stanzaQueue",primaryKey:["stanzaQueueId"]}],aa=[{autoIncrement:!0,indexes:{"[thread+serverTs]":{columns:["thread","serverTs"],unique:!1},"[thread+sortOrderMs]":{columns:["thread","sortOrderMs"],unique:!1},altIndex:{columns:["altIndex"],unique:!1},externalId:{columns:["externalId"],unique:!1},messageDeleteTs:{columns:["messageDeleteTs"],unique:!1},messageExpirationTs:{columns:["messageExpirationTs"],unique:!1},msgId:{columns:["msgId"],unique:!1},quoteExternalId:{columns:["quoteExternalId"],unique:!1},revokedExternalId:{columns:["revokedExternalId"],unique:!1},threadJid:{columns:["threadJid"],unique:!1},unsendMsgContentDeleteTs:{columns:["unsendMsgContentDeleteTs"],unique:!1}},name:"e2ee_messages",primaryKey:["rowId"]}],ba=[{autoIncrement:!0,indexes:{"[thread+serverTs]":{columns:["thread","serverTs"],predicate:function(a){return a.serverTs!=null},unique:!1},"[thread+sortOrderMs]":{columns:["thread","sortOrderMs"],unique:!1},"[threadJid+sortOrderMs]":{columns:["threadJid","sortOrderMs"],unique:!1},altIndex:{columns:["altIndex"],predicate:function(a){return a.altIndex!=null},unique:!1},externalId:{columns:["externalId"],unique:!1},messageDeleteTs:{columns:["messageDeleteTs"],predicate:function(a){return a.messageDeleteTs!=null},unique:!1},messageExpirationTs:{columns:["messageExpirationTs"],predicate:function(a){return a.messageExpirationTs!=null},unique:!1},msgId:{columns:["msgId"],unique:!1},quoteExternalId:{columns:["quoteExternalId"],predicate:function(a){return a.quoteExternalId!=null},unique:!1},revokedExternalId:{columns:["revokedExternalId"],predicate:function(a){return a.revokedExternalId!=null},unique:!1},threadJid:{columns:["threadJid"],unique:!1},unsendMsgContentDeleteTs:{columns:["unsendMsgContentDeleteTs"],predicate:function(a){return a.unsendMsgContentDeleteTs!=null},unique:!1}},name:"e2ee_messages",primaryKey:["rowId"]}],ca=[{autoIncrement:!1,dexieOnly_primaryKeyUnique:!0,indexes:{ts:{columns:["ts"],unique:!1}},name:"e2ee_sentBytesCache",primaryKey:["waMsgId"]}],da=[{autoIncrement:!0,indexes:{"[thread+serverTs]":{columns:["thread","serverTs"],predicate:function(a){return a.serverTs!=null},unique:!1},"[threadJid+sortOrderMs]":{columns:["threadJid","sortOrderMs"],unique:!1},altIndex:{columns:["altIndex"],predicate:function(a){return a.altIndex!=null},unique:!1},externalId:{columns:["externalId"],unique:!1},messageDeleteTs:{columns:["messageDeleteTs"],predicate:function(a){return a.messageDeleteTs!=null},unique:!1},messageExpirationTs:{columns:["messageExpirationTs"],predicate:function(a){return a.messageExpirationTs!=null},unique:!1},msgId:{columns:["msgId"],unique:!1},quoteExternalId:{columns:["quoteExternalId"],predicate:function(a){return a.quoteExternalId!=null},unique:!1},revokedExternalId:{columns:["revokedExternalId"],predicate:function(a){return a.revokedExternalId!=null},unique:!1},threadJid:{columns:["threadJid"],unique:!1},unsendMsgContentDeleteTs:{columns:["unsendMsgContentDeleteTs"],predicate:function(a){return a.unsendMsgContentDeleteTs!=null},unique:!1}},name:"e2ee_messages",primaryKey:["rowId"]}],ea=[{autoIncrement:!0,indexes:{"[originalMsgExternalId+threadJid]":{columns:["originalMsgExternalId","threadJid"],unique:!1}},name:"e2ee_editMsgHistory",primaryKey:["editMsgHistoryId"]}],fa=[{autoIncrement:!0,indexes:{deviceJid:{columns:["deviceJid"],unique:!1},displayOrder:{columns:["isArchived","ts"],unique:!1},isConfirmedActionTs:{columns:["isConfirmed","action","ts"],unique:!1},isNotifiedTs:{columns:["isNotified","ts"],unique:!1}},name:"e2ee_deviceChangeAlerts",primaryKey:["deviceChangeAlertsId"]},{autoIncrement:!1,indexes:{threadId:{columns:["threadId"],unique:!1}},name:"e2ee_groupInfo",primaryKey:["groupJid"]}],ga=[{autoIncrement:!0,indexes:{"[uploadStatus+uploadTsSec]":{columns:["uploadStatus","uploadTsSec"],unique:!1},backupActionType:{columns:["backupActionType"],unique:!1},msgIdKey:{columns:["msgIdKey"],unique:!1},uploadStatus:{columns:["uploadStatus"],unique:!1},uploadTsSec:{columns:["uploadTsSec"],unique:!1}},name:"e2ee_ebUploadQueue",primaryKey:["queueId"]}],ha=[{autoIncrement:!1,indexes:{},name:"e2ee_ephemeralSettings",primaryKey:["userJid"]}],ia=[{autoIncrement:!1,indexes:{ebClientRequired:{columns:["ebClientRequired","timestampMs"],unique:!1},restorable:{columns:["restorable","timestampMs"],unique:!1}},name:"e2ee_ebMessageRestoreTasks",primaryKey:["messageId"]}],ja=[{autoIncrement:!1,indexes:{},name:"e2ee_igMessageAuxiliaryInfo",primaryKey:["messageId"]}],ka=[{autoIncrement:!1,indexes:{plaintextHash:{columns:["plaintextHash"],unique:!1}},name:"e2ee_mediaKeys",primaryKey:["ciphertextHash"]}],la=[{autoIncrement:!0,indexes:{"[jid+priority]":{columns:["jid","priority"],unique:!1},jid:{columns:["jid"],unique:!1},priority:{columns:["priority"],unique:!1}},name:"e2ee_stanzaQueue",primaryKey:["stanzaQueueId"]}],ma=[{autoIncrement:!1,indexes:{"[threadJid+userJid]":{columns:["threadJid","userJid"],unique:!1},userJid:{columns:["userJid"],unique:!1}},name:"e2ee_participants",primaryKey:["id"]}],na=[{autoIncrement:!1,indexes:{},name:"e2ee_groupInfo",primaryKey:["groupJid"]}],oa=[{autoIncrement:!0,indexes:{},name:"e2ee_ebRestoreQueue",primaryKey:["queueId"]}],pa=[{autoIncrement:!1,indexes:{},name:"e2ee_ftsPurgeBacklog",primaryKey:["externalId"]},{autoIncrement:!1,indexes:{},name:"e2ee_ftsPurgeThreadBacklog",primaryKey:["chatJid"]}],qa=[{autoIncrement:!0,indexes:{"[threadJid+sortOrderMs]":{columns:["threadJid","sortOrderMs"],unique:!1},altIndex:{columns:["altIndex"],predicate:function(a){return a.altIndex!=null},unique:!1},externalId:{columns:["externalId"],unique:!1},messageDeleteTs:{columns:["messageDeleteTs"],predicate:function(a){return a.messageDeleteTs!=null},unique:!1},messageExpirationTs:{columns:["messageExpirationTs"],predicate:function(a){return a.messageExpirationTs!=null},unique:!1},msgId:{columns:["msgId"],unique:!1},quoteExternalId:{columns:["quoteExternalId"],predicate:function(a){return a.quoteExternalId!=null},unique:!1},revokedExternalId:{columns:["revokedExternalId"],predicate:function(a){return a.revokedExternalId!=null},unique:!1},threadJid:{columns:["threadJid"],unique:!1},unsendMsgContentDeleteTs:{columns:["unsendMsgContentDeleteTs"],predicate:function(a){return a.unsendMsgContentDeleteTs!=null},unique:!1}},name:"e2ee_messages",primaryKey:["rowId"]}],ra=[{autoIncrement:!0,indexes:{"*prefixes":{columns:["prefixes"],multiEntry_DO_NOT_USE:!0,unique:!1},chatId:{columns:["chatId"],unique:!1},id:{columns:["id"],unique:!1}},name:"e2ee_ftsIndexV3",primaryKey:["ftsRowId"],removed:!0}],sa=[{autoIncrement:!0,indexes:{fbid:{columns:["fbid"],unique:!1},hashedPlaintextHash:{columns:["hashedPlaintextHash"]},objectId:{columns:["objectId"],unique:!1}},name:"e2ee_media",primaryKey:["mediaId"]}],ta=[{autoIncrement:!1,indexes:{},name:"e2ee_retroactiveBackupsState",primaryKey:["threadId"],removed:!0}],ua=[{autoIncrement:!1,indexes:{},name:"e2ee_uploadRetryStatus",primaryKey:[],removed:!0}],va=[{autoIncrement:!1,indexes:{},name:"e2ee_receiverFetchInfo",primaryKey:["receiverFetchId"]}],wa=[{autoIncrement:!0,indexes:{"[threadJid+ts]":{columns:["threadJid","ts"],unique:!1},externalId:{columns:["externalId"],unique:!1},reactionId:{columns:["reactionId"],unique:!1},reactToExternalId:{columns:["reactToExternalId"],unique:!1},reactToMsgId:{columns:["reactToMsgId"],unique:!1},threadJid:{columns:["threadJid"],unique:!1},ts:{columns:["ts"],unique:!1}},name:"e2ee_reactions",primaryKey:["rowId"]}],xa=[{autoIncrement:!0,indexes:{"*msgIds":{columns:["msgIds"],multiEntry_DO_NOT_USE:!0},fbid:{columns:["fbid"],unique:!1},hashedPlaintextHash:{columns:["hashedPlaintextHash"]},objectId:{columns:["objectId"],unique:!1}},name:"e2ee_media",primaryKey:["mediaId"]}];a=new Map([[(d=d("MAWDbVersionList")).VERSION.V21,a],[d.VERSION.V22,b],[d.VERSION.V23,c],[d.VERSION.V24,e],[d.VERSION.V25,f],[d.VERSION.V30,h],[d.VERSION.V31,i],[d.VERSION.V32,j],[d.VERSION.V33,k],[d.VERSION.V34,l],[d.VERSION.V35,m],[d.VERSION.V36,n],[d.VERSION.V37,o],[d.VERSION.V38,p],[d.VERSION.V39,q],[d.VERSION.V40,r],[d.VERSION.V41,s],[d.VERSION.V42,t],[d.VERSION.V45,u],[d.VERSION.V48,v],[d.VERSION.V49,w],[d.VERSION.V50,x],[d.VERSION.V51,y],[d.VERSION.V52,z],[d.VERSION.V57,A],[d.VERSION.V59,B],[d.VERSION.V61,C],[d.VERSION.V62,D],[d.VERSION.V63,E],[d.VERSION.V64,F],[d.VERSION.V65,G],[d.VERSION.V67,H],[d.VERSION.V69,I],[d.VERSION.V70,J],[d.VERSION.V73,K],[d.VERSION.V74,L],[d.VERSION.V75,M],[d.VERSION.V77,N],[d.VERSION.V78,O],[d.VERSION.V79,P],[d.VERSION.V80,Q],[d.VERSION.V81,R],[d.VERSION.V83,S],[d.VERSION.V84,T],[d.VERSION.V85,U],[d.VERSION.V86,V],[d.VERSION.V88,W],[d.VERSION.V89,X],[d.VERSION.V90,Y],[d.VERSION.V91,Z],[d.VERSION.V92,$],[d.VERSION.V93,aa],[d.VERSION.V94,ba],[d.VERSION.V95,ca],[d.VERSION.V96,da],[d.VERSION.V97,ea],[d.VERSION.V98,fa],[d.VERSION.V99,ga],[d.VERSION.V100,ha],[d.VERSION.V102,ia],[d.VERSION.V103,ja],[d.VERSION.V104,ka],[d.VERSION.V105,la],[d.VERSION.V106,ma],[d.VERSION.V107,na],[d.VERSION.V108,oa],[d.VERSION.V109,pa],[d.VERSION.V110,qa],[d.VERSION.V111,ra],[d.VERSION.V112,sa],[d.VERSION.V113,ta],[d.VERSION.V114,ua],[d.VERSION.V115,va],[d.VERSION.V116,wa],[d.VERSION.V117,xa]]);b=["messages","unrenderedMessages","groupInfo","meta","identity","prekey","prekeyGeneration","session","signedPrekey","senderKeySessions","receipts","pendingReceipts","threads","contacts","participants","tasks","personalSenderKeyStatuses","appData","appMeta","chunk","mediaBackup","media","reactions","groupInvites","dyiBatch","syncActions","missingKeys","pendingMutations","collectionVersions","syncKeys","deviceChangeAlerts","xma","editMsgHistory","deletedMessages","ebMsgRanges"];g.dbSchema=a;g.TABLES_TO_ENCRYPT=b}),98);
__d("MAWGetDbVersion",["MAWDbVersionList","justknobx","objectValues"],(function(a,b,c,d,e,f,g){"use strict";var h=null;function a(){var a;return(a=h)!=null?a:d("MAWDbVersionList").toVersion(c("justknobx")._("1716"))}function b(a){if(!c("justknobx")._("1495"))return;if(a==null){h=null;return h}if(a==="current"){h=null;return h}var b=Math.max.apply(Math,c("objectValues")(d("MAWDbVersionList").VERSION));if(a==="latest"){h=d("MAWDbVersionList").toVersion(b);return h}if(!Number.isInteger(a))return h;if(a<0){h=d("MAWDbVersionList").toVersion(b+a);return h}h=d("MAWDbVersionList").toVersion(a)}g.getArmadilloDbVersion=a;g.setArmadilloDbVersionForTest=b}),98);
__d("sortBy",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){a=a.map(function(a,c){return{index:c,sortValue:b(a),value:a}});a.sort(function(a,b){var c=a.sortValue,d=b.sortValue;if(c>d)return 1;return c<d?-1:a.index-b.index});return a.map(function(a){return a.value})}f["default"]=a}),66);
__d("MAWDbSchema.restore",["MAWDbSchema","MAWGetDbVersion","objectEntries","sortBy"],(function(a,b,c,d,e,f,g){"use strict";a={e2ee_appData:!0,e2ee_appMeta:!0,e2ee_chunk:!0,e2ee_collectionVersions:!0,e2ee_deletedMessages:!0,e2ee_deviceChangeAlerts:!0,e2ee_dyiBatch:!0,e2ee_ebMessageRestoreTasks:!0,e2ee_ebMsgRanges:!0,e2ee_ebRestoreQueue:!0,e2ee_ebUploadQueue:!0,e2ee_editMsgHistory:!0,e2ee_ephemeralSettings:!0,e2ee_existingUsers:!0,e2ee_ftsBackloggedMessages:!0,e2ee_ftsEncryptionMeta:!0,e2ee_ftsIndexV3:!0,e2ee_ftsPurgeBacklog:!0,e2ee_ftsPurgeThreadBacklog:!0,e2ee_groupInfo:!0,e2ee_groupInvites:!0,e2ee_historySyncQRCodeData:!0,e2ee_historySyncQRCodeSecretKey:!0,e2ee_igMessageAuxiliaryInfo:!0,e2ee_isDualSend:!0,e2ee_media:!0,e2ee_mediaBackup:!0,e2ee_messages:!0,e2ee_missingKeys:!0,e2ee_participants:!0,e2ee_pendingMessageStanzaQueue:!0,e2ee_pendingMutations:!0,e2ee_pendingReceipts:!0,e2ee_pendingStanzas:!0,e2ee_reactions:!0,e2ee_receiverFetchInfo:!0,e2ee_syncActions:!0,e2ee_syncKeys:!0,e2ee_threads:!0,e2ee_unrenderedMessages:!0,e2ee_xma:!0};function h(a){var b=Object.fromEntries(c("objectEntries")(a.indexes).filter(function(a){a=a[1];return a.multiEntry_DO_NOT_USE!==!0}).map(function(b){var c=b[0];b=b[1];return[c,{columns:[].concat(b.columns,b.unique!==!1?[]:a.primaryKey),predicate:b.predicate}]}));b={auto_increment:a.autoIncrement===!0,indexes:b,name:a.name,primary_key:a.primaryKey};return b}var i=c("sortBy")(Array.from(d("MAWDbSchema").dbSchema.entries()),function(a){a=a[0];return a}).map(function(a){var b=a[0];a=a[1];return{schema:a,version:b}});b=function(a){return Array.from(i.filter(function(b){return b.version<=a&&b.schema!=null}).reduce(function(a,b){(b=b.schema)==null?void 0:b.forEach(function(b){if(b.removed===!0){a["delete"](b.name);return}a.set(b.name,h(b))});return a},new Map()).values())};e=b(d("MAWGetDbVersion").getArmadilloDbVersion());g.msgrDbStores=a;g.getSchemaForVersion=b;g.clientSchema=e}),98);
__d("LSDbSchema",["MAWDbSchema.restore"],(function(a,b,c,d,e,f){"use strict";a=importNamespace("MAWDbSchema.restore").clientSchema;f.clientSchema=a}),66);
__d("LSSchemaProvider",["cr:2649","cr:2670"],(function(a,b,c,d,e,f,g){"use strict";var f=(a=b("cr:2670"))!=null?a:b("cr:2649");c=f.schemaProvider;g["default"]=c}),98);
__d("ReStoreDefaultValuesMetadata",["FBLogger"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b={c:"string",t:"string"};for(var d in b){if(!Object.prototype.hasOwnProperty.call(a,d)||a[d]==null){c("FBLogger")("messenger_web_product").warn('Malformed default values data, missing key "%s"',d);return null}var e=a[d],f=b[d];e=typeof e;if(e!==f){c("FBLogger")("messenger_web_product").warn('Malformed default values data, key "%s" has type "%s" but expected "%s"',d,e,f);return null}}if(typeof a.c!=="string"||typeof a.t!=="string")return null;e=[];f=a.t;try{e=JSON.parse(a.c);for(d=0;d<e.length;d++){b=e[d];if(typeof b!=="string")return null}}catch(a){return null}return{columns:e,tableName:f}}function b(a){return{c:JSON.stringify(a.columns),t:a.tableName}}d="_db_defaults_meta";g.tryParseDefaultValuesData=a;g.defaultValuesColumnToValue=b;g.defaultValuesTableName=d}),98);
__d("ReStoreKeyComparer",["I64"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a){if((h||(h=d("I64"))).isI64(a))return"I64";else if(Array.isArray(a))return"Array";else if(typeof a==="string")return"String";else if(typeof a==="number")return"Number";else if(typeof a==="boolean")return"Boolean";else if(a instanceof Date)return"Date";else if(typeof a==="object"&&a!=null)return"Object";else if(a==="undefined")return"Undefined";else if(a===null)return"Null";return"Unknown"}var j=function(b){babelHelpers.inheritsLoose(a,b);function a(a,c){a="Expected types to be the same but got "+i(a)+" and "+i(c);return b.call(this,a)||this}return a}(babelHelpers.wrapNativeSuper(Error)),k=function(b){babelHelpers.inheritsLoose(a,b);function a(a){a="Unexpected type "+i(a);return b.call(this,a)||this}return a}(babelHelpers.wrapNativeSuper(Error)),l=[[]];function m(a,b){var c=a===l,d=b===l;if(c&&d)return 0;if(c)return 1;if(d)return-1;if(a===null)return b===null?0:-1;else if(b===null)return 1;if(a===void 0)return b===void 0?0:-1;else if(b===void 0)return 1;if(Array.isArray(a)){if(!Array.isArray(b)){if(typeof b==="string")return 1;throw new j(a,b)}c=a[0];d=b[0];if(c<d)return-1;if(c>d)return 1;c=a[1];d=b[1];if(c<d)return-1;if(c>d)return 1}else if(typeof a==="string"){if(typeof b!=="string"){if(typeof b==="number"||b instanceof Date)return 1;if(Array.isArray(b))return-1;throw new j(a,b)}if(a<b)return-1;if(a>b)return 1}else if(typeof a==="number"){if(typeof b!=="number"){if(typeof b==="string")return-1;throw new j(a,b)}if(a<b)return-1;if(a>b)return 1}else if(a instanceof Date){if(!(b instanceof Date)){if(typeof b==="string")return-1;throw new j(a,b)}if(a<b)return-1;if(a>b)return 1}else if(typeof a==="boolean"){if(typeof b!=="boolean")throw new j(a,b);if(!a&&b)return-1;if(a&&!b)return 1}else throw new k(a);return 0}function n(a,b){var c;for(c=0;c<a.length&&c<b.length;c++){var d=m(a[c],b[c]);if(d!==0)return d}if(c<a.length)return 1;return c<b.length?-1:0}a=function(a,b){return n(b,a)};g.MAX_KEY=l;g.compareValue=m;g.compareKey=n;g.compareKeyDesc=a}),98);
__d("ReQLBounds",["ReStoreKeyComparer"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,b,c){return b.length<a?[].concat(b,[c]):b}function j(a,b){b===void 0&&(b=-1);return i(b,a,(h||(h=d("ReStoreKeyComparer"))).MAX_KEY)}function k(a,b,c){if(a!=null&&b!=null)return(h||(h=d("ReStoreKeyComparer"))).compareKey(a[1],b[1])*c>0?a[0]:b[0];if(a!=null)return a[0];if(b!=null)return b[0]}function l(a,b){return k((a==null?void 0:a.gt)!=null?[{gt:a.gt},j(a.gt)]:(a==null?void 0:a.gte)!=null?[{gte:a.gte},a.gte]:void 0,(b==null?void 0:b.gt)!=null?[{gt:b.gt},j(b.gt)]:(b==null?void 0:b.gte)!=null?[{gte:b.gte},b.gte]:void 0,1)}function m(a,b){return k((a==null?void 0:a.lt)!=null?[{lt:a.lt},a.lt]:(a==null?void 0:a.lte)!=null?[{lte:a.lte},j(a.lte)]:void 0,(b==null?void 0:b.lt)!=null?[{lt:b.lt},b.lt]:(b==null?void 0:b.lte)!=null?[{lte:b.lte},j(b.lte)]:void 0,-1)}function a(a,b){if(a==null)return void 0;a=babelHelpers.extends({},a);a.gt!=null&&(a.gt=i(b,a.gt,(h||(h=d("ReStoreKeyComparer"))).MAX_KEY));a.lte!=null&&(a.lte=i(b,a.lte,(h||(h=d("ReStoreKeyComparer"))).MAX_KEY));return a}function b(a,b,c){a.forEach(function(a){var e=a[0];a=a[1];var f=(e==null?void 0:e.gt)!=null?(h||(h=d("ReStoreKeyComparer"))).compareKey(b,e.gt)>0:(e==null?void 0:e.gte)!=null?(h||(h=d("ReStoreKeyComparer"))).compareKey(b,e.gte)>=0:!0;e=(e==null?void 0:e.lt)!=null?(h||(h=d("ReStoreKeyComparer"))).compareKey(b,e.lt)<0:(e==null?void 0:e.lte)!=null?(h||(h=d("ReStoreKeyComparer"))).compareKey(b,e.lte)<=0:!0;if(f&&e)return c(a)})}function c(a,b){if(b==null)return a;var c=l(b,a);b=m(b,a);if(c!=null&&b!=null)return babelHelpers.extends({},c,b);if(c!=null)return c;if(b!=null)return b}g.nextKey=j;g.getLowerLimit=l;g.getUpperLimit=m;g.extendBounds=a;g.forEachMatchingBounds=b;g.mergeBounds=c}),98);
__d("ReStoreOperationLock",["isPromise","unrecoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";var h;b=function(){function a(a){var b=this;this.waitFor=null;this.waitFor=a.then(function(a){return b.waitFor=null})}var b=a.prototype;b.chainPromiseOrValue=function(a){if(this.waitFor!=null)return this.waitFor.then(function(){return a("\ud83d\udd12")});else return a("\ud83d\udd12")};return a}();d=function(){function a(){this.$1=Promise.resolve()}var b=a.prototype;b.chainPromiseOrValue=function(a){var b=this;return new Promise(function(c,d){b.$1=b.$1.then(async function(){try{c(await a("\ud83d\udd12"))}catch(a){d(a)}})})};return a}();function i(a,b){function d(b){if(b.done)return b.value;if(!(h||(h=c("isPromise")))(b.value))throw c("unrecoverableViolation")("expected promise","messenger_web_product");return b.value.then(function(b){return d(a.next(b))})}return d(a.next(b))}function a(a,b){return{next:function(c){return b.chainPromiseOrValue(function(b){return i(a.next(b,c))})}}}g.WaitForPromiseLock=b;g.ReStoreOperationLock=d;g.lockIterator=a}),98);
__d("ReStoreIndex",["ReQLBounds","ReStoreOperationLock","ReStoreUtils"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(){function a(a,b,c,e,f){var g=this;this.entries=function(a,b,c){b===void 0&&(b="asc");return d("ReStoreOperationLock").lockIterator(d("ReStoreUtils").entries(g.$5,a,g.$1,g.$3,b,c,g.$2),g.$4)};this.get=function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return g.$4.chainPromiseOrValue(function(a){return d("ReStoreUtils").getLocked(g.$5,new WeakMap(),g.$1.name,g.$3,b,a,g.$2)})};this.getKey=function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return g.$4.chainPromiseOrValue(function(a){return g.$6(g.$5,new WeakMap(),b,a)})};this.keys=function(a,b,c){b===void 0&&(b="asc");return d("ReStoreOperationLock").lockIterator(d("ReStoreUtils").keys(g.$5,a,g.$1,g.$3,b,c),g.$4)};this.$3=a;this.keyFields=b.indexes[a];this.$1=b;this.$2=c;this.$4=e;this.$5=f}var b=a.prototype;b.$6=async function(a,b,c,e){a=await d("ReStoreUtils").getLocked(a,b,this.$1.name,this.$3,c,e,this.$2);return a===void 0?void 0:d("ReStoreUtils").searchKey(this.$1,a)};return a}();b=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}return b}(a);c=function(a){babelHelpers.inheritsLoose(b,a);function b(b,c,e,f,g,i){var j;j=a.call(this,b,c,e,f,g)||this;j.subscribe=function(a,b,c){return j.$ReStoreIndex$p_3.subscribeIndex(j.$ReStoreIndex$p_1.name,j.$ReStoreIndex$p_2,a,(h||(h=d("ReQLBounds"))).extendBounds(b,j.$ReStoreIndex$p_1.indexes[j.$ReStoreIndex$p_2].length),c)};j.$ReStoreIndex$p_2=b;j.$ReStoreIndex$p_1=c;j.$ReStoreIndex$p_3=i;return j}return b}(a);g.ReStoreTransactionIndex=b;g.ReStoreIndex=c}),98);
__d("PromiseOrValue",["isPromise","unrecoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){if((h||(h=c("isPromise")))(a)&&(h||(h=c("isPromise")))(b))return a.then(function(a){return b.then(function(b){return[a,b]})});if((h||(h=c("isPromise")))(a))return a.then(function(a){return[a,b]});return(h||(h=c("isPromise")))(b)?b.then(function(b){return[a,b]}):[a,b]}function b(a){var b=a.find(h||(h=c("isPromise")));return!b?a:Promise.all(a)}function d(a,b){return(h||(h=c("isPromise")))(a)?a.then(b):b(a)}function i(a,b){b=b;while(!0){var d=a(b);if((h||(h=c("isPromise")))(d))return d.then(function(b){return b.action==="break"?b.value:i(a,b.value)});if(d.action==="break")return d.value;b=d.value}throw c("unrecoverableViolation")("just for flow","messenger_web_product")}g.all2=a;g.all=b;g.map=d;g.loop=i}),98);
__d("ReStoreTable",["I64","PromiseOrValue","ReQLBounds","ReStoreIndex","ReStoreOperationLock","ReStoreUtils","unrecoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function k(a){a=(h||(h=d("I64"))).cast(a);if(a===void 0)throw c("unrecoverableViolation")("Expected int64","messenger_web_product");return h.to_float(a)}function l(a,b,c,d,e){b=JSON.stringify([b,c]);c=a.get(b);a.set(b,[c==null?d:c[0],e])}a=function(a,b,e,f){var g=this;this.entries=function(a,b,c){b===void 0&&(b="asc");return d("ReStoreOperationLock").lockIterator(d("ReStoreUtils").entries(g.$4,a,g.$1,void 0,b,c,g.$2),g.$3)};this.get=function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return g.$3.chainPromiseOrValue(function(a){return d("ReStoreUtils").getLocked(g.$4,new WeakMap(),g.$1.name,void 0,b,a,g.$2)})};this.keys=function(a,b,c){b===void 0&&(b="asc");return d("ReStoreOperationLock").lockIterator(d("ReStoreUtils").keys(g.$4,a,g.$1,void 0,b,c),g.$3)};this.peekNextAutoIncrementId=function(){return Promise.resolve(g.$3.chainPromiseOrValue(async function(a){a=g.$1.autoIncrement;if(!a)throw c("unrecoverableViolation")("only supported for auto-incrementing tables","maw_db");a=await d("ReStoreUtils").gen(g.$4.table(g.$1.name).readSeed(new WeakMap()));if(a===void 0)throw c("unrecoverableViolation")("unexpected undefined autoIncrementSeed","maw_db");return(h||(h=d("I64"))).of_float(a)}))};this.keyFields=a.primaryKeyIds;this.$1=a;this.$2=b;this.$3=e;this.$4=f};b=function(a){babelHelpers.inheritsLoose(b,a);function b(b,c,e,f,g,h,j,k,l,m){var n;b=c.tableNames[b];n=a.call(this,b,e,f,g)||this;n.$ReStoreTransactionTable$p_1=new Map();n.$ReStoreTransactionTable$p_10=new Map();n.add=function(a){return Promise.resolve((i||(i=d("PromiseOrValue"))).map(i.map(n.$ReStoreTransactionTable$p_4.beforeAdd({tableName:n.$ReStoreTransactionTable$p_3.name,transaction:n.$ReStoreTransactionTable$p_8,value:a}),function(a){return n.$ReStoreTransactionTable$p_12(function(b,c){var e;(e=n.$ReStoreTransactionTable$p_9)==null?void 0:e.recordLogicalWrite();return d("ReStoreUtils").gen(n.$ReStoreTransactionTable$p_13(n.$ReStoreTransactionTable$p_10,c,new WeakMap(),n.$ReStoreTransactionTable$p_3.name,a,b))})}),function(b){return(i||(i=d("PromiseOrValue"))).map(n.$ReStoreTransactionTable$p_4.afterAdd({key:b,tableName:n.$ReStoreTransactionTable$p_3.name,transaction:n.$ReStoreTransactionTable$p_8,value:a}),function(){return b})}))};n.delete=function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return Promise.resolve((i||(i=d("PromiseOrValue"))).map(n.$ReStoreTransactionTable$p_4.beforeDelete({key:b,tableName:n.$ReStoreTransactionTable$p_3.name,transaction:n.$ReStoreTransactionTable$p_8}),function(a){return n.$ReStoreTransactionTable$p_12(function(b,c){var e=babelHelpers.assertThisInitialized(n);return d("ReStoreUtils").gen(function*(){var f;(f=e.$ReStoreTransactionTable$p_9)==null?void 0:f.recordLogicalWrite();yield* d("ReStoreUtils").deleteItemLocked(e.$ReStoreTransactionTable$p_2,e.$ReStoreTransactionTable$p_10,c,new WeakMap(),e.$ReStoreTransactionTable$p_3.name,a,b);yield* d("ReStoreUtils").cascadeKeyUpdatesLocked(e.$ReStoreTransactionTable$p_2,e.$ReStoreTransactionTable$p_10,c,new WeakMap(),e.$ReStoreTransactionTable$p_3.name,a,void 0,e.$ReStoreTransactionTable$p_4,b,e.$ReStoreTransactionTable$p_11)}())})}))};n.put=function(a){return Promise.resolve((i||(i=d("PromiseOrValue"))).map(i.map(n.$ReStoreTransactionTable$p_4.beforePut({tableName:n.$ReStoreTransactionTable$p_3.name,transaction:n.$ReStoreTransactionTable$p_8,value:a}),function(a){return n.$ReStoreTransactionTable$p_12(function(b,c){var e;(e=n.$ReStoreTransactionTable$p_9)==null?void 0:e.recordLogicalWrite();return d("ReStoreUtils").gen(d("ReStoreUtils").putLocked(n.$ReStoreTransactionTable$p_2,n.$ReStoreTransactionTable$p_10,c,new WeakMap(),n.$ReStoreTransactionTable$p_3.name,a,n.$ReStoreTransactionTable$p_4,b,n.$ReStoreTransactionTable$p_11))})}),function(b){return(i||(i=d("PromiseOrValue"))).map(n.$ReStoreTransactionTable$p_4.afterPut({key:b,tableName:n.$ReStoreTransactionTable$p_3.name,transaction:n.$ReStoreTransactionTable$p_8,value:a}),function(){return b})}))};n.upsert=function(a,b){return Promise.resolve((i||(i=d("PromiseOrValue"))).map(n.$ReStoreTransactionTable$p_4.beforeUpsert({tableName:n.$ReStoreTransactionTable$p_3.name,transaction:n.$ReStoreTransactionTable$p_8,value:b}),function(c){return n.$ReStoreTransactionTable$p_12(function(e,f){var g=babelHelpers.assertThisInitialized(n);return d("ReStoreUtils").gen(function*(){var h;(h=g.$ReStoreTransactionTable$p_9)==null?void 0:h.recordLogicalWrite();yield* d("ReStoreUtils").upsertLocked(g.$ReStoreTransactionTable$p_2,g.$ReStoreTransactionTable$p_10,f,new WeakMap(),g.$ReStoreTransactionTable$p_3.name,a,c,g.$ReStoreTransactionTable$p_4,e,g.$ReStoreTransactionTable$p_11);yield* d("ReStoreUtils").cascadeKeyUpdatesLocked(g.$ReStoreTransactionTable$p_2,g.$ReStoreTransactionTable$p_10,f,new WeakMap(),g.$ReStoreTransactionTable$p_3.name,a,d("ReStoreUtils").searchKey(g.$ReStoreTransactionTable$p_3,b),g.$ReStoreTransactionTable$p_4,e,g.$ReStoreTransactionTable$p_11)}())})}))};n.index=function(a){return d("ReStoreUtils").getOrCreate(n.$ReStoreTransactionTable$p_1,a,function(){return new(d("ReStoreIndex").ReStoreTransactionIndex)(a,n.$ReStoreTransactionTable$p_3,n.$ReStoreTransactionTable$p_4,n.$ReStoreTransactionTable$p_5,n.$ReStoreTransactionTable$p_6)})};n.$ReStoreTransactionTable$p_3=b;n.$ReStoreTransactionTable$p_2=c;n.$ReStoreTransactionTable$p_4=e;n.$ReStoreTransactionTable$p_5=f;n.$ReStoreTransactionTable$p_6=g;n.$ReStoreTransactionTable$p_7=h;n.$ReStoreTransactionTable$p_8=j;n.$ReStoreTransactionTable$p_9=k;n.$ReStoreTransactionTable$p_10=l;n.$ReStoreTransactionTable$p_11=m;return n}var c=b.prototype;c.$ReStoreTransactionTable$p_12=function(a){var b=this;return this.$ReStoreTransactionTable$p_5.chainPromiseOrValue(function(c){var e=b.$ReStoreTransactionTable$p_6.createNested(b.$ReStoreTransactionTable$p_9);return(i||(i=d("PromiseOrValue"))).map(a(c,e),function(a){e.flush();return a})})};c.$ReStoreTransactionTable$p_13=function*(a,b,c,e,f,g){var i=b.table(e),j=this.$ReStoreTransactionTable$p_2.tableNames[e];if(j.autoIncrement){var m=f[j.primaryKeyIds[0]];m=(h||(h=d("I64"))).of_float(yield* i.incrementSeed(c,m===void 0?m:k(m)));f[j.primaryKeyIds[0]]=m}m=d("ReStoreUtils").appendDefaultValues(f,j.name,this.$ReStoreTransactionTable$p_11);f=d("ReStoreUtils").searchKey(j,m);if(f==null)throw new Error("Evaluating the object store's key path did not yield a value");if((yield* i.tableGet(c,f))==null){j=d("ReStoreUtils").indicesWithKeyForValue(this.$ReStoreTransactionTable$p_3,Object.keys(j.indexes),m);yield* d("ReStoreUtils").deconflictIndicesLocked(this.$ReStoreTransactionTable$p_2,a,b,c,e,j,this.$ReStoreTransactionTable$p_4,g,this.$ReStoreTransactionTable$p_11);g=(yield* i.tableSet(c,f,m));i=g[0];yield* d("ReStoreUtils").addIdToIndices(b,c,e,i,j);l(a,e,f,void 0,m)}return f};return b}(a);e=function(a){babelHelpers.inheritsLoose(b,a);function b(b,c,e,f,g){var h;h=a.call(this,b,c,e,f)||this;h.$ReStoreTable$p_1=new Map();h.index=function(a){return d("ReStoreUtils").getOrCreate(h.$ReStoreTable$p_1,a,function(){return new(d("ReStoreIndex").ReStoreIndex)(a,h.$ReStoreTable$p_2,h.$ReStoreTable$p_3,h.$ReStoreTable$p_4,h.$ReStoreTable$p_5,h.$ReStoreTable$p_6)})};h.subscribe=function(a,b,c){return h.$ReStoreTable$p_6.subscribeTable(h.$ReStoreTable$p_2.name,a,(j||(j=d("ReQLBounds"))).extendBounds(b,h.$ReStoreTable$p_2.primaryKeyIds.length),c)};h.$ReStoreTable$p_2=b;h.$ReStoreTable$p_3=c;h.$ReStoreTable$p_4=e;h.$ReStoreTable$p_5=f;h.$ReStoreTable$p_6=g;return h}return b}(a);g.ReStoreTransactionTable=b;g.ReStoreTable=e}),98);
__d("LSStorage",["ReStoreKeyComparer"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){return(h||(h=d("ReStoreKeyComparer"))).compareKey(a,b)===0}g.areKeysEqual=a}),98);
__d("ReStoreUtils",["I64","LSStorage","Random","ReQLBounds","ReStoreKeyComparer","ReStoreOperationLock","ReStoreTable","isPromise","nullthrows","unrecoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l=500;async function a(a){var b=[],c=await a.next();while(!c.done)b.push(c.value),c=await a.next();return b}function m(a,b,d){var e=a.indexes;a=a.primaryKeyIds;a=d==null?a:e[d];return a.map(function(a){if(b[a]!==void 0||d!=null)return b[a];throw c("unrecoverableViolation")("primary key must be defined on object","maw_db")})}function n(a,b,c){var d=c[b];return!d?a:Object.keys(d).reduce(function(a,b){Object.prototype.hasOwnProperty.call(a,b)||(a[b]=d[b]);return a},babelHelpers.extends({},a))}function o(a,b,c,e,f,g,h){function i(){var j=a.table(c.name),l=babelHelpers.extends({},(k||(k=d("ReQLBounds"))).extendBounds(g,(e===void 0?c.primaryKeyIds:c.indexes[e]).length),{dir:f}),m=e==null?j.tableEntries(b,l):j.indexEntries(b,e,l);return j={next:function*(a,b){a=(yield* m.next(b));if(a.done)return{done:!0};b=a.value[1];return{done:!1,value:[a.value[0],h==null?b:h.afterEntriesNext({tableName:c.name,value:b})]}}},j[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]=i,j}return i()}function b(a,b,c,e,f,g){function h(){var i=a.table(c.name),j=i.keys(b,e,babelHelpers.extends({},(k||(k=d("ReQLBounds"))).extendBounds(g,(e===void 0?c.primaryKeyIds:c.indexes[e]).length),{dir:f}));return i={next:function*(a,b){return yield* j.next(b)}},i[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]=h,i}return h()}function p(a,b){function d(b){if(b.done)return b.value;if(!(h||(h=c("isPromise")))(b.value))throw c("unrecoverableViolation")("expected promise","messenger_web_product");return b.value.then(function(b){return d(a.next(b))})}return d(a.next(b))}async function e(a,b,c,d,e,f,g){f=a.table(c);d!=null?a=await p(f.indexGet(b,d,e)):a=await p(f.tableGet(b,e));return a===void 0?void 0:g.afterGet({tableName:c,value:a})}function q(a,b,c){return(a.has(b)?a:a.set(b,c())).get(b)}function r(a){a=(i||(i=d("I64"))).cast(a);if(a===void 0)throw c("unrecoverableViolation")("Expected int64","messenger_web_product");return i.to_float(a)}function s(a,b,c,d,e){b=JSON.stringify([b,c]);c=a.get(b);(c==null?d:c[0])==null&&e==null?a.delete(b):a.set(b,[c==null?d:c[0],e])}function* t(a,b,c,e,f,g,h,i,k,l){function n(a,b){return a.length>=b?a:[].concat(a,[(j||(j=d("ReStoreKeyComparer"))).MAX_KEY])}if(h!=null&&(j||(j=d("ReStoreKeyComparer"))).compareKey(g,h)===0)return;f=a.tableNames[f];var p=f.cascadeUpdates,q=f.primaryKeyIds;f=function*(d){var f=d.indexName;d=d.tableName;var j=a.tableNames[d],p=j.indexes,r=j.primaryKeyIds,s=f==null?r:p[f];r={gte:g,lte:n(g,s.length)};p=o(c,e,j,f,"asc",r);j=[];f=(yield* p.next(k));while(!f.done)j.push(f.value),f=(yield* p.next(k));for(r of j){r[0];p=r[1];f=m(a.tableNames[d],p);if(h===void 0)yield* w(a,b,c,e,d,f,k),yield* t(a,b,c,e,d,f,void 0,i,k,l);else{j=q.reduce(function(a,b,c){if(c>=h.length)return a;a[s[c]]=h[c];return a},babelHelpers.extends({},p));yield* v(a,b,c,e,d,f,j,i,k,l);yield* t(a,b,c,e,d,f,m(a.tableNames[d],j),i,k,l)}}};for(p of p)yield* f(p)}function* u(a,b,c,e,f,g,h,k,l){var o=c.table(f),p=a.tableNames[f];if(p.autoIncrement){var q=g[p.primaryKeyIds[0]];q=(i||(i=d("I64"))).of_float(yield* o.incrementSeed(e,q===void 0?q:r(q)));g[p.primaryKeyIds[0]]=q}q=m(p,g);var t={},u=(yield* o.tableGet(e,q)),v=g;u!==void 0?t=x(p,Object.keys(p.indexes),u):v=n(g,p.name,l);g=(yield* o.tableSet(e,q,v));var w=g[0];g=g[1];p=x(p,Object.keys(p.indexes),v);var A=babelHelpers.extends({},p);for(var B of Object.keys(A))t[B]!==void 0&&(j||(j=d("ReStoreKeyComparer"))).compareKey(t[B],A[B])===0&&(delete A[B],delete t[B]);yield* y(a,b,c,e,f,A,h,k,l);yield* z(c,e,f,w,g?p:A);for(B of Object.keys(t))yield* o.indexDelete(e,B,t[B]);s(b,f,q,u,v);return q}function* v(a,b,c,e,f,g,h,i,j,k){var l=m(a.tableNames[f],h);d("LSStorage").areKeysEqual(g,l)||(yield* w(a,b,c,e,f,g,j));yield* u(a,b,c,e,f,h,i,j,k)}function* w(a,b,c,d,e,f,g){g=c.table(e);c=a.tableNames[e];a=(yield* g.tableGet(d,f));if(a!==void 0){if(Object.keys(c.indexes).length)for(var h of Object.keys(c.indexes)){var i=m(c,a,h);i!=null&&(yield* g.indexDelete(d,h,i))}yield* g.tableDelete(d,f);s(b,e,f,a,void 0)}}function x(a,b,c){return b.reduce(function(b,d){var e;e=(e=a.indexPredicates)==null?void 0:e[d];if(e!=null&&!e(c))return b;e=m(a,c,d);b[d]=e;return b},{})}function* y(a,b,c,d,e,f,g,h,i){var j=c.table(e);for(var k of Object.keys(f)){var l=f[k];l=(yield* j.indexGet(d,k,l));if(l!=null){l=m(a.tableNames[e],l);yield* w(a,b,c,d,e,l,h);yield* t(a,b,c,d,e,l,void 0,g,h,i)}}}function* z(a,b,c,d,e){a=a.table(c);for(c of Object.keys(e)){var f=e[c];f===void 0?yield* a.indexDelete(b,c,f):yield* a.indexSet(b,c,f,d)}}function* f(a,b,d,e,f,g,h,i,j,k){var m=d.table(i),n=g.tableNames[i];for(var p of j)yield* m.clearIds(e,p);p=j.filter(function(a){return(n==null?void 0:n.indexes[a])!=null});if(p.length===0)return;j=o(d,e,n,void 0,"asc",void 0,f);var q=[],r=(yield* j.next(k));while(!r.done){while(!r.done&&q.length<=l)q.push(r.value),r=(yield* j.next(k));for(var s of q){var t=s[0],u=s[1];u=x(g.tableNames[i],p,u);yield* y(g,a,d,e,i,u,f,k,h);t=c("nullthrows")(yield* m.getId(e,t));yield* z(d,e,i,t,u)}q.length=0;b==null?void 0:b()}}var A="__internal__transaction_id";function B(a,b,e,f,g,h,i){var j=new(d("ReStoreOperationLock").ReStoreOperationLock)(),k=i==null?void 0:i.qplFlow,l=new Map(),m=new Proxy((i={},i[A]=c("Random").uint32(),i.table=function(c){return new(d("ReStoreTable").ReStoreTransactionTable)(c,a,e,j,g,f,m,k,h,b)},i),{get:function(c,i){return!Object.prototype.hasOwnProperty.call(a.tableNames,i)?Reflect.get.apply(Reflect,arguments):q(l,i,function(){return new(d("ReStoreTable").ReStoreTransactionTable)(i,a,e,j,g,f,m,k,h,b)})}});return m}function C(a){return a.types.includes("indexeddb")}g.collectIterator=a;g.searchKey=m;g.appendDefaultValues=n;g.entries=o;g.keys=b;g.gen=p;g.getLocked=e;g.getOrCreate=q;g.cascadeKeyUpdatesLocked=t;g.putLocked=u;g.upsertLocked=v;g.deleteItemLocked=w;g.indicesWithKeyForValue=x;g.deconflictIndicesLocked=y;g.addIdToIndices=z;g.rebuildIndicesLocked=f;g.createReStoreTransaction=B;g.isPDB=C}),98);
__d("ReStoreDefaultValueMigration",["LSPlatformLsInitLog","ReStoreDefaultValuesMetadata","ReStoreUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c={};b=(yield d("ReStoreUtils").collectIterator(b[d("ReStoreDefaultValuesMetadata").defaultValuesTableName].entries(a)));for(a of b){b=a[0];var e=a[1];if(b!=null){var f;b=d("ReStoreDefaultValuesMetadata").tryParseDefaultValuesData(e);if(b==null)continue;e=b.columns;b=b.tableName;c[b]=(f=c[b])!=null?f:new Set();for(f of e)c[b].add(f)}}return c});return i.apply(this,arguments)}function j(a,b,c,d){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,d){a=(yield h(a,b));b={};for(c in c.tableNames){var e=d[c];if(e!=null)for(var f in e){var g;g=(g=a[c])==null?void 0:g.has(f);if(!g){b[c]=(g=b[c])!=null?g:{};b[c][f]=e[f]}}}return b});return k.apply(this,arguments)}function l(a,b,c){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){for(b in b){var e=Object.keys(c[b]||{});e={columns:e,tableName:b};yield a[d("ReStoreDefaultValuesMetadata").defaultValuesTableName].put(d("ReStoreDefaultValuesMetadata").defaultValuesColumnToValue(e))}});return m.apply(this,arguments)}function a(a,b,c,d){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e){var f=new WeakMap();d("LSPlatformLsInitLog").addPoint("default_values_update_start");var g=function(a,b){d("LSPlatformLsInitLog").addPoint("default_values_update_end_failure",{string:{default_values_update_failure_point:b,default_values_update_failure_reason:String(a)}})};try{b=(yield j(f,a,b,e));try{if(c===!1)for(c in b){var h=a[c].entries(f),i=(yield h.next());while(!i.done){var k=babelHelpers["extends"]({},i.value[1]);k=d("ReStoreUtils").appendDefaultValues(k,c,e);yield a[c].put(k);i=(yield h.next())}}yield l(a,b,e);d("LSPlatformLsInitLog").addPoint("default_values_update_end")}catch(a){g(a,"setDefaultValues")}}catch(a){g(a,"findDefaultValuesToUpdate")}});return n.apply(this,arguments)}g.runMigrationForTableDefaultValuesIfNeeded=a}),98);
__d("ReStoreIndexMetadata",["FBLogger"],(function(a,b,c,d,e,f,g){"use strict";function h(a){a=typeof a==="string"?a:null;if(a==null)return null;try{a=JSON.parse(a);for(var b=a,c=Array.isArray(b),d=0,b=c?b:b[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var e;if(c){if(d>=b.length)break;e=b[d++]}else{d=b.next();if(d.done)break;e=d.value}e=e;if(typeof e!=="string")return null}return a}catch(a){return null}}function a(a){var b={indexName:"string",keyIds:"string","predicate?":"string",tableName:"string"};for(var d in b){var e=d.endsWith("?");if(e)e=a[d.slice(0,-1)];else{if(!Object.prototype.hasOwnProperty.call(a,d)||a[d]==null){c("FBLogger")("messenger_web_product").warn('Malformed index data, missing key "%s"',d);return null}e=a[d]}var f=b[d],g=typeof e;if(e!=null&&g!==f){c("FBLogger")("messenger_web_product").warn('Malformed index data, key "%s" has type "%s" but expected "%s"',d,g,f);return null}}e=h(a.keyIds);if(e==null){c("FBLogger")("messenger_web_product").warn('Malformed index data, key IDs "%s" are invalid',typeof a.keyIds==="string"?a.keyIds:"<"+typeof a.keyIds+">");return null}return typeof a.indexName!=="string"||typeof a.tableName!=="string"||typeof a.predicate!=="string"&&a.predicate!=null?null:babelHelpers["extends"]({data:e,indexName:a.indexName,tableName:a.tableName},a.predicate==null?{}:{predicate:a.predicate})}function b(a,b){if(a[0]==null)return!0;if(a[0].length!==b[0].length)return!0;for(var c=0;c<a[0].length;c++)if(a[0][c]!==b[0][c])return!0;return a[1]!==b[1]?!0:!1}function d(a){return babelHelpers["extends"]({indexName:a.indexName,keyIds:JSON.stringify(a.data),tableName:a.tableName},a.predicate==null?{}:{predicate:a.predicate})}e="_db_indices_meta";g.tryParseIndexData=a;g.indicesDiffer=b;g.indexDataToValue=d;g.indicesTableName=e}),98);
__d("ReStoreIndicesMigration",["LSPlatformLsInitLog","ReStoreIndexMetadata","ReStoreOperationLock","ReStoreUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c={};b=(yield d("ReStoreUtils").collectIterator(b[d("ReStoreIndexMetadata").indicesTableName].entries(a)));for(a of b){b=a[0];var e=a[1];if(b!=null){var f;e=d("ReStoreIndexMetadata").tryParseIndexData(e);if(e==null)continue;var g=e.indexName,h=e.tableName;c[h]=(f=c[h])!=null?f:{};c[h][g]=babelHelpers["extends"]({index:e.data,key:b},e.predicate==null?{}:{predicate:e.predicate})}}return c});return i.apply(this,arguments)}function j(a,b,c){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){a=(yield h(a,b));b={};for(var e in c.tableNames){var f=c.tableNames[e];for(var g in f.indexes){var i,j;i=[f.indexes[g],(i=f.indexPredicates)==null?void 0:(i=i[g])==null?void 0:i.toString()];j=(j=a[e])==null?void 0:j[g];if(d("ReStoreIndexMetadata").indicesDiffer([j==null?void 0:j.index,j==null?void 0:j.predicate],i)){b[e]=(j=b[e])!=null?j:{};b[e][g]=i}}}j={};for(i in c.tableNames)if(i in a){g=a[i];for(f in g){var k;e=g[f];k=(k=c.tableNames[i])==null?void 0:(k=k.indexes)==null?void 0:k[f];if(k==null){j[i]=(k=j[i])!=null?k:{};j[i][f]=e}}}return{toRemove:j,toUpdate:b}});return k.apply(this,arguments)}function l(a,b){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){for(var c in b){var e=b[c];for(var f in e){var g=e[f],h=g[0];g=g[1];h=babelHelpers["extends"]({data:h,indexName:f,tableName:c},g==null?{}:{predicate:g});yield a[d("ReStoreIndexMetadata").indicesTableName].put(d("ReStoreIndexMetadata").indexDataToValue(h))}}});return m.apply(this,arguments)}function n(a,b){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){for(var c in b){var e=b[c];for(var f in e){var g,h=e[f].key;yield (g=a[d("ReStoreIndexMetadata").indicesTableName])["delete"].apply(g,h)}}});return o.apply(this,arguments)}function p(a,b,c,e,f){return new(d("ReStoreOperationLock").ReStoreOperationLock)().chainPromiseOrValue(function(g){return d("ReStoreUtils").gen(d("ReStoreUtils").rebuildIndicesLocked(a.changedKeys,a.clearCache,a.storeTx,new WeakMap(),a.hooksManager,c,e,b,f,g))})}function a(a,c,e,f){var g=new WeakMap();d("LSPlatformLsInitLog").addPoint("index_migration_start");var h=function(a,b){d("LSPlatformLsInitLog").addPoint("index_migration_end_failure",{string:{index_migration_failure_point:b,index_migration_failure_reason:String(a)}})};return j(g,a.transaction,c).then(function(){var g=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var g=b.toRemove;b=b.toUpdate;var h=Array.from(new Set([].concat(Object.keys(b),Object.keys(g))));d("LSPlatformLsInitLog").addAnnotations({"int":{index_migration_rebuild_tables_count:h.length}});if(f===!1)for(h of h)if(c.tableNames[h]!=null){var i;i=Array.from(new Set([].concat(Object.keys((i=b[h])!=null?i:{}),Object.keys((i=g[h])!=null?i:{}))));yield p(a,h,c,e,i)}yield l(a.transaction,b);yield n(a.transaction,g);d("LSPlatformLsInitLog").addPoint("index_migration_end")});return function(a){return g.apply(this,arguments)}}(),function(a){return h(a,"findIndicesToUpdateOrRemove")})["catch"](function(a){return h(a,"rebuildIndices")})}g.runMigrationForIndicesIfNeeded=a}),98);
__d("ReQLGlobalQueryContext",[],(function(a,b,c,d,e,f){"use strict";var g={};function a(a){return a.get(g)}function b(a,b){a.set(g,b)}var h={contents:void 0,withinSupportedContext:!1};function c(a){var b=h.withinSupportedContext;h.withinSupportedContext=!0;try{return a()}finally{h.withinSupportedContext=b}}f.getDependencies=a;f.setDependencies=b;f.globalQueryContext=h;f.runFromContextThatHandlesThrownPromise=c}),66);
__d("ReQL",["BPlusTree","PromiseOrValue","ReQLBounds","ReQLGlobalQueryContext","ReStoreKeyComparer","unrecoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l={bounds:b,filter:f,getKeyRange:o,map:q,take:u};function m(a,b){try{var c=(h||(h=d("ReQLGlobalQueryContext"))).globalQueryContext.contents,e=h.getDependencies(b);e==null&&(h||(h=d("ReQLGlobalQueryContext"))).setDependencies(b,[]);h.globalQueryContext.contents=b;var f,g;try{f=(h||(h=d("ReQLGlobalQueryContext"))).runFromContextThatHandlesThrownPromise(a),g=(h||(h=d("ReQLGlobalQueryContext"))).getDependencies(b)||[]}finally{(h||(h=d("ReQLGlobalQueryContext"))).setDependencies(b,e),h.globalQueryContext.contents=c}return[f,g]}catch(c){if(c instanceof Promise)return c.then(function(){return m(a,b)});throw c}}function a(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return b}function b(a){var b=this;return Object.setPrototypeOf({direction:b.direction,iterator:function(c,e){return b.iterator(c,(i||(i=d("ReQLBounds"))).mergeBounds(a,e))},keyLength:b.keyLength,subscribe:function(c,e){return b.subscribe(c,(i||(i=d("ReQLBounds"))).mergeBounds(a,e))}},l)}var n=Object.setPrototypeOf({direction:"asc",iterator:function(){return{next:function(){return{done:!0}}}},keyLength:0,subscribe:function(){return function(){}}},l);function e(){return n}function f(a){var b=this,c=new Map();return Object.setPrototypeOf({direction:b.direction,iterator:function(e,f){var g=b.iterator(e,f);return{next:function(b){return(j||(j=d("PromiseOrValue"))).loop(function(b){return(j||(j=d("PromiseOrValue"))).map(g.next(b),function(b){if(b.done)return{action:"break",value:b};var e=b.value,f=e[0];e=e[1];if(a(e)){(i||(i=d("ReQLBounds"))).forEachMatchingBounds(c,f,function(a){a.add(JSON.stringify(f))});return{action:"break",value:b}}(i||(i=d("ReQLBounds"))).forEachMatchingBounds(c,f,function(a){a.delete(JSON.stringify(f))});return{action:"continue",value:void 0}})},b)}}},keyLength:b.keyLength,subscribe:function(e,f){var g={},h=new Set();c.set(g,[(i||(i=d("ReQLBounds"))).extendBounds(f,b.keyLength),h]);var j=b.subscribe(function(b,c,d){var f=JSON.stringify(b);if(c.operation==="add"&&a(c.value)){h.add(f);return e(b,c,d)}if(c.operation==="put"&&a(c.value)){if(h.has(f))return e(b,c,d);h.add(f);return e(b,{operation:"add",value:c.value},d)}if(c.operation==="put"&&h.has(f)){h.delete(f);return e(b,{operation:"delete"},d)}if(c.operation==="delete"&&h.has(f)){h.delete(f);return e(b,c,d)}},f);return function(){c.delete(g);return j()}}},l)}function o(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];var e=this;function f(a){return a.gt!=null?{gt:[].concat(b,a.gt)}:{gte:[].concat(b,a.gte)}}function g(a){return a.lt!=null?{lt:[].concat(b,a.lt)}:{lte:[].concat(b,a.lte)}}function h(a){return a==null?{gte:b,lte:b}:babelHelpers.extends({},a.gte!=null||a.gt!=null?f(a):{gte:b},a.lte!=null||a.lt!=null?g(a):{lte:b})}return Object.setPrototypeOf({direction:e.direction,iterator:function(a,c){var f=e.iterator(a,h(c));return{next:function(a){return(j||(j=d("PromiseOrValue"))).map(f.next(a==null?a:[].concat(b,a)),function(a){return a.done?{done:!0}:{done:!1,value:[a.value[0].slice(b.length),a.value[1]]}})}}},keyLength:e.keyLength-b.length,subscribe:function(a,c){return e.subscribe(function(c,d,e){return a(c.slice(b.length),d,e)},h(c))}},l)}function p(a,b){if(a.direction!==b.direction)throw c("unrecoverableViolation")("merge join requires iterables to be sorted in the same direction","maw_db");return Object.setPrototypeOf({direction:a.direction,iterator:function(e,f){var g=a.iterator(e,f),h=b.iterator(e,f),i=h.next();function l(a){return(j||(j=d("PromiseOrValue"))).map(i,function(b){var c=b.done?!0:(k||(k=d("ReStoreKeyComparer"))).compareKey(a,b.value[0])<=0;c=c?b:h.next(a);i=c;return c})}return{next:function(a){return(j||(j=d("PromiseOrValue"))).map(g.next(a),function(a){if(a.done)return{done:!0,value:void 0};var b=a.value;b=b[0];return(j||(j=d("PromiseOrValue"))).map(l(b),function(b){var e=a.value,f=e[0];e=e[1];if(b.done)return{done:!1,value:[f,[e,void 0]]};b=b.value;var g=b[0];b=b[1];g=(k||(k=d("ReStoreKeyComparer"))).compareKey(f,g);if(g>0)throw c("unrecoverableViolation")("Right iterable should always be equal to or ahead","maw_db");else if(g<0)return{done:!1,value:[f,[e,void 0]]};else return{done:!1,value:[f,[e,b]]}})})}}},keyLength:Math.max(a.keyLength,b.keyLength),subscribe:function(c,e){var f=!0,g=a.subscribe(async function(a,e,g){return(j||(j=d("PromiseOrValue"))).map(b.iterator(g,{gte:a,lte:a}).next(),function(b){b=b.value;if(!f)return;return c(a,e.operation==="add"?{operation:"add",value:[e.value,b==null?void 0:b[1]]}:e.operation==="put"?{operation:"put",value:[e.value,b==null?void 0:b[1]]}:{operation:"delete"},g)})},e),h=b.subscribe(async function(b,e,g){return(j||(j=d("PromiseOrValue"))).map(a.iterator(g,{gte:b,lte:b}).next(),function(a){if(!f||a.done)return;return c(b,e.operation==="add"?{operation:"add",value:[a.value[1],e.value]}:e.operation==="put"?{operation:"put",value:[a.value[1],e.value]}:{operation:"delete"},g)})},e);return function(){f=!1,g(),h()}}},l)}function q(a){var b=this,c=new Map();function e(a,b,c,e,g){var h=JSON.stringify(c),i=a.get(h);i==null&&(i=[],a.set(h,i));i.forEach(function(a){return a()});i.length=0;var k=i;g.forEach(function(g){k.push(g.subscribe(function(g,h,i){return(j||(j=d("PromiseOrValue"))).map(f(a,b,c,e,i),function(a){return b(c,{operation:"put",value:a},i)})}))})}function f(b,c,f,g,h){return(j||(j=d("PromiseOrValue"))).map(m(function(){return a(g)},h),function(a){var d=a[0];a=a[1];e(b,c,f,g,a);return d})}function g(a,b){var c=JSON.stringify(b);if(!a.has(c))return;b=(b=a.get(JSON.stringify(b)))!=null?b:[];b.forEach(function(a){return a()});b.length=0;a.delete(c)}return Object.setPrototypeOf({direction:b.direction,iterator:function(f,g){var h=b.iterator(f,g);return{next:function(b){return(j||(j=d("PromiseOrValue"))).map(h.next(b),function(g){if(g.done)return g;g=g.value;var b=g[0],h=g[1];return(j||(j=d("PromiseOrValue"))).map(j.map(m(function(){return a(h)},f),function(a){var f=a[0],g=a[1];(i||(i=d("ReQLBounds"))).forEachMatchingBounds(c,b,function(a){var c=a[0];a=a[1];return e(c,a,b,h,g)});return f}),function(a){return{done:!1,value:[b,a]}})})}}},keyLength:b.keyLength,subscribe:function(a,e){var h={},k=new Map();c.set(h,[(i||(i=d("ReQLBounds"))).extendBounds(e,b.keyLength),[k,a]]);var l=b.subscribe(function(b,c,e){if(c.operation==="delete"){g(k,b);return a(b,c,e)}else if(c.operation==="add"){var h=c.value;return(j||(j=d("PromiseOrValue"))).map(f(k,a,b,h,e),function(c){return a(b,{operation:"add",value:c},e)})}else if(c.operation==="put"){h=c.value;return(j||(j=d("PromiseOrValue"))).map(f(k,a,b,h,e),function(c){return a(b,{operation:"put",value:c},e)})}},e);return function(){k.forEach(function(a){a.forEach(function(a){return a()})}),c.delete(h),l()}}},l)}function r(a,b){var c=s(a,b);for(var d=arguments.length,e=new Array(d>2?d-2:0),f=2;f<d;f++)e[f-2]=arguments[f];return e.reduce(function(a,b){return s(a,b)},c)}function s(a,b){if(a.direction!==b.direction)throw c("unrecoverableViolation")("union requires iterables to be sorted in the same direction","maw_db");var e=Math.max(a.keyLength,b.keyLength);function f(a,b){return b===0||a.length===0?[]:a.slice(0,b)}function g(a){return a.gt!=null?{gt:f(a.gt,e)}:{gte:f(a.gte,e)}}function h(a){return a.lt!=null?{lt:f(a.lt,e)}:{lte:f(a.lte,e)}}function i(a){return a==null?void 0:babelHelpers.extends({},a.gte!=null||a.gt!=null?g(a):{},a.lte!=null||a.lt!=null?h(a):{})}return Object.setPrototypeOf({direction:a.direction,iterator:function(c,g){var h=a.iterator(c,i(g)),l=b.iterator(c,i(g)),m=h.next(),n=l.next();return{next:function(b){b!==void 0&&(m=h.next(f(b,e)),n=l.next(f(b,e)));return(j||(j=d("PromiseOrValue"))).map(j.all2(m,n),function(b){var c=b[0];b=b[1];function e(a,b){if(a.done)return{done:!0};a={done:!1,value:[[].concat(a.value[0],[b]),a.value[1]]};b?m=h.next():n=l.next();return a}if(c.done)return e(b,!1);if(b.done)return e(c,!0);var f=a.direction==="asc"?[c,b]:[b,c],g=f[0];f=f[1];f=(k||(k=d("ReStoreKeyComparer"))).compareKey((g=g.value)==null?void 0:g[0],(g=f.value)==null?void 0:g[0]);if(f<0)return e(c,!0);else return e(b,!1)})}}},keyLength:e+1,subscribe:function(c,d){var e=a.subscribe(function(a,b,d){return c([].concat(a,[!0]),b,d)},d),f=b.subscribe(function(a,b,d){return c([].concat(a,[!1]),b,d)},d);return function(){e(),f()}}},l)}function t(a,b){if(a.direction!==b.direction)throw c("unrecoverableViolation")("merge join requires iterables to be sorted in the same direction","maw_db");return Object.setPrototypeOf({direction:a.direction,iterator:function(c,e){var f=a.iterator(c,e),g=b.iterator(c,e);function h(a){return(j||(j=d("PromiseOrValue"))).loop(function(a){var b=a[0];a=a[1];if(b.done||a.done)return{action:"break",value:{done:!0}};var c=b.value,e=c[0];c=c[1];var h=a.value,i=h[0];h=h[1];var l=(k||(k=d("ReStoreKeyComparer"))).compareKey(e,i);if(l>0)return(j||(j=d("PromiseOrValue"))).map(j.all2(b,g.next(e)),function(a){return{action:"continue",value:a}});else if(l<0)return(j||(j=d("PromiseOrValue"))).map(j.all2(f.next(i),a),function(a){return{action:"continue",value:a}});return{action:"break",value:{done:!1,value:[e,[c,h]]}}},a)}return{next:function(a){return(j||(j=d("PromiseOrValue"))).map(j.all2(f.next(a),g.next(a)),h)}}},keyLength:Math.max(a.keyLength,b.keyLength),subscribe:function(c,e){var f=!0;function g(a,b,e,g,h){return(j||(j=d("PromiseOrValue"))).map(a.iterator(h,{gte:e,lte:e}).next(),function(a){if(a.done||!f)return;a=a.value[1];a=g.operation==="add"?{operation:"add",value:b(g.value,a)}:g.operation==="put"?{operation:"put",value:b(g.value,a)}:g;return c(e,a,h)})}var h=a.subscribe(function(){for(var a=arguments.length,c=new Array(a),d=0;d<a;d++)c[d]=arguments[d];return g.apply(void 0,[b,function(a,b){return[a,b]}].concat(c))},e),i=b.subscribe(function(){for(var b=arguments.length,c=new Array(b),d=0;d<b;d++)c[d]=arguments[d];return g.apply(void 0,[a,function(a,b){return[b,a]}].concat(c))},e);return function(){f=!1,h(),i()}}},l)}function u(a){var b=this,e=new Map();return Object.setPrototypeOf({direction:b.direction,iterator:function(c,f){var g=b.iterator(c,f),h=0;return{next:function(b){if(h>=a)return{done:!0};else return(j||(j=d("PromiseOrValue"))).map(g.next(b),function(b){b.done||(i||(i=d("ReQLBounds"))).forEachMatchingBounds(e,b.value[0],function(c){var d=c[0];c=c[1];c.contents<=a&&(d.has(b.value[0])||(c.contents+=1,d.set(b.value[0],void 0)))});h+=1;return b})}}},keyLength:b.keyLength,subscribe:function(f,g){var h={},l=b.direction==="asc"?1:-1,m=new(c("BPlusTree"))(function(a,b){return(k||(k=d("ReStoreKeyComparer"))).compareKey(a,b)*-l}),n={contents:0};e.set(h,[(i||(i=d("ReQLBounds"))).extendBounds(g,b.keyLength),[m,n]]);var o=b.subscribe(function(c,g,i){var o,p=(o=m.entries().next().value)==null?void 0:o[0];o=p==null?!0:(k||(k=d("ReStoreKeyComparer"))).compareKey(c,p)*l<=0;if(g.operation==="delete"&&o){var q;n.contents>0&&(m.delete(c),q=f(c,g,i));return(j||(j=d("PromiseOrValue"))).map(q,function(){return(j||(j=d("PromiseOrValue"))).map(b.iterator(i,p==null?void 0:l===1?{gt:p}:{lt:p}).next(),function(a){if(!a.done&&e.has(h)){m.set(a.value[0],void 0);return f(a.value[0],{operation:"add",value:a.value[1]},i)}n.contents>0&&(n.contents-=1)})})}if(g.operation==="add"&&n.contents<a){n.contents+=1;m.set(c,void 0);return f(c,g,i)}if(g.operation==="add"&&o){var r;p!=null&&(m.delete(p),r=f(p,{operation:"delete"},i));return(j||(j=d("PromiseOrValue"))).map(r,function(){m.set(c,void 0);return f(c,g,i)})}if(g.operation==="put"&&o)return f(c,g,i)},g);return function(){e.delete(h);return o()}}},l)}var v=new WeakMap();function w(a,b){var c=v.get(a);if(c!=null)return c;c=b.reduce(function(b,c,d){b[c]=a[d];return b},{});v.set(a,c);return c}function x(a,b,c,e,f){if(f==null||f.length>a.keyFields.length||f.some(function(b){return a.keyFields.indexOf(b)===-1}))return a.entries(b,c,e);var g=a.keys(b,c,e);return{next:function(b){return(j||(j=d("PromiseOrValue"))).map(g.next(b),function(b){return b.done?{done:!0}:{done:!1,value:[b.value,w(b.value,a.keyFields)]}})}}}function y(a,b){return Object.setPrototypeOf({direction:"asc",iterator:function(c,d){return x(a,c,"asc",d,b)},keyLength:a.keyFields.length,subscribe:function(c,d){return a.subscribe(c,d,b)}},l)}function z(a,b){return Object.setPrototypeOf({direction:"desc",iterator:function(c,d){return x(a,c,"desc",d,b)},keyLength:a.keyFields.length,subscribe:function(c,d){return a.subscribe(c,d,b)}},l)}function A(a){var b=[],c=a.iterator(new WeakMap());return Promise.resolve((j||(j=d("PromiseOrValue"))).loop(function(){return(j||(j=d("PromiseOrValue"))).map(c.next(),function(a){if(a.done)return{action:"break",value:b};b.push(a.value[1]);return{action:"continue",value:void 0}})}))}async function B(a){a=a.iterator(new WeakMap());a=await a.next();return a.done?void 0:a.value[1]}async function C(a){a=a.iterator(new WeakMap());a=await a.next();if(a.done)throw c("unrecoverableViolation")("expected result","maw_db");return a.value[1]}function D(a,b){var c=new WeakMap();function e(a){return a.gt!=null?{gt:a.gt.slice(1)}:{gte:a.gte.slice(1)}}function f(a){return a.lt!=null?{lt:a.lt.slice(1)}:{lte:a.lte.slice(1)}}function g(a){return a==null?void 0:babelHelpers.extends({},a.gte!=null||a.gt!=null?e(a):{},a.lte!=null||a.lt!=null?f(a):{})}return Object.setPrototypeOf({direction:a.direction,iterator:function(e,f){var g={};if(f){if(f.gt!=null){var h=f.gt,i=(k||(k=d("ReStoreKeyComparer"))).compareValue(b,h[0]);if(i===0)if(h.length===1)return{next:function(){return{done:!0}}};else g.gt=h.slice(1);else if(i<0)return{next:function(){return{done:!0}}}}if(f.gte!=null){h=f.gte;i=(k||(k=d("ReStoreKeyComparer"))).compareValue(b,h[0]);if(i===0)g.gte=h.slice(1);else if(i<0)return{next:function(){return{done:!0}}}}if(f.lte!=null){h=f.lte;i=(k||(k=d("ReStoreKeyComparer"))).compareValue(b,h[0]);if(i===0)h.length!==1&&(g.lte=h.slice(1));else if(i>0)return{next:function(){return{done:!0}}}}if(f.lt!=null){h=f.lt;i=(k||(k=d("ReStoreKeyComparer"))).compareValue(b,h[0]);if(i===0)if(h.length===1)return{next:function(){return{done:!0}}};else g.lt=h.slice(1);else if(i>0)return{next:function(){return{done:!0}}}}}var l=a.iterator(e,g);return{next:function(a){return(j||(j=d("PromiseOrValue"))).map(l.next(a==null?void 0:a.slice(1)),function(a){if(a.done)return{done:!0};var d=c.get(a.value[0]);d==null&&(d=[b].concat(a.value[0]),c.set(a.value[0],d));return{done:!1,value:[d,a.value[1]]}})}}},keyLength:a.keyLength+1,subscribe:function(d,e){return a.subscribe(function(a,e,f){var g=c.get(a);g==null&&(g=[b].concat(a),c.set(a,g));return d(g,e,f)},g(e))}},l)}g.prototype=l;g.key=a;g.empty=e;g.leftJoin=p;g.union=r;g.mergeJoin=t;g.fromTableAscending=y;g.fromTableDescending=z;g.toArrayAsync=A;g.firstAsync=B;g.firstExnAsync=C;g.prependKey=D}),98);
__d("ReStoreMigrateUtil",["$InternalEnum","Promise","ReQL","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;f=b("$InternalEnum").Mirrored(["UPDATE_METADATA","UPGRADE_COMPLETE","NO_UPGRADE_NEEDED"]);function a(a,b){b="V"+b;return b in a?b:null}function i(a,b){return j.apply(this,arguments)}function j(){j=babelHelpers.wrapAsyncGenerator(function*(a,b){a=a.iterator(new WeakMap());var c=[],d=(yield babelHelpers.awaitAsyncGenerator(a.next()));while(!d.done){var e=d.value;e[0];e=e[1];c.push(e);c.length===b&&(yield c,c=[]);d=(yield babelHelpers.awaitAsyncGenerator(a.next()))}c.length&&(yield c)});return j.apply(this,arguments)}function c(a,b,c){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e){var f=!0,g=!1,j;try{for(var k=babelHelpers.asyncIterator(i(d("ReQL").fromTableAscending(a),100)),l,l;l=(yield k.next()),f=l.done,l=(yield l.value),!f;f=!0){l=l;yield (h||(h=b("Promise"))).all(l.map(function(b){return c(b).then(a.put)}));e==null?void 0:e()}}catch(a){g=!0,j=a}finally{try{!f&&k["return"]!=null&&(yield k["return"]())}finally{if(g)throw j}}});return k.apply(this,arguments)}function e(a,b){function c(b){if(b==null)return void 0;var c={};for(var d in b)c[a+"_"+d]=b[d];return c}return{bool:c(b.bool),"int":c(b["int"]),string:c(b.string)}}g.ReStoreMigrateResult=f;g.getVersionFromNumber=a;g.fetchReQLBatch=i;g.upgradeTableEntries=c;g.prefixAnnotations=e}),98);
__d("ReStoreHashMigration",["ReStoreDefaultValueMigration","ReStoreIndicesMigration","ReStoreMigrateUtil","ReStorePersistedMetadata","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a){a=Object.values(a.tableNames).map(function(a){return babelHelpers["extends"]({},a,{indexPredicates:Object.entries((a=a.indexPredicates)!=null?a:{}).map(function(a){var b=a[0];a=a[1];return[b,a.toString()]})})});return JSON.stringify(a)}function c(a,b,c,d){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e){var f,g,h,i=e.loggers,j=i.logHistory;i=i.userFlow;var k=e.storeTx,l=e.transaction,m=d("ReStorePersistedMetadata").ReStorePersistedDefaultValuesVersion.hash(c),n=d("ReStorePersistedMetadata").ReStorePersistedSchemaVersion.hash(b);i==null?void 0:i.addAnnotations(d("ReStoreMigrateUtil").prefixAnnotations(a,{"int":{defaultValuesVersion:m,schemaVersion:n}}));var o=new(d("ReStorePersistedMetadata").ReStorePersistedSchemaVersion)(a),p=new(d("ReStorePersistedMetadata").ReStorePersistedDefaultValuesVersion)(a);f=(f=(yield o.read(k)))==null?void 0:f.schemaVersion;g=(g=(yield p.read(k)))==null?void 0:g.defaultValuesVersion;j==null?void 0:j.debug("storeSchemaVersion: "+((h=f)!=null?h:"null"));j==null?void 0:j.debug("storeDefaultValuesVersion: "+((h=g)!=null?h:"null"));f!=null&&(i==null?void 0:i.addAnnotations(d("ReStoreMigrateUtil").prefixAnnotations(a,{"int":{storeDefaultValuesVersion:g,storeSchemaVersion:f}})));if(f===n&&g===m)return d("ReStoreMigrateUtil").ReStoreMigrateResult.NO_UPGRADE_NEEDED;h=f==null;yield d("ReStoreDefaultValueMigration").runMigrationForTableDefaultValuesIfNeeded(l,b,h,c);j==null?void 0:j.debug("migration default values finished");yield d("ReStoreIndicesMigration").runMigrationForIndicesIfNeeded(e,b,c,h);j==null?void 0:j.debug("migration indices finished");o.write(k,{schemaVersion:n});p.write(k,{defaultValuesVersion:m});j==null?void 0:j.debug("version is written");j==null?void 0:j.debug("migration hash end");i==null?void 0:i.addPoint("migration_hash_end");if(h)return d("ReStoreMigrateUtil").ReStoreMigrateResult.UPDATE_METADATA;else return d("ReStoreMigrateUtil").ReStoreMigrateResult.UPGRADE_COMPLETE});return h.apply(this,arguments)}g.serializeTableData=a;g.runHashMigration=c}),98);
__d("ReStorePersistenceIds",[],(function(a,b,c,d,e,f){"use strict";b="nextId";c="seed";function a(a){return a}f.idForNextId=b;f.idForSeed=c;f.castPersistenceId=a}),66);
__d("ReStorePersistedMetadata",["ReStoreHashMigration","ReStorePersistenceIds","ReStoreUtils","hashString"],(function(a,b,c,d,e,f,g){"use strict";var h="_db_schema_meta";a=function(){function a(a){this.$1=d("ReStorePersistenceIds").castPersistenceId(a)}var b=a.prototype;b.read=async function(a){a=await d("ReStoreUtils").gen(a.table(h).readData(new WeakMap(),this.$1));return a};b.write=function(a,b){a.table(h).writeData(new WeakMap(),this.$1,b)};b.getId=function(){return this.$1};return a}();b=function(a){babelHelpers.inheritsLoose(b,a);function b(b){return a.call(this,b+"_schema_version")||this}b.hash=function(a){return c("hashString")(d("ReStoreHashMigration").serializeTableData(a))};return b}(a);e=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.call(this,"custom_migration_value_version")||this}return b}(a);f=function(a){babelHelpers.inheritsLoose(b,a);function b(b){return a.call(this,b+"_default_value_version")||this}b.hash=function(a){return c("hashString")(JSON.stringify(a))};return b}(a);g.schemaMetadataTableName=h;g.ReStorePersistedMetadata=a;g.ReStorePersistedSchemaVersion=b;g.ReStorePersistedCustomMigrationVersion=e;g.ReStorePersistedDefaultValuesVersion=f}),98);
__d("ReStoreMetadata",["ReStoreDefaultValuesMetadata","ReStoreIndexMetadata","ReStorePersistedMetadata"],(function(a,b,c,d,e,f,g){"use strict";function h(a){return!0}function a(a){var b=a.reduce(function(a,b){return function(c){return c[b]!=null&&a(c)}},h);b.toString=function(){return"dynamic predicate on ["+a.join(",")+"]"};return b}function b(a){return function(b){var c={},d={};for(var b=b,e=Array.isArray(b),f=0,b=e?b:b[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var g;if(e){if(f>=b.length)break;g=b[f++]}else{f=b.next();if(f.done)break;g=f.value}g=g;for(var g=g,h=Array.isArray(g),i=0,g=h?g:g[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var j,k;if(h){if(i>=g.length)break;k=g[i++]}else{i=g.next();if(i.done)break;k=i.value}k=k;k.id!=null&&(c[k.id]=k.name);d[k.name]={autoIncrement:(j=k.auto_increment)!=null?j:!1,cascadeUpdates:(j=a[k.name])!=null?j:[],indexes:(j=Object.fromEntries(Object.entries((j=k.indexes)!=null?j:{}).map(function(a){var b=a[0];a=a[1].columns;return[b,a]})))!=null?j:{},indexPredicates:Object.fromEntries(Object.entries((j=k.indexes)!=null?j:{}).filter(function(a){a[0];a=a[1];return a.predicate}).map(function(a){var b=a[0];a=a[1];return[b,a.predicate]})),name:k.name,primaryKeyIds:k.primary_key}}}return{tableIds:c,tableNames:d}}}e=(c={},c[d("ReStoreDefaultValuesMetadata").defaultValuesTableName]={autoIncrement:!1,cascadeUpdates:[],indexes:{},name:d("ReStoreDefaultValuesMetadata").defaultValuesTableName,primaryKeyIds:["t"]},c[d("ReStoreIndexMetadata").indicesTableName]={autoIncrement:!1,cascadeUpdates:[],indexes:{},name:d("ReStoreIndexMetadata").indicesTableName,primaryKeyIds:["tableName","indexName"]},c[d("ReStorePersistedMetadata").schemaMetadataTableName]={autoIncrement:!1,cascadeUpdates:[],indexes:{},name:d("ReStorePersistedMetadata").schemaMetadataTableName,primaryKeyIds:[]},c);g.createPredicate=a;g.getBuildTableData=b;g.RESTORE_METADATA_TABLES=e}),98);
__d("ReStoreHashSchemaProvider",["ReStoreHashMigration","ReStoreMetadata","ReStoreMigrateUtil","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a,b,c){var e=b.tableIds;b=b.tableNames;c===void 0&&(c={});this.$1=a;this.tableNames=babelHelpers["extends"]({},b,d("ReStoreMetadata").RESTORE_METADATA_TABLES);this.tableIds=e;this.defaults=(a=c)!=null?a:{}}var c=a.prototype;c.migrate=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b,c;(b=a.loggers.logHistory)==null?void 0:b.debug("["+this.$1+"][ReStoreHashSchemaProvider] Start migration");(b=a.loggers.userFlow)==null?void 0:b.addAnnotations(d("ReStoreMigrateUtil").prefixAnnotations(this.$1,{string:{schemaProviderType:"hash"}}));(b=a.loggers.userFlow)==null?void 0:b.addPoint(this.$1+"_migration_hash_start");b=(yield d("ReStoreHashMigration").runHashMigration(this.$1,{tableIds:this.tableIds,tableNames:this.tableNames},this.defaults,a));(c=a.loggers.logHistory)==null?void 0:c.debug("["+this.$1+"][ReStoreHashSchemaProvider] End migration. Result: "+b);(c=a.loggers.userFlow)==null?void 0:c.addPoint(this.$1+"_migration_hash_end");return b});function c(b){return a.apply(this,arguments)}return c}();return a}();g["default"]=a}),98);
__d("ReStoreSchemaProvider",["ReStoreMigrateUtil","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a,c){return{defaults:babelHelpers["extends"]({},a.defaults,c.defaults),migrate:function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var e=(yield a.migrate(b));b=(yield c.migrate(b));if(e===d("ReStoreMigrateUtil").ReStoreMigrateResult.UPGRADE_COMPLETE||b===d("ReStoreMigrateUtil").ReStoreMigrateResult.UPGRADE_COMPLETE)return d("ReStoreMigrateUtil").ReStoreMigrateResult.UPGRADE_COMPLETE;else if(e===d("ReStoreMigrateUtil").ReStoreMigrateResult.UPDATE_METADATA||b===d("ReStoreMigrateUtil").ReStoreMigrateResult.UPDATE_METADATA)return d("ReStoreMigrateUtil").ReStoreMigrateResult.UPDATE_METADATA;else return d("ReStoreMigrateUtil").ReStoreMigrateResult.NO_UPGRADE_NEEDED});function f(a){return e.apply(this,arguments)}return f}(),tableIds:babelHelpers["extends"]({},a.tableIds,c.tableIds),tableNames:babelHelpers["extends"]({},a.tableNames,c.tableNames)}}g.mergeSchemaProviders=a}),98);
__d("LSMetadata",["LSClientSchemaType","LSDbSchema","LSSchemaProvider","ReStoreHashSchemaProvider","ReStoreMetadata","ReStoreSchemaProvider"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return d("ReStoreSchemaProvider").mergeSchemaProviders(a,h)}var h=new(c("ReStoreHashSchemaProvider"))(d("LSClientSchemaType").MAW_SCHEMA_NAME,d("ReStoreMetadata").getBuildTableData({})([d("LSDbSchema").clientSchema]));b=a(c("LSSchemaProvider"));g.buildSchema=a;g.schema=b}),98);
__d("MAWBridge",["WABridge"],(function(a,b,c,d,e,f,g){"use strict";function a(){return d("WABridge").getBridge()}g.getBridge=a}),98);
__d("MAWBridgeFireAndForget",["MAWBridge","MAWWaitForBackendSetup"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c,e){return d("MAWWaitForBackendSetup").runAfterBackendSetup(function(){d("MAWBridge").getBridge().fireAndForget(a,b,c,e)},b)}g.fireAndForget=a}),98);
__d("MAWWorkerEvent",["QPLUserFlow","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h=new Set();function a(a,b){if(h.has(b))return;h.add(b);c("QPLUserFlow").start(c("qpl")._(1056842055,"807"),{annotations:{string:{event:a}},instanceKey:b})}function b(a){if(!h.has(a))return;h["delete"](a);c("QPLUserFlow").endSuccess(c("qpl")._(1056842055,"807"),{instanceKey:a})}function d(a,b){if(!h.has(a))return;h["delete"](a);c("QPLUserFlow").endFailure(c("qpl")._(1056842055,"807"),"fail",{annotations:{string:{error:b}},instanceKey:a})}function e(a){if(!h.has(a))return;h["delete"](a);c("QPLUserFlow").addPoint(c("qpl")._(1056842055,"807"),"timeout_logged");c("QPLUserFlow").endFailure(c("qpl")._(1056842055,"807"),"timeout",{instanceKey:a})}g.logStart=a;g.logSuccess=b;g.logFailure=d;g.logTimeout=e}),98);
__d("MAWBridgeLoggingUtils",["MAWWorkerEvent","ODS"],(function(a,b,c,d,e,f,g){"use strict";var h,i=3185,j="armadillo_worker_runtime",k="getWorkerHeartbeat",l=10,m=new Array(l);function n(a,b,c){(h||(h=d("ODS"))).bumpEntityKey(i,j,a+"_"+b+"_"+c)}function a(a,b,c){n(a,b,"start");if(b===k)return;(h||(h=d("ODS"))).bumpEntityKey(i,j,"route_start");d("MAWWorkerEvent").logStart(b,c);m.length===l&&m.shift();m.push(a+"_"+b)}function o(a){m.filter(Boolean).forEach(function(b){(h||(h=d("ODS"))).bumpEntityKey(i,j,b+a)})}function b(a,b,c){n(a,b,"success");if(b===k)return;(h||(h=d("ODS"))).bumpEntityKey(i,j,"route_success");d("MAWWorkerEvent").logSuccess(c)}function c(a,b,c,e){n(a,b,"fail");if(b===k)return;(h||(h=d("ODS"))).bumpEntityKey(i,j,"route_fail");d("MAWWorkerEvent").logFailure(e,c)}function e(a,b,c){n(a,b,"timeout");if(b===k)return;(h||(h=d("ODS"))).bumpEntityKey(i,j,"route_timeout");d("MAWWorkerEvent").logTimeout(c)}function f(){o("_before_unresponsive"),m.fill(null)}g.CAT_ID=i;g.ENT=j;g.HEARTBEAT_ROUTE=k;g.RECENT_ROUTES_NUM=l;g.routeStart=a;g.logRecentRoutes=o;g.routeSuccess=b;g.routeFail=c;g.routeTimeout=e;g.logRecentBridgeEvents=f}),98);
__d("MAWODSProxy",["CurrentMessengerUser","ODS","WABridge","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h,i=!((b=c("gkx")("23949"))!=null?b:!1);function a(a,b){var c=a.amount,e=a.entity;a=a.key;b===void 0&&(b=!0);i?(h||(h=d("ODS"))).bumpEntityKey(3185,e,a+"."+(d("CurrentMessengerUser").getAppID()||"unknown"),c):d("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{amount:c,entity:e,key:a},b)}g.odsBumpEntityKey=a}),98);
__d("WAOdsEnums",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum")({WA_CONNECTIVITY:"wa_connectivity",GET_DEVICES:"armadillo_get_devices",DECRYPTION:"armadillo_msg_decryption",DEVICE_REREG_CHECK:"armadillo_device_rereg_check",DEVICE_REGISTRATION:"armadillo_device_registration",DEVICE_REGISTRATION_NON_EMPLOYEE:"armadillo_device_registration_non_employee",PHASH_MISMATCH:"phash_mismatch",WEB_PLACEHOLDER:"armadillo_web_placeholder",PREKEY_UPLOAD:"armadillo_prekey_upload",PREKEY_DIGEST:"armadillo_prekey_digest",C2C_META_SYNC:"armadillo_c2c_meta_sync",ADMIN_MESSAGE:"armadillo_admin_message",PREVIEW_SNIPPET:"armadillo_snippet",TOTAL_INCOMING_MESSAGE:"armadillo_total_incoming_message",COMPARE_IDENTITY:"armadillo_compare_identity",GET_PREKEY:"armadillo_get_prekey",SECURITY_ALERT_FOR_CONTACT:"armadillo_security_alert_for_contact",SECURITY_ALERT_FOR_SELF:"armadillo_security_alert_for_self",MSG_SEND:"armadillo_message_send",RETRY_MISSING_MSG:"armadillo_retry_missing_msg",REGISTRATION_TYPE:"aramdillo_registration_type",CLOCK_SKEW_UPDATE:"clock_skew_update",STREAM_ERROR:"wajs_stream_error",ICDC:"wajs_icdc",LOAD_MORE_NO_ORIGINAL_MSG_IN_MAW:"load_more_no_original_msg_in_maw",POISON_QUEUE_ENTTITY:"armadillo_poison_queue_entity",PQ_MIGRATION:"wajs_pq_migration",WORM:"wajs_worm",CAT_ROTATION:"cat_rotation",EB_RESTORE:"eb_restore",WA_DISCONNECT:"armadillo_disconnect",GROUP_CREATE:"armadillo_group_create",GROUP_DELETE:"armadillo_group_delete",GROUP_ADD_PARTICIPANT:"armadillo_group_add_participant",GROUP_PROMOTE_PARTICIPANT:"armadillo_group_promote_participant",GROUP_DEMOTE_PARTICIPANT:"armadillo_group_demote_participant",GROUP_REMOVE_PARTICIPANT:"armadillo_group_remove_participant",GROUP_LEAVE_PARTICIPANT:"armadillo_group_leave_participant",GROUP_SKS_INVALID:"armadillo_group_sks_invalid",SEND_READ_RECEIPTS:"armadillo_send_read_receipts",MESSAGE_MISSING_THREAD_JID:"MESSAGE_MISSING_THREAD_JID",MESSAGE_MISSING:"MESSAGE_MISSING",MAW_NON_TIMEOUT:"maw_non_timeout",MAW_TIMEOUT:"maw_timeout",WA_FAIL_STANZA_QUEUE_ITEM:"wa_fail_stanza_queue_item",WA_QUERY_GROUP:"wa_query_group",MAW_MISMATCH_PARTICIPANT:"maw_mismatch_participant",MAW_ONE_TO_ONE_THREAD_PARTICIPANT_CLEANUP:"maw_one_to_one_thread_participant_cleanup",MAW_THREADID_DEPRECATION:"maw_threadid_deprecation",MAW_THREADID_DEPRECATION_DETAILS:"maw_threadid_deprecation_details",MAW_DELETE_DANGLING_PARTICIPANTS:"maw_delete_dangling_participants",S2S_QPL_MISSING_INSTANCE_KEY:"s2s_qpl_missing_instance_key",MAW_DEPRECATED_REDIRECT:"maw_deprecated_redirect",MAW_MUTATION_VALIDATOR:"maw_mutation_validator",MAW_THREAD_UPDATE_MIDDLEWARE:"maw_thread_update_middleware",MAW_MY_USER_JID_GETTER:"maw_my_user_jid_getter",WA_NO_SIGNED_PRE_KEY:"wa_no_signed_pre_key",WA_LONG_SESSION_DROP:"wa_long_session_drop",MAW_SEND_REACTION:"maw_send_reaction",MAW_MIGRATE_REACTION_TS_AS_INDEX:"maw_migrate_reaction_ts_as_index",MAW_XMA_PROTOCOL_PARSING:"maw_xma_protocol_parsing",IGDW_INSTAMADILLO_MESSAGE_ON_OLD_WORKER:"igdw_new_msg_old_worker",WORKER_SCHEDULER_STUCK:"worker_scheduler_stuck"});f.Entity=a}),66);
__d("WACustomError",[],(function(a,b,c,d,e,f){"use strict";var g=Object.create(Error.prototype,{constructor:{value:void 0,writable:!0,configurable:!0}});function a(a,b,c){b===void 0&&(b=!0);function d(c){var d=Error.call(this,c);this.message=c;d.name=a;this.name=a;b&&(this.stack=d.stack)}d.prototype=Object.create(c?c.prototype:g);d.prototype.constructor=d;return d}function h(a){if(a.length===0)return"No errors";return a.length===1?a[0].message:a.map(function(a){return"- "+a.message}).join("\n")}e=function(a){babelHelpers.inheritsLoose(b,a);function b(b,c){c=c!=null&&c.length>0?c:h(b);c=a.call(this,c)||this;c.errors=b;return c}return b}(a("AggregateError",!0));var i=function(b){babelHelpers.inheritsLoose(a,b);function a(){return b.apply(this,arguments)||this}return a}(a("TimeoutError",!1)),j=function(b){babelHelpers.inheritsLoose(a,b);function a(a,c){a=b.call(this,a)||this;a.code=c;return a}return a}(a("HttpError",!1)),k=function(b){babelHelpers.inheritsLoose(a,b);function a(){return b.apply(this,arguments)||this}return a}(a("UnimplementedMethod")),l=!1;function b(a){if(a==null||a.name!=="QuotaExceededError")throw a;l=!0}function c(){return l}function d(a){return JSON.stringify(a,Object.getOwnPropertyNames(a))}var m=function(b){babelHelpers.inheritsLoose(a,b);function a(a,c){a=b.call(this,a)||this;a.inner=c;return a}return a}(babelHelpers.wrapNativeSuper(Error));f.customError=a;f.AggregateError=e;f.TimeoutError=i;f.HttpError=j;f.UnimplementedMethod=k;f.supressQuotaExceededError=b;f.hasSupressedQuotaExceededError=c;f.obtainErrorSummary=d;f.WrappedError=m}),66);
__d("WAAbortError",["WACustomError"],(function(a,b,c,d,e,f,g){"use strict";b=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}return b}(d("WACustomError").customError("AbortError"));var h="AbortError";function a(a){return function(b){if(b.name===h)return a(b);else throw b}}g.AbortError=b;g.ABORT_ERROR=h;g.catchAbort=a}),98);
__d("WAPromiseDelays",["Promise","WAAbortError"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,c){return new(h||(h=b("Promise")))(function(b,e){if(c==null?void 0:c.aborted)throw new(d("WAAbortError").AbortError)();var f=setTimeout(g,a);c==null?void 0:c.addEventListener("abort",h);function g(){c==null?void 0:c.removeEventListener("abort",h),b()}function h(){c==null?void 0:c.removeEventListener("abort",h),clearTimeout(f),e(new(d("WAAbortError").AbortError)())}})}function c(a,c,d){return new(h||(h=b("Promise")))(function(b,e){var f=setTimeout(function(){try{b(d())}catch(a){e(a)}},c);a.then(function(a){clearTimeout(f),b(a)},function(a){clearTimeout(f),e(a)})})}g.delayMs=a;g.withTimeout=c}),98);
__d("MAWMaybeWithTimeout",["MAWODSProxy","WAOdsEnums","WAPromiseDelays"],(function(a,b,c,d,e,f,g){"use strict";function h(){return!0}function a(a,b,c,e){return h()?d("WAPromiseDelays").withTimeout(a.then(function(a){var b;d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_NON_TIMEOUT,key:(b=e)!=null?b:"unknown"});return a}),b,function(){var a;d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_TIMEOUT,key:(a=e)!=null?a:"unknown"});return c()}):a}g.maybeWithTimeout=a}),98);
__d("MAWTimedBridge",["FBLogger","MAWBridgeLoggingUtils","MAWMaybeWithTimeout","MAWWaitForBackendSetup","MAWWebWorkerInstance"],(function(a,b,c,d,e,f,g){"use strict";var h=6e4;function a(a,b,e,f,g){g===void 0&&(g=h);var i=!1;return d("MAWMaybeWithTimeout").maybeWithTimeout(d("MAWWaitForBackendSetup").waitForBackendSetup(e).then(function(){i=!0;return a()}),g,function(){var a=d("MAWWebWorkerInstance").doesWorkerExist();d("MAWBridgeLoggingUtils").routeTimeout(b,e,f);throw c("FBLogger")("messenger_e2ee_web").mustfixThrow("Failed to complete bridge route %s in time. Backend setup: %s, workerExists: %s",e,i,a)},e)}g.bridgeTimeout=a}),98);
__d("MAWBridgeSendAndReceive",["MAWBridge","MAWBridgeLoggingUtils","MAWTimedBridge"],(function(a,b,c,d,e,f,g){"use strict";var h=0;function a(a,b,c,e){var f=d("MAWTimedBridge").bridgeTimeout(function(){var f=(e==null?void 0:e.isLoggingDisabled)!==!0;f&&d("MAWBridgeLoggingUtils").routeStart(a,b,h);return d("MAWBridge").getBridge().sendAndReceive(a,b,c,e==null?void 0:e.isLoggingDisabled).then(function(c){f&&d("MAWBridgeLoggingUtils").routeSuccess(a,b,h);return c})["catch"](function(c){f&&d("MAWBridgeLoggingUtils").routeFail(a,b,c.message,h);throw c})},a,b,h,e==null?void 0:e.timeoutMs);h++;return f}g.sendAndReceive=a}),98);
__d("WAAssertUnreachable",["WAErr"],(function(a,b,c,d,e,f,g){"use strict";function a(a){throw c("WAErr")("Impossible value, the default statement should never be reached for value: "+a)}g["default"]=a}),98);
__d("WAJids",["WAAssertUnreachable","WAErr"],(function(a,b,c,d,e,f,g){"use strict";var h=0,i="@me",j="@system",k="status@broadcast",aa="0@s.whatsapp.net",l="@g.us",m=/^([1-9][0-9]{0,19}|(?!10)[1-9][0-9]{4,19}-[1-9][0-9]{9})@g.us$/,ba="@call",n="@msgr",ca="msgr",o="@interop",da="interop",p=/^([1-9][0-9]{0,2}-[1-9][0-9]{0,14}(:[0])?)@interop$/,q=/^([1-9][0-9]{0,2}-[1-9][0-9]{0,14}(:[0])?)@interop$/,r=/^([1-9][0-9]{0,19}(:[1-9][0-9]{0,2})?)@msgr$/,s=/^([1-9][0-9]{0,19})@msgr$/,t=/^([1-9][0-9]{0,19})(:0)?@msgr$/,ea="@s.whatsapp.net",fa="s.whatsapp.net",u="@s.whatsapp.net",v="s.whatsapp.net",w="lid",x="@newsletter",y=/^([1-9][0-9]{0,19})@newsletter$/,z=/^(0|((?!10)[1-9][0-9]{4,19}(\.[0-9]{1,2})?(:[0-9]{1,2})))@s.whatsapp.net$/,A=/^(0|((?!10)[1-9][0-9]{4,19})(\.[0-9]{1,2})?)@s.whatsapp.net$/,B="@lid",ga="lid",C=/^([1-9][0-9]{0,14})@lid$/,D=/^([1-9][0-9]{0,14}(:[0-9]{1,2})?)@lid$/,ha="@broadcast",E=/^(status|location|[1-9][0-9]{0,19})@broadcast$/,F=/^([0-9a-fA-F]{18,32})@call$/,G="@hosted",H="hosted",I=/^(((?!10)[1-9][0-9]{4,19})):99@hosted$/,J="@hosted.lid",K="hosted.lid",L=/^([1-9][0-9]{0,14}):99@hosted.lid$/,M="@bot",ia=/^[1-9][0-9]{0,19}(:0)?@bot$/,ja="16505361212"+u,ka=/([0-9a-zA-Z-:]+)@(g\.us|call|s\.whatsapp\.net|broadcast|msgr|lid)/g;function a(a){return""+a+u}function b(a){return""+a+B}function N(a){return""+a+n}function d(a){return a.endsWith(l)?a:""+a+l}function e(a){return a.endsWith(x)?a:""+a+x}function f(a){return a.endsWith(G)?a:""+a+G}function la(a){return a.endsWith(J)?a:""+a+J}function ma(){return l}function O(a){if(a.endsWith(u))return a.slice(0,-u.length);else if(a.endsWith(n))return a.slice(0,-n.length);else if(a.endsWith(o))return a.slice(0,-o.length);else if(a.endsWith(B))return a.slice(0,-B.length);else if(a.endsWith(M))return a.slice(0,-M.length);else throw c("WAErr")('userIdFromJid called with non-user jid "'+a+'"')}function na(a,b){return Y(O(a)+":"+b+u)}function oa(a,b){return Z(O(a)+":"+b+n)}function pa(a,b){return xb(P(a)+":"+b+B)}function qa(a,b){return X(O(a)+":"+b+W(a))}function ra(a){return""+a+ha}function sa(a){return a.split("@")[0]}function ta(a){a=a.split("@")[0];a=a.split(":");var b=a[0];a=a[1];a=parseInt(a,10);return{userId:b,deviceID:a}}function ua(a){a=ta(a);return a.deviceID}function va(a,b){if(a===i||a===j)return b;else return sa(a)}function wa(a){return a===i||a===j?null:a}function xa(a){if(a===i||a===j)return null;return!a.endsWith(u)?null:a}function ya(a){if(!a.endsWith(u))throw c("WAErr")('phoneNumberFromJid called with non-user jid "'+a+'"');return a.slice(0,-u.length)}function za(a){if(a.endsWith(u))return ya(a);else if(a.endsWith(B))return P(a);throw c("WAErr")('lidOrPhoneFromUserJid called with non phone or lid jid "'+a+'"')}function Aa(a){return a.endsWith(u)||a.endsWith(o)||a.endsWith(n)||a.endsWith(B)?a:null}function Ba(a){return a.endsWith(u)?a:null}function Ca(a){return a===k?null:$(a)}function Da(a){return a===k?null:$(a)}function Ea(a){return a===k?k:null}function P(a){if(!a.endsWith(B))throw c("WAErr")('lidFromLidUserJid called with non-LidUserJid "'+a+'"');return a.slice(0,-B.length)}function Q(a){a=a.split("@");var b=a[0];a=a[1];b=b.split(":")[0];b=b.split(".")[0];a===H&&(a=v);a===K&&(a=w);return yb(b+"@"+a)}function Fa(a){return Q(a)}function Ga(a){return Q(a)}function Ha(a){if(a.jidType==="phoneDevice")return a.deviceJid;else if(a.jidType==="interopDevice")return a.deviceJid;else if(a.jidType==="lidDevice")return a.deviceJid;else if(a.jidType==="msgrDevice")return a.deviceJid;else if(a.jidType==="lidUser")return a.userJid;else if(a.jidType==="interopUser")return a.userJid;else if(a.jidType==="msgrUser")return a.userJid;else if(a.jidType==="phoneUser")return a.userJid;else if(a.jidType==="group")return a.groupJid;else if(a.jidType==="status")return a.statusJid;else if(a.jidType==="call")return a.callJid;else if(a.jidType==="newsletter")return a.newsletterJid;else if(a.jidType==="hosted")return a.hostedDeviceJid;else if(a.jidType==="hostedLid")return a.hostedLidDeviceJid;else if(a.jidType==="bot")return a.userJid;else{a.jidType;return a.broadcastJid}}function Ia(a){return Y(O(a)+":"+h+u)}function Ja(a){return Z(O(a)+":"+h+n)}function Ka(a){return pa(a,h)}function La(a){return ua(a)===h}function Ma(a){return Cb(a)}function Na(a){return a}function R(a){a=a.split("@");var b=a[0];a=a[1];b=b.split(":");var c=b[0];b=b[1];c=c.split(".");var d=c[0];c=c[1];return{user:d,device:b,agent:c,server:a}}function Oa(a){a=R(a);var b=a.user,c=a.agent;c=c===void 0?"0":c;var d=a.device;d=d===void 0?"0":d;a=a.server;return b+"."+c+":"+d+"@"+a}function Pa(a){switch(a.jidType){case"interopUser":return a.userJid;case"lidUser":return a.userJid;case"msgrUser":return a.userJid;case"phoneUser":return a.userJid;case"group":return a.groupJid;case"status":return a.statusJid;case"interopDevice":return a.deviceJid;case"lidDevice":return a.deviceJid;case"msgrDevice":return a.deviceJid;case"phoneDevice":return a.deviceJid;case"broadcast":return a.broadcastJid;case"call":return a.callJid;case"newsletter":return a.newsletterJid;case"hosted":return a.hostedDeviceJid;case"hostedLid":return a.hostedLidDeviceJid;case"bot":return a.userJid;default:return c("WAAssertUnreachable")(a.jidType)}}function Qa(a){if(a===k)return{jidType:"status",statusJid:k};else if(A.test(a))return{jidType:"phoneUser",userJid:zb(a)};else if(q.test(a))return{jidType:"interopUser",userJid:Ab(a)};else if(s.test(a))return{jidType:"msgrUser",userJid:Bb(a)};else if(t.test(a)){var b=a.substr(0,a.indexOf(":"));return{jidType:"msgrUser",userJid:N(b)}}else if(z.test(a))return{jidType:"phoneDevice",deviceJid:Y(a)};else if(p.test(a))return{jidType:"interopDevice",deviceJid:wb(a)};else if(r.test(a))return{jidType:"msgrDevice",deviceJid:Z(a)};else if(m.test(a))return{jidType:"group",groupJid:a.endsWith(l)?a:""+a+l};else if(E.test(a))return{jidType:"broadcast",broadcastJid:a};else if(F.test(a))return{jidType:"call",callJid:a};else if(C.test(a))return{jidType:"lidUser",userJid:a};else if(D.test(a))return{jidType:"lidDevice",deviceJid:a};else if(y.test(a))return{jidType:"newsletter",newsletterJid:a};else if(I.test(a))return{jidType:"hosted",hostedDeviceJid:a};else if(L.test(a))return{jidType:"hostedLid",hostedLidDeviceJid:a};else if(ia.test(a))return{jidType:"bot",userJid:a};else return{jidType:"unknown"}}function Ra(a){return a==="status@broadcast"?a:null}function Sa(a){if(A.test(a)||q.test(a)||s.test(a)||C.test(a))return a;else if(t.test(a)){a=a.substr(0,a.indexOf(":"));return N(a)}else return null}function Ta(a){return E.test(a)?a:null}function Ua(a){if(z.test(a)||r.test(a)||p.test(a)||D.test(a)||I.test(a)||L.test(a))return a;if(A.test(a))return sb(a);return ia.test(a)?tb(a):null}function Va(a){return p.test(a)?a:null}function S(a){return m.test(a)?a:null}function Wa(a){return Ra(a)||S(a)||Ta(a)?a:null}function Xa(a){return F.test(a)?a:null}function Ya(a){return a==="s.whatsapp.net"||a==="g.us"||a==="call"?a:null}function Za(a){return Sa(a)||S(a)}function $a(a){return y.test(a)?a:null}function ab(a){return I.test(a)?a:null}function bb(a){return L.test(a)?a:null}function cb(a){return Aa(a)==null?$(a):null}function db(a){a=R(a);var b=a.user,c=a.device;c=c===void 0?"0":c;a=a.server;return Y(b+":"+c+"@"+a)}function eb(a){if(a.endsWith(l))return a.slice(0,-l.length);else throw c("WAErr")('groupId called with non-group jid "'+a+'"')}function fb(a){var b=Qa(a);if(b.jidType==="unknown")return a;if(b.jidType==="status")return b.statusJid;b.jidType;return Pa(b).replace(/^([^@]*)([^@][^@][^@][^@])@(.*)$/,"...$2@$3")}function gb(a){return!a.includes("@")?a:a.replace(ka,fb)}function T(a){if(a.endsWith(l))return $(a);else return null}function U(a,b){if(a.endsWith(u))return b.phoneUser(a);else if(a.endsWith(n))return b.msgrUser(a);else if(a.endsWith(o))return b.interopUser(a);else if(a.endsWith(B))return b.lidUser(a);else if(T(a)!=null)return b.group($(a));throw c("WAErr")("Can not switch on chat jid "+a)}function hb(a,b){if(a.endsWith(n))return b.user(a);else if(T(a)!=null)return b.group(a);throw c("WAErr")("Can not switch on chat jid "+a)}function V(a,b){if(a.endsWith(u))return b.user(a);else if(T(a)!=null)return b.group(a);throw c("WAErr")("Can not switch on chat jid "+a)}function ib(a,b){return U(a,{lidUser:function(a){return b.user(a)},interopUser:function(a){return b.user(a)},msgrUser:function(a){return b.user(a)},phoneUser:function(a){return b.user(a)},group:function(a){return b.group(a)}})}function jb(a,b){return a===k?b.status():V(a,{user:b.user,group:b.group})}function kb(a,b){return a===k?b.status():U(a,{interopUser:b.interopUser,phoneUser:b.phoneUser,msgrUser:b.msgrUser,lidUser:b.lidUser,group:b.group})}function lb(a,b){return a===k?b.multicast(k):V(a,{user:b.user,group:b.multicast})}function mb(a){return a.endsWith(B)}function nb(a){return a==="@me"}function ob(a){return a==="@system"}function pb(){return n}function qb(){return u}function rb(){return ea}function W(a){if(a.endsWith(u))return u;else if(a.endsWith(n))return n;else if(a.endsWith(B))return B;else if(a.endsWith(M))return M;else throw c("WAErr")('userDomainFromJid called with non-user jid "'+a+'"')}function sb(a){return X(O(a)+":"+h+W(a))}function tb(a){return X(""+O(a)+W(a))}function ub(a){a=a.platform;var b=a==="msgr"?n:u;function c(a){return""+a+b}function d(){return b}return{toUserJid:c,getUserDomain:d}}function vb(a){return a}function X(a){return a}function Y(a){return a}function Z(a){return a}function wb(a){return a}function xb(a){return a}function yb(a){return a}function zb(a){return a}function Ab(a){return a}function Bb(a){return a}function $(a){return a}function Cb(a){return a}function Db(a){return a}function Eb(a){return a}function Fb(a){return a}function Gb(a){return U(a,{group:function(a){return eb(a)},lidUser:function(a){return O(a)},interopUser:function(a){return O(a)},phoneUser:function(a){return O(a)},msgrUser:function(a){return O(a)}})}function Hb(){return ba}g.DEFAULT_DEVICE_ID=h;g.AUTHOR_ME=i;g.AUTHOR_SYSTEM=j;g.STATUS_JID=k;g.PSA_JID=aa;g.MSGR_USER_DOMAIN=n;g.MSGR_USER_JID_SUFFIX=ca;g.INTEROP_DOMAIN=o;g.INTEROP_USER_JID_SUFFIX=da;g.WA_SERVER_JID_SUFFIX=fa;g.WA_USER_DOMAIN=u;g.WA_USER_JID_SUFFIX=v;g.WA_LID_SUFFIX=w;g.WA_NEWSLETTER_JID_DOMAIN=x;g.LID_DOMAIN=B;g.LID_SUFFIX=ga;g.HOSTED_DOMAIN=G;g.HOSTED_SUFFIX=H;g.HOSTED_LID_DOMAIN=J;g.HOSTED_LID_SUFFIX=K;g.BOT_DOMAIN=M;g.SURVEY_USER_JID=ja;g.toPhoneUserJid=a;g.toLidUserJid=b;g.toMsgrUserJid=N;g.toGroupJid=d;g.toNewsletterJid=e;g.toHostedDeviceJid=f;g.toHostedLidDeviceJid=la;g.getGroupDomain=ma;g.userIdFromJid=O;g.toPhoneDeviceJid=na;g.toMsgrDeviceJid=oa;g.toLidDeviceJid=pa;g.toDeviceJid=qa;g.toBroadcastJid=ra;g.extractUserId=sa;g.extractDeviceIDParts=ta;g.extractDeviceId=ua;g.authorToUserId=va;g.authorAsUserJid=wa;g.authorAsPhoneUserJid=xa;g.phoneNumberFromJid=ya;g.lidOrPhoneFromUserJid=za;g.interpretAsUserJid=Aa;g.interpretAsPhoneUserJid=Ba;g.asChatJid=Ca;g.asPhoneChatJid=Da;g.asStatusJid=Ea;g.lidFromLidUserJid=P;g.extractUserJid=Q;g.extractPhoneUserJid=Fa;g.extractLidUserJid=Ga;g.extractJidFromJidWithType=Ha;g.defaultPhoneDeviceJidForUser=Ia;g.defaultMsgrDeviceJidForUser=Ja;g.defaultLidDeviceJidForLidUserJid=Ka;g.isPrimaryDevice=La;g.interpretAsDeviceId=Ma;g.interpretAsNumber=Na;g.parseJidParts=R;g.fullFormDeviceJidString=Oa;g.extractFromJid=Pa;g.interpretAndValidateJid=Qa;g.validateStatusJid=Ra;g.validateUserJid=Sa;g.validateBroadcastJid=Ta;g.validateDeviceJid=Ua;g.validateInteropDeviceJid=Va;g.validateGroupJid=S;g.validateMulticastJid=Wa;g.validateCallJid=Xa;g.validateDomainJid=Ya;g.validateChatJid=Za;g.validateNewsletterJid=$a;g.validateHostedDeviceJid=ab;g.validateHostedLidDeviceJid=bb;g.asMulticastJid=cb;g.stripAgentIdFromPhoneDeviceJid=db;g.groupIdFromJid=eb;g.sanitizeJidForLogging=fb;g.maybeSanitizeLogLineText=gb;g.interpretAsGroupJid=T;g.switchOnChatJidType=U;g.switchOnMsgrChatJidType=hb;g.switchOnPhoneChatJidType=V;g.switchOnUserChatJidType=ib;g.switchOnPhoneJidType=jb;g.switchOnJidType=kb;g.switchOnMulticastJidType=lb;g.isLidUser=mb;g.isAuthorMe=nb;g.isAuthorSystem=ob;g.getMsgrUserDomain=pb;g.getWhatsappUserDomain=qb;g.getServerDomain=rb;g.defaultDeviceJidForUser=sb;g.defaultDeviceJidForBot=tb;g.createJidUtils=ub;g.unsafeCoerceToChatJid=vb;g.unsafeCoerceToDeviceJid=X;g.unsafeCoerceToPhoneDeviceJid=Y;g.unsafeCoerceToMsgrDeviceJid=Z;g.unsafeCoerceToInteropDeviceJid=wb;g.unsafeCoerceToLidDeviceJid=xb;g.unsafeCoerceToUserJid=yb;g.unsafeCoerceToPhoneUserJid=zb;g.unsafeCoerceToInteropUserJid=Ab;g.unsafeCoerceToMsgrUserJid=Bb;g.unsafeCoerceToGroupJid=$;g.unsafeCoerceToDeviceId=Cb;g.unsafeCoerceToNewsletterJid=Db;g.unsafeCoerceToHostedDeviceJid=Eb;g.unsafeCoerceToHostedLidDeviceJid=Fb;g.threadIdForChatJid=Gb;g.getGroupCallDomain=Hb}),98);
__d("MAWJids",["WAJids"],(function(a,b,c,d,e,f,g){"use strict";a=d("WAJids").createJidUtils({platform:"msgr"});b=a.toUserJid;g.jidUtils=a;g.toUserJid=b}),98);
__d("MAWChatJid",["FBLogger","I64","MAWJids","Promise","ReQL","WAJids"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(a){a=d("WAJids").threadIdForChatJid(a);return(i||(i=d("I64"))).of_string(a)}function k(a,e){try{return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.mi_act_mapping_table.index("jid")).getKeyRange(j(e))).then(function(a){return a==null?void 0:a.serverThreadKey})}catch(a){c("FBLogger")("messenger_e2ee_web").catching(a).warn("Invalid chatJid: "+e);return(h||(h=b("Promise"))).reject(a)}}function a(a,b,d){return k(a,b).then(function(a){if(a!=null)return a;throw c("FBLogger")("messenger_e2ee_web").mustfixThrow("[toThreadKey] No mapping record for chatJid, source: %s",d)})}function e(a,e){try{return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.mi_act_mapping_table.index("jid")).getKeyRange(e)).then(function(a){return a==null?void 0:a.serverThreadKey})}catch(a){c("FBLogger")("messenger_e2ee_web").catching(a).warn("Invalid integer jid: "+(i||(i=d("I64"))).to_string(e));return(h||(h=b("Promise"))).reject(a)}}function l(a,e){return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.mi_act_mapping_table.index("fk_threads")).getKeyRange(e)).then(function(a){return a==null?void 0:a.jid})["catch"](function(a){c("FBLogger")("messenger_e2ee_web").catching(a).warn("Invalid threadKey: "+(i||(i=d("I64"))).to_string(e));return(h||(h=b("Promise"))).reject(a)})}function f(a,b){return l(a,b).then(function(a){if(a!=null)return d("MAWJids").toUserJid((i||(i=d("I64"))).to_string(a));throw c("FBLogger")("messenger_e2ee_web").mustfixThrow("[toChatJid] No mapping record for threadKey")})}g.toIntegerJid=j;g.toThreadKeyMaybe=k;g.toThreadKey=a;g.toThreadKeyMaybeForChatJidInteger=e;g.fromThreadKeyToChatJid=l;g.toChatJid=f}),98);
__d("MAWCryptoConsts",[],(function(a,b,c,d,e,f){a=60*60;b=24*a;c=32;d=new Uint8Array(0).buffer;e=128;a=256;var g=12,h=1,i=2,j=2;b=b*30*6;var k=3,l="AES-GCM",m="HKDF",n="SHA-256";f.HKDF_SEED_LENGTH_IN_BYTES=c;f.HKDF_INFO=d;f.AES_GCM_TAG_LENGTH=e;f.AES_GCM_KEY_LENGTH=a;f.AES_GCM_IV_LENGTH_IN_BYTES=g;f.VERSION=h;f.CIPHER_ID=i;f.ADDITIONAL_DATA_LENGTH_IN_BYTES=j;f.ENC_KEY_TTL=b;f.MAX_KEYCHAIN_SETUP_RETRIES=k;f.AES_GCM=l;f.HKDF=m;f.SHA256=n}),66);
__d("MAWIndexedDbMetadata",[],(function(a,b,c,d,e,f){"use strict";var g="v1",h="v1",i="v1",j="v1",k="v1",l="v1",m="messenger_web_"+g,n="messenger_web_v3",o="messenger_web_encryption_"+h,p="messenger_web_signal_"+i,q="messenger_web_signal_v3",r="messenger_web_log_"+j,s="messenger_web_eb_lsdb_"+k,t="messenger_web_fts_"+l;function a(a){return m+"_"+a}function b(a){return t+"_"+a}function c(a){return n+"_"+a}function d(a){return o+"_"+a}function e(a){return p+"_"+a}function u(a){return q+"_"+a}function v(a){return r+"_"+a}function w(a){return s+"_"+a}f.dbName=a;f.ftsDbName=b;f.restoreDbName2=c;f.encryptionDbName=d;f.jobsDbName=e;f.signalWorm=u;f.logDbName=v;f.ebLSDBName=w}),66);
__d("MWEBODSCategory",[],(function(a,b,c,d,e,f){"use strict";a=7319;f["default"]=a}),66);
__d("MWEBODSEntityKey.enum",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum")({START:"start",SUCCESS:"success",FAIL:"fail",INCORRECT_PIN_CODE:"incorrect_pin_code",INCORRECT_RECOVERY_CODE:"incorrect_recovery_code"});c=a;f["default"]=c}),66);
__d("MWEBODSEntityName.enum",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum")({MW_EB_PIN_RESTORE_AUTH:"mw_eb_pin_restore_auth",MW_EB_RC_RESTORE_AUTH:"mw_eb_rc_restore_auth",MW_EB_AUTO_RESTORE_AUTH:"mw_eb_auto_restore_auth",MW_EB_OTC_AUTH:"mw_eb_otc_auth",MW_EB_ONBOARDING_AUTH:"mw_eb_onboarding_auth",MW_EBSM_HYDRATION:"mw_ebsm_hydration",MW_EBSM_IDB:"mw_eb_ebsm_idb",MAW_EB_UPLOAD_TRACKING:"maw_eb_upload_tracking",MAW_EB_UPLOAD_COUNTER:"maw_eb_upload_counter",MAW_EB_RESTORE_COUNTER:"maw_eb_restore_counter",MAW_EB_RESTORE_QUEUE:"maw_eb_restore_queue"});c=a;f["default"]=c}),66);
__d("MAWEncryptedBackupsPersistedDB",["EBSMGating","EBSMProperties","FBLogger","LSMetadata","MAWCurrentUser","MAWIndexedDBDeletion","MAWIndexedDbMetadata","MWEBODSCategory","MWEBODSEntityKey.enum","MWEBODSEntityName.enum","ODS","Promise","QPLUserFlow","WALoggerDeferred","err","gkx","justknobx","qex","qpl","recoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] EB state DB upgrade needed"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] EBSM upgrade failed: ",". Falling back to ephemeral LSDB"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] EB state DB onVersionChange: closing the db"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] EB state DB initialization successsful"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] EB state DB initialization: db blocked"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] EB state DB initialization failed"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Initializing EB state DB"]);p=function(){return a};return a}var q=null,r=c("justknobx")._("2243");function a(){if(q==null)throw c("err")("EB state IndexedDB should've been initialized");return q}var s=(i||(i=b("Promise"))).resolve();function e(){return s}function f(a){a===void 0&&(a=!1);return!a&&!d("EBSMGating").isPersistedEBTableEnabled()?(i||(i=b("Promise"))).resolve():(i||(i=b("Promise"))).resolve().then(function(){if(q==null){c("QPLUserFlow").start(c("qpl")._(521471732,"1454"));(h||(h=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MW_EBSM_IDB,c("MWEBODSEntityKey.enum").START);void d("WALoggerDeferred").LOG(p());var a=indexedDB.open(d("MAWIndexedDbMetadata").ebLSDBName(d("MAWCurrentUser").getID()),c("EBSMProperties").dbVersion);return new(i||(i=b("Promise")))(function(e,f){a.onerror=function(a){c("QPLUserFlow").endFailure(c("qpl")._(521471732,"1454"),"EB state idb initialization failed"),void d("WALoggerDeferred").ERROR(o()),c("QPLUserFlow").endFailure(c("qpl")._(521477507,"1406"),"Initialisation failed. Reached onerror."),c("FBLogger")("labyrinth_web").catching(a).mustfix("[labyrinth_web] EBSM idb init failed: %s",a),(h||(h=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MW_EBSM_IDB,c("MWEBODSEntityKey.enum").FAIL),f(a)},a.onblocked=function(){void d("WALoggerDeferred").LOG(n()),(h||(h=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MW_EBSM_IDB,"blocked")},a.onsuccess=function(a){var b=a.target.result;void d("WALoggerDeferred").LOG(m());b.onversionchange=function(){void d("WALoggerDeferred").LOG(l()),b.close()};q=b;return s.then(function(){c("QPLUserFlow").endSuccess(c("qpl")._(521471732,"1454")),(h||(h=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MW_EBSM_IDB,c("MWEBODSEntityKey.enum").SUCCESS),e(b)})["catch"](function(a){void d("WALoggerDeferred").ERROR(k(),a.message),c("QPLUserFlow").endFailure(c("qpl")._(521471732,"1454"),"EB state idb upgrade failed"),(h||(h=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MW_EBSM_IDB,"upgrade.fail"),h.bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MW_EBSM_IDB,c("MWEBODSEntityKey.enum").FAIL),e(null)})},a.onupgradeneeded=function(a){var e=a.target.result;a=new(i||(i=b("Promise")))(function(a,b){setTimeout(function(){b(c("err")("EBSM upgrade timeout"))},r)});var f=new i(function(a){c("QPLUserFlow").addPoint(c("qpl")._(521471732,"1454"),"eb_state_idb_upgrade_start",{data:{bool:{eb_state_upgrade:!0}}});void d("WALoggerDeferred").LOG(j());var b=Object.keys(d("LSMetadata").schema.tableNames);for(var f=0;f<b.length;f++){var g=b[f];c("EBSMProperties").persistedTables.has(g)&&!e.objectStoreNames.contains(g)&&e.createObjectStore(g,{autoIncrement:!0})}c("QPLUserFlow").addPoint(c("qpl")._(521471732,"1454"),"eb_state_idb_upgrade_end",{data:{bool:{eb_state_upgrade:!0}}});a()});s=i.race([f,a])}})}else return q})}function t(a){a=a.hasUserGivenAutoRestoreConsent;var b=a?["secure_encrypted_backups_epochs","secure_encrypted_backups_client_state"]:[];c("qex")._("926")&&b.push("occamadillo_most_recent_message_per_thread");c("gkx")("5229")&&b.push("auto_restore_opt_out");a=Array.from(c("EBSMProperties").persistedTables).filter(function(a){return!b.includes(a)});try{if(q!=null){var d=q.transaction(a,"readwrite");a.forEach(function(a){a=d.objectStore(a);a.clear()});d.oncomplete=function(){d.db.close()}}}catch(a){c("recoverableViolation")(a,"labyrinth_web")}}function u(){var a=d("MAWIndexedDbMetadata").ebLSDBName(d("MAWCurrentUser").getID());return d("MAWIndexedDBDeletion").deleteDB(a,"ebsm")}function v(a){if(q!=null){var c=q.transaction([a],"readwrite");a=c.objectStore(a);a.clear();c.oncomplete=function(){c.db.close()}}return(i||(i=b("Promise"))).resolve()}g.getEBLSDB=a;g.isDBBeingUpgraded=e;g.makeEBIDB=f;g.clearEBIDBNonPersistedRows=t;g.deleteEBIDB=u;g.clearEBSMTable=v}),98);
__d("MAWLowLevelApiTypes",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a={EXISTING_GROUP_INVITE:"existing_group_invite",MISSING_GROUP:"missing_group"};c={EXPIRED_GROUP_INVITE:"expired_group_invite",MISSING_GROUP:"missing_group",MISSING_GROUP_INVITE:"missing_group_invite"};d=b("$InternalEnum")({Initializing:"initializing",Open:"open",Closed:"closed",Error:"error",Upgrading:"upgrading"});f.WRITE_GROUP_INVITE_ERROR=a;f.GET_GROUP_INVITE_ERROR=c;f.DatabaseState=d}),66);
__d("MAWGetWorkerStatusApi",["MAWLowLevelApiTypes","WAResultOrError","WATagsLogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Worker Status: ",""]);h=function(){return a};return a}var i=d("WATagsLogger").TAGS(["WorkerStatus"]),j="initializing",k="disconnected",l={},m=[];function n(){var a=d("WAResultOrError").makeResult({comms:k,databases:l,startup:j});i.LOG(h(),JSON.stringify(a));if(k==="disconnected")return d("WAResultOrError").makeError("comms_disconnected");var b=Object.values(l).some(function(a){a=a.status;return a===d("MAWLowLevelApiTypes").DatabaseState.Error||a===d("MAWLowLevelApiTypes").DatabaseState.Closed});if(b)return d("WAResultOrError").makeError("database_failure");b=Object.values(l).some(function(a){a=a.status;return a===d("MAWLowLevelApiTypes").DatabaseState.Upgrading});return b?d("WAResultOrError").makeError("database_upgrading"):a}function o(){var a=n();m.forEach(function(b){return b(a)})}function a(a){m.push(a);var b=n();a(b)}function b(a){k=a,o()}function c(a){j=a,o()}function e(a,b){l[a]=babelHelpers["extends"]({},l[a],{status:b}),o()}function f(a,b){l[a]=babelHelpers["extends"]({},l[a],{api:b}),o()}function p(a){return l[a]}g.getWorkerStatus=n;g.onWorkerStateChange=a;g.setCommsStatus=b;g.updateWorkerStatus=c;g.setDatabaseStatus=e;g.setDatabaseApi=f;g.getDatabaseMetadata=p}),98);
__d("MAWKeychainUtil",[],(function(a,b,c,d,e,f){function a(a){return self.crypto.getRandomValues(new Uint8Array(a))}function b(a){var b=a.reduce(function(a,b){return a+b.byteLength},0),c=new Uint8Array(b);a.reduce(function(a,b){c.set(new Uint8Array(b),a);return a+b.byteLength},0);return c.buffer}function c(a,b){return new Uint8Array([a,b]).buffer}function d(a){var b=a.length;if(b>0&&b%2===0&&/^[\da-f]+$/gi.test(a)){var c=[];for(var d=0,b=b/2;d<b;++d){var e=parseInt(a.substring(d*2,d*2+2),16);c.push(e)}return new Uint8Array(c)}else return null}f.getBufferWithRandomValuesFromLength=a;f.mergeBuffers=b;f.makeAAD=c;f.fromHexString=d}),66);
__d("MAWSubtleCrypto",[],(function(a,b,c,d,e,f){a=self.crypto;b=a&&(a.subtle||a.webkitSubtle||a.subtle);f.MAWSubtleCrypto=b}),66);
__d("MAWWebInitDataHelpers",["MessengerWebInitData","err"],(function(a,b,c,d,e,f,g){"use strict";function a(){return 2}function b(a){switch(a){case 2:return c("MessengerWebInitData").accountKeyV2;case 1:return c("MessengerWebInitData").accountKey;default:throw c("err")("Invalid format version, should never happen.")}}g.getLastAccountKeyFormatVersion=a;g.getAccountKeyString=b}),98);
__d("WABase64",["WACryptoDependencies","WAErr","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Found unexpected character code while decoding B64 at index ",", length ",": ",""]);h=function(){return a};return a}var i=43,j=47,k=61,l=45,m=95,n=3e3,o="data:image/jpeg;base64,",p=function(a){return typeof a==="string"&&/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(a)};function q(a){return r(a,i,j,!0)}function a(a,b){b===void 0&&(b=!1);return r(a,l,m,b)}function r(a,b,c,d){a=Array.isArray(a)||a instanceof ArrayBuffer?new Uint8Array(a):a;if(a.length<=n)return s(a,b,c,d);else{var e=[];for(var f=0;f<a.length;f+=n)e.push(s(a.subarray(f,f+n),b,c,d));return e.join("")}}function s(a,b,c,d){var e=Math.ceil(a.length*4/3),f=4*Math.ceil(a.length/3),g=new Array(f);for(var h=0,i=0;h<f;h+=4,i+=3){var j=a[i]<<16|a[i+1]<<8|a[i+2];g[h]=j>>18;g[h+1]=j>>12&63;g[h+2]=j>>6&63;g[h+3]=j&63}for(j=0;j<e;j++){a=g[j];a<26?g[j]=65+a:a<52?g[j]=71+a:a<62?g[j]=a-4:a===62?g[j]=b:g[j]=c}for(h=e;h<f;h++)g[h]=61;i=String.fromCharCode.apply(String,g);return d?i:i.substring(0,e)}function t(a,b,c,e){var f=a.length,g=new Int32Array(f+f%4);for(var i=0;i<f;i++){var j=a.charCodeAt(i);if(65<=j&&j<=90)g[i]=j-65;else if(97<=j&&j<=122)g[i]=j-71;else if(48<=j&&j<=57)g[i]=j+4;else if(j===b)g[i]=62;else if(j===c)g[i]=63;else if(j===e){f=i;break}else{self.ERROR!=null&&d("WALogger").ERROR(h(),i,f,j);return null}}j=g.length/4;for(b=0,c=0;b<j;b++,c+=4)g[b]=g[c]<<18|g[c+1]<<12|g[c+2]<<6|g[c+3];e=Math.floor(f*3/4);i=new Uint8Array(e);a=0;b=0;for(;b+3<=e;a++,b+=3){j=g[a];i[b]=j>>16;i[b+1]=j>>8&255;i[b+2]=j&255}switch(e-b){case 2:i[b]=g[a]>>16;i[b+1]=g[a]>>8&255;break;case 1:i[b]=g[a]>>16}return i}function b(a){a=t(a,i,j,k);if(a)return a.buffer;else throw c("WAErr")("Base64.decode given invalid string")}function e(a,b){b===void 0&&(b=!1);a=t(a,l,m,b?k:-1);if(a)return a.buffer;else throw c("WAErr")("Base64.decode given invalid string")}function f(a){a=a instanceof ArrayBuffer?new Uint8Array(a):t(a,i,j,k);return a&&Array.from(a)}function u(a){return Math.floor(a.length*3/4)}function v(a){a=new Uint8Array(a);d("WACryptoDependencies").getCrypto().getRandomValues(a);return q(a)}g.BASE64_DATA_URL_SCHEME=o;g.isBase64=p;g.encodeB64=q;g.encodeB64UrlSafe=a;g.decodeB64=b;g.decodeB64UrlSafe=e;g.decodeB64ToJsArray=f;g.sizeWhenB64Decoded=u;g.randomBase64=v}),98);
__d("MAWKeychainCrypto",["FBLogger","MAWCryptoConsts","MAWKeychainUtil","MAWSubtleCrypto","MAWWebInitDataHelpers","WABase64","asyncToGeneratorRuntime","err","memoizeOneWithArgs"],(function(a,b,c,d,e,f,g){"use strict";var h=d("MAWKeychainUtil").makeAAD(d("MAWCryptoConsts").VERSION,d("MAWCryptoConsts").CIPHER_ID);function a(a,b,e){var f=d("MAWKeychainUtil").getBufferWithRandomValuesFromLength(d("MAWCryptoConsts").AES_GCM_IV_LENGTH_IN_BYTES),g=e?e:h;return d("MAWSubtleCrypto").MAWSubtleCrypto.encrypt({additionalData:g,iv:new Uint8Array(f),name:d("MAWCryptoConsts").AES_GCM,tagLength:d("MAWCryptoConsts").AES_GCM_TAG_LENGTH},a,b).then(function(a){a=d("MAWKeychainUtil").mergeBuffers([g,f,a]);return d("WABase64").encodeB64(a)})["catch"](function(b){throw c("FBLogger")("maw_ear").catching(b).mustfixThrow("Failed to encryptDataToStringBuffer",typeof a,a.constructor.name)})}function e(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e,f=new Uint8Array(d("WABase64").decodeB64(b)),g=f.subarray(0,(e=d("MAWCryptoConsts")).ADDITIONAL_DATA_LENGTH_IN_BYTES),h=f.subarray(e.ADDITIONAL_DATA_LENGTH_IN_BYTES,e.AES_GCM_IV_LENGTH_IN_BYTES+e.ADDITIONAL_DATA_LENGTH_IN_BYTES);f=f.subarray(e.AES_GCM_IV_LENGTH_IN_BYTES+e.ADDITIONAL_DATA_LENGTH_IN_BYTES);try{e=(yield d("MAWSubtleCrypto").MAWSubtleCrypto.decrypt({additionalData:g,iv:h,name:d("MAWCryptoConsts").AES_GCM,tagLength:d("MAWCryptoConsts").AES_GCM_TAG_LENGTH},a,f));return e}catch(d){c("FBLogger")("maw_ear").catching(d).mustfix("Failed to decryptDataToArrayBuffer",a.constructor.name,b.length,String(d));throw d}});return i.apply(this,arguments)}function j(a){a=d("MAWWebInitDataHelpers").getAccountKeyString(a);var b=d("MAWKeychainUtil").fromHexString(a);if(b==null)throw c("err")("Invalid value for account key. Is empty="+String(a.length===0)+";");return b.buffer}function k(a){a=j(a);return d("MAWSubtleCrypto").MAWSubtleCrypto.importKey("raw",a,{name:d("MAWCryptoConsts").AES_GCM},!1,["encrypt","decrypt"])}function f(){return d("WABase64").encodeB64(d("MAWKeychainUtil").getBufferWithRandomValuesFromLength(d("MAWCryptoConsts").HKDF_SEED_LENGTH_IN_BYTES))}function l(a){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=d("WABase64").decodeB64(a);try{a=(yield d("MAWSubtleCrypto").MAWSubtleCrypto.importKey("raw",a,{name:d("MAWCryptoConsts").HKDF},!1,["deriveKey"]));return a}catch(a){c("FBLogger")("maw_ear").catching(a).mustfix("Failed to importBrowserEncryptionKey");throw a}});return m.apply(this,arguments)}function n(){return d("MAWKeychainUtil").getBufferWithRandomValuesFromLength(d("MAWCryptoConsts").HKDF_SEED_LENGTH_IN_BYTES)}function o(a,b){var e;return d("MAWSubtleCrypto").MAWSubtleCrypto.deriveKey({hash:{name:(e=d("MAWCryptoConsts")).SHA256},info:e.HKDF_INFO,name:e.HKDF,salt:b},a,{length:e.AES_GCM_KEY_LENGTH,name:e.AES_GCM},!0,["encrypt","decrypt"]).then(function(a){return d("MAWSubtleCrypto").MAWSubtleCrypto.exportKey("raw",a)})["catch"](function(a){c("FBLogger")("maw_ear").catching(a).mustfix("Failed to genDatabaseEncryptionKey");throw a})}function p(a){a=a.slice(0,d("MAWCryptoConsts").ADDITIONAL_DATA_LENGTH_IN_BYTES);return new DataView(a).getUint8(0)}function q(a){return p(a)}var r=c("memoizeOneWithArgs")(function(a){return k(a)});function s(a){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=d("WABase64").decodeB64(a);a=(yield d("MAWSubtleCrypto").MAWSubtleCrypto.digest(d("MAWCryptoConsts").SHA256,a));return d("WABase64").encodeB64(a)});return t.apply(this,arguments)}g.ADDITIONAL_DATA=h;g.encryptDataToStringBuffer=a;g.decryptDataToArrayBuffer=e;g.getAccountKeyBuffer=j;g.genAccountKey=k;g.genBrowserEncryptionKeyString=f;g.importBrowserEncryptionKey=l;g.genDatabaseEncryptionSeed=n;g.genDatabaseEncryptionKey=o;g.getKeyVersionFromCipherData=p;g.getKeyVersionFromCipherDataString=q;g.getAccountKey=r;g.generateHashString=s}),98);
__d("MAWKeychainNaClCrypto",["MAWCryptoConsts","MAWKeychainCrypto","WABase64","tweetnacl"],(function(a,b,c,d,e,f,g){"use strict";var h=function(b){babelHelpers.inheritsLoose(a,b);function a(a){var c;c=b.call(this,a)||this;c.name="EARError";c.message=a;return c}return a}(babelHelpers.wrapNativeSuper(Error));function i(a,b,c){c=c?c:d("MAWKeychainCrypto").ADDITIONAL_DATA;c=new Uint8Array(c);var e=d("tweetnacl").randomBytes(d("tweetnacl").secretbox.nonceLength);b=d("tweetnacl").secretbox(b,e,new Uint8Array(a));a=new Uint8Array(d("MAWCryptoConsts").ADDITIONAL_DATA_LENGTH_IN_BYTES+e.length+b.length);a.set(c);a.set(e,d("MAWCryptoConsts").ADDITIONAL_DATA_LENGTH_IN_BYTES);a.set(b,d("MAWCryptoConsts").ADDITIONAL_DATA_LENGTH_IN_BYTES+e.length);return a.buffer}function j(a,b,c){return d("WABase64").encodeB64(i(a,b,c))}function k(a,b,c){var e,f;b.slice(0,(e=d("MAWCryptoConsts")).ADDITIONAL_DATA_LENGTH_IN_BYTES);var g=b.slice(e.ADDITIONAL_DATA_LENGTH_IN_BYTES,e.ADDITIONAL_DATA_LENGTH_IN_BYTES+(f=d("tweetnacl")).secretbox.nonceLength);e=b.slice(e.ADDITIONAL_DATA_LENGTH_IN_BYTES+f.secretbox.nonceLength,e.ADDITIONAL_DATA_LENGTH_IN_BYTES+f.secretbox.nonceLength+4*Math.ceil(b.byteLength/3));b=f.secretbox.open(new Uint8Array(e),new Uint8Array(g),new Uint8Array(a));if(b==null){throw new h("decryptTweetNaCl was unable to decrypt an entity. Attempting to use key version : "+((f=c)!=null?f:"non-provided")+".")}return b}function l(a,b,c){return k(a,d("WABase64").decodeB64(b),c)}function a(a,b,c){return j(a,b,c)}function b(a,b,c){return l(a,b,c)}function c(a,b,c){return k(a,b,c)}g.EARDecryptionError=h;g.encryptTweetNaClArrayBuffer=i;g.encryptTweetNaCl=j;g.decryptTweetNaClArrayBuffer=k;g.decryptTweetNaCl=l;g.encrypt=a;g.decrypt=b;g.decryptArrayBuffer=c}),98);
__d("MWLSIndexedDBName",["MAWCurrentUser","MWLSDatabaseNames"],(function(a,b,c,d,e,f,g){"use strict";function a(){var a=d("MAWCurrentUser").getID();return d("MWLSDatabaseNames").lightspeedPrefix+a}g.dbName=a}),98);
__d("MAWRestoreDbState",["Deferred","FBLogger","MAWCurrentUser","MAWGetWorkerStatusApi","MAWIndexedDbMetadata","MWLSIndexedDBName","gkx","qex"],(function(a,b,c,d,e,f,g){"use strict";var h=null,i=!1,j=new(c("Deferred"))();function a(){j.isSettled()||c("FBLogger")("messenger_e2ee_web").mustfix("isUsingShim called before db initted");return i}function b(){return!j.isSettled()?void 0:i}function e(){return j.getPromise().then(function(){return i})}function k(){var a=d("MAWCurrentUser").getID();a=c("qex")._("1210")?d("MWLSIndexedDBName").dbName():d("MAWIndexedDbMetadata").restoreDbName2(a);d("MAWGetWorkerStatusApi").setDatabaseApi(a,"shim")}function f(a){i=a,k(),j.resolve()}function l(a){if(!c("gkx")("1159"))return;if(a==null){h=null;return}h=a}function m(){return!c("gkx")("1159")?null:h}g.isUsingShim_UNSAFE=a;g.isUsingShim_LOGGING_ONLY=b;g.isUsingShim=e;g.setIsUsingShim=f;g.setTargetDbState=l;g.getTargetDbState=m}),98);
__d("MAWQplProxy",["ExecutionEnvironment","MAWBridge","MAWRestoreDbState","MAWSendQplToServer","QPLEvent","asyncToGeneratorRuntime","gkx","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=(h=c("gkx")("23949"))!=null?h:!1,l=new Set([25313175,25310776,1056839232,1056840931,521485625,521480745,521478596,521479468,521485815,521476165]),m=0;function n(){return Date.now()}function o(a,b,c,e){var f;e===void 0&&(e=!0);f=(f=c==null?void 0:c.timestamp)!=null?f:n();d("MAWBridge").getBridge().fireAndForget("event","qplEvent",{action:{name:b,type:"point"},annotations:c==null?void 0:c.annotations,event:a,instanceKey:c==null?void 0:c.instanceKey,timestamp:e?f:void 0},!0)}function a(a,b,c,e){var f;d("MAWBridge").getBridge().fireAndForget("event","qplEvent",{action:{type:"annotations"},annotations:{bool:(f={},f[b]=c,f)},event:a,instanceKey:e},!0)}function e(a,b,c,e){var f;d("MAWBridge").getBridge().fireAndForget("event","qplEvent",{action:{type:"annotations"},annotations:{string:(f={},f[b]=c,f)},event:a,instanceKey:e},!0)}function f(a,b,c,e){var f;d("MAWBridge").getBridge().fireAndForget("event","qplEvent",{action:{type:"annotations"},annotations:{"int":(f={},f[b]=c,f)},event:a,instanceKey:e},!0)}function p(a,b,c){d("MAWBridge").getBridge().fireAndForget("event","qplEvent",{action:{type:"annotations"},annotations:{"double":b},event:a,instanceKey:c},!0)}function q(a,b,c){d("MAWBridge").getBridge().fireAndForget("event","qplEvent",{action:{type:"annotations"},annotations:b,event:a,instanceKey:c},!0)}function r(a,b,c,e){var f=n();d("MAWBridge").getBridge().fireAndForget("event","qplEvent",{action:{name:b,type:"failure"},annotations:c,event:a,instanceKey:e,timestamp:f},!0)}function s(a,b,c,e){e===void 0&&(e=!0);var f=n();d("MAWBridge").getBridge().fireAndForget("event","qplEvent",{action:{type:"success"},annotations:b,event:a,instanceKey:c,timestamp:e?f:void 0},!0)}function t(a,b,c){var e=n();d("MAWBridge").getBridge().fireAndForget("event","qplEvent",{action:{type:"cancel"},annotations:b,event:a,instanceKey:c,timestamp:e},!0)}function u(a,b,c){d("MAWBridge").getBridge().fireAndForget("event","qplEvent",{action:{name:b,type:"error"},debugInfo:c==null?void 0:c.debugInfo,error:c==null?void 0:c.error,event:a,instanceKey:c==null?void 0:c.instanceKey},!0)}function v(a,b,c,d,e){return w.apply(this,arguments)}function w(){w=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,d,e){o(a,b+"_start",{annotations:d,instanceKey:e});d=(yield c());o(a,b+"_end",{instanceKey:e});return d});return w.apply(this,arguments)}function x(a,b,e,f,g){g===void 0&&(g=!0);e==null&&m++;var h=(e=e)!=null?e:m;f=(e=f)!=null?e:c("justknobx")._("2596");if(!(j||(j=c("ExecutionEnvironment"))).isInWorker||!y(a))return d("MAWSendQplToServer").startQplUserFlow(a,b,h,f);e=n();d("MAWBridge").getBridge().fireAndForget("event","qplEvent",{action:{type:"start"},annotations:b!=null?babelHelpers["extends"]({},b,{bool:babelHelpers["extends"]({},b.bool,{isUsingShim:d("MAWRestoreDbState").isUsingShim_LOGGING_ONLY()})}):{bool:{isUsingShim:d("MAWRestoreDbState").isUsingShim_LOGGING_ONLY()}},event:a,instanceKey:h,timeoutInMs:f,timestamp:g?e:void 0},!0);return{addAnnotations:function(b){return q(a,b,h)},addPoint:function(b,c){return o(a,b,{annotations:c,instanceKey:h})},endCancel:function(b){return t(a,b,h)},endFail:function(b,c){return r(a,b,c,h)},endSuccess:function(b){return s(a,b,h)},markError:function(b,c,d){return u(a,b,{debugInfo:c,error:d,instanceKey:h})},startTime:e}}function y(a){return k||l.has((i||(i=d("QPLEvent"))).getMarkerId(a))}g.performanceAbsoluteNow=n;g.sendQplPointThroughBridge=o;g.sendQPLBoolAnnotationThroughBridge=a;g.sendQPLStringAnnotationThroughBridge=e;g.sendQPLIntAnnotationThroughBridge=f;g.sendQPLDoubleAnnotationsThroughBridge=p;g.sendQPLAnnotationsThroughBridge=q;g.sendQPLFailThroughBridge=r;g.sendQPLSuccessThroughBridge=s;g.sendQPLCancelThroughBridge=t;g.sendQPLErrorThroughBridge=u;g.measurePerfInQPL=v;g.startQplUserFlow=x}),98);
__d("MAWSendQplToServer",["ExecutionEnvironment","MAWEBSwitch","MAWQplProxy","MAWRestoreDbState","QPLUserFlow","WAExceededStorageQuota","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,e,f){var g=d("MAWQplProxy").performanceAbsoluteNow();c("QPLUserFlow").start(a,{annotations:babelHelpers["extends"]({},b||{},{bool:babelHelpers["extends"]({},(b==null?void 0:b.bool)||{},{is_eb_enabled:c("MAWEBSwitch").isEnabled(),isDev:0,isFromUIThread:(h||(h=c("ExecutionEnvironment"))).isInMainThread,isGifSearchEnbled:!0,isUsingShim:d("MAWRestoreDbState").isUsingShim_LOGGING_ONLY(),processAcksInOneQueue:c("gkx")("23955"),useSharedWorker:"SharedWorkerGlobalScope"in self&&self instanceof self.SharedWorkerGlobalScope})}),instanceKey:e,timeoutInMs:f,timestamp:g});return{addAnnotations:function(b){c("QPLUserFlow").addAnnotations(a,b,{instanceKey:e})},addPoint:function(b,f){var g=d("MAWQplProxy").performanceAbsoluteNow();f&&c("QPLUserFlow").addAnnotations(a,f,{instanceKey:e});c("QPLUserFlow").addPoint(a,b,{instanceKey:e,timestamp:g})},endCancel:function(b){var f,g=d("MAWQplProxy").performanceAbsoluteNow();c("QPLUserFlow").addAnnotations(a,babelHelpers["extends"]({},b,{bool:babelHelpers["extends"]({},b==null?void 0:b.bool,{exceededStorageQuota:d("WAExceededStorageQuota").getExceededStorageQuota(),isRelaxedDurability:!0}),string:babelHelpers["extends"]({},b==null?void 0:b.string,{threadID:b==null?void 0:(f=b.string)==null?void 0:f.jid})}),{instanceKey:e});c("QPLUserFlow").endCancel(a,{annotations:b,instanceKey:e,timestamp:g})},endFail:function(b,f){var g,h=d("MAWQplProxy").performanceAbsoluteNow();c("QPLUserFlow").addAnnotations(a,babelHelpers["extends"]({},f,{bool:babelHelpers["extends"]({},f==null?void 0:f.bool,{exceededStorageQuota:d("WAExceededStorageQuota").getExceededStorageQuota(),isRelaxedDurability:!0}),string:babelHelpers["extends"]({},f==null?void 0:f.string,{threadID:f==null?void 0:(g=f.string)==null?void 0:g.jid})}),{instanceKey:e});c("QPLUserFlow").endFailure(a,b,{annotations:f,instanceKey:e,timestamp:h})},endSuccess:function(b){var f=d("MAWQplProxy").performanceAbsoluteNow();c("QPLUserFlow").addAnnotations(a,{bool:{exceededStorageQuota:d("WAExceededStorageQuota").getExceededStorageQuota(),isRelaxedDurability:!0}},{instanceKey:e});c("QPLUserFlow").endSuccess(a,{annotations:b,instanceKey:e,timestamp:f})},markError:function(b,d,f){return c("QPLUserFlow").markError(a,b,{debugInfo:d,error:f,instanceKey:e})},startTime:g}}g.startQplUserFlow=a}),98);
__d("MAWUnrecoverableDbErrors",[],(function(a,b,c,d,e,f){"use strict";var g=function(b){babelHelpers.inheritsLoose(a,b);function a(){return b.apply(this,arguments)||this}return a}(babelHelpers.wrapNativeSuper(Error));e=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(b=c=a.call.apply(a,[this].concat(e))||this,c.name="indexed_db_access_error",b)||babelHelpers.assertThisInitialized(c)}return b}(g);var h=function(b){babelHelpers.inheritsLoose(a,b);function a(){var a,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(a=c=b.call.apply(b,[this].concat(e))||this,c.name="ear_init_error",a)||babelHelpers.assertThisInitialized(c)}return a}(g),i=function(b){babelHelpers.inheritsLoose(a,b);function a(){var a,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(a=c=b.call.apply(b,[this].concat(e))||this,c.name="ebsm_hydration_error",a)||babelHelpers.assertThisInitialized(c)}return a}(g),j=function(b){babelHelpers.inheritsLoose(a,b);function a(){var a,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(a=c=b.call.apply(b,[this].concat(e))||this,c.name="wa_exceeded_storage_quota_error",a)||babelHelpers.assertThisInitialized(c)}return a}(g),k=null,l=new Set();function a(){return k}function b(a){k=a,l.forEach(function(b){return b(a)})}function c(a){return a==null?!1:a instanceof g}function d(a){l.add(a);return function(){return l["delete"](a)}}f.UnrecoverableDbError=g;f.IndexedDbAccessError=e;f.EarInitError=h;f.EbsmHydrationError=i;f.WAExceededStorageQuotaError=j;f.getError=a;f.setError=b;f.isUnrecoverableDbError=c;f.subscribe=d}),66);
__d("WAArrayBufferUtils",["Promise","WAErr"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){var b=new ArrayBuffer(a.length);b=new Uint8Array(b);var c,d;for(c=0,d=a.length;c<d;c++)b[c]=a.charCodeAt(c);return b.buffer}function d(a,c){c===void 0&&(c=5e5);return new(h||(h=b("Promise")))(function(b,d){var e=a.length,f=new ArrayBuffer(e),g=new Uint8Array(f),h=0;setTimeout(i,0);function i(){var d=Math.min(h+c,e);while(h<d)g[h]=a.charCodeAt(h),h++;if(h===e){b(f);return}setTimeout(i,16)}})}function e(a){return String.fromCharCode.apply(null,new Uint8Array(a))}var i=8388607;function f(a,b){a=new Uint8Array(a);if(b>i)throw c("WAErr")("Divisor is too big");var d=0;for(var e=0;e<a.length;++e)d=((d<<8)+a[e])%b;return d}function j(a){a=a.map(function(a){return new Uint8Array(a)});var b=a.reduce(function(a,b){return a+b.byteLength},0),c=new Uint8Array(b);a.reduce(function(a,b){c.set(b,a);return a+b.byteLength},0);return c.buffer.slice(c.byteOffset,c.byteOffset+c.byteLength)}function k(a,b){a=new Uint8Array(a);b=new Uint8Array(b);return l(a,b)}function l(a,b){if(a.byteLength!==b.byteLength)return!1;for(var c=0;c!==a.byteLength;c++)if(a[c]!==b[c])return!1;return!0}g.stringToArrayBuffer=a;g.largeStringToArrayBuffer=d;g.arrayBufferToString=e;g.arrayBufferMod=f;g.concatBuffers=j;g.arrayBuffersEqualUNSAFE=k;g.uint8ArraysEqualUNSAFE=l}),98);
__d("MAWVaultMaterials",["FBLogger","WAArrayBufferUtils","randomInt","tweetnacl"],(function(a,b,c,d,e,f,g){"use strict";var h=null,i=null,j=null;function k(a){i=a}function l(){return h}function m(a){h=a}function a(){h=null,i=null}function n(){return p()!=null&&l()!=null}function b(){return j}function o(){var a=1e9,b=9999999999;return c("randomInt")(a,b)+"##"+c("randomInt")(a,b)}function p(){return i}function q(){if(!n())throw c("FBLogger")("maw_ear").mustfixThrow("Vault materials are null");return{encryptionKey:h,prefixAndSuffix:i}}function e(a,b){var e=n();c("FBLogger")("maw_ear").debug("Setting vault materials -- vaultMaterials=%s, previouslySetup=%s",Boolean(a).toString(),e);if(!e){r((e=a)!=null?e:{encryptionKey:d("tweetnacl").randomBytes(32).buffer,prefixAndSuffix:o()});j=(e=b)!=null?e:a!=null?"existing":"newly-generated"}return q()}function r(a){var b=a.encryptionKey;a=a.prefixAndSuffix;if(b==null||a==null)throw c("FBLogger")("maw_ear").mustfixThrow("Cannot set null values for encryption key and prefix");m(b);k(a)}function f(){return s(q())}function s(a){var b=a.encryptionKey;a=a.prefixAndSuffix;if(a!=null&&b!=null){b=d("WAArrayBufferUtils").arrayBufferToString(b);return JSON.stringify({encryptionKey:b,prefixAndSuffix:a})}else return""}function t(a){if(a==="")return null;else{a=JSON.parse(a);if(a.encryptionKey==null||a.prefixAndSuffix==null)throw c("FBLogger")("maw_ear").mustfixThrow("Vault materials were not in correct format");var b=d("WAArrayBufferUtils").stringToArrayBuffer(a.encryptionKey);a=a.prefixAndSuffix;return{encryptionKey:b,prefixAndSuffix:a}}}g.TEST_ONLY_clearVaultMaterials=a;g.hasVaultBeenSetup=n;g.getVaultMaterialsSource=b;g.getVaultPrefixAndSuffix=p;g.getVaultMaterials=q;g.initializeVaultMaterials=e;g.materialsToString=f;g.fromMaterialsToString=s;g.fromStringToMaterials=t}),98);
__d("MAWVaultMaterialsStorageStatus",[],(function(a,b,c,d,e,f){"use strict";var g=!1;function a(){return g}function b(){g=!0}f.isCurrentContextHoldingLock=a;f.setIsCurrentContextHoldingLock=b}),66);
__d("MAWVault",["ExecutionEnvironment","FBLogger","MAWKeychainNaClCrypto","MAWVaultMaterials","MAWVaultMaterialsStorageStatus","gkx","hasMultipleTabs","promiseDone","shouldUseMAWSharedWorker"],(function(a,b,c,d,e,f,g){"use strict";var h,i=new Map(),j=new Map();function k(a){return new RegExp("^[0-9]{10}##[0-9]{10}.*[0-9]{10}##[0-9]{10}$").test(a)}function l(a){if(!c("gkx")("23909"))return!1;var b=d("MAWVaultMaterials").getVaultPrefixAndSuffix();b=b==null?!1:new RegExp(b+".*"+b).test(a);return b}function m(a,b){b===void 0&&(b=!1);if(!c("gkx")("23909"))return a;if(l(a)){var e=d("MAWVaultMaterials").getVaultMaterials(),f=e.encryptionKey;e=e.prefixAndSuffix;if(e==null)throw c("FBLogger")("maw_ear").mustfixThrow("Vault prefix and suffix should not be null when unvaulting");var g=new RegExp(e+"(.*)"+e);g=a.match(g);if(g==null||g.length!=2)throw c("FBLogger")("maw_ear").mustfixThrow("Could not retrieve inner value to unvault");if(f==null)throw c("FBLogger")("maw_ear").mustfixThrow("Vault encryption key was null before unvault");g=g[1];e=""+e+g+e;var i=o(f,g);return a.replace(e,function(){return i})}if(k(a))if(b)throw c("FBLogger")("maw_ear").mustfixThrow("Encountered vaulted value with incorrect key.");else c("promiseDone")(d("hasMultipleTabs").hasMultipleTabs().then(function(a){c("FBLogger")("maw_ear").mustfix("Encountered vaulted value with incorrect key. Vault material source: %s, environment: %s, hasMultipleTabs: %s, isSharedWorker: %s, isCurrentContextHoldingLock: %s",d("MAWVaultMaterials").getVaultMaterialsSource(),(h||(h=c("ExecutionEnvironment"))).isInMainThread?"main":"worker",a==null?"unknown_multi_tab":a?"multi_tab":"single_tab",d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker()?"shared_worker":"dedicated_worker",d("MAWVaultMaterialsStorageStatus").isCurrentContextHoldingLock()?"holding_lock":"not_holding_lock")}));return a}function a(a){if(a==="")return a;if(!c("gkx")("23909"))return a;if(!d("MAWVaultMaterials").hasVaultBeenSetup()){c("FBLogger")("maw_ear").mustfix("Attempted to vault value while materials were not setup");return a}if(l(a)){c("FBLogger")("maw_ear").warn("Attempted to vault value that's already been vaulted");return a}k(a)&&c("FBLogger")("maw_ear").mustfix("Attempted to vault value that's already been vaulted with a different key");var b=d("MAWVaultMaterials").getVaultMaterials(),e=b.encryptionKey;b=b.prefixAndSuffix;if(b==null||e==null)throw c("FBLogger")("maw_ear").mustfixThrow("Cannot vault before vault materials are set");e=n(e,a);return""+b+e+b}function b(a){if(!c("gkx")("23909"))return a;if(!l(a))throw c("FBLogger")("maw_ear").mustfixThrow("Value should be vaulted");return m(a)}function n(a,b){var c=i==null?void 0:i.get(b);if(c!=null)return c;c=new TextEncoder().encode(b).buffer;a=d("MAWKeychainNaClCrypto").encryptTweetNaCl(a,new Uint8Array(c));i==null?void 0:i.set(b,a);j==null?void 0:j.set(a,b);return a}function o(a,b){var c=j==null?void 0:j.get(b);if(c!=null)return c;c=new TextDecoder().decode(d("MAWKeychainNaClCrypto").decryptTweetNaCl(a,b));i==null?void 0:i.set(c,b);j==null?void 0:j.set(b,c);return c}g.isVaulted=l;g.unvault=m;g.vault=a;g.unvaultOrThrow=b}),98);
__d("isObject",[],(function(a,b,c,d,e,f){function a(a){var b=typeof a;return b==="function"||b==="object"&&!!a}f["default"]=a}),66);
__d("isPlainObject",[],(function(a,b,c,d,e,f){"use strict";function a(a){return Object.prototype.toString.call(a)==="[object Object]"}f["default"]=a}),66);
__d("MAWVaultDb",["MAWQplProxy","MAWVault","err","gkx","isObject","isPlainObject","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h=1/1e3,i=new WeakMap();function j(a,b){return b[a]!=null}function a(a,b,e){if(!c("isPlainObject")(a)||!c("gkx")("23909")||!j(b,e)||a==null)return a;var f=i.get(a);if(f!=null)return f;f=Math.random()<h?d("MAWQplProxy").startQplUserFlow(c("qpl")._(25301509,"119")):null;try{e=e[b];e=k(a,e,d("MAWVault").vault);f==null?void 0:f.endSuccess();i.set(a,e);return e}catch(a){f==null?void 0:f.endFail("vault_fail");throw c("err")(a.message+" - Failed to vault an entity in the table: "+b)}}function b(a,b,e){if(!c("isPlainObject")(a)||!c("gkx")("23909")||!j(b,e)||a==null)return a;var f=Math.random()<h?d("MAWQplProxy").startQplUserFlow(c("qpl")._(741087294,"2028")):null;try{a=k(a,e[b],d("MAWVault").unvault);f==null?void 0:f.endSuccess();return a}catch(a){f==null?void 0:f.endFail("unvault_fail");throw c("err")(a.message+" - Unvaulting failed for an entity in the table: "+b)}}function k(a,b,d){if(a==null)return a;b=Object.entries(b).filter(function(b){b=b[0];return a[b]!=null});return b.length===0?a:b.reduce(function(a,b){var e=b[0];b=b[1];typeof b!=="boolean"&&c("isObject")(b)?a[e]=k(a[e],b,d):b===!0&&(a[e]=d(a[e]));return a},babelHelpers["extends"]({},a))}g.vaultDbRow=a;g.unvaultDbRow=b;g.setInPath=k}),98);
__d("MAWVaultDefinitions",[],(function(a,b,c,d,e,f){"use strict";a={editMsgHistory:{msgContent:{content:!0}},messages:{msgContent:{content:!0},quote:{content:{msgContent:{content:!0}}}},unrenderedMessages:{msgContent:!0}};b={edit_message_history:{messageContent:!0},messages:{replyMessageText:!0,text:!0},threads:{snippet:!0}};f.ARMADILLO_IDB_VAULT_DEFINITIONS=a;f.PERSISTED_DB_VAULT_DEFINITIONS=b}),66);
__d("getMWEncryptedBackupsIsLocalStorageSupported",["FBLogger","WebStorage"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(){if((h||(h=c("WebStorage"))).getLocalStorage()==null){c("FBLogger")("labyrinth_web").warn("Local storage not supported");return!1}if((h||(h=c("WebStorage"))).isLocalStorageQuotaExceeded()){c("FBLogger")("labyrinth_web").warn("Local storage quota exceeded");return!1}return!0}g.getMWEncryptedBackupsIsLocalStorageSupported=a}),98);
__d("MWEBUseLocalStorage",["WALogger","WebStorage","getMWEncryptedBackupsIsLocalStorageSupported"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Encrypted Backups key "," written to local storage"]);i=function(){return a};return a}function a(a,b){a=a;b=(b=b)!=null?b:"true";if(d("getMWEncryptedBackupsIsLocalStorageSupported").getMWEncryptedBackupsIsLocalStorageSupported()){var e;d("WALogger").LOG(i(),a);(e=(h||(h=c("WebStorage"))).getLocalStorage())==null?void 0:e.setItem(a,b)}}function b(a){a=a;if(d("getMWEncryptedBackupsIsLocalStorageSupported").getMWEncryptedBackupsIsLocalStorageSupported()){var b;(b=(h||(h=c("WebStorage"))).getLocalStorage())==null?void 0:b.removeItem(a)}}function e(a){if(d("getMWEncryptedBackupsIsLocalStorageSupported").getMWEncryptedBackupsIsLocalStorageSupported()){var b;a=a;return(b=(h||(h=c("WebStorage"))).getLocalStorageForRead())==null?void 0:b.getItem(a)}return null}function f(a){if(d("getMWEncryptedBackupsIsLocalStorageSupported").getMWEncryptedBackupsIsLocalStorageSupported()){var b;a=a;return((b=(h||(h=c("WebStorage"))).getLocalStorageForRead())==null?void 0:b.getItem(a))!=null}return!0}g.mwEBCreateLocalStorageEntry=a;g.mwEBDeleteLocalStorageEntry=b;g.mwEBGetLocalStorageEntryValue=e;g.mwEBGetIsLocalStorageEntryValuePresent=f}),98);
__d("MWEncryptedBackupsLocalStorageEntryEnum",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum")({INTERSTITIAL_DIALOG_VERIFY_DEVICE_NUX_DISMISSED:"maw_eb_interstitial_dialog_verify_device_nux_dismissed",VERIFY_DEVICE_NUX_DISMISSED:"maw_eb_verify_device_in_thread_nux_dismissed",ENCRYPTED_BACKUPS_OPT_OUT:"maw_encrypted_backups_opt_out",MW_ENCRYPTED_BACKUPS_USER_CLICKED_ON_SETTINGS:"mw_encrypted_backups_user_clicked_on_settings",MW_ENCRYPTED_BACKUPS_HIGH_FRICTION_RESTORE_DISMISSED:"mw_encrypted_backups_high_friction_restore__dismissed",ENCRYPTED_BACKUPS_TURN_OFF_SECURE_STORAGE:"mw_encrypted_backups_turn_off_secure_storage",ENCRYPTED_BACKUPS_REMEMBER_BROWSER_CONSENT:"mw_encrypted_backups_remember_browser_consent",ENCRYPTED_BACKUPS_RESTORED_SUCCESSFULLY:"maw_eb_restored_successfully",MW_EB_SHOULD_NOT_DISPLAY_SOFTBLOCK:"mw_eb_should_not_display_softblock",MW_EB_HAS_RESTORED_IN_CURRENT_SESSION:"maw_eb_has_restored_in_current_session",MW_EB_HAS_RESTORED_IN_CURRENT_SESSION_2:"maw_eb_has_restored_in_current_session_temp",ENCRYPTED_BACKUPS_ONBOARDED_SUCCESSFULLY:"maw_eb_onboarded_successfully",EB_ONBOARDING_DEFER_UPSELL_UNTIL_TIME:"mw_eb_onboarding_defer_upsell_until_time",EB_ONBOARDING_QP_DISMISSED:"mw_eb_onboarding_qp_dismissed",EB_MOBILE_ONBOARDING_QP_DISMISSED:"mw_eb_mobile_onboarding_qp_dismissed",EBSM_CORRUPTION_WIPE:"ebsm_corruption_wipe",MW_EB_HAS_OPTED_OUT_OF_AUTO_RESTORE:"mw_eb_has_opted_out_of_auto_restore"});c=a;f["default"]=c}),66);
__d("ReStoreDbClosedError",["ClientConsistencyEventEmitter","MAWCurrentUser"],(function(a,b,c,d,e,f,g){"use strict";var h="ReStore DB closed";a=function(a){babelHelpers.inheritsLoose(b,a);function b(b){var e;b=(b=b)!=null?b:h;e=a.call(this,b)||this;e.message=b;switch(d("MAWCurrentUser").getAppID()){case 772021112871879:c("ClientConsistencyEventEmitter").emit("hardRefresh","ls_forced_refresh");break;default:c("ClientConsistencyEventEmitter").emit("softRefresh","ls_forced_refresh")}return e}return b}(babelHelpers.wrapNativeSuper(Error));g["default"]=a}),98);
__d("ReStoreLocalStorageQuotaExceed",["FBLogger","recoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";var h="Failed to execute 'setItem' on 'Storage'",i="ReStoreLocalStorageQuotaExceed";function j(){try{var a=window.localStorage,b=[],d=[];if(a!=null&&a.length!==0)for(var e in a){b.length===0&&d.length===0&&(e.includes("falco_queue_log")&&d.push(e));if(!Object.prototype.hasOwnProperty.call(a,e))continue;var f=((a[e]||"").length+e.length)*2;f/1024>2e3&&b.push(e)}c("FBLogger")("maw_db").mustfix(h+": QuotaExceeded - trying to clean up %s or %s",b.join(","),d.join(","));return b.length!==0?b:d}catch(a){c("FBLogger")("maw_db").mustfix("Error getting local storage big values for cleanup.");return[]}}function a(){try{var a=window.localStorage,b=j();b.forEach(function(b){a.removeItem(b)})}catch(a){c("recoverableViolation")("Couldn't remove vals from localStorage","maw_db",a)}}b=function(a){babelHelpers.inheritsLoose(b,a);function b(b){var c;b=h+": "+b+"; Keys to delete: "+j().join(",");c=a.call(this,b)||this;c.message=b;c.name=i;return c}return b}(babelHelpers.wrapNativeSuper(Error));g.ERROR_NAME=i;g.getLocalStorageValuesToRemoveOnExceed=j;g.clearLocalStorageBigValues=a;g.ReStoreLocalStorageQuotaExceed=b}),98);
__d("ReStoreVaulting",["cr:2075","cr:2151","cr:2203"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return b("cr:2075")!=null?b("cr:2075").vault(a):a}function c(a){return b("cr:2075")!=null?b("cr:2075").unvault(a):a}function d(a,c){return b("cr:2151")!=null&&b("cr:2203")!=null?b("cr:2151").unvaultDbRow(a,c,b("cr:2203").PERSISTED_DB_VAULT_DEFINITIONS):a}function e(a,c){return b("cr:2151")!=null&&b("cr:2203")!=null?b("cr:2151").vaultDbRow(a,c,b("cr:2203").PERSISTED_DB_VAULT_DEFINITIONS):a}g.maybeVault=a;g.maybeUnvault=c;g.maybeUnvaultDbRow=d;g.maybeVaultDbRow=e}),98);
__d("SortedAsyncIterable",["PromiseAnnotate","PromiseOrValue","ReQLGlobalQueryContext","isPromise"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;function l(a){var b;if((i||(i=d("ReQLGlobalQueryContext"))).globalQueryContext.contents==null){var c=new WeakMap();(i||(i=d("ReQLGlobalQueryContext"))).globalQueryContext.contents=c;return c}c=(i||(i=d("ReQLGlobalQueryContext"))).globalQueryContext.contents;(b=(i||(i=d("ReQLGlobalQueryContext"))).getDependencies(c))==null?void 0:b.push(a);return c}function a(a){var b=[],e=a.iterator(l(a)),f=(k||(k=d("PromiseOrValue"))).loop(function(){return(k||(k=d("PromiseOrValue"))).map(e.next(),function(a){if(a.done)return{action:"break",value:b};b.push(a.value);return{action:"continue",value:void 0}})});return(h||(h=c("isPromise")))(f)?(j||(j=d("PromiseAnnotate"))).setDisplayName(f,"ReQL"+(a.uniqueId!=null?"_"+a.uniqueId:"")):f}g.getOrCreateContext=l;g.toArray=a}),98);
__d("isArmadillo",["qex"],(function(a,b,c,d,e,f,g){"use strict";function a(){return c("qex")._("135")===!0}g["default"]=a}),98);